exports.id=451,exports.ids=[451],exports.modules={58359:()=>{},93739:()=>{},87287:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var a=r(17577);let s=()=>((0,a.useEffect)(()=>{setTimeout(()=>{["vibecarding.com","fonts.googleapis.com","fonts.gstatic.com"].forEach(e=>{let t=document.createElement("link");t.rel="dns-prefetch",t.href=`//${e}`,document.head.appendChild(t)});let e=document.createElement("link");e.rel="preconnect",e.href="https://vibecarding.com",e.crossOrigin="anonymous",document.head.appendChild(e);let t=document.createElement("link");if(t.rel="prefetch",t.href="https://vibecarding.com/api/cards/list?page=1&per_page=40&template_mode=true",t.as="fetch",t.crossOrigin="anonymous",document.head.appendChild(t),"connection"in navigator)try{navigator.connection?.addEventListener?.("change",()=>{let e=navigator.connection;(e?.effectiveType==="4g"||e?.downlink>1.5)&&console.log("\uD83D\uDE80 Good connection detected, enabling aggressive preloading")})}catch(e){}},0)},[]),null)},52466:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(17577),s=r(29753);let i=()=>{let{preloadAllCards:e}=(0,s.r)();return(0,a.useEffect)(()=>{(async()=>{try{await e()}catch(e){console.warn("Early preload failed:",e)}})()},[e]),null}},60097:(e,t,r)=>{"use strict";r.d(t,{$F:()=>m,AW:()=>u,Ju:()=>h,VD:()=>p,Xi:()=>g,h_:()=>c});var a=r(10326),s=r(17577),i=r(79313),l=r(39183),n=r(32933),o=r(53982),d=r(77863);let c=i.fC,m=i.xz;i.ZA,i.Uv,i.Tr,i.Ee,s.forwardRef(({className:e,inset:t,children:r,...s},n)=>(0,a.jsxs)(i.fF,{ref:n,className:(0,d.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...s,children:[r,a.jsx(l.Z,{className:"ml-auto"})]})).displayName=i.fF.displayName,s.forwardRef(({className:e,...t},r)=>a.jsx(i.tu,{ref:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...t})).displayName=i.tu.displayName;let u=s.forwardRef(({className:e,sideOffset:t=4,...r},s)=>a.jsx(i.Uv,{children:a.jsx(i.VY,{ref:s,sideOffset:t,className:(0,d.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...r})}));u.displayName=i.VY.displayName;let g=s.forwardRef(({className:e,inset:t,...r},s)=>a.jsx(i.ck,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",e),...r}));g.displayName=i.ck.displayName,s.forwardRef(({className:e,children:t,checked:r,...s},l)=>(0,a.jsxs)(i.oC,{ref:l,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...s,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(i.wU,{children:a.jsx(n.Z,{className:"h-4 w-4"})})}),t]})).displayName=i.oC.displayName,s.forwardRef(({className:e,children:t,...r},s)=>(0,a.jsxs)(i.Rk,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(i.wU,{children:a.jsx(o.Z,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=i.Rk.displayName;let h=s.forwardRef(({className:e,inset:t,...r},s)=>a.jsx(i.__,{ref:s,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));h.displayName=i.__.displayName;let p=s.forwardRef(({className:e,...t},r)=>a.jsx(i.Z0,{ref:r,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",e),...t}));p.displayName=i.Z0.displayName},65685:(e,t,r)=>{"use strict";r.d(t,{x:()=>n});var a=r(10326),s=r(17577),i=r(16999),l=r(77863);let n=s.forwardRef(({className:e,children:t,...r},s)=>(0,a.jsxs)(i.fC,{ref:s,className:(0,l.cn)("relative overflow-hidden",e),...r,children:[a.jsx(i.l_,{className:"h-full w-full rounded-[inherit]",children:t}),a.jsx(o,{}),a.jsx(i.Ns,{})]}));n.displayName=i.fC.displayName;let o=s.forwardRef(({className:e,orientation:t="vertical",...r},s)=>a.jsx(i.gb,{ref:s,orientation:t,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:a.jsx(i.q4,{className:"relative flex-1 rounded-full bg-border"})}));o.displayName=i.gb.displayName},65304:(e,t,r)=>{"use strict";r.d(t,{O:()=>i});var a=r(10326),s=r(77863);function i({className:e,...t}){return a.jsx("div",{className:(0,s.cn)("animate-pulse rounded-md bg-primary/10",e),...t})}},38274:(e,t,r)=>{"use strict";r.d(t,{Z:()=>e1});var a=r(10326),s=r(17577),i=r.n(s),l=r(33071),n=r(90772),o=r(70717),d=r(48998),c=r(30361),m=r(85999),u=r(32933);function g({steps:e,currentStep:t,completedSteps:r,onStepClick:s}){return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 mb-6",children:[a.jsx("div",{className:"hidden md:flex items-center justify-between",children:e.map((l,n)=>{let o=n+1,d=r.includes(o),c=t===o,m=o<=t||d;return(0,a.jsxs)(i().Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[a.jsx("button",{onClick:()=>m&&s(o),disabled:!m,className:`
                    relative w-10 h-10 rounded-full flex items-center justify-center 
                    transition-all duration-200 mb-2
                    ${d?"bg-green-500 text-white shadow-lg hover:bg-green-600":c?"bg-blue-500 text-white shadow-lg ring-4 ring-blue-100 dark:ring-blue-900/30":m?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-300 dark:hover:bg-gray-600":"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 cursor-not-allowed"}
                    ${m?"cursor-pointer":"cursor-not-allowed"}
                  `,children:d?a.jsx(u.Z,{className:"w-5 h-5"}):a.jsx("span",{className:"text-sm font-medium",children:o})}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:`
                    text-xs font-medium
                    ${c?"text-blue-600 dark:text-blue-400":d?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}
                  `,children:l.title}),l.isOptional&&a.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Optional"})]})]}),n<e.length-1&&a.jsx("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700 mx-2 mt-5",children:a.jsx("div",{className:`
                      h-full transition-all duration-300
                      ${r.includes(o)?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                    `})})]},l.id)})}),(0,a.jsxs)("div",{className:"md:hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:`
              w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
              ${r.includes(t)?"bg-green-500 text-white":"bg-blue-500 text-white"}
            `,children:r.includes(t)?a.jsx(u.Z,{className:"w-4 h-4"}):t}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Step ",t," of ",e.length]}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e[t-1]?.title})]})]}),a.jsx("div",{className:"flex items-center space-x-1.5",children:e.map((e,i)=>{let l=i+1,n=r.includes(l),o=t===l;return a.jsx("button",{onClick:()=>{(l<=t||n)&&s(l)},className:`
                    transition-all duration-200 rounded-full touch-manipulation
                    ${n?"w-3 h-3 bg-green-500":o?"w-4 h-4 bg-blue-500":"w-3 h-3 bg-gray-300 dark:bg-gray-600"}
                  `},i)})})]}),a.jsx("div",{className:"overflow-x-auto pb-2",children:a.jsx("div",{className:"flex items-center space-x-3 min-w-max",children:e.map((l,n)=>{let o=n+1,d=r.includes(o),c=t===o,m=o<=t||d;return(0,a.jsxs)(i().Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col items-center flex-shrink-0",children:[a.jsx("button",{onClick:()=>m&&s(o),disabled:!m,className:`
                        relative w-11 h-11 rounded-full flex items-center justify-center 
                        transition-all duration-200 mb-1 touch-manipulation
                        ${d?"bg-green-500 text-white shadow-sm":c?"bg-blue-500 text-white shadow-sm ring-2 ring-blue-100 dark:ring-blue-900/30":m?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 cursor-not-allowed"}
                        ${m?"cursor-pointer":"cursor-not-allowed"}
                      `,children:d?a.jsx(u.Z,{className:"w-4 h-4"}):a.jsx("span",{className:"text-sm font-medium",children:o})}),a.jsx("div",{className:"text-center max-w-[80px]",children:a.jsx("div",{className:`
                        text-xs font-medium leading-tight
                        ${c?"text-blue-600 dark:text-blue-400":d?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}
                      `,children:l.mobileTitle||l.title})})]}),n<e.length-1&&a.jsx("div",{className:"w-8 h-px bg-gray-200 dark:bg-gray-700 mt-4 flex-shrink-0",children:a.jsx("div",{className:`
                          h-full transition-all duration-300
                          ${r.includes(o)?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})})]},l.id)})})})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[a.jsx("span",{children:"Progress"}),(0,a.jsxs)("span",{children:[Math.round((r.length+(t>r.length?.5:0))/e.length*100),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${(r.length+(t>r.length?.5:0))/e.length*100}%`}})})]})]})}var h=r(54432),p=r(34474),f=r(67048),x=r(3022),y=r(59593),b=r(67427),v=r(58907),j=r(92771),w=r(87815),N=r(22989),k=r(16968),C=r(28731),D=r(52679),S=r(98908),T=r(95920),E=r(39730),I=r(12714),$=r(29753);let P=[{id:"custom",label:"Custom",description:"Create your own unique card type",icon:f.Z,emoji:"✨",color:"from-purple-100 to-purple-200 dark:from-purple-900 dark:to-purple-800"},{id:"birthday",label:"Birthday",description:"Celebrate another year of life",icon:x.Z,emoji:"\uD83C\uDF82",color:"from-pink-100 to-pink-200 dark:from-pink-900 dark:to-pink-800"},{id:"thank-you",label:"Thank You",description:"Express gratitude and appreciation",icon:y.Z,emoji:"\uD83D\uDE4F",color:"from-blue-100 to-blue-200 dark:from-blue-900 dark:to-blue-800"},{id:"anniversary",label:"Anniversary",description:"Commemorate special milestones",icon:b.Z,emoji:"\uD83D\uDC91",color:"from-red-100 to-red-200 dark:from-red-900 dark:to-red-800"},{id:"congratulations",label:"Congratulations",description:"Celebrate achievements and success",icon:v.Z,emoji:"\uD83C\uDF89",color:"from-yellow-100 to-yellow-200 dark:from-yellow-900 dark:to-yellow-800"},{id:"holiday",label:"Holiday",description:"Seasonal and holiday greetings",icon:j.Z,emoji:"\uD83C\uDF84",color:"from-green-100 to-green-200 dark:from-green-900 dark:to-green-800"},{id:"get-well",label:"Get Well Soon",description:"Send healing wishes and support",icon:w.Z,emoji:"\uD83D\uDC90",color:"from-teal-100 to-teal-200 dark:from-teal-900 dark:to-teal-800"},{id:"sympathy",label:"Sympathy",description:"Offer comfort during difficult times",icon:N.Z,emoji:"\uD83D\uDD4A️",color:"from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700"},{id:"love",label:"Love & Romance",description:"Express romantic feelings",icon:b.Z,emoji:"\uD83D\uDC95",color:"from-rose-100 to-rose-200 dark:from-rose-900 dark:to-rose-800"},{id:"graduation",label:"Graduation",description:"Celebrate educational achievements",icon:k.Z,emoji:"\uD83C\uDF93",color:"from-indigo-100 to-indigo-200 dark:from-indigo-900 dark:to-indigo-800"},{id:"new-baby",label:"New Baby",description:"Welcome new arrivals",icon:C.Z,emoji:"\uD83D\uDC76",color:"from-cyan-100 to-cyan-200 dark:from-cyan-900 dark:to-cyan-800"},{id:"wedding",label:"Wedding",description:"Celebrate unions and marriages",icon:D.Z,emoji:"\uD83D\uDC92",color:"from-violet-100 to-violet-200 dark:from-violet-900 dark:to-violet-800"},{id:"retirement",label:"Retirement",description:"Honor career achievements",icon:S.Z,emoji:"\uD83C\uDF81",color:"from-amber-100 to-amber-200 dark:from-amber-900 dark:to-amber-800"},{id:"housewarming",label:"Housewarming",description:"Welcome to new homes",icon:T.Z,emoji:"\uD83C\uDFE1",color:"from-orange-100 to-orange-200 dark:from-orange-900 dark:to-orange-800"},{id:"apology",label:"Apology",description:"Make amends and seek forgiveness",icon:E.Z,emoji:"\uD83D\uDE4F",color:"from-slate-100 to-slate-200 dark:from-slate-900 dark:to-slate-800"},{id:"thinking-of-you",label:"Thinking of You",description:"Show you care and remember",icon:I.Z,emoji:"\uD83D\uDCAD",color:"from-sky-100 to-sky-200 dark:from-sky-900 dark:to-sky-800"}],F=[{id:"funny",label:"\uD83D\uDE04 Funny",description:"Humorous and lighthearted",color:"from-yellow-100 to-orange-100 dark:from-yellow-900 dark:to-orange-900"},{id:"genz-humor",label:"\uD83D\uDC80 GenZ Humor",description:"Internet memes, chaotic energy, and unhinged vibes",color:"from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900"},{id:"romantic",label:"\uD83D\uDC95 Romantic",description:"Sweet and loving",color:"from-pink-100 to-rose-100 dark:from-pink-900 dark:to-rose-900"},{id:"professional",label:"\uD83D\uDC54 Professional",description:"Formal and business-appropriate",color:"from-slate-100 to-gray-100 dark:from-slate-900 dark:to-gray-900"},{id:"heartfelt",label:"❤️ Heartfelt",description:"Sincere and emotional",color:"from-red-100 to-pink-100 dark:from-red-900 dark:to-pink-900"},{id:"playful",label:"\uD83C\uDF89 Playful",description:"Fun and energetic",color:"from-cyan-100 to-blue-100 dark:from-cyan-900 dark:to-blue-900"},{id:"elegant",label:"✨ Elegant",description:"Sophisticated and refined",color:"from-violet-100 to-indigo-100 dark:from-violet-900 dark:to-indigo-900"},{id:"casual",label:"\uD83D\uDE0A Casual",description:"Relaxed and friendly",color:"from-green-100 to-teal-100 dark:from-green-900 dark:to-teal-900"},{id:"inspirational",label:"\uD83C\uDF1F Inspirational",description:"Motivating and uplifting",color:"from-amber-100 to-yellow-100 dark:from-amber-900 dark:to-yellow-900"},{id:"quirky",label:"\uD83E\uDD2A Quirky",description:"Unique and unconventional",color:"from-lime-100 to-emerald-100 dark:from-lime-900 dark:to-emerald-900"},{id:"traditional",label:"\uD83C\uDFAD Traditional",description:"Classic and timeless",color:"from-stone-100 to-amber-100 dark:from-stone-900 dark:to-amber-900"}];function A({formData:e,updateFormData:t,onStepComplete:r,onTemplateSelect:i}){let[l,n]=(0,s.useState)(!1),{preloadAllCards:o}=(0,$.r)();return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-1.5 h-8 bg-gradient-to-b from-blue-500 to-cyan-500 rounded-full"}),a.jsx("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200",children:"Card Type"})]}),(0,a.jsxs)(p.Ph,{value:e.selectedType,onValueChange:e=>t({selectedType:e}),children:[a.jsx(p.i4,{className:"h-12 sm:h-14 border-2 hover:border-blue-300 dark:hover:border-blue-700 transition-colors touch-manipulation text-base",children:a.jsx(p.ki,{children:(()=>{let t=P.find(t=>t.id===e.selectedType);return t?(t.icon,(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-8 h-8 bg-gradient-to-br ${t.color} rounded-lg flex items-center justify-center shadow-sm`,children:a.jsx("span",{className:"text-lg",children:t.emoji})}),a.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.label})]})):a.jsx("span",{className:"text-gray-400",children:"Choose card type"})})()})}),a.jsx(p.Bw,{className:"max-h-[400px]",children:P.map(e=>(e.icon,a.jsx(p.Ql,{value:e.id,className:"cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[a.jsx("div",{className:`w-10 h-10 bg-gradient-to-br ${e.color} rounded-lg flex items-center justify-center shadow-sm`,children:a.jsx("span",{className:"text-xl",children:e.emoji})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:e.label}),a.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]})},e.id)))})]}),"custom"===e.selectedType&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 animate-in slide-in-from-top-2 duration-300",children:[(0,a.jsxs)("label",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100 mb-3 block flex items-center gap-2",children:[a.jsx(f.Z,{className:"w-4 h-4"}),"Describe Your Custom Card Type"]}),a.jsx(h.I,{placeholder:"✨ E.g., 'Promotion at work', 'Moving away', 'First day of school'",value:e.customCardType,onChange:e=>t({customCardType:e.target.value}),className:"h-12 border-2 border-purple-300 dark:border-purple-700 focus:border-purple-500 dark:focus:border-purple-500 touch-manipulation",style:{fontSize:"16px"}}),a.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-300 mt-2",children:"What type of card is this? This helps personalize the message and style."})]})]}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-1.5 h-8 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"}),a.jsx("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200",children:"Card Tone & Style"})]}),(0,a.jsxs)(p.Ph,{value:e.selectedTone,onValueChange:e=>t({selectedTone:e}),children:[a.jsx(p.i4,{className:"h-12 sm:h-14 border-2 hover:border-purple-300 dark:hover:border-purple-700 transition-colors touch-manipulation text-base",children:a.jsx(p.ki,{children:(()=>{let t=F.find(t=>t.id===e.selectedTone);return t?(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-8 h-8 bg-gradient-to-br ${t.color} rounded-lg flex items-center justify-center shadow-sm`,children:a.jsx("span",{className:"text-base",children:t.label.split(" ")[0]})}),a.jsx("span",{className:"font-medium",children:t.label.split(" ").slice(1).join(" ")})]}):a.jsx("span",{className:"text-gray-400",children:"Choose card tone"})})()})}),a.jsx(p.Bw,{children:F.map(e=>a.jsx(p.Ql,{value:e.id,className:"cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[a.jsx("div",{className:`w-10 h-10 bg-gradient-to-br ${e.color} rounded-lg flex items-center justify-center shadow-sm`,children:a.jsx("span",{className:"text-xl",children:e.label.split(" ")[0]})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:e.label.split(" ").slice(1).join(" ")}),a.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]})},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-1.5 h-8 bg-gradient-to-b from-green-500 to-teal-500 rounded-full"}),a.jsx("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200",children:"Personalization (Optional)"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"To (Optional)"}),a.jsx(h.I,{placeholder:"\uD83C\uDFAF To",value:e.toField,onChange:e=>t({toField:e.target.value}),className:"h-12 sm:h-14 touch-manipulation border-2 hover:border-green-300 dark:hover:border-green-700 transition-colors text-base",style:{fontSize:"16px"}})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"From (Optional)"}),a.jsx(h.I,{placeholder:"\uD83D\uDCDD From",value:e.fromField,onChange:e=>t({fromField:e.target.value}),className:"h-12 sm:h-14 touch-manipulation border-2 hover:border-green-300 dark:hover:border-green-700 transition-colors text-base",style:{fontSize:"16px"}})]})]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-800",children:[a.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCA1 Tips"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[a.jsx("li",{children:"• Pick your card type and tone"}),a.jsx("li",{children:"• To/From fields help personalize"}),a.jsx("li",{children:"• All fields are optional"})]})]})]})}var R=r(77863);let M=s.forwardRef(({className:e,...t},r)=>a.jsx("textarea",{className:(0,R.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));M.displayName="Textarea";var O=r(941),U=r(12591),z=r(49508),Z=r(1256),_=r(21405),L=r(65304),G=r(60097);function H({formData:e,updateFormData:t,onStepComplete:r,handleGetMessageHelp:i,isGeneratingMessage:l,messageHistory:d=[],currentMessageIndex:c=-1,undoMessage:m,redoMessage:u}){let[g,h]=(0,s.useState)(!1),[p,f]=(0,s.useState)(!1),x=async()=>{i&&await i()},y=(0,s.useMemo)(()=>{if(e.isHandwrittenMessage)return"✍️ Leave blank - you'll handwrite";let{selectedType:t,selectedTone:r}=e;return"birthday"===t&&"funny"===r?"\uD83D\uDC9D Add a joke about their age or a funny memory...":"anniversary"===t&&"romantic"===r?"\uD83D\uDC9D Express your love and cherished memories...":"thank-you"===t&&"professional"===r?"\uD83D\uDC9D Express gratitude professionally...":"funny"===r?"\uD83D\uDC9D Add humor, jokes, or funny memories...":"heartfelt"===r?"\uD83D\uDC9D Share sincere feelings and warm wishes...":"\uD83D\uDC9D Your message here... (or click 'Help me write')"},[e.selectedType,e.selectedTone,e.isHandwrittenMessage]),b=c<d.length-1,v=e.finalCardMessage?.length||0;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Describe Your Card (Optional)"}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:()=>h(!g),className:"gap-1 text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:g?(0,a.jsxs)(a.Fragment,{children:[a.jsx(O.Z,{className:"w-3 h-3"}),"Collapse"]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(O.Z,{className:"w-3 h-3 rotate-180"}),"Expand"]})})]}),a.jsx(M,{placeholder:"\uD83D\uDCA1 Optional: E.g., 'Birthday card with cute cats and rainbow colors'",value:e.prompt,onChange:e=>t({prompt:e.target.value}),rows:g?6:3,className:g?"resize-y":"resize-none",style:{fontSize:"16px"}}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["\uD83D\uDCA1 ",a.jsx("strong",{children:"Tip:"})," Add colors, style, themes for better results, or leave blank for defaults"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Card Message"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[d.length>0&&(0,a.jsxs)(G.h_,{children:[a.jsx(G.$F,{asChild:!0,children:(0,a.jsxs)(n.z,{variant:"ghost",size:"sm",className:"gap-1 text-xs",disabled:e.isHandwrittenMessage,children:[a.jsx(o.Z,{className:"w-3 h-3"}),a.jsx("span",{className:"hidden sm:inline",children:"History"})]})}),(0,a.jsxs)(G.AW,{align:"end",className:"w-80",children:[d.map((e,r)=>(0,a.jsxs)(G.Xi,{onClick:()=>t({finalCardMessage:e}),className:"block",children:[a.jsx("div",{className:"text-sm truncate",children:e}),r===c&&a.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Current"})]},r)),d.length>5&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(G.VD,{}),(0,a.jsxs)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:["Showing last ",Math.min(5,d.length)," messages"]})]})]})]}),(m||u)&&(0,a.jsxs)("div",{className:"flex gap-0.5",children:[a.jsx(n.z,{variant:"ghost",size:"sm",onClick:m,disabled:!(c>0)||e.isHandwrittenMessage,className:"px-1.5",title:"Undo",children:a.jsx(U.Z,{className:"w-3 h-3"})}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:u,disabled:!b||e.isHandwrittenMessage,className:"px-1.5",title:"Redo",children:a.jsx(z.Z,{className:"w-3 h-3"})})]}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:()=>f(!p),className:"gap-1 text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:p?(0,a.jsxs)(a.Fragment,{children:[a.jsx(O.Z,{className:"w-3 h-3"}),a.jsx("span",{className:"hidden sm:inline",children:"Collapse"})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(O.Z,{className:"w-3 h-3 rotate-180"}),a.jsx("span",{className:"hidden sm:inline",children:"Expand"})]})}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:x,disabled:l||e.isHandwrittenMessage,className:"gap-1 text-xs",children:[a.jsx(Z.Z,{className:"w-3 h-3"}),l?"Writing...":"Help me write"]}),e.finalCardMessage&&(0,a.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:x,disabled:l||e.isHandwrittenMessage,className:"gap-1 text-xs",title:"Generate another variation",children:[a.jsx(_.Z,{className:"w-3 h-3"}),a.jsx("span",{className:"hidden sm:inline",children:"Try another"})]})]})]})]}),a.jsx("div",{className:"relative",children:l?(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(L.O,{className:"h-16 w-full"}),a.jsx("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Creating personalized message..."})]}):a.jsx(M,{placeholder:y,value:e.finalCardMessage,onChange:e=>t({finalCardMessage:e.target.value}),rows:p?6:3,className:p?"resize-y":"resize-none",style:{fontSize:"16px"},disabled:e.isHandwrittenMessage})}),!e.isHandwrittenMessage&&(0,a.jsxs)("div",{className:"mt-1 space-y-0.5",children:[e.finalCardMessage&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[v," characters"]}),a.jsx("div",{className:"text-xs text-muted-foreground/70",children:"\uD83D\uDCA1 Messages typically work best between 50-250 characters"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[a.jsx("input",{type:"checkbox",id:"handwritten-message",checked:e.isHandwrittenMessage,onChange:r=>{t({isHandwrittenMessage:r.target.checked,finalCardMessage:r.target.checked?"":e.finalCardMessage})},className:"rounded"}),a.jsx("label",{htmlFor:"handwritten-message",className:"text-sm text-gray-600 dark:text-gray-400",children:"Leave blank space for handwritten message"})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 border border-green-200 dark:border-green-800",children:[a.jsx("h4",{className:"font-medium text-green-900 dark:text-green-100 mb-2",children:"✨ Tips"}),(0,a.jsxs)("ul",{className:"text-sm text-green-800 dark:text-green-200 space-y-1",children:[a.jsx("li",{children:"• Be specific for better results"}),a.jsx("li",{children:'• Use "Help me write" for AI messages'}),a.jsx("li",{children:"• Both fields are optional"})]})]})]})}var Y=r(24527),B=r(94019);let q=[{id:"ai-smart-style",label:"✨ Smart Style",description:"Let our experts choose the perfect style for your card",color:"from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900",preview:"✨"},{id:"custom",label:"✨ Custom Style",description:"Define your own unique artistic style",color:"from-violet-100 to-purple-100 dark:from-violet-900 dark:to-purple-900",preview:"\uD83C\uDFAF"},{id:"watercolor",label:"\uD83C\uDFA8 Watercolor",description:"Soft, flowing paint effects (our personal favorite)",color:"from-blue-100 to-cyan-100 dark:from-blue-900 dark:to-cyan-900",preview:"\uD83C\uDFA8"},{id:"minimalist",label:"✨ Minimalist",description:"Clean, simple, elegant design",color:"from-gray-100 to-slate-100 dark:from-gray-900 dark:to-slate-900",preview:"◯"},{id:"botanical",label:"\uD83C\uDF3F Botanical",description:"Beautiful flowers and nature elements",color:"from-green-100 to-emerald-100 dark:from-green-900 dark:to-emerald-900",preview:"\uD83C\uDF3F"},{id:"comic-book",label:"\uD83D\uDCA5 Comic Book",description:"Bold graphic novel style",color:"from-yellow-100 to-red-100 dark:from-yellow-900 dark:to-red-900",preview:"\uD83D\uDCA5"},{id:"dreamy-fantasy",label:"\uD83C\uDF38 Dreamy Fantasy",description:"Enchanting anime-inspired art",color:"from-pink-100 to-purple-100 dark:from-pink-900 dark:to-purple-900",preview:"\uD83C\uDF38"},{id:"modern-geometric",label:"\uD83D\uDD37 Modern Geometric",description:"Clean contemporary shapes",color:"from-indigo-100 to-blue-100 dark:from-indigo-900 dark:to-blue-900",preview:"\uD83D\uDD37"}];function W({formData:e,updateFormData:t,onStepComplete:r,handleFileUpload:s,handleRemoveReferenceImage:i,isUploading:l=!1}){let o=async r=>{if(s){await s(r,"reference");return}if(!r.type.startsWith("image/")){m.Am.error("Please upload an image file");return}console.log("Uploading file:",r.name);try{let a=new FormData;a.append("file",r);let s=await fetch("https://vibecarding.com/upload",{method:"POST",body:a});if(!s.ok)throw Error(`Upload failed: ${s.status}`);let i=await s.json();t({referenceImages:[...e.referenceImages,r],referenceImageUrls:[...e.referenceImageUrls,i.url]}),console.log("\uD83D\uDD0D DEBUG: Reference image uploaded successfully:",{fileName:r.name,url:i.url,totalImages:e.referenceImages.length+1}),m.Am.success(`Reference image uploaded! ${e.referenceImages.length+1} photo${e.referenceImages.length+1>1?"s":""} ready for character creation.`)}catch(e){console.error("Upload failed:",e),m.Am.error("Upload failed. Please try again.")}},d=r=>{if(i){i(r);return}t({referenceImages:e.referenceImages.filter((e,t)=>t!==r),referenceImageUrls:e.referenceImageUrls.filter((e,t)=>t!==r)})};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Artistic Style"}),(0,a.jsxs)(p.Ph,{value:e.selectedArtisticStyle,onValueChange:e=>t({selectedArtisticStyle:e}),children:[a.jsx(p.i4,{children:a.jsx(p.ki,{placeholder:"Choose artistic style"})}),a.jsx(p.Bw,{children:q.map(e=>a.jsx(p.Ql,{value:e.id,children:(0,a.jsxs)("div",{className:"text-left w-full",children:[a.jsx("div",{className:"font-medium",children:e.label}),a.jsx("div",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id))})]}),"custom"===e.selectedArtisticStyle&&(0,a.jsxs)("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Describe Your Custom Style"}),a.jsx(M,{placeholder:"e.g., in vintage 1920s art deco style with gold accents and geometric patterns...",value:e.customStyleDescription,onChange:e=>t({customStyleDescription:e.target.value}),rows:3,className:"resize-none",style:{fontSize:"16px"}}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Describe the artistic style you want for your card (colors, techniques, era, mood, etc.)"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Reference Photos (Optional)"}),"gpt-image-1"!==e.selectedImageModel&&0===e.referenceImageUrls.length&&a.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg mb-3",children:a.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"Reference photos are only available with GPT Image 1 model. You can enable this in the Details step."})}),"gpt-image-1"===e.selectedImageModel&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"Upload photos to create cartoon characters!"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:e=>e.target.files?.[0]&&o(e.target.files[0]),disabled:l,className:"hidden",id:"reference-upload"}),(0,a.jsxs)("label",{htmlFor:"reference-upload",className:`cursor-pointer ${l?"opacity-50 cursor-not-allowed":""}`,children:[a.jsx(Y.Z,{className:`w-6 h-6 mx-auto mb-2 text-gray-400 ${l?"animate-spin":""}`}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:l?"Uploading...":"Upload reference photo"})]})]})]}),e.referenceImageUrls.length>0&&(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.referenceImageUrls.length," photo",e.referenceImageUrls.length>1?"s":""," uploaded:"]}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.referenceImageUrls.map((e,t)=>(0,a.jsxs)("div",{className:"relative group",children:[a.jsx("img",{src:e,alt:`Reference ${t+1}`,className:"w-full aspect-square object-cover rounded border"}),a.jsx(n.z,{variant:"destructive",size:"sm",onClick:()=>d(t),className:"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(B.Z,{className:"w-3 h-3"})})]},t))}),(0,a.jsxs)("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Character Style Instructions (Optional)"}),a.jsx(M,{placeholder:"e.g., 'Make us look like anime characters', 'Keep our exact outfits but in watercolor style'",value:e.imageTransformation,onChange:e=>t({imageTransformation:e.target.value}),rows:3,className:"resize-none",style:{fontSize:"16px"}})]})]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 border border-purple-200 dark:border-purple-800",children:[a.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-100 mb-2",children:"\uD83C\uDFA8 Tips"}),(0,a.jsxs)("ul",{className:"text-sm text-purple-800 dark:text-purple-200 space-y-1",children:[a.jsx("li",{children:"• Smart Style picks best style"}),a.jsx("li",{children:"• Photos create cartoon versions"}),a.jsx("li",{children:"• All options are optional"})]})]})]})}function V({formData:e,updateFormData:t,onStepComplete:r}){return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-1.5 h-8 bg-gradient-to-b from-orange-500 to-red-500 rounded-full"}),a.jsx("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200",children:"Your Email"})]}),a.jsx(h.I,{type:"email",placeholder:"\uD83D\uDCE7 your.email@example.com",required:!0,value:e.userEmail,onChange:e=>t({userEmail:e.target.value}),style:{fontSize:"16px"},className:"h-12 sm:h-14 border-2 hover:border-orange-300 dark:hover:border-orange-700 transition-colors touch-manipulation text-base"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"We'll email you when your card is ready!"})]}),(0,a.jsxs)("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3 border border-orange-200 dark:border-orange-800",children:[a.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-100 mb-2",children:"\uD83D\uDCE7 Almost There!"}),a.jsx("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:"Your email is required to generate and deliver your personalized greeting card."})]})]})}function Q({formData:e,updateFormData:t,onStepComplete:r,isGenerating:i,isGeneratingFinalCard:l,isGeneratingMessage:o,generationProgress:d,progressPercentage:m=0,currentElapsedTime:u=0,isDraftMode:g=!1,draftCards:h=[],selectedDraftIndex:p=-1,formatGenerationTime:f,onGenerateDraftCards:x,onSelectDraft:y}){let[b,v]=(0,s.useState)(!1);return i&&0===h.length?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto",children:a.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Creating Your Card"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:d||"Generating your personalized card..."})]})]}),a.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/30 dark:to-cyan-900/30 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:d||"Generating your card..."})]}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:a.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full transition-all duration-1000 ease-out",style:{width:`${Math.min(m,100)}%`}})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("span",{className:"font-medium",children:[Math.round(m),"% Complete"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[u>0&&f&&(0,a.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["⏱️ ",f(u)]}),a.jsx("span",{className:"text-gray-500",children:g&&!l?"~30-60 sec expected":"~1:30-2:00 min expected"})]})]})]})}),(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[a.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Generating:"}),(0,a.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["custom"===e.selectedType?e.customCardType:e.selectedType," card",e.selectedTone&&` with ${e.selectedTone} tone`,e.referenceImageUrls?.length>0&&` • ${e.referenceImageUrls.length} reference photo${e.referenceImageUrls.length>1?"s":""}`]})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center space-y-2",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Ready to Create Your Card?"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Choose how you'd like to generate your personalized greeting card"})]}),a.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 border border-purple-200 dark:border-purple-800",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-6 h-6 bg-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:a.jsx("span",{className:"text-white text-sm",children:"\uD83C\uDFA8"})}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-medium text-purple-900 dark:text-purple-100 mb-1",children:"Draft Mode"}),(0,a.jsxs)("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:["Generate 5 designs, pick your favorite","ai-smart-style"===e.selectedArtisticStyle&&a.jsx("span",{className:"font-medium",children:" in curated styles"})]})]})]})}),0===h.length&&a.jsx("div",{className:"space-y-4",children:a.jsx("button",{onClick:x,disabled:i||o||!e.userEmail?.trim(),className:"w-full h-12 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-lg font-medium flex items-center justify-center gap-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),a.jsx("span",{children:"Creating 5 design options..."})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("span",{className:"text-lg",children:"\uD83C\uDFA8"}),a.jsx("span",{children:"Create 5 Front Cover Options"})]})})}),h.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-2",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i?"Preview & Select as They're Ready!":"Choose Your Favorite Design"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i?`${h.length}/5 front cover variations complete... You can select one now to proceed!`:"5 front cover variations created with low quality for fast preview. Select your favorite to generate the complete high-quality card!"})]}),i&&a.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/30 dark:to-cyan-900/30 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:d||"Generating remaining variations..."})]}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:a.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full transition-all duration-1000 ease-out",style:{width:`${Math.min(m,100)}%`}})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("span",{className:"font-medium",children:[Math.round(m),"% Complete"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[u>0&&f&&(0,a.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["⏱️ ",f(u)]}),a.jsx("span",{className:"text-gray-500",children:"~30-60 sec expected"})]})]})]})}),(0,a.jsxs)("div",{className:"w-full",children:[a.jsx("div",{className:"flex overflow-x-auto gap-3 pb-4 -mx-4 px-4 snap-x snap-mandatory touch-pan-x",children:Array.from({length:5},(t,r)=>{let s=h[r];return h.length,a.jsx("div",{className:`flex-shrink-0 w-52 sm:w-56 snap-center rounded-lg border-2 p-3 sm:p-3 transition-all cursor-pointer touch-manipulation ${p===r?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 shadow-lg":s?"border-gray-200 dark:border-gray-700 hover:border-purple-300 hover:bg-purple-50/50 dark:hover:bg-purple-900/10":"border-dashed border-gray-300 dark:border-gray-600"}`,onClick:()=>s&&y&&y(r),children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"aspect-[2/3] relative overflow-hidden rounded border mb-3",children:[a.jsx("img",{src:s.frontCover,alt:`Design ${r+1}`,className:"w-full h-full object-cover"}),p===r&&a.jsx("div",{className:"absolute inset-0 bg-purple-600/20 flex items-center justify-center",children:a.jsx("div",{className:"bg-white rounded-full p-2",children:a.jsx(c.Z,{className:"w-8 h-8 text-purple-600"})})})]}),(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsxs)("h4",{className:"font-medium text-sm",children:["Design ",r+1]}),"ai-smart-style"===e.selectedArtisticStyle&&s.styleInfo&&a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:s.styleInfo.styleLabel}),(0,a.jsxs)("div",{className:"space-y-2",children:[p===r&&a.jsx("div",{className:"bg-purple-600 text-white text-xs px-3 py-1 rounded-full",children:"✓ Selected"}),(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation()},className:"w-full text-xs h-9 touch-manipulation",children:[a.jsx("span",{className:"hidden sm:inline",children:"Preview Design"}),a.jsx("span",{className:"sm:hidden",children:"Preview"})]})]})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[a.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),a.jsx("h4",{className:"font-medium text-sm mb-1",children:"Creating..."}),a.jsx("p",{className:"text-xs text-gray-500",children:"Generating front cover..."})]})},r)})}),-1!==p&&a.jsx("div",{className:"text-center bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mt-4",children:(0,a.jsxs)("p",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:["✓ Design ",p+1," selected - ready to generate complete card!"]})})]})]}),!e.userEmail?.trim()&&a.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-amber-600",children:"⚠️"}),a.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"Please enter your email address in the previous steps to generate your card."})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"\uD83D\uDCA1 Generation Tips:"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-1",children:[a.jsx("li",{children:"• Draft Mode is recommended for first-time users"}),a.jsx("li",{children:"• Generation typically takes 1-3 minutes depending on complexity"}),a.jsx("li",{children:"• You can safely leave this page during generation"}),e.referenceImageUrls?.length>0&&(0,a.jsxs)("li",{children:["• Your ",e.referenceImageUrls.length," reference photo",e.referenceImageUrls.length>1?"s":""," will be used for character creation"]})]})]})]})}var J=r(87273);let K=s.forwardRef(({className:e,value:t,...r},s)=>a.jsx(J.fC,{ref:s,className:(0,R.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...r,children:a.jsx(J.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));K.displayName=J.fC.displayName;var X=r(62288),ee=r(1572),et=r(3869),er=r(5932),ea=r(567),es=r(77506),ei=r(41291),el=r(71059),en=r(94893),eo=r(54689),ed=r(70715),ec=r(82685),em=r(11890),eu=r(39183),eg=r(76993),eh=r(43810),ep=r(41329),ef=r(88129);let ex=({src:e,thumbnailSrc:t,alt:r,className:i="",onLoad:l,onError:n,loading:o="lazy",priority:d=!1,sizes:c,srcSet:m})=>{let[u,g]=(0,s.useState)("loading"),[h,p]=(0,s.useState)(""),f=(0,s.useCallback)(e=>new Promise((t,r)=>{let a=new Image;a.onload=()=>t(),a.onerror=e=>r(e),a.src=e}),[]);return(0,s.useEffect)(()=>{let r=!0;return(async()=>{if(!e||""===e.trim()){g("error");return}try{t&&(g("loading"),await f(t),r&&(p(t),g("thumbnail"))),d||"eager"===o||console.log("\uD83D\uDD04 ProgressiveImage: Loading immediately (fixed lazy loading)",e),await f(e),r&&(p(e),g("loaded"),l?.())}catch(e){r&&(g("error"),n?.())}})(),()=>{r=!1}},[e,t,d,o,f,l,n]),a.jsx("div",{className:"w-full h-full relative overflow-hidden",children:(()=>{switch(u){case"loading":return a.jsx("div",{className:"flex items-center justify-center bg-gray-100 dark:bg-gray-800 w-full h-full",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[a.jsx(es.Z,{className:"w-6 h-6 animate-spin text-gray-400"}),a.jsx("span",{className:"text-xs text-gray-500",children:"Loading..."})]})});case"thumbnail":return(0,a.jsxs)("div",{className:"relative w-full h-full",children:[a.jsx("img",{src:h,alt:r,className:`${i} filter blur-sm transition-all duration-300`,draggable:!1,sizes:c,srcSet:m}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("div",{className:"bg-black/20 rounded-full p-2",children:a.jsx(es.Z,{className:"w-4 h-4 animate-spin text-white"})})})]});case"loaded":return a.jsx("img",{src:h,alt:r,className:`${i} transition-all duration-300`,draggable:!1,sizes:c,srcSet:m});case"error":return a.jsx("div",{className:"flex items-center justify-center bg-gray-100 dark:bg-gray-800 w-full h-full",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-red-600 dark:text-red-400 text-xs",children:"✕"})}),a.jsx("span",{className:"text-xs text-gray-500",children:"Failed to load"})]})});default:return null}})()})},ey=()=>"(max-width: 640px) 300px, (max-width: 1024px) 400px, 600px",eb={enter:e=>({x:e>0?1e3:-1e3,opacity:0,scale:.8}),center:{zIndex:1,x:0,opacity:1,scale:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0,scale:.8})},ev=(e,t)=>Math.abs(e)*t;function ej({card:e,onCardUpdate:t,isFrontBackOnly:r=!1,onPrint:i,paperConfig:l,sectionLoadingStates:o,selectedPaperSize:d,onPaperSizeChange:u,paperSizes:g,isCardCompleted:f,fastPreviewMode:x=!1,onViewFullCard:y}){let b=!e&&o&&Object.values(o).some(e=>"loading"===e),v=e||(b?{id:"loading",prompt:"Loading...",frontCover:"",backCover:"",leftPage:"",rightPage:"",createdAt:new Date}:null);if(!v)return null;let[j,w]=(0,s.useState)(0),[N,k]=(0,s.useState)(0),[C,D]=(0,s.useState)(!1),[S,T]=(0,s.useState)(null),[E,$]=(0,s.useState)(!1),[P,F]=(0,s.useState)(null),[A,R]=(0,s.useState)(""),[O,U]=(0,s.useState)(!1),[z,Z]=(0,s.useState)({}),[_,L]=(0,s.useState)({}),[G,H]=(0,s.useState)(!1),[q,W]=(0,s.useState)(""),[V,Q]=(0,s.useState)(!1),[J,K]=(0,s.useState)(""),[ee,ej]=(0,s.useState)(!1),[ew,eN]=(0,s.useState)(!1),[ek,eC]=(0,s.useState)({}),eD=(e,t)=>{let r=z[e],a=_[e];return r&&r.length>0&&void 0!==a?r[a]:t},eS=e=>{let t=_[e];return void 0!==t&&t>0},eT=e=>{let t=z[e],r=_[e];return t&&void 0!==r&&r<t.length-1},eE=e=>{eS(e)&&L(t=>({...t,[e]:t[e]-1}))},eI=e=>{eT(e)&&L(t=>({...t,[e]:t[e]+1}))},e$=(e,t)=>{let r=z[e]||[],a=_[e]||-1,s=[...r.slice(0,a+1),t];Z(t=>({...t,[e]:s})),L(t=>({...t,[e]:s.length-1}))},eP=e=>{switch(e){case"front-cover":return v.frontCover;case"back-cover":return v.backCover;case"left-interior":return v.leftPage;case"right-interior":return v.rightPage;default:return null}},eF=[{id:"front-cover",title:"Front Cover",subtitle:"What recipients see first",image:eD("front-cover",v.frontCover),originalImage:v.frontCover,description:"The front cover design that recipients will see first.",color:"bg-blue-500",type:"single",editLabel:"Edit Front Cover"},{id:"left-interior",title:"Left Interior",subtitle:"Decorative page",image:eD("left-interior",v.leftPage),originalImage:v.leftPage,description:"The decorative left page when the card is opened.",color:"bg-emerald-500",type:"single",editLabel:"Edit Left Interior"},{id:"right-interior",title:"Right Interior",subtitle:"Message page",image:eD("right-interior",v.rightPage),originalImage:v.rightPage,description:"The right page with your message when the card is opened.",color:"bg-emerald-600",type:"single",editLabel:"Edit Right Interior"},{id:"back-cover",title:"Back Cover",subtitle:"What's on the back",image:eD("back-cover",v.backCover),originalImage:v.backCover,description:"The back of the card with subtle design elements.",color:"bg-gray-500",type:"single",editLabel:"Edit Back Cover"}],eA=r?eF.filter(e=>!e.id.includes("interior")):eF,eR=e=>{k(e),w(t=>1===e?t===eA.length-1?0:t+1:0===t?eA.length-1:t-1)},eM=e=>{k(e>j?1:-1),w(e)},eO=()=>{C?(S&&(clearInterval(S),T(null)),D(!1)):(T(setInterval(()=>{eR(1)},3e3)),D(!0))},eU=()=>{$(!0),document.body.style.overflow="hidden"},ez=()=>{$(!1),document.body.style.overflow="unset"},eZ=e=>{if(b){m.Am.error("Please wait for the card to finish generating before editing");return}F(e),R("")},e_=async()=>{if(!P||!A.trim()){m.Am.error("Please enter an edit prompt");return}let e=eP(P);if(!e){m.Am.error("Could not find source image for editing");return}U(!0);try{let r,a="";if(v.generatedPrompts)switch(P){case"front-cover":a=v.generatedPrompts.frontCover||"";break;case"back-cover":a=v.generatedPrompts.backCover||"";break;case"left-interior":a=v.generatedPrompts.leftInterior||"";break;case"right-interior":a=v.generatedPrompts.rightInterior||""}let s="";if(a){let e=`You are an expert AI prompt engineer specializing in image generation prompts for greeting cards. Your task is to modify an existing image generation prompt based on a user's edit request.

ORIGINAL PROMPT:
"${a}"

USER'S EDIT REQUEST:
"${A}"

CRITICAL INSTRUCTIONS:
1. You MUST return the ENTIRE modified prompt, not just the changes
2. Keep ALL the original formatting, style instructions, and technical details
3. Only modify the specific elements mentioned in the user's edit request
4. Preserve all portrait format requirements and greeting card specifications
5. Maintain the same level of detail and descriptiveness as the original
6. Keep all safety instructions and content guidelines from the original
7. Ensure the modified prompt will generate the same type of image (greeting card ${P.replace("-"," ")}) with only the requested changes

EXAMPLES OF WHAT TO MODIFY:
- Colors: If user says "make it blue", change color references in the prompt
- Style: If user says "more cartoonish", adjust style descriptors
- Elements: If user says "add flowers", incorporate flower elements
- Text: If user says "change the message", update text content
- Mood: If user says "make it happier", adjust mood descriptors

WHAT TO PRESERVE:
- All technical specifications (portrait format, dimensions, etc.)
- All safety and content guidelines
- The basic structure and purpose of the image
- All printing and edge safety requirements
- The greeting card context and purpose

Return the ENTIRE modified prompt that incorporates the user's requested changes while preserving everything else from the original prompt. Do not provide explanations or summaries - just return the complete modified prompt.`;try{let t;let r=await fetch("/internal/call_mcp_tool",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"ai_chat",arguments:{messages:e,model:"gemini-2.5-pro",include_thoughts:!1}})});if(!r.ok)throw Error(`AI prompt modification failed: ${r.status}`);let i=await r.json();if(i.error&&"None"!==i.error&&null!==i.error)throw Error(i.error);if("string"==typeof i.result)try{t=JSON.parse(i.result)}catch{throw Error("Invalid JSON response from AI")}else t=i.result;if("error"===t.status)throw Error(t.message);s=t.response||a}catch(e){console.warn("AI prompt modification failed, using fallback approach:",e),s=`CRITICAL: This is a greeting card ${P.replace("-"," ")} in portrait format.

ORIGINAL IMAGE DESCRIPTION: The current image was created with this prompt: "${a}"

Your edit request: "${A}"

IMPORTANT INSTRUCTIONS:
- This is a portrait (vertical) image for a greeting card
- You must PRESERVE the portrait format and dimensions
- Only modify what was specifically requested in the edit
- Keep the overall layout structure intact - do not crop or cut off any sections
- Maintain the aspect ratio and size of the original image
- Ensure the edited result is suitable for printing as part of a greeting card
- Position any text elements safely away from edges with generous margins
- The image should remain focused on its specific purpose: ${P.replace("-"," ")}
- Base your edits on the original design described above, making only the requested changes

Apply the requested changes while preserving the complete image structure and portrait format.`}}else s=`CRITICAL: This is a greeting card ${P.replace("-"," ")} in portrait format.

Your edit request: "${A}"

IMPORTANT INSTRUCTIONS:
- This is a portrait (vertical) image for a greeting card
- You must PRESERVE the portrait format and dimensions
- Only modify what was specifically requested in the edit
- Keep the overall layout structure intact - do not crop or cut off any sections
- Maintain the aspect ratio and size of the original image
- Ensure the edited result is suitable for printing as part of a greeting card
- Position any text elements safely away from edges with generous margins
- The image should remain focused on its specific purpose: ${P.replace("-"," ")}

Apply the requested changes while preserving the complete image structure and portrait format.`;let i=await fetch("/internal/call_mcp_tool",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"edit_images",arguments:{images:[e],edit_prompt:s,user_number:"+17145986105",model:"gpt-image-1",output_format:"jpeg",quality:"auto",output_compression:100,size:l?.dimensions||"1024x1536",n:1}})});if(!i.ok)throw Error(`HTTP ${i.status}`);let n=await i.json();if(n.error&&"None"!==n.error&&null!==n.error)throw Error(n.error);if("string"==typeof n.result)try{r=JSON.parse(n.result)}catch{throw Error("Invalid JSON response")}else r=n.result;if("error"===r.status)throw Error(r.message);let o=r.results[0];if("error"===o.status)throw Error(o.message);let d=o.edited_url;if(!d)throw Error("No edited image URL returned");if(e$(P,d),t&&!b){let e={...v};switch(P){case"front-cover":e.frontCover=d;break;case"back-cover":e.backCover=d;break;case"left-interior":e.leftPage=d;break;case"right-interior":e.rightPage=d}if(e.generatedPrompts&&s)switch(e.generatedPrompts={...e.generatedPrompts},P){case"front-cover":e.generatedPrompts.frontCover=s;break;case"back-cover":e.generatedPrompts.backCover=s;break;case"left-interior":e.generatedPrompts.leftInterior=s;break;case"right-interior":e.generatedPrompts.rightInterior=s}t(e)}m.Am.success(`✨ ${eA.find(e=>e.id===P)?.title} edited successfully!`),F(null),R("")}catch(e){console.error("Edit failed:",e),m.Am.error(`Failed to edit image: ${e instanceof Error?e.message:"Unknown error"}`)}finally{U(!1)}},eL=e=>{Z(t=>{let r={...t};return delete r[e],r}),L(t=>{let r={...t};return delete r[e],r}),m.Am.success("Reset to original image")},eG=e=>{if(!o)return"idle";switch(e){case"front-cover":return o.frontCover;case"back-cover":return o.backCover;case"left-interior":return o.leftInterior;case"right-interior":return o.rightInterior;case"interior":let t=o.leftInterior,r=o.rightInterior;if("loading"===t||"loading"===r)return"loading";if("error"===t||"error"===r)return"error";if("completed"===t&&"completed"===r)return"completed";return"idle";default:return"idle"}},eH=e=>{switch(e){case"loading":return a.jsx("div",{className:"absolute top-3 left-16 bg-blue-500/90 text-white rounded-full p-2 shadow-lg",children:a.jsx(es.Z,{className:"w-4 h-4 animate-spin"})});case"completed":return a.jsx("div",{className:"absolute top-3 left-16 bg-green-500/90 text-white rounded-full p-2 shadow-lg",children:a.jsx(c.Z,{className:"w-4 h-4"})});case"error":return a.jsx("div",{className:"absolute top-3 left-16 bg-red-500/90 text-white rounded-full p-2 shadow-lg",children:a.jsx(ei.Z,{className:"w-4 h-4"})});default:return null}},eY=async()=>{if(b){m.Am.error("Please wait for the card to finish generating before sharing");return}H(!0);try{if(v.shareUrl){W(v.shareUrl),Q(!0),m.Am.success("Card is ready to share!"),H(!1);return}let e=await fetch("/api/cards/store",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:v.prompt,frontCover:v.frontCover,backCover:v.backCover,leftPage:v.leftPage,rightPage:v.rightPage,generatedPrompts:v.generatedPrompts||null})});if(!e.ok)throw Error("Failed to store card");let r=await e.json();W(r.share_url),t&&!b&&t({...v,shareUrl:r.share_url}),Q(!0),m.Am.success("Card is ready to share!")}catch(e){console.error("Error sharing card:",e),m.Am.error("Failed to prepare card for sharing")}finally{H(!1)}},eB=async()=>{try{await navigator.clipboard.writeText(q),m.Am.success("Link copied to clipboard!")}catch(e){m.Am.error("Failed to copy link")}},eq=async()=>{if(!J.trim()){m.Am.error("Please enter an email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(J)){m.Am.error("Please enter a valid email address");return}ej(!0);try{let e=await fetch("https://vibecarding.com/send_email_nodejs_style",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:J,from:"vibecarding@ast.engineer",subject:"\uD83C\uDF89 Someone shared a beautiful card with you!",body:`Hi there!

Someone thought you'd love to see this beautiful greeting card created with VibeCarding!

View the card: ${q}

This card was created with love using our AI-powered greeting card platform. You can create your own cards at https://vibecarding.com

Best regards,
The VibeCarding Team
vibecarding@ast.engineer`})});if(e.ok)m.Am.success("✉️ Card sent successfully via email!"),Q(!1),K("");else{let t=await e.text();console.error("Email send failed:",e.status,t),m.Am.error("Failed to send email. Please try again.")}}catch(e){console.error("Error sending email:",e),m.Am.error("Failed to send email. Please try again.")}finally{ej(!1)}},eW=async()=>{if(b){m.Am.error("Please wait for the card to finish generating before sending to factory");return}eN(!0);try{let e=`
Front Cover Prompt:
${v.generatedPrompts?.frontCover||"Not available"}

Back Cover Prompt:
${v.generatedPrompts?.backCover||"Not available"}

${!r&&v.generatedPrompts?.leftInterior?`Left Interior Prompt:
${v.generatedPrompts.leftInterior}

`:""}${!r&&v.generatedPrompts?.rightInterior?`Right Interior Prompt:
${v.generatedPrompts.rightInterior}

`:""}`,t=await fetch("https://vibecarding.com/send_email_nodejs_style",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:"cards1@ast.engineer",from:"vibecarding@ast.engineer",subject:"New Card Request",body:e})});if(!t.ok)throw Error(`HTTP ${t.status}`);let a=await t.json();if("success"===a.status)m.Am.success("\uD83C\uDFED Card sent to factory successfully!");else throw Error(a.message||"Failed to send to factory")}catch(e){console.error("Error sending to factory:",e),m.Am.error("Failed to send to factory. Please try again.")}finally{eN(!1)}};return x&&v.frontCover?(0,a.jsxs)(ep.E.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h3",{className:"text-lg font-bold mb-1",children:"Quick Preview"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Front cover preview - loading faster for you"})]}),(0,a.jsxs)("div",{className:"relative bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl p-6 shadow-lg",children:[a.jsx("div",{className:"relative aspect-[2/3] max-w-sm mx-auto",children:(0,a.jsxs)("div",{className:"w-full h-full relative bg-white rounded-lg overflow-hidden shadow-xl group",children:[a.jsx(ex,{src:v.frontCover,thumbnailSrc:void 0,alt:"Card front cover",className:"w-full h-full object-contain",priority:!0,sizes:ey()}),a.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-all duration-200 flex items-center justify-center",children:a.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:y&&(0,a.jsxs)(n.z,{onClick:y,className:"bg-white/90 hover:bg-white text-gray-700 shadow-lg",children:[a.jsx(I.Z,{className:"w-4 h-4 mr-2"}),"View Full Card"]})})}),eH(eG("front-cover"))]})}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center mt-4",children:"The front cover design that recipients will see first"})]}),y&&a.jsx("div",{className:"flex justify-center",children:(0,a.jsxs)(n.z,{onClick:y,variant:"outline",className:"border-blue-500 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20",children:[a.jsx(I.Z,{className:"w-4 h-4 mr-2"}),"View Complete Card"]})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(ep.E.div,{className:"text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:[a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Card Preview"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r?"Swipe through your card: front cover and back cover":"Swipe through your card: front cover, left interior, right interior, and back cover"})]}),(0,a.jsxs)(ep.E.div,{className:"relative bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl p-6 overflow-hidden shadow-xl",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.2},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:eA.map((e,t)=>a.jsx(ep.E.button,{className:`w-3 h-3 rounded-full transition-all duration-300 ${t===j?"bg-blue-500 scale-125":"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400"}`,onClick:()=>eM(t),whileHover:{scale:1.2},whileTap:{scale:.9}},t))}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[j+1," / ",eA.length]}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:eO,className:"h-8 w-8 p-0",children:C?a.jsx(el.Z,{className:"w-4 h-4"}):a.jsx(en.Z,{className:"w-4 h-4"})}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:()=>w(0),className:"h-8 w-8 p-0",children:a.jsx(eo.Z,{className:"w-4 h-4"})}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:eU,className:"h-8 w-8 p-0",title:"View in fullscreen",children:a.jsx(ed.Z,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:"relative h-[60vh] sm:h-80 md:h-96 overflow-hidden rounded-xl",children:a.jsx(ef.M,{initial:!1,custom:N,children:a.jsx(ep.E.div,{custom:N,variants:eb,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2},scale:{duration:.2}},drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(e,{offset:t,velocity:r})=>{let a=ev(t.x,r.x);a<-1e4?eR(1):a>1e4&&eR(-1)},className:"absolute inset-0 cursor-grab active:cursor-grabbing",children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[a.jsx(ep.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,a.jsxs)(ea.C,{className:`${eA[j].color} text-white w-full justify-center py-2 mb-4 text-sm font-medium`,children:[eA[j].title," (",eA[j].subtitle,")"]})}),a.jsx(ep.E.div,{className:"flex-1 relative border-2 border-white/20 rounded-lg overflow-hidden shadow-2xl bg-white group",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.4,duration:.4},children:eA[j].image?(0,a.jsxs)("div",{className:"w-full h-full relative cursor-pointer group/image",onClick:eU,title:"Click to view fullscreen",children:[a.jsx(ex,{src:eA[j].image,thumbnailSrc:void 0,alt:eA[j].title,className:"w-full h-full object-contain bg-white",priority:0===j,sizes:ey()}),a.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/image:bg-black/10 transition-all duration-200 flex items-center justify-center",children:a.jsx("div",{className:"opacity-0 group-hover/image:opacity-100 transition-opacity duration-200 bg-white/90 rounded-full p-3 shadow-lg",children:a.jsx(ed.Z,{className:"w-6 h-6 text-gray-700"})})}),(0,a.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[a.jsx("div",{className:"absolute top-3 left-3 pointer-events-auto",children:eH(eG(eA[j].id))}),a.jsx("button",{onClick:e=>{e.stopPropagation(),eZ(eA[j].id)},className:"absolute top-3 right-3 bg-white/90 hover:bg-white text-gray-700 rounded-full p-2 shadow-lg transition-all duration-200 pointer-events-auto",title:eA[j].editLabel,children:a.jsx(ec.Z,{className:"w-4 h-4"})}),z[eA[j].id]&&z[eA[j].id].length>0&&a.jsx("button",{onClick:e=>{e.stopPropagation(),eL(eA[j].id)},className:"absolute top-3 left-3 bg-amber-500/90 hover:bg-amber-500 text-white rounded-full p-2 shadow-lg transition-all duration-200 pointer-events-auto",title:"Reset to original",children:a.jsx(eo.Z,{className:"w-3 h-3"})}),z[eA[j].id]&&z[eA[j].id].length>0&&(0,a.jsxs)("div",{className:"absolute bottom-3 left-3 bg-white/90 rounded-lg shadow-lg p-2 flex items-center gap-2 pointer-events-auto",children:[a.jsx("button",{onClick:e=>{e.stopPropagation(),eE(eA[j].id)},disabled:!eS(eA[j].id),className:"p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Previous version",children:a.jsx(em.Z,{className:"w-3 h-3"})}),(0,a.jsxs)("span",{className:"text-xs text-gray-700 px-1",children:[(_[eA[j].id]||0)+1,"/",z[eA[j].id].length]}),a.jsx("button",{onClick:e=>{e.stopPropagation(),eI(eA[j].id)},disabled:!eT(eA[j].id),className:"p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Next version",children:a.jsx(eu.Z,{className:"w-3 h-3"})})]}),z[eA[j].id]&&z[eA[j].id].length>0&&(0,a.jsxs)("div",{className:"absolute bottom-3 right-3 bg-emerald-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1 pointer-events-auto",children:[a.jsx(Y.Z,{className:"w-3 h-3"}),"Edited"]})]})]}):a.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-800",children:(0,a.jsxs)("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-lg p-8 flex flex-col items-center gap-4",children:[a.jsx(es.Z,{className:"w-8 h-8 animate-spin text-gray-400"}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"loading"===eG(eA[j].id)?"Generating...":"Loading section..."}),a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:eA[j].title})]})]})})}),a.jsx(ep.E.p,{className:"text-sm text-gray-600 dark:text-gray-400 text-center mt-3 px-4 leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:eA[j].description})]})},j)})}),a.jsx(ep.E.button,{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-full p-2 shadow-lg hover:bg-white dark:hover:bg-gray-700 transition-colors z-10",onClick:()=>eR(-1),whileHover:{scale:1.1},whileTap:{scale:.9},children:a.jsx(em.Z,{className:"w-5 h-5"})}),a.jsx(ep.E.button,{className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-full p-2 shadow-lg hover:bg-white dark:hover:bg-gray-700 transition-colors z-10",onClick:()=>eR(1),whileHover:{scale:1.1},whileTap:{scale:.9},children:a.jsx(eu.Z,{className:"w-5 h-5"})})]}),a.jsx(ep.E.div,{className:`grid ${r?"grid-cols-2":"grid-cols-2 sm:grid-cols-4"} gap-3`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:eA.map((e,t)=>{let r=eG(e.id);return(0,a.jsxs)(ep.E.button,{onClick:()=>eM(t),className:`p-3 rounded-lg border-2 transition-all duration-300 text-left relative ${t===j?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,a.jsxs)("div",{className:"absolute top-2 right-2",children:["loading"===r&&a.jsx(es.Z,{className:"w-3 h-3 animate-spin text-blue-500"}),"completed"===r&&a.jsx(c.Z,{className:"w-3 h-3 text-green-500"}),"error"===r&&a.jsx(ei.Z,{className:"w-3 h-3 text-red-500"})]}),a.jsx("div",{className:`w-3 h-3 rounded-full mb-2 ${e.color}`}),a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.title}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.subtitle})]},e.id)})}),f&&g&&u&&a.jsx(ep.E.div,{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h4",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Print Size"}),a.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Change the paper size for printing (doesn't affect your images)"})]}),a.jsx("div",{className:"w-48",children:(0,a.jsxs)(p.Ph,{value:d,onValueChange:u,children:[a.jsx(p.i4,{className:"border-blue-300 dark:border-blue-700",children:a.jsx(p.ki,{placeholder:"Choose paper size"})}),a.jsx(p.Bw,{children:g.map(e=>a.jsx(p.Ql,{value:e.id,children:(0,a.jsxs)("div",{className:"text-left",children:[a.jsx("div",{className:"font-medium",children:e.label}),a.jsx("div",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id))})]})})]})}),(0,a.jsxs)(ep.E.div,{className:"flex flex-col sm:flex-row gap-3 pt-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},children:[i&&(0,a.jsxs)(n.z,{onClick:i,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white",children:[a.jsx(et.Z,{className:"w-4 h-4 mr-2"}),"Print Card",l&&(0,a.jsxs)("span",{className:"ml-2 text-xs opacity-75",children:["(",l.printWidth," \xd7 ",l.printHeight,")"]})]}),a.jsx(n.z,{onClick:eW,disabled:ew||b,variant:"outline",className:"flex-1 border-orange-500 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 disabled:opacity-50",children:ew?(0,a.jsxs)(a.Fragment,{children:[a.jsx(es.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):b?(0,a.jsxs)(a.Fragment,{children:[a.jsx(es.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:["\uD83C\uDFED",a.jsx("span",{className:"ml-2",children:"Send to Factory"})]})}),a.jsx(n.z,{onClick:eY,disabled:G||b,variant:"outline",className:"flex-1 border-blue-500 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 disabled:opacity-50",children:G?(0,a.jsxs)(a.Fragment,{children:[a.jsx(es.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Preparing..."]}):b?(0,a.jsxs)(a.Fragment,{children:[a.jsx(es.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(eg.Z,{className:"w-4 h-4 mr-2"}),"Share Card"]})})]}),a.jsx(X.Vq,{open:V,onOpenChange:Q,children:(0,a.jsxs)(X.cZ,{className:"sm:max-w-md",children:[(0,a.jsxs)(X.fK,{children:[(0,a.jsxs)(X.$N,{className:"flex items-center gap-2",children:[a.jsx(eg.Z,{className:"w-5 h-5"}),"Share Your Card"]}),a.jsx(X.Be,{children:"Your card is ready to share! Copy the link or send it via email."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Share URL"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(h.I,{value:q,readOnly:!0,className:"flex-1"}),a.jsx(n.z,{onClick:eB,variant:"outline",size:"sm",children:a.jsx(eh.Z,{className:"w-4 h-4"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Send via Email"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(h.I,{type:"email",placeholder:"recipient@example.com",value:J,onChange:e=>K(e.target.value),className:"flex-1"}),a.jsx(n.z,{onClick:eq,variant:"outline",size:"sm",disabled:!J.trim()||ee,children:ee?a.jsx(es.Z,{className:"w-4 h-4 animate-spin"}):a.jsx(er.Z,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-xs text-gray-500",children:ee?"Sending email...":"Sends the card directly via email"})]})]})]})}),a.jsx(ef.M,{children:E&&a.jsx(ep.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/95 backdrop-blur-sm",onClick:ez,children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 md:p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx(ea.C,{className:`${eA[j].color} text-white px-4 py-2`,children:eA[j].title}),a.jsx("span",{className:"text-white/80 text-sm hidden md:block",children:eA[j].subtitle})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-white/80 text-sm",children:[j+1," / ",eA.length]}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),eO()},className:"h-9 w-9 p-0 text-white hover:bg-white/10",children:C?a.jsx(el.Z,{className:"w-5 h-5"}):a.jsx(en.Z,{className:"w-5 h-5"})}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),ez()},className:"h-9 w-9 p-0 text-white hover:bg-white/10",children:a.jsx(B.Z,{className:"w-5 h-5"})})]})]}),a.jsx("div",{className:"flex-1 relative px-4 md:px-6 pb-6",children:(0,a.jsxs)("div",{className:"h-full relative",children:[a.jsx(ef.M,{initial:!1,custom:N,children:a.jsx(ep.E.div,{custom:N,variants:eb,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2},scale:{duration:.2}},drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(e,{offset:t,velocity:r})=>{let a=ev(t.x,r.x);a<-1e4?eR(1):a>1e4&&eR(-1)},className:"absolute inset-0 cursor-grab active:cursor-grabbing",onClick:e=>e.stopPropagation(),children:a.jsx("div",{className:"h-full flex items-center justify-center",children:eA[j].image?a.jsx("div",{className:"max-w-full max-h-full",children:a.jsx(ex,{src:eA[j].image,thumbnailSrc:void 0,alt:eA[j].title,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",priority:!0})}):a.jsx("div",{className:"flex items-center justify-center bg-gray-800 rounded-lg p-8",children:a.jsx("p",{className:"text-white/70",children:"Loading section..."})})})},`fullscreen-${j}`)}),a.jsx(ep.E.button,{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 backdrop-blur-sm rounded-full p-3 text-white hover:bg-black/70 transition-colors z-10",onClick:e=>{e.stopPropagation(),eR(-1)},whileHover:{scale:1.1},whileTap:{scale:.9},children:a.jsx(em.Z,{className:"w-6 h-6"})}),a.jsx(ep.E.button,{className:"absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 backdrop-blur-sm rounded-full p-3 text-white hover:bg-black/70 transition-colors z-10",onClick:e=>{e.stopPropagation(),eR(1)},whileHover:{scale:1.1},whileTap:{scale:.9},children:a.jsx(eu.Z,{className:"w-6 h-6"})})]})}),a.jsx("div",{className:"flex items-center justify-center gap-3 pb-6",children:eA.map((e,t)=>a.jsx(ep.E.button,{className:`transition-all duration-300 ${t===j?"w-8 h-3 bg-white rounded-full":"w-3 h-3 bg-white/40 rounded-full hover:bg-white/60"}`,onClick:e=>{e.stopPropagation(),eM(t)},whileHover:{scale:1.2},whileTap:{scale:.9}},`fullscreen-indicator-${e.id}`))}),a.jsx("div",{className:"px-6 pb-6",children:a.jsx(ep.E.p,{className:"text-white/80 text-center text-sm md:text-base leading-relaxed max-w-2xl mx-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:eA[j].description})})]})})}),a.jsx(X.Vq,{open:!!P,onOpenChange:e=>!e&&F(null),children:(0,a.jsxs)(X.cZ,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(X.fK,{children:[(0,a.jsxs)(X.$N,{className:"flex items-center gap-2",children:[a.jsx(Y.Z,{className:"w-5 h-5 text-blue-600"}),P?eA.find(e=>e.id===P)?.editLabel:"Edit Section"]}),a.jsx(X.Be,{children:"interior"===P?(0,a.jsxs)(a.Fragment,{children:["Describe how you'd like to modify this section of your card. This interior has ",a.jsx("strong",{children:"two areas"}),": decorative artwork on the left and your message on the right. Be specific about which area you want to change and what modifications you want.",a.jsx("br",{}),a.jsx("br",{}),(0,a.jsxs)("span",{className:"text-amber-600 dark:text-amber-400 text-sm",children:["\uD83D\uDCA1 ",a.jsx("strong",{children:"Tip:"}),' Specify "left side" for decorative changes or "right side" for message changes to ensure both areas are preserved.']})]}):"Describe how you'd like to modify this section of your card. Be specific about colors, style, content, or any changes you want to make."})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[P&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Current Image","left-interior"===P||"right-interior"===P?"s":""]}),a.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white",children:"left-interior"===P||"right-interior"===P?(0,a.jsxs)("div",{className:"flex h-64",children:[(0,a.jsxs)("div",{className:"w-1/2 relative",children:[a.jsx(ex,{src:eD("left-interior",e.leftPage),thumbnailSrc:void 0,alt:"Left Interior",className:"w-full h-full object-contain"}),"left-interior"===P&&a.jsx("div",{className:"absolute inset-0 border-4 border-blue-500 bg-blue-500/10"})]}),a.jsx("div",{className:"w-px bg-gray-300"}),(0,a.jsxs)("div",{className:"w-1/2 relative",children:[a.jsx(ex,{src:eD("right-interior",e.rightPage),thumbnailSrc:void 0,alt:"Right Interior",className:"w-full h-full object-contain"}),"right-interior"===P&&a.jsx("div",{className:"absolute inset-0 border-4 border-blue-500 bg-blue-500/10"})]})]}):a.jsx(ex,{src:eA.find(e=>e.id===P)?.image||"",thumbnailSrc:void 0,alt:"Current section",className:"w-full h-64 object-contain"})}),("left-interior"===P||"right-interior"===P)&&a.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"The highlighted area shows which side you're editing. Both sides are shown for context."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Edit Instructions"}),a.jsx(M,{placeholder:"e.g., Change the background to a sunset sky, make the flowers more colorful, add sparkles, change the text style to handwritten...",value:A,onChange:e=>R(e.target.value),rows:4,className:"resize-none",style:{fontSize:"16px"}}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Be specific about what you want to change. Only the areas you describe will be modified while keeping the rest intact."})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx(n.z,{onClick:()=>F(null),variant:"outline",className:"flex-1",disabled:O,children:"Cancel"}),a.jsx(n.z,{onClick:e_,disabled:!A.trim()||O,className:"flex-1 bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700",children:O?(0,a.jsxs)(a.Fragment,{children:[a.jsx(es.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Editing..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(Y.Z,{className:"w-4 h-4 mr-2"}),"Apply Edit"]})})]})]})]})})]})}let ew=[{id:"standard",label:"5\xd77 Card (Standard)",description:"Standard 5\xd77 greeting card (10\xd77 print layout)",aspectRatio:"9:16",dimensions:"1024x1536",printWidth:"10in",printHeight:"7in"},{id:"compact",label:"4\xd76 Card (Compact)",description:"Compact 4\xd76 greeting card (8\xd76 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8in",printHeight:"6in"},{id:"a6",label:"A6 Card (4\xd76)",description:"A6 paper size (8.3\xd75.8 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8.3in",printHeight:"5.8in"}];function eN({formData:e,isGeneratingFinalCard:t,generationProgress:r,progressPercentage:i,currentElapsedTime:o,selectedDraftIndex:u,draftCards:g,generatedCard:f,isCardCompleted:x,onGenerateFinalCard:y,formatGenerationTime:b}){let[v,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)("physical"),[k,C]=(0,s.useState)("standard"),[D,S]=(0,s.useState)(!1),T=g[u],E=async()=>{if(!f){m.Am.error("No card available to print");return}if(!e.userEmail?.trim()){m.Am.error("Please enter your email address before printing"),j(!1);return}j(!1);try{if(!f.frontCover){m.Am.error("Card is missing front cover image. Please regenerate the card.");return}if(!f.backCover){m.Am.error("Card is missing back cover image. Please regenerate the card.");return}if(!e.isFrontBackOnly&&(!f.leftPage||!f.rightPage)){m.Am.error("Card is missing interior pages. Please regenerate the card or use front-back only mode.");return}let t={front_cover:f.frontCover,back_cover:f.backCover,left_page:f.leftPage,right_page:f.rightPage,card_name:(f.prompt||"Custom Card").substring(0,50)+((f.prompt||"").length>50?"...":""),paper_size:k,is_front_back_only:e.isFrontBackOnly,copies:1,color_mode:"color",quality:"high"};if("email"===w){let r={...t,user_email:e.userEmail.trim(),send_pdf:!0},a=await fetch("/api/send-pdf-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){let e=await a.text();throw Error(`HTTP ${a.status}: ${e}`)}let s=await a.json();if("success"===s.status)m.Am.success(`📧 PDF sent to ${e.userEmail}! Check your inbox.`);else throw Error(s.error||"Failed to send PDF")}else{let e=await fetch("/api/print-queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw Error(`HTTP ${e.status}`);let r=await e.json();if("queued"===r.status)m.Am.success(`🖨️ Your card is now printing! You can pick it up shortly.`),setTimeout(async()=>{try{let e=await fetch(`/api/print-status/${r.job_id}`);if(e.ok){let t=await e.json();"found"===t.status&&("completed"===t.job.status?m.Am.success("✅ Your card has been added to the print queue and should be available for pickup shortly."):"failed"===t.job.status&&m.Am.error("❌ There was an issue with printing. Please try again or contact us for help."))}}catch(e){console.log("Could not check print status:",e)}},1e4);else throw Error(r.error||"Unknown error")}}catch(e){console.error("Print/Email error:",e),m.Am.error("email"===w?"Failed to send PDF email":"Failed to queue print job")}};return(0,a.jsxs)("div",{className:"space-y-6",children:[T&&(0,a.jsxs)(l.Zb,{className:"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800",children:[a.jsx(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"text-lg flex items-center gap-2",children:[a.jsx(c.Z,{className:"w-5 h-5 text-green-600"}),"Selected Design"]})}),a.jsx(l.aY,{children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("img",{src:T.frontCover,alt:"Selected draft",className:"w-24 h-36 object-cover rounded-lg border shadow-sm"})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Creating your complete card"}),a.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 font-medium",children:"✓ Ready to generate final version"})]})]})})]}),t&&(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"text-xl flex items-center gap-2",children:[a.jsx(ee.Z,{className:"w-6 h-6 text-blue-600"}),"Generating Your Complete Card"]})}),(0,a.jsxs)(l.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Progress"}),(0,a.jsxs)("span",{className:"font-medium",children:[Math.round(i),"%"]})]}),a.jsx(K,{value:i,className:"h-3"})]}),r&&a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:a.jsx("p",{className:"text-center text-blue-800 dark:text-blue-200 font-medium",children:r})}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[a.jsx(d.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Elapsed: ",b(o)]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"\uD83D\uDCA1 While you wait:"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[a.jsx("li",{children:"• High-quality generation typically takes 1-3 minutes"}),a.jsx("li",{children:"• You can safely leave this page during generation"}),a.jsx("li",{children:"• Your card will be ready when you return"}),(0,a.jsxs)("li",{children:["• We'll send email updates to ",e.userEmail]})]})]})]})]}),x&&f&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Zb,{className:"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800",children:[a.jsx(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"text-xl flex items-center gap-2 text-green-800 dark:text-green-200",children:[a.jsx(c.Z,{className:"w-6 h-6"}),"Your Card is Ready!"]})}),a.jsx(l.aY,{children:a.jsx("div",{className:"text-center",children:a.jsx("p",{className:"text-green-700 dark:text-green-300",children:"\uD83C\uDF89 Your complete high-quality card has been generated successfully!"})})})]}),a.jsx(ej,{card:f,isFrontBackOnly:e.isFrontBackOnly,isCardCompleted:!0,onPrint:()=>{if(f){if(!e.userEmail?.trim()){m.Am.error("Please enter your email address before printing");return}N("physical"),j(!0)}},paperConfig:ew.find(e=>e.id===k)||ew[0],selectedPaperSize:k,onPaperSizeChange:C,paperSizes:ew})]}),!t&&!x&&!f&&u>=0&&(0,a.jsxs)(l.Zb,{className:"border-amber-200 bg-amber-50 dark:bg-amber-900/20 dark:border-amber-800",children:[a.jsx(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"text-lg flex items-center gap-2 text-amber-800 dark:text-amber-200",children:[a.jsx(d.Z,{className:"w-5 h-5"}),"Ready to Generate"]})}),a.jsx(l.aY,{children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[a.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Ready to create your final high-quality card?"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"This will generate your final card based on the selected design."}),D&&!t&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(n.z,{onClick:()=>{S(!1),y(u)},className:"bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700",size:"lg",children:[a.jsx(ee.Z,{className:"w-5 h-5 mr-2"}),"Generate Final Card"]}),a.jsx("div",{children:a.jsx(n.z,{variant:"outline",onClick:()=>S(!1),size:"sm",children:"Not ready yet"})})]})]})})]}),a.jsx(X.Vq,{open:v,onOpenChange:j,children:(0,a.jsxs)(X.cZ,{className:"sm:max-w-md",children:[(0,a.jsxs)(X.fK,{children:[(0,a.jsxs)(X.$N,{className:"flex items-center gap-2",children:[a.jsx(et.Z,{className:"w-5 h-5"}),"Print Your Card"]}),a.jsx(X.Be,{children:"Choose how you'd like to print your greeting card."})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("h4",{className:"text-sm font-medium",children:"Print Options"}),a.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${"physical"===w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,onClick:()=>N("physical"),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("input",{type:"radio",checked:"physical"===w,onChange:()=>N("physical"),className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(et.Z,{className:"w-4 h-4 text-blue-600"}),a.jsx("span",{className:"font-medium",children:"Physical Print"})]}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Print directly to our office printer. Pick up your card shortly."})]})]})}),a.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${"email"===w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,onClick:()=>N("email"),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("input",{type:"radio",checked:"email"===w,onChange:()=>N("email"),className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(er.Z,{className:"w-4 h-4 text-green-600"}),a.jsx("span",{className:"font-medium",children:"Email PDF"})]}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Get a PDF version sent to your email for printing at home."})]})]})})]}),"physical"===w&&(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-sm font-medium",children:"Print Settings"}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2 block",children:"Paper Size"}),(0,a.jsxs)(p.Ph,{value:k,onValueChange:C,children:[a.jsx(p.i4,{children:a.jsx(p.ki,{})}),a.jsx(p.Bw,{children:ew.map(e=>a.jsx(p.Ql,{value:e.id,children:(0,a.jsxs)("div",{className:"text-left",children:[a.jsx("div",{className:"font-medium",children:e.label}),a.jsx("div",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id))})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Email Address"}),a.jsx(h.I,{value:e.userEmail||"",disabled:!0,className:"bg-gray-50 dark:bg-gray-800"}),"email"===w&&a.jsx("p",{className:"text-xs text-gray-500",children:"PDF will be sent to this email address"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx(n.z,{variant:"outline",onClick:()=>j(!1),className:"flex-1",children:"Cancel"}),a.jsx(n.z,{onClick:E,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700",children:"email"===w?(0,a.jsxs)(a.Fragment,{children:[a.jsx(er.Z,{className:"w-4 h-4 mr-2"}),"Send PDF"]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(et.Z,{className:"w-4 h-4 mr-2"}),"Print Card"]})})]})]})]})})]})}var ek=r(86333),eC=r(24230);function eD({currentStep:e,totalSteps:t,onPrevious:r,onNext:s,canProceed:i,isGenerating:l}){let o=()=>{s()};return(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[!i&&!l&&a.jsx("div",{className:"text-center px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:a.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Please complete the required fields to continue"})}),(0,a.jsxs)("div",{className:"flex flex-col sm:hidden gap-3",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:["Step ",e," of ",t]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(n.z,{variant:"outline",onClick:r,disabled:1===e||l,className:"flex-1 gap-2 h-12 px-4 touch-manipulation text-base",children:[a.jsx(ek.Z,{className:"w-5 h-5"}),"Previous"]}),(0,a.jsxs)(n.z,{onClick:o,disabled:!i||l,className:"flex-1 gap-2 h-12 px-4 touch-manipulation bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-base",children:["Next",a.jsx(eC.Z,{className:"w-5 h-5"})]})]})]}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center justify-between gap-4",children:[(0,a.jsxs)(n.z,{variant:"outline",onClick:r,disabled:1===e||l,className:"gap-2 h-11 px-6 touch-manipulation",children:[a.jsx(ek.Z,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:["Step ",e," of ",t]}),(0,a.jsxs)(n.z,{onClick:o,disabled:!i||l,className:"gap-2 h-11 px-6 touch-manipulation bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700",children:[a.jsx("span",{className:"hidden sm:inline",children:"Next"}),a.jsx(eC.Z,{className:"w-4 h-4"})]})]})]})}var eS=r(79210),eT=r(65685),eE=r(36283),eI=r(37358),e$=r(89392),eP=r(71709),eF=r(98091);let eA="vibecarding-card-history",eR=()=>{let[e,t]=(0,s.useState)({completedCards:[],draftSessions:[],lastUpdated:Date.now()}),[r,a]=(0,s.useState)(!0);(0,s.useEffect)(()=>{i()},[]);let i=(0,s.useCallback)(()=>{try{let e=localStorage.getItem(eA);if(e){let r=JSON.parse(e),a=Date.now(),s=r.completedCards.filter(e=>a-new Date(e.createdAt).getTime()<2592e6),i=r.draftSessions.filter(e=>a-new Date(e.lastModified).getTime()<6048e5);t({completedCards:s,draftSessions:i,lastUpdated:a})}}catch(e){console.error("Failed to load card history:",e)}finally{a(!1)}},[]),l=(0,s.useCallback)(e=>{try{localStorage.setItem(eA,JSON.stringify(e))}catch(e){console.error("Failed to save card history:",e)}},[]),n=(0,s.useCallback)(e=>{t(t=>{let r={...t,completedCards:[e,...t.completedCards],lastUpdated:Date.now()};return l(r),r})},[l]),o=(0,s.useCallback)((r,a,s=-1,i)=>{let n=new Date,o=i||eM(),d=eO(r),c={id:o,formData:r,draftCards:a,selectedDraftIndex:s,createdAt:i&&e.draftSessions.find(e=>e.id===i)?.createdAt||n,lastModified:n,title:d};return t(e=>{let t;let r=e.draftSessions.findIndex(e=>e.id===o);r>=0?(t=[...e.draftSessions])[r]=c:t=[c,...e.draftSessions];let a={...e,draftSessions:t,lastUpdated:Date.now()};return l(a),a}),o},[e.draftSessions,l]),d=(0,s.useCallback)(t=>e.draftSessions.find(e=>e.id===t)||null,[e.draftSessions]),c=(0,s.useCallback)(e=>{t(t=>{let r={...t,draftSessions:t.draftSessions.filter(t=>t.id!==e),lastUpdated:Date.now()};return l(r),r})},[l]),m=(0,s.useCallback)(e=>{t(t=>{let r={...t,completedCards:t.completedCards.filter(t=>t.id!==e),lastUpdated:Date.now()};return l(r),r})},[l]),u=(0,s.useCallback)(()=>{let e={completedCards:[],draftSessions:[],lastUpdated:Date.now()};t(e),l(e)},[l]),g=(0,s.useCallback)(()=>e.draftSessions.length>0?e.draftSessions[0]:null,[e.draftSessions]);return{history:e,isLoading:r,addCompletedCard:n,saveDraftSession:o,resumeDraftSession:d,deleteDraftSession:c,deleteCompletedCard:m,clearHistory:u,getActiveDraftSession:g,hasCompletedCards:e.completedCards.length>0,hasDraftSessions:e.draftSessions.length>0,totalCards:e.completedCards.length,totalDrafts:e.draftSessions.length}},eM=()=>`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,eO=e=>{let t="custom"===e.selectedType?e.customCardType:e.selectedType,r=e.selectedTone,a=new Date().toLocaleString();return t&&r?`${t} (${r}) - ${a}`:t?`${t} - ${a}`:`Draft Card - ${a}`};function eU({isOpen:e,onClose:t,onResumeDraft:r,onLoadCard:i}){let{history:o,isLoading:c,deleteDraftSession:u,deleteCompletedCard:g,resumeDraftSession:h,clearHistory:p}=eR(),[f,x]=(0,s.useState)("completed"),y=e=>{h(e)?(r?.(e),t(),m.Am.success("Draft session resumed!")):m.Am.error("Failed to resume draft session")},b=e=>{u(e),m.Am.success("Draft session deleted")},v=e=>{g(e),m.Am.success("Card deleted from history")},j=async e=>{if(e.shareUrl)try{await navigator.clipboard.writeText(e.shareUrl),m.Am.success("Share link copied to clipboard!")}catch(e){m.Am.error("Failed to copy share link")}else m.Am.error("No share link available for this card")},w=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),N=e=>{let t=Math.floor((new Date().getTime()-new Date(e).getTime())/36e5);return t<1?"Just now":t<24?`${t}h ago`:t<48?"1 day ago":`${Math.floor(t/24)} days ago`};return a.jsx(X.Vq,{open:e,onOpenChange:t,children:(0,a.jsxs)(X.cZ,{className:"max-w-4xl max-h-[80vh] p-0",children:[(0,a.jsxs)(X.fK,{className:"p-6 pb-4",children:[a.jsx(X.$N,{className:"text-xl font-bold",children:"Your Card History"}),a.jsx(X.Be,{children:"View your completed cards and resume draft sessions"})]}),(0,a.jsxs)(eS.mQ,{value:f,onValueChange:e=>x(e),className:"flex-1",children:[a.jsx("div",{className:"px-6",children:(0,a.jsxs)(eS.dr,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(eS.SP,{value:"completed",className:"flex items-center gap-2",children:[a.jsx(eE.Z,{className:"w-4 h-4"}),"Completed Cards (",o.completedCards.length,")"]}),(0,a.jsxs)(eS.SP,{value:"drafts",className:"flex items-center gap-2",children:[a.jsx(d.Z,{className:"w-4 h-4"}),"Draft Sessions (",o.draftSessions.length,")"]})]})}),(0,a.jsxs)("div",{className:"px-6 pb-6",children:[a.jsx(eS.nU,{value:"completed",className:"mt-4",children:a.jsx(eT.x,{className:"h-96",children:0===o.completedCards.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx(eE.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No completed cards yet"}),a.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Complete your first card to see it here!"})]}):a.jsx("div",{className:"space-y-4",children:o.completedCards.map(e=>a.jsx(l.Zb,{className:"hover:shadow-md transition-shadow",children:a.jsx(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("img",{src:e.frontCover,alt:"Card preview",className:"w-20 h-28 object-cover rounded-lg border shadow-sm"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:[e.prompt.substring(0,50),e.prompt.length>50&&"..."]}),a.jsx("div",{className:"flex items-center gap-2 ml-2",children:(0,a.jsxs)(ea.C,{variant:"secondary",className:"text-xs",children:[a.jsx(eI.Z,{className:"w-3 h-3 mr-1"}),w(e.createdAt)]})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx(d.Z,{className:"w-4 h-4"}),N(e.createdAt)]}),e.styleInfo&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx(e$.Z,{className:"w-4 h-4"}),e.styleInfo.styleLabel]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>i?.(e.id),className:"flex items-center gap-1",children:[a.jsx(eP.Z,{className:"w-4 h-4"}),"View"]}),e.shareUrl&&(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>j(e),className:"flex items-center gap-1",children:[a.jsx(eg.Z,{className:"w-4 h-4"}),"Share"]}),(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>v(e.id),className:"flex items-center gap-1 text-red-600 hover:text-red-700",children:[a.jsx(eF.Z,{className:"w-4 h-4"}),"Delete"]})]})]})]})})},e.id))})})}),a.jsx(eS.nU,{value:"drafts",className:"mt-4",children:a.jsx(eT.x,{className:"h-96",children:0===o.draftSessions.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx(d.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No draft sessions"}),a.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Create draft cards to see them here!"})]}):a.jsx("div",{className:"space-y-4",children:o.draftSessions.map(e=>a.jsx(l.Zb,{className:"hover:shadow-md transition-shadow",children:a.jsx(l.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:e.draftCards.length>0?(0,a.jsxs)("div",{className:"relative",children:[a.jsx("img",{src:e.draftCards[0].frontCover,alt:"Draft preview",className:"w-20 h-28 object-cover rounded-lg border shadow-sm"}),e.draftCards.length>1&&a.jsx(ea.C,{variant:"secondary",className:"absolute -top-2 -right-2 text-xs bg-purple-600 text-white",children:e.draftCards.length})]}):a.jsx("div",{className:"w-20 h-28 bg-gray-100 dark:bg-gray-800 rounded-lg border flex items-center justify-center",children:a.jsx(d.Z,{className:"w-6 h-6 text-gray-400"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.title}),a.jsx("div",{className:"flex items-center gap-2 ml-2",children:(0,a.jsxs)(ea.C,{variant:"outline",className:"text-xs",children:[e.draftCards.length," drafts"]})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx(d.Z,{className:"w-4 h-4"}),N(e.lastModified)]}),e.selectedDraftIndex>=0&&a.jsx("span",{className:"flex items-center gap-1",children:(0,a.jsxs)(ea.C,{variant:"secondary",className:"text-xs",children:["Draft ",e.selectedDraftIndex+1," selected"]})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n.z,{variant:"default",size:"sm",onClick:()=>y(e.id),className:"flex items-center gap-1 bg-purple-600 hover:bg-purple-700",children:[a.jsx(en.Z,{className:"w-4 h-4"}),"Resume"]}),(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>b(e.id),className:"flex items-center gap-1 text-red-600 hover:text-red-700",children:[a.jsx(eF.Z,{className:"w-4 h-4"}),"Delete"]})]})]})]})})},e.id))})})})]})]}),(0,a.jsxs)("div",{className:"border-t p-4 flex items-center justify-between bg-gray-50 dark:bg-gray-800",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o.completedCards.length," completed • ",o.draftSessions.length," drafts"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>{p(),m.Am.success("All history cleared")},className:"text-red-600 hover:text-red-700",children:[a.jsx(eF.Z,{className:"w-4 h-4 mr-1"}),"Clear All"]}),a.jsx(n.z,{variant:"outline",onClick:t,children:"Close"})]})]})]})})}var ez=r(22665),eZ=r(80057);let e_={sympathy:{back:5,leftInterior:20,rightInterior:10},"get-well":{back:10,leftInterior:30,rightInterior:15},"thank-you":{back:15,leftInterior:35,rightInterior:20},wedding:{back:10,leftInterior:30,rightInterior:15},birthday:{back:20,leftInterior:40,rightInterior:20},anniversary:{back:15,leftInterior:35,rightInterior:15},congratulations:{back:20,leftInterior:40,rightInterior:20},"new-baby":{back:15,leftInterior:35,rightInterior:20},holiday:{back:20,leftInterior:40,rightInterior:25},default:{back:15,leftInterior:35,rightInterior:20}};class eL{static{this.SAFETY_REQUIREMENTS=`
- SAFETY: Never include brand names, character names, trademarked terms, or inappropriate content
- Keep content family-friendly and appropriate for all ages
- If the theme references trademarked content, use generic alternatives or focus on the emotions/concepts instead`.trim()}static getVisualDensity(e){return e_[e]||e_.default}static{this.LAYOUT_REQUIREMENTS=`
- Flat 2D artwork for printing
- Full-bleed backgrounds extending to edges
- Keep text, faces, and key elements at least 10% away from top/bottom edges
- Keep text/faces 0.5" from left/right edges for safe printing`.trim()}static{this.TEXT_LEGIBILITY_REQUIREMENTS=`
- EXACT TEXT REPRODUCTION: The message text must be reproduced EXACTLY as written - every word, punctuation mark, and character must be perfect
- PUT TEXT IN QUOTES: Always enclose the message text in double quotes to make it clear this is literal text to be rendered exactly
- CRYSTAL CLEAR LEGIBILITY: The handwriting must be extremely readable - prioritize clarity over artistic flourishes
- NO SPELLING ERRORS: Every word must be spelled correctly exactly as provided
- PROPER SPACING: Use appropriate letter spacing, word spacing, and line spacing for easy reading
- CONTRAST: Ensure high contrast between text and background for maximum readability
- SIZE: Make text large enough to read easily - avoid cramped or tiny text
- COMPLETE MESSAGE: Include the ENTIRE message text - do not truncate, abbreviate, or omit any part
- Use beautiful, clearly readable handwritten cursive script that feels elegant and personal
- Position the message text in the optimal location for readability (center area, avoid top/bottom 10%)`.trim()}static{this.REFERENCE_PHOTO_INSTRUCTIONS=`
CRITICAL CHARACTER REFERENCE INSTRUCTIONS:
- The attached photos show the exact people/characters to include
- Create cartoon/illustrated versions of these specific individuals
- Capture their unique features, hair, clothing style
- Do NOT create generic characters - use the reference photos
- Match their appearance while adapting to the artistic style`.trim()}static{this.QR_CODE_SPACE=`
- IMPORTANT: Leave the bottom-right corner area (approximately 1 inch square) completely clear and undecorated for QR code placement`.trim()}static generateCardPrompts(e){let t=e.customCardType||e.cardType,r=e.theme||`A beautiful ${t} card`,a=e.artisticStyle?.promptModifier||"";`
Theme: "${r}"
Style: ${e.artisticStyle?.label||"Default"}
${e.toField?`To: ${e.toField}`:""}
${e.fromField?`From: ${e.fromField}`:""}
${!e.isFrontBackOnly&&e.message?`Message: "${e.message}"`:""}
${e.referenceImageUrls?.length?`Reference Photos: ${e.referenceImageUrls.length} photo(s) provided for character creation`:""}`.trim();let s={frontCover:this.generateFrontCoverPrompt(t,r,a,e),backCover:this.generateBackCoverPrompt(a,e.cardType)};return e.isFrontBackOnly||(s.leftInterior=this.generateLeftInteriorPrompt(a,e.cardType),s.rightInterior=this.generateRightInteriorPrompt(e.message||"",e.isHandwrittenMessage||!1,a,e.cardType)),s}static generateDraftPrompt(e){let t=e.customCardType||e.cardType,r=e.theme||`A beautiful ${t} card`,a=e.artisticStyle?.promptModifier||"";if(e.isDraftVariation&&void 0!==e.variationIndex){let t=["watercolor painting style with flowing colors and soft edges","beautiful botanical illustration with natural elements","comic book style with bold colors and dynamic composition","dreamy fantasy art with magical ethereal elements","clean minimalist design with simple elegant shapes"];e.variationIndex<t.length&&(a=t[e.variationIndex])}return`You are an expert AI greeting card designer. Create a front cover prompt for a ${t} greeting card.

Theme: "${r}"
Style: ${e.artisticStyle?.label||"Default"}
Tone: ${e.toneLabel} - ${e.toneDescription}
${e.toField?`To: ${e.toField}`:""}
${e.fromField?`From: ${e.fromField}`:""}
${e.referenceImageUrls?.length?`Reference Photos: I have attached ${e.referenceImageUrls.length} reference photo${e.referenceImageUrls.length>1?"s":""} for character creation.`:""}

Front Cover Requirements:
- Include "${t}" greeting text positioned safely in center area (avoid top/bottom 10%)
- Use beautiful, readable handwritten cursive script
- ${e.referenceImageUrls?.length?"Create cartoon/illustrated characters from reference photos":"Create charming cartoon-style figures if needed"}
- Be creative and unique, avoid generic designs
- Flat 2D artwork for printing
- Style: ${a}

Return ONLY the front cover prompt as plain text.`}static generateMessagePrompt(e){let t=e.customCardType||e.cardType,r=e.theme||`A beautiful ${t} card with ${e.toneDescription} style`;return`Create a ${e.toneDescription} message for a ${t} greeting card.

Card Theme/Description: "${r}"
${e.toField?`Recipient: ${e.toField}`:"Recipient: [not specified]"}
${e.fromField?`Sender: ${e.fromField}`:"Sender: [not specified]"}
Card Tone: ${e.toneLabel} - ${e.toneDescription}

Instructions:
- Write a message that is ${e.toneDescription} and feels personal and genuine
- ${e.toField?`Address the message to ${e.toField} directly, using their name naturally`:"Write in a way that could be personalized to any recipient"}
- ${e.fromField?`Write as if ${e.fromField} is personally writing this message`:`Write in a ${e.toneDescription} tone`}
- Match the ${e.toneDescription} tone and occasion of the ${t} card type
- Be inspired by the theme: "${r}"
- Keep it concise but meaningful (2-4 sentences ideal)
- Make it feel authentic, not generic
${this.SAFETY_REQUIREMENTS}
${this.getToneSpecificInstructions(e.tone)}
- ${e.toField&&e.fromField?`Show the relationship between ${e.fromField} and ${e.toField} through the ${e.toneDescription} message tone`:""}
- ${e.fromField?`End the message with a signature line like "Love, ${e.fromField}" or "- ${e.fromField}" or similar, naturally integrated into the message.`:""}

Return ONLY the message text that should appear inside the card - no quotes, no explanations, no markdown formatting (no *bold*, _italics_, or other markdown), just the complete ${e.toneDescription} message in plain text.

IMPORTANT: Wrap your final message in <MESSAGE> </MESSAGE> tags. Everything outside these tags will be ignored.`}static generateFinalFromDraftPrompts(e){e.customCardType||e.cardType,e.theme;let t=e.artisticStyle?.promptModifier||"",r=this.generateBackCoverPromptFromFront(e.frontCoverPrompt,t,e.cardType),a={frontCover:e.frontCoverPrompt,backCover:r};return e.isFrontBackOnly||(a.leftInterior=this.generateLeftInteriorPromptFromFront(e.frontCoverPrompt,t,e.cardType),a.rightInterior=this.generateRightInteriorPromptFromFront(e.frontCoverPrompt,e.message||"",e.isHandwrittenMessage||!1,t,e.cardType)),a}static generateFrontCoverPrompt(e,t,r,a){let s=`Create a beautiful front cover for a ${e} greeting card. ${t}. Include "${e}" greeting text in elegant handwritten script positioned in the center area. ${r} ${this.LAYOUT_REQUIREMENTS}`;return a.referenceImageUrls?.length&&(s+=` ${this.REFERENCE_PHOTO_INSTRUCTIONS}`),s}static generateBackCoverPrompt(e,t){let r=this.getVisualDensity(t);return`Create a very minimal back cover design for a greeting card. Use only ${r.back}% decoration - perhaps a single small motif, a subtle pattern border, or gentle color wash. The design should be understated and elegant, leaving most of the space clean and peaceful. Think of it as a quiet ending to the card experience. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES - only minimal abstract elements. ${e} ${this.LAYOUT_REQUIREMENTS} ${this.QR_CODE_SPACE}`}static generateLeftInteriorPrompt(e,t){let r=this.getVisualDensity(t);return`Create subtle, complementary decorative art for the left interior page of a greeting card. Use soft, muted versions of the card's color palette. Keep decoration minimal and elegant - think ${r.leftInterior}% visual density compared to the front cover. Focus on gentle patterns, soft watercolor washes, delicate florals, or abstract elements that won't compete with the message on the facing page. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES - only decorative and artistic elements. ${e} ${this.LAYOUT_REQUIREMENTS}`}static generateRightInteriorPrompt(e,t,r,a){let s=this.getVisualDensity(a),i=100-s.rightInterior;return t?`Create an elegant writing space for the right interior page. Add very subtle decorative elements - perhaps just delicate corner flourishes or a faint border. Keep ${i}% of the page clean white/cream space for handwriting. The decoration should whisper, not shout. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES - only minimal decorative elements. ${r} ${this.LAYOUT_REQUIREMENTS}`:`Create the right interior page with this exact message as the absolute focal point: "${e}". 
    
${this.TEXT_LEGIBILITY_REQUIREMENTS}

The message should be the star - use elegant handwritten script positioned perfectly for reading. Add only minimal decoration (${s.rightInterior}% of the page) such as:
- Delicate corner flourishes
- A single small decorative element above or below the text
- Very subtle background texture or soft color wash
- Thin, elegant border elements

The decoration should enhance the message, not compete with it. Think of a premium wedding invitation - mostly white space with perfect typography. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES - only minimal decorative elements. ${r} ${this.LAYOUT_REQUIREMENTS}`}static generateBackCoverPromptFromFront(e,t,r){let a=this.getVisualDensity(r);return`Create a very minimal back cover for a greeting card. Extract ONLY the color palette and artistic style from this description BUT create a much simpler design: "${e}". 
    
Use only ${a.back}% visual density - perhaps a single small element, subtle corner detail, or soft color gradient. Most of the back should be clean, peaceful space. Think elegant minimalism. IMPORTANT: DO NOT include any people, characters, or figures. ${t} ${this.LAYOUT_REQUIREMENTS} ${this.QR_CODE_SPACE}`}static generateLeftInteriorPromptFromFront(e,t,r){let a=this.getVisualDensity(r);return`Create subtle left interior page art for a greeting card. Extract the color palette and artistic style from this description BUT create a much softer, more minimal design (${a.leftInterior}% visual density): "${e}". 
    
Use muted, pastel versions of the colors. Focus on gentle elements like soft watercolor washes, delicate patterns, or subtle textures. This page should complement but not compete with the message on the facing page. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES. ${t} ${this.LAYOUT_REQUIREMENTS}`}static generateRightInteriorPromptFromFront(e,t,r,a,s){return r?`Create an elegant, minimal writing space for the right interior of a greeting card. Extract ONLY subtle style hints from: "${e}". 
      
Keep 80% of the page as clean white/cream space for handwriting. Add only whisper-light decoration - perhaps faint corner flourishes or a delicate border. The page should feel premium and understated. NO PEOPLE, NO CHARACTERS, NO FIGURES. ${a} ${this.LAYOUT_REQUIREMENTS}`:`Create a right interior page where this message is the absolute star: "${t}". 

Use subtle style elements from the front design but keep decoration minimal (10-20% of page). Extract color hints from: "${e}".

${this.TEXT_LEGIBILITY_REQUIREMENTS} 

Think premium stationery - mostly white space, perfect message placement, and just a touch of elegant decoration (corner details, small flourish, or soft wash). The message should dominate the visual hierarchy. NO PEOPLE, NO CHARACTERS, NO FIGURES. ${a} ${this.LAYOUT_REQUIREMENTS}`}static getToneSpecificInstructions(e){return({funny:"- Include appropriate humor that fits the occasion","genz-humor":'- Use GenZ humor with internet slang, memes, and chaotic energy - think "no cap", "periodt", "it\'s giving...", "slay", etc. Be unhinged but endearing',professional:"- Keep it formal and business-appropriate",romantic:"- Include loving and romantic language",playful:"- Use fun and energetic language"})[e]||""}static enhancePromptWithReferencePhotos(e,t,r){return t&&"gpt-1"===r?`${e}

${this.REFERENCE_PHOTO_INSTRUCTIONS}`:e}static formatPromptGenerationQuery(e,t,r){return`Create prompts for a greeting card.

${e}

Requirements:
${this.LAYOUT_REQUIREMENTS}
${this.SAFETY_REQUIREMENTS}
${t}

Return JSON:
${r}`}}let eG="https://vibecarding.com",eH=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,eY=e=>{let t=Math.floor(e/60),r=Math.floor(e%60);return t>0?`${t}m ${r}s`:`${r}s`};async function eB(e,t,r){if(console.log("\uD83D\uDCE7 sendThankYouEmail called with:",{toEmail:e,cardType:t,cardUrl:r}),!e.trim()){console.log("\uD83D\uDCE7 sendThankYouEmail - toEmail is empty, returning");return}try{let a=`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; color: #333;">
        <div style="text-align: center; margin-bottom: 30px;">
          <h1 style="color: #2563eb; margin-bottom: 10px;">🎉 Your Card is Ready!</h1>
        </div>
        
        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">Hi there!</p>
        
        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
          Thank you for using VibeCarding to create your beautiful <strong>${t}</strong> card!
        </p>
        
        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
          We hope you love how it turned out. Your card has been generated and is ready for printing or sharing.
        </p>
        
        <div style="text-align: center; margin: 30px 0;">
          <a href="${r}" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;">
            View Your Card
          </a>
        </div>
        
        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
          If you have any questions or feedback, feel free to reach out to us.
        </p>
        
        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
          Happy card making!
        </p>
        
        <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280;">
          <p style="margin-bottom: 5px;"><strong>Best regards,</strong></p>
          <p style="margin-bottom: 5px;">The VibeCarding Team</p>
          <p style="margin: 0;">
            <a href="mailto:vibecarding@ast.engineer" style="color: #2563eb; text-decoration: none;">vibecarding@ast.engineer</a>
          </p>
        </div>
      </div>
    `,s=`Hi there!

Thank you for using VibeCarding to create your beautiful ${t} card!

We hope you love how it turned out. Your card has been generated and is ready for printing or sharing.

View your card: ${r}

If you have any questions or feedback, feel free to reach out to us.

Happy card making!

Best regards,
The VibeCarding Team
vibecarding@ast.engineer`;console.log("\uD83D\uDCE7 Attempting to send email to user:",e);let i=await fetch(`${eG}/send_email_nodejs_style`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({to:e,from:"vibecarding@ast.engineer",subject:`Your ${t} card is ready!`,body:a,text:s,html:a})});if(console.log("\uD83D\uDCE7 User email response status:",i.status),i.ok){let e=await i.json();console.log("\uD83D\uDCE7 User email response data:",e)}await fetch(`${eG}/send_email_nodejs_style`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:"jordan@ast.engineer",from:"vibecarding@ast.engineer",subject:`Card Created - ${t} for ${e}`,body:`<div style="font-family: Arial, sans-serif; padding: 20px;">
          <h3 style="color: #2563eb;">New Card Created on VibeCarding</h3>
          <p><strong>User:</strong> ${e}</p>
          <p><strong>Card Type:</strong> ${t}</p>
          <p><strong>Card URL:</strong> <a href="${r}">${r}</a></p>
          <p style="margin-top: 20px; color: #6b7280; font-size: 14px;">
            This is an automated notification of card creation activity.
          </p>
        </div>`,text:`New card created on VibeCarding:

User: ${e}
Card Type: ${t}
Card URL: ${r}

This is an automated notification of card creation activity.`})}),i.ok&&m.Am.success("✉️ Thank you email sent!")}catch(e){console.error("Failed to send thank you email:",e)}}async function eq(e,t={}){let{systemPrompt:r=null,model:a="gemini-2.5-pro",includeThoughts:s=!1,jsonSchema:i=null,attachments:l=[]}=t;try{let t;let n=await fetch("/internal/call_mcp_tool",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"ai_chat",arguments:{messages:e,system_prompt:r,model:a,include_thoughts:s,json_schema:i,...l.length>0&&{attachments:l}}})});if(!n.ok)throw Error(`HTTP ${n.status}`);let o=await n.json();if(o.error&&"None"!==o.error&&null!==o.error)throw Error(o.error);if("string"==typeof o.result)try{t=JSON.parse(o.result)}catch{t={status:"error",message:"Invalid JSON response"}}else t=o.result;if("error"===t.status)throw Error(t.message);return t.response}catch(e){throw console.error("AI chat failed:",e),e}}let eW=[{id:"funny",label:"\uD83D\uDE04 Funny",description:"Humorous and lighthearted"},{id:"genz-humor",label:"\uD83D\uDC80 GenZ Humor",description:"Internet memes, chaotic energy, and unhinged vibes"},{id:"romantic",label:"\uD83D\uDC95 Romantic",description:"Sweet and loving"},{id:"professional",label:"\uD83D\uDC54 Professional",description:"Formal and business-appropriate"},{id:"heartfelt",label:"❤️ Heartfelt",description:"Sincere and emotional"},{id:"playful",label:"\uD83C\uDF89 Playful",description:"Fun and energetic"},{id:"elegant",label:"✨ Elegant",description:"Sophisticated and refined"},{id:"casual",label:"\uD83D\uDE0A Casual",description:"Relaxed and friendly"},{id:"inspirational",label:"\uD83C\uDF1F Inspirational",description:"Motivating and uplifting"},{id:"quirky",label:"\uD83E\uDD2A Quirky",description:"Unique and unconventional"},{id:"traditional",label:"\uD83C\uDFAD Traditional",description:"Classic and timeless"}],eV=[{id:"ai-smart-style",label:"✨ Smart Style",description:"Let our experts choose the perfect style for your card",promptModifier:""},{id:"custom",label:"✨ Custom Style",description:"Define your own unique artistic style",promptModifier:""},{id:"watercolor",label:"\uD83C\uDFA8 Watercolor",description:"Soft, flowing paint effects (our personal favorite)",promptModifier:"in watercolor painting style, with soft flowing colors, artistic brush strokes, paper texture, and organic paint bleeds"},{id:"minimalist",label:"✨ Minimalist",description:"Clean, simple, elegant design",promptModifier:"in minimalist style with clean lines, simple shapes, plenty of white space, sophisticated typography, and elegant simplicity"},{id:"botanical",label:"\uD83C\uDF3F Botanical",description:"Beautiful flowers and nature elements",promptModifier:"in botanical illustration style with detailed flowers, leaves, and natural elements, soft organic shapes, elegant floral arrangements, and nature-inspired designs perfect for greeting cards"},{id:"comic-book",label:"\uD83D\uDCA5 Comic Book",description:"Bold graphic novel style",promptModifier:"in comic book art style with bold outlines, vibrant colors, dynamic poses, speech bubble aesthetics, halftone patterns, and superhero comic book visual elements that create an exciting and energetic feel"},{id:"dreamy-fantasy",label:"\uD83C\uDF38 Dreamy Fantasy",description:"Enchanting anime-inspired art",promptModifier:"in dreamy fantasy anime style, with soft pastels, magical atmosphere, detailed nature elements, whimsical characters, and enchanting fairy-tale qualities"},{id:"art-deco",label:"✨ Art Deco",description:"Elegant 1920s geometric luxury",promptModifier:"in vintage Art Deco style with geometric patterns, gold accents, elegant typography, luxurious details, and 1920s glamour"},{id:"vintage-illustration",label:"\uD83D\uDCDA Vintage Illustration",description:"Classic storybook charm",promptModifier:"in vintage illustration style like classic children's books, with warm nostalgic colors, charming characters, whimsical details, and timeless fairy-tale aesthetics"},{id:"modern-geometric",label:"\uD83D\uDD37 Modern Geometric",description:"Clean contemporary shapes",promptModifier:"in modern geometric style with clean shapes, contemporary design elements, balanced compositions, and sophisticated color palettes perfect for modern greeting cards"},{id:"soft-pastel",label:"\uD83C\uDF38 Soft Pastel",description:"Gentle, soothing colors",promptModifier:"in soft pastel style with gentle colors, dreamy atmosphere, delicate textures, and calming visual elements that create a peaceful and heartwarming feeling"},{id:"retro-vintage",label:"\uD83D\uDCFB Retro Vintage",description:"Classic 1950s-60s nostalgia",promptModifier:"in retro vintage style with 1950s-60s aesthetics, classic typography, warm nostalgic colors, and mid-century design elements"}],eQ=[{id:"standard",label:"5\xd77 Card (Standard)",description:"Standard 5\xd77 greeting card (10\xd77 print layout)",aspectRatio:"9:16",dimensions:"1024x1536",printWidth:"10in",printHeight:"7in"},{id:"compact",label:"4\xd76 Card (Compact)",description:"Compact 4\xd76 greeting card (8\xd76 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8in",printHeight:"6in"},{id:"a6",label:"A6 Card (4\xd76)",description:"A6 paper size (8.3\xd75.8 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8.3in",printHeight:"5.8in"}],eJ={selectedType:"birthday",customCardType:"",selectedTone:"funny",toField:"",fromField:"",prompt:"",finalCardMessage:"",isHandwrittenMessage:!1,selectedArtisticStyle:"watercolor",customStyleDescription:"",referenceImages:[],referenceImageUrls:[],imageTransformation:"",userEmail:"",selectedImageModel:"gpt-image-1",selectedDraftModel:"gpt-image-1",selectedPaperSize:"standard",numberOfCards:1,isFrontBackOnly:!1},eK="vibecarding-wizard-form-data",eX="vibecarding-wizard-state",e0=[{id:"basics",title:"Card Basics",mobileTitle:"Basics",description:"Choose your card type and tone"},{id:"content",title:"Content & Message",mobileTitle:"Content",description:"Describe your card and write your message"},{id:"personalization",title:"Personalization",mobileTitle:"Style",description:"Choose artistic style and add photos",isOptional:!0},{id:"details",title:"Email Address",mobileTitle:"Email",description:"Where to send your finished card"},{id:"drafts",title:"Draft Selection",mobileTitle:"Drafts",description:"Choose from 5 design variations"},{id:"generate",title:"Final Generation",mobileTitle:"Generate",description:"Creating your complete card"}];function e1(){let e=function(){let[e,t]=(0,s.useState)(eJ),[r,a]=(0,s.useState)(!1),i=(0,s.useCallback)(e=>{t(t=>({...t,...e}))},[]),l=(0,s.useCallback)(()=>{t(eJ);try{localStorage.removeItem(eK)}catch(e){console.warn("Failed to clear form data from localStorage:",e)}},[]),n=(0,s.useCallback)(()=>{try{localStorage.removeItem(eK),localStorage.removeItem("vibecarding-wizard-state")}catch(e){console.warn("Failed to clear stored data:",e)}},[]),o=(0,s.useCallback)(t=>{switch(t){case 1:if(!e.selectedType||"custom"===e.selectedType&&!e.customCardType.trim()||!e.selectedTone)return!1;return!0;case 2:return!0;case 3:if("custom"===e.selectedArtisticStyle&&!e.customStyleDescription.trim()||e.referenceImageUrls.length>0&&"gpt-image-1"!==e.selectedImageModel)return!1;return!0;case 4:if(!e.userEmail.trim()||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.userEmail))return!1;return!0;case 5:return o(1)&&o(2)&&o(3)&&o(4);default:return!1}},[e]),d=(0,s.useCallback)(t=>{let r=[];switch(t){case 1:let a="custom"===e.selectedType?e.customCardType:e.selectedType;r.push(`Card Type: ${a||"Not selected"}`),r.push(`Tone: ${e.selectedTone||"Not selected"}`),e.toField&&r.push(`To: ${e.toField}`),e.fromField&&r.push(`From: ${e.fromField}`);break;case 2:e.prompt&&r.push(`Description: ${e.prompt.substring(0,50)}...`),e.finalCardMessage&&r.push(`Message: ${e.finalCardMessage.substring(0,50)}...`),e.isHandwrittenMessage&&r.push("Handwritten message space included");break;case 3:r.push(`Style: ${e.selectedArtisticStyle}`),e.referenceImageUrls.length>0&&r.push(`Reference photos: ${e.referenceImageUrls.length} uploaded`);break;case 4:r.push(`Email: ${e.userEmail}`),r.push(`Model: ${e.selectedImageModel}`),r.push(`Paper: ${e.selectedPaperSize}`),e.isFrontBackOnly&&r.push("Front/back only")}return r},[e]),c=(0,s.useCallback)(t=>{let r=[];switch(t){case 1:e.selectedType||r.push("Please select a card type"),"custom"!==e.selectedType||e.customCardType.trim()||r.push("Please describe your custom card type"),e.selectedTone||r.push("Please select a tone");break;case 3:"custom"!==e.selectedArtisticStyle||e.customStyleDescription.trim()||r.push("Please describe your custom artistic style"),e.referenceImageUrls.length>0&&"gpt-image-1"!==e.selectedImageModel&&r.push("Reference photos are only supported with GPT Image 1 model");break;case 4:e.userEmail.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.userEmail)||r.push("Please enter a valid email address"):r.push("Email address is required")}return r},[e]);return{formData:e,updateFormData:i,resetForm:l,clearStoredData:n,validateStep:o,getStepSummary:d,getValidationErrors:c,isInitialLoadComplete:r}}(),t=function(){let[e,t]=(0,s.useState)({currentStep:1,completedSteps:[],timestamp:Date.now()}),[r,a]=(0,s.useState)(!1),i=(0,s.useCallback)(e=>{t(t=>({...t,currentStep:e}))},[]),l=(0,s.useCallback)(e=>{t(t=>({...t,completedSteps:e}))},[]),n=(0,s.useCallback)(e=>{t(t=>({...t,completedSteps:t.completedSteps.includes(e)?t.completedSteps:[...t.completedSteps,e].sort((e,t)=>e-t)}))},[]),o=(0,s.useCallback)(e=>{t(t=>({...t,completedSteps:t.completedSteps.filter(t=>t!==e)}))},[]),d=(0,s.useCallback)(()=>{t({currentStep:1,completedSteps:[],timestamp:Date.now()});try{localStorage.removeItem(eX)}catch(e){console.warn("Failed to clear wizard state from localStorage:",e)}},[]),c=(0,s.useCallback)(()=>{try{localStorage.removeItem(eX)}catch(e){console.warn("Failed to clear stored wizard state:",e)}},[]),m=(0,s.useCallback)(()=>{t(e=>({...e,currentStep:e.currentStep+1}))},[]),u=(0,s.useCallback)(()=>{t(e=>({...e,currentStep:Math.max(1,e.currentStep-1)}))},[]),g=(0,s.useCallback)(e=>{t(t=>({...t,currentStep:e}))},[]);return{currentStep:e.currentStep,completedSteps:e.completedSteps,setCurrentStep:i,setCompletedSteps:l,markStepCompleted:n,markStepIncomplete:o,resetWizardState:d,clearStoredWizardState:c,goToNextStep:m,goToPreviousStep:u,goToStep:g,isInitialLoadComplete:r}}(),r=eR(),i=function(){let e=(0,s.useRef)(null),[t,r]=(0,s.useState)(!1),a=(0,s.useRef)(null),i=(0,s.useRef)(Date.now()),[l,n]=(0,s.useState)(""),[o,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[g,h]=(0,s.useState)(""),[p,f]=(0,s.useState)("birthday"),[x,y]=(0,s.useState)(""),[b,v]=(0,s.useState)("funny"),[j,w]=(0,s.useState)(!1),[N,k]=(0,s.useState)(null),[C,D]=(0,s.useState)(1),[S,T]=(0,s.useState)([]),[E,I]=(0,s.useState)(0),[$,P]=(0,s.useState)(!1),[F,A]=(0,s.useState)(!1),[R,M]=(0,s.useState)("watercolor"),[O,U]=(0,s.useState)(""),[z,Z]=(0,s.useState)("gpt-image-1"),[_,L]=(0,s.useState)("gpt-image-1"),[G,H]=(0,s.useState)(""),[Y,B]=(0,s.useState)(0),[q,W]=(0,s.useState)(null),[V,Q]=(0,s.useState)(!1),[J,K]=(0,s.useState)(null),[X,ee]=(0,s.useState)(!0),[et,er]=(0,s.useState)(!1),[ea,es]=(0,s.useState)([]),[ei,el]=(0,s.useState)([]),[en,eo]=(0,s.useState)(-1),[ed,ec]=(0,s.useState)(!1),[em,eu]=(0,s.useState)(-1),[eg,eh]=(0,s.useState)(!1),[ep,ef]=(0,s.useState)(0),[ex,ey]=(0,s.useState)(null),[eb,ev]=(0,s.useState)(null),[ej,ew]=(0,s.useState)([]),[eN,ek]=(0,s.useState)([]),[eC,eD]=(0,s.useState)(""),[eS,eT]=(0,s.useState)(!1),[eE,eI]=(0,s.useState)(""),[e$,eP]=(0,s.useState)(null),[eF,eA]=(0,s.useState)(!1),[eR,eM]=(0,s.useState)(!1),[eO,eU]=(0,s.useState)("standard"),[e_,eJ]=(0,s.useState)({frontCover:"idle",backCover:"idle",leftInterior:"idle",rightInterior:"idle"}),[eK,eX]=(0,s.useState)(0),[e0,e1]=(0,s.useState)(!1),[e2,e3]=(0,s.useState)(!1),[e4,e5]=(0,s.useState)(!1),[e8,e6]=(0,s.useState)([]),[e9,e7]=(0,s.useState)(-1),[te,tt]=(0,s.useState)(""),[tr,ta]=(0,s.useState)(!1),[ts,ti]=(0,s.useState)(!1),[tl,tn]=(0,s.useState)(!1),[to,td]=(0,s.useState)(!1),[tc,tm]=(0,s.useState)(""),[tu,tg]=(0,s.useState)(!1),[th,tp]=(0,s.useState)([]),[tf,tx]=(0,s.useState)("text"),[ty,tb]=(0,s.useState)([]),[tv,tj]=(0,s.useState)(!1),[tw,tN]=(0,s.useState)("physical"),[tk,tC]=(0,s.useState)(!1),[tD,tS]=(0,s.useState)(null),[tT,tE]=(0,s.useState)(null),[tI,t$]=(0,s.useState)(0),[tP,tF]=(0,s.useState)(null),[tA,tR]=(0,s.useState)(!1),[tM,tO]=(0,s.useState)(null),[tU,tz]=(0,s.useState)({promptChanges:"",messageChanges:"",useReferenceImage:!1,referenceImageFile:null,referenceImageUrls:[],referenceImageTransformation:""}),tZ=(e,t)=>{},t_=(0,s.useCallback)(()=>{if(e.current?.connected){console.log("✅ WebSocket already connected");return}try{console.log("\uD83D\uDD0C Connecting to WebSocket...");let t=(0,eZ.ZP)(eG,{transports:["websocket","polling"],timeout:1e4,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});t.on("connect",()=>{console.log("✅ WebSocket connected:",t.id),r(!0),m.Am.success("\uD83D\uDD17 Real-time updates connected"),a.current&&(console.log("\uD83D\uDD04 Resubscribing to job:",a.current),t.emit("subscribe_job",{job_id:a.current}))}),t.on("disconnect",e=>{console.log("❌ WebSocket disconnected:",e),r(!1),"io server disconnect"===e&&t.connect()}),t.on("connect_error",e=>{console.error("❌ WebSocket connection error:",e),r(!1)}),t.on("job_update",e=>{console.log("\uD83D\uDCE6 Job update received:",e),tY(e)}),e.current=t}catch(e){console.error("❌ Failed to connect WebSocket:",e),m.Am.error("Failed to connect real-time updates. Using fallback mode.")}},[]),tL=(0,s.useCallback)(()=>{e.current&&(console.log("\uD83D\uDD0C Disconnecting WebSocket..."),e.current.disconnect(),e.current=null,r(!1))},[]),tG=(0,s.useCallback)(t=>{a.current=t,e.current?.connected?(console.log("\uD83D\uDCE1 Subscribing to job updates:",t),e.current.emit("subscribe_job",{job_id:t})):console.log("⏳ WebSocket not connected, will subscribe when connected")},[]),tH=(0,s.useCallback)(t=>{a.current===t&&(a.current=null),e.current?.connected&&(console.log("\uD83D\uDCE1 Unsubscribing from job updates:",t),e.current.emit("unsubscribe_job",{job_id:t}))},[]),tY=(0,s.useCallback)(e=>{let{job_id:t,status:r,progress:s,cardData:l,error:n,completedAt:o}=e;if(!t)return;let d=t.startsWith("draft-"),c=d?parseInt(t.split("-")[1]):-1;if(console.log("\uD83D\uDD04 Processing job update:",{job_id:t,status:r,isDraftJob:d,draftIndex:c,progress:s}),t===a.current&&(i.current=Date.now()),s){H(s);let e=s.match(/(\d+)%/);if(e){let t=parseInt(e[1]);eX(t),console.log(`📊 Progress update: ${t}% - ${s}`)}}if("completed"===r&&l){if(console.log("\uD83C\uDF89 Job completed! Card data:",l,"isDraftJob:",d),d&&c>=0){let e;if(console.log(`🎨 Draft variation ${c+1} completed!`),"ai-smart-style"===R){let t=["watercolor","botanical","comic-book","dreamy-fantasy","minimalist"];c>=0&&c<t.length&&(e={styleName:t[c],styleLabel:["\uD83C\uDFA8 Watercolor","\uD83C\uDF3F Botanical","\uD83D\uDCA5 Comic Book","\uD83C\uDF38 Dreamy Fantasy","✨ Minimalist"][c]})}let r={id:`draft-${c+1}-${Date.now()}`,prompt:l.prompt||`Draft Variation ${c+1}`,frontCover:l.frontCover||"",backCover:"",leftPage:"",rightPage:"",createdAt:new Date,generatedPrompts:{frontCover:l.generatedPrompts?.frontCover||""},styleInfo:e};es(e=>{let t=[...e];return t.push(r),t}),el(e=>{let t=[...e];return t.push(c),t}),ef(e=>{let t=e+1;return console.log(`📊 Draft progress: ${t}/5 front cover variations complete`),1===t&&tq(),5===t?(ed||(w(!1),H(""),eX(100),tV()),eh(e=>e||ed?e:(m.Am.success("\uD83C\uDFA8 All 5 front cover variations ready! Choose your favorite below."),!0))):(H(`✨ ${t}/5 front cover variations complete... ${t>=2?"You can select one now to proceed!":""}`),eX(t/5*100)),t}),t1(t)}else tB(l),t1(t),K(null),tH(t)}else"failed"===r?(console.error("❌ Job failed:",n),d&&c>=0?m.Am.error(`Draft variation ${c+1} failed. Continuing with others...`):(m.Am.error("❌ Card generation failed. Please try again."),w(!1),ec(!1),tV(),H(""),eX(0),K(null),tH(t)),t1(t)):"not_found"===r&&(console.warn("⚠️ Job not found on server, cleaning up stale reference:",t),a.current===t&&(a.current=null),J===t&&(K(null),w(!1),ec(!1),H(""),eX(0),tV()),t1(t),tH(t))},[R,ed]),tB=(0,s.useCallback)(async e=>{console.log("\uD83C\uDFAF handleFinalCardCompletion called with cardData:",e),console.log("\uD83C\uDFAF Current userEmail state:",eE);let t={...e};t.createdAt?("string"==typeof t.createdAt||"number"==typeof t.createdAt)&&(t.createdAt=new Date(t.createdAt)):t.createdAt=new Date,t.id||(t.id=`card-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),console.log("\uD83D\uDD04 Final card data prepared:",t),console.log("✅ Card completion processing finished - QR codes handled by backend"),console.log("\uD83C\uDFAF Setting final card state:",t),k(t),T([t]),I(0),Q(!0),w(!1),ec(!1),er(!1),eh(!1),ef(0),H(""),tq(),e.generationTimeSeconds&&tS(e.generationTimeSeconds),tV(),eX(100),H("Card generation complete!"),m.Am.success("\uD83C\uDF89 Your card is ready!"),eE.trim()&&m.Am.success(`✉️ Card sent to ${eE}`,{duration:5e3}),console.log("\uD83D\uDCE7 Email sending disabled - backend handles email notifications"),console.log("✅ Final card completion process finished successfully")},[eE,p,x]),tq=()=>{setTimeout(()=>{let e=document.querySelector("[data-card-preview]");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},500)},tW=(e,t)=>{let r=e||Date.now();tE(r),tP&&clearInterval(tP),tF(setInterval(()=>{let e=(Date.now()-r)/1e3;t$(e),eX(Math.min(e/(t||(et?45:150))*100,95))},1e3))},tV=()=>{tP&&(clearInterval(tP),tF(null))},tQ=async(e,t)=>{if(!e.type.startsWith("image/")){m.Am.error("Please upload an image file");return}eT(!0);try{let r=new FormData;r.append("file",e);let a=await fetch(`${eG}/upload`,{method:"POST",body:r});if(!a.ok)throw Error(`Upload failed: ${a.status}`);let s=await a.json();"handwriting"===t?(ey(e),ev(s.url),m.Am.success("Handwriting sample uploaded!")):(ew(t=>[...t,e]),ek(e=>[...e,s.url]),console.log("\uD83D\uDD0D DEBUG: Reference image uploaded successfully:",{fileName:e.name,url:s.url,totalImages:ej.length+1}),m.Am.success(`Reference image uploaded! ${ej.length+1} photo${ej.length+1>1?"s":""} ready for character creation.`))}catch(e){m.Am.error("Upload failed. Please try again.")}finally{eT(!1)}},tJ=e=>{if(""===e.trim())return;let t=e.replace(/<\/?MESSAGE>/g,"").trim();if(""===t)return;let r=e8.slice(0,e9+1);r.push(t),r.length>10?r.shift():e7(e9+1),e6(r),e7(r.length-1)},tK=async()=>{if("custom"===p&&!x.trim()){m.Am.error("Please describe your custom card type first!");return}P(!0);try{let e="custom"===p?x:p,t=eW.find(e=>e.id===b),r=t?t.description.toLowerCase():"heartfelt and sincere",a=l.trim()||`A beautiful ${e} card with ${r} style`,s={cardType:p,customCardType:x,tone:b,toneLabel:t?t.label:"Heartfelt",toneDescription:r,theme:a,toField:c,fromField:g},i=eL.generateMessagePrompt(s),n=await eq(i,{model:"gemini-2.5-pro",includeThoughts:!1});if(n?.trim()){let e=n.match(/<MESSAGE>([\s\S]*?)<\/MESSAGE>/),t=e?e[1].trim():n.trim();return t=t.replace(/<\/?MESSAGE>/g,"").trim(),o.trim()&&o.trim()!==t&&tJ(o),d(t),tJ(t),m.Am.success("✨ Personalized message created!"),t}}catch(e){return m.Am.error("Failed to generate message. Please try again."),null}finally{P(!1)}},tX=async()=>{if(!eE.trim()){m.Am.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(eE)){m.Am.error("Please enter a valid email address");return}if("custom"===R&&!O.trim()){m.Am.error("Please describe your custom artistic style");return}if(eN.length>0&&"gpt-image-1"!==z){m.Am.error("Reference photos are only supported with GPT Image 1 model. Please switch to GPT Image 1 in Advanced Options or remove reference photos.");return}er(!1),es([]),el([]),eo(-1),ec(!1),eu(-1),eh(!1),ef(0),T([]),k(null),I(0),eP(null),Q(!1),w(!0),tW(void 0,120),H("Creating your personalized card..."),eX(0);try{let e=(0,ez.Z)();K(e);let t="custom"===p?x:p,r=eW.find(e=>e.id===b),a=o;if(eF)a="[Blank space for handwritten message]";else if(!a.trim()&&!eR){H("✍️ Writing the perfect message...");let e=`Create a heartfelt message for a ${t} greeting card.

Card Theme/Description: "${l||`A beautiful ${t} card`}"
${c?`Recipient: ${c}`:"Recipient: [not specified]"}
${g?`Sender: ${g}`:"Sender: [not specified]"}

Instructions:
- Write a message that feels personal and genuine
- Keep it concise but meaningful (2-4 sentences ideal)
- Make it feel authentic, not generic
- Keep content family-friendly and appropriate for all ages
- ${g?`End the message with a signature line like "Love, ${g}" or "- ${g}" or similar, naturally integrated into the message.`:""}

Return ONLY the message text that should appear inside the card.

IMPORTANT: Wrap your final message in <MESSAGE> </MESSAGE> tags.`,r=await eq(e,{model:"gemini-2.5-pro",includeThoughts:!1});if(r?.trim()){let e=r.match(/<MESSAGE>([\s\S]*?)<\/MESSAGE>/);e&&e[1]&&(a=e[1].trim(),d(a))}}let s=eV.find(e=>e.id===R);"custom"===R||s?.promptModifier;let i=eQ.find(e=>e.id===eO)||eQ[0];H("\uD83C\uDFA8 Creating artistic vision for your card...");let n={cardType:p,customCardType:x,tone:b,toneDescription:r?.description.toLowerCase()||"heartfelt and sincere",theme:l||`A beautiful ${t} card`,toField:c,fromField:g,message:a,isHandwrittenMessage:eF,artisticStyle:s,referenceImageUrls:eN,isFrontBackOnly:eR,selectedImageModel:z},u=eL.generateCardPrompts(n);eN.length>0&&"gpt-1"===z&&(u.frontCover=eL.enhancePromptWithReferencePhotos(u.frontCover,!0,z));let h={frontCover:u.frontCover,backCover:u.backCover,...eR?{}:{leftInterior:u.leftInterior,rightInterior:u.rightInterior}};if(!h||!h.frontCover)throw Error("Failed to generate image prompts");let f={prompt:l||`A beautiful ${t} card`,selectedType:p,customCardType:x,selectedTone:b,finalCardMessage:a,toField:c,fromField:g,userEmail:eE,selectedArtisticStyle:R,customStyleDescription:O,selectedImageModel:z,isFrontBackOnly:eR,numberOfCards:C,selectedPaperSize:eO,prompts:h,paperConfig:i};tZ(e,f),H("\uD83D\uDE80 Starting background generation...");let y=[];eN.length>0&&"gpt-image-1"===z&&y.push(...eN);let v=await fetch("/api/generate-card-async",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:e,prompts:h,config:{userNumber:"+17145986105",modelVersion:z,aspectRatio:i.aspectRatio,quality:"medium",outputFormat:"jpeg",outputCompression:100,moderation:"low",dimensions:i.dimensions,isFrontBackOnly:eR,userEmail:eE,cardType:t,toField:c,fromField:g,isDraftMode:!1,...y.length>0&&{input_images:y,input_images_mode:"front_cover_only"}}})});if(!v.ok)throw Error(`Server error: ${v.status}`);let j=await v.json();if("processing"!==j.status)throw Error(j.message||"Failed to start card generation");H("✨ Bringing your vision to life..."),m.Am.success("\uD83C\uDF89 Card generation started!"),tG(e)}catch(e){console.error("Card generation error:",e),m.Am.error("Failed to generate card. Please try again."),J&&(t1(J),K(null)),w(!1),H(""),tV()}},t0=async()=>{if(!eE.trim()){m.Am.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(eE)){m.Am.error("Please enter a valid email address");return}if("custom"===R&&!O.trim()){m.Am.error("Please describe your custom artistic style");return}if(eN.length>0&&"gpt-image-1"!==_){m.Am.error("Reference photos are only supported with GPT Image 1 model. Please switch to GPT Image 1 for draft mode or remove reference photos.");return}er(!0),w(!0),tW(void 0,45),H("\uD83C\uDFA8 Creating 5 front cover variations for you to choose from..."),eX(0),es([]),el([]),eo(-1),eh(!1),ef(0),k(null),T([]),Q(!1);try{console.log("\uD83D\uDE80 Starting draft mode generation with 5 variations");let e="custom"===p?x:p,t=eW.find(e=>e.id===b),r=t?t.description.toLowerCase():"heartfelt and sincere",a=l.trim()||`A beautiful ${e} card with ${r} style`;if("gpt-image-1"===_){let e="ai-smart-style"===R?" across 5 curated artistic styles!":" (using low quality for fast previews)!";m.Am.success(`🎨 Generating 5 front cover variations with GPT-1${e}`)}else{let e="ai-smart-style"===R?" across 5 curated artistic styles!":" for you to choose from!";m.Am.success(`🎨 Generating 5 front cover variations${e}`)}let s=Array.from({length:5},async(s,i)=>{try{let s,l;console.log(`🎨 Starting draft variation ${i+1}`),"ai-smart-style"===R&&(s=["watercolor","botanical","comic-book","dreamy-fantasy","minimalist"][i],l=["\uD83C\uDFA8 Watercolor","\uD83C\uDF3F Botanical","\uD83D\uDCA5 Comic Book","\uD83C\uDF38 Dreamy Fantasy","✨ Minimalist"][i],console.log(`🎨 Draft ${i+1}: Using predefined style "${s}" (${l})`));let n=eV.find(e=>e.id===(s||R));s&&"custom"===s||n?.promptModifier;let o={cardType:p,customCardType:x,tone:b,toneLabel:t?t.label:"Heartfelt",toneDescription:r,theme:a,toField:c,fromField:g,artisticStyle:n,referenceImageUrls:eN,isDraftVariation:"smart"===R,variationIndex:i},d=eL.generateDraftPrompt(o),m=await eq(d,{model:"gemini-2.5-pro",attachments:eN});if(!m?.trim())throw Error("Failed to generate front cover prompt");let u=m.trim();u=eL.enhancePromptWithReferencePhotos(u,eN.length>0,_);let h=`draft-${i}-${(0,ez.Z)()}`,f=[];eN.length>0&&"gpt-image-1"===_&&f.push(...eN);let y=await fetch("/api/generate-card-async",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:h,prompts:{frontCover:u},config:{userNumber:"+17145986105",modelVersion:_,aspectRatio:eQ.find(e=>e.id===eO)?.aspectRatio||"9:16",quality:"low",outputFormat:"jpeg",outputCompression:100,moderation:"low",dimensions:eQ.find(e=>e.id===eO)?.dimensions||"1024x1536",isFrontBackOnly:!0,userEmail:eE,cardType:e,toField:c,fromField:g,isDraftMode:!0,...f.length>0&&{input_images:f,input_images_mode:"front_cover_only"}}})});if(!y.ok)throw Error(`Server error: ${y.status}`);let v=await y.json();if("processing"!==v.status)throw Error(v.message||"Failed to start draft generation");console.log(`✅ Draft variation ${i+1} job started:`,h),tZ(h,{isDraft:!0,draftIndex:i,styleInfo:s?{styleName:s,styleLabel:l}:void 0,frontCoverPrompt:u}),console.log(`🔄 Subscribing to WebSocket updates for draft job ${h}`),tG(h)}catch(e){console.error(`❌ Draft variation ${i+1} failed:`,e),m.Am.error(`Draft variation ${i+1} failed: ${e instanceof Error?e.message:"Unknown error"}`)}});await Promise.allSettled(s),console.log("\uD83D\uDE80 All draft variations started")}catch(e){console.error("Draft card generation error:",e),m.Am.error(`Failed to start draft generation: ${e instanceof Error?e.message:"Unknown error"}`),w(!1),er(!1),eh(!1),ef(0),H(""),tV()}},t1=e=>{},t2=async e=>{if(ed){console.log("⚠️ Final card generation already in progress, skipping duplicate call");return}if(e<0||e>=ea.length||!ea[e]){m.Am.error("Invalid draft selection");return}if(void 0===ei[e]){m.Am.error("Could not find original draft data");return}let t=5-ea.length;t>0&&j&&(w(!1),m.Am.info(`🎯 Focusing on your selected design! Skipping ${t} remaining variations.`)),ec(!0),eo(e),tW(void 0,120),H("\uD83C\uDFA8 Creating high-quality version of your selected design...");try{let t;let r=ea[e],a=(0,ez.Z)();console.log("\uD83D\uDD04 Generating complete prompts from stored front cover prompt + user info");let s=r.generatedPrompts?.frontCover;if(!s)throw Error("Selected draft is missing frontCover prompt");console.log("✅ Found stored front cover prompt:",s.substring(0,100)+"...");let i="custom"===p?x:p,n=eW.find(e=>e.id===b),d=n?n.description.toLowerCase():"heartfelt and sincere",u=l.trim()||`A beautiful ${i} card with ${d} style`,h=o;eF&&(h="[Blank space for handwritten message]");let f=r.styleInfo;f&&f.styleName?(t=eV.find(e=>e.id===f.styleName),t?.promptModifier):(t=eV.find(e=>e.id===R),"custom"===R||t?.promptModifier);let y={frontCoverPrompt:s,cardType:p,customCardType:x,theme:u,tone:b,toneDescription:d,toField:c,fromField:g,message:h,isHandwrittenMessage:eF,artisticStyle:t,isFrontBackOnly:eR},v=eL.generateFinalFromDraftPrompts(y);if(!v||!v.frontCover||!v.backCover)throw Error("Failed to generate complete prompts for final card");console.log("✅ Generated complete prompts for final card:",{hasFrontCover:!!v.frontCover,hasBackCover:!!v.backCover,hasLeftInterior:!!v.leftInterior,hasRightInterior:!!v.rightInterior});let j=[];eN.length>0&&"gpt-image-1"===z&&(j.push(...eN),console.log("\uD83D\uDD0D DEBUG: Added reference images to final draft generation:",eN),console.log("\uD83D\uDD0D DEBUG: Total input images for final draft generation:",j.length),m.Am.success(`📸 ${eN.length} reference photo${eN.length>1?"s":""} applied to final generation!`));let w=await fetch("/api/generate-card-async",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:a,prompts:v,config:{userNumber:"+17145986105",modelVersion:z,aspectRatio:eQ.find(e=>e.id===eO)?.aspectRatio||"9:16",quality:"medium",outputFormat:"jpeg",outputCompression:100,moderation:"low",dimensions:eQ.find(e=>e.id===eO)?.dimensions||"1024x1536",isFrontBackOnly:eR,userEmail:eE,cardType:"custom"===p?x:p,toField:c,fromField:g,isDraftMode:!1,...j.length>0&&{input_images:j,input_images_mode:"front_cover_only"}}})});if(!w.ok)throw Error(`Server error: ${w.status}`);let N=await w.json();if("processing"!==N.status)throw Error(N.message||"Failed to start final card generation");K(a),m.Am.success("\uD83C\uDFA8 Generating high-quality version of your selected design!"),tG(a)}catch(e){console.error("Final card generation error:",e),m.Am.error("Failed to generate final card. Please try again."),ec(!1),H(""),tV()}};return{prompt:l,setPrompt:n,finalCardMessage:o,setFinalCardMessage:d,toField:c,setToField:u,fromField:g,setFromField:h,selectedType:p,setSelectedType:f,customCardType:x,setCustomCardType:y,selectedTone:b,setSelectedTone:v,isGenerating:j,setIsGenerating:w,isGeneratingMessage:$,setIsGeneratingMessage:P,generatedCard:N,setGeneratedCard:k,numberOfCards:C,setNumberOfCards:D,generatedCards:S,setGeneratedCards:T,selectedCardIndex:E,setSelectedCardIndex:I,showAdvanced:F,setShowAdvanced:A,selectedArtisticStyle:R,setSelectedArtisticStyle:M,customStyleDescription:O,setCustomStyleDescription:U,selectedImageModel:z,setSelectedImageModel:Z,selectedDraftModel:_,setSelectedDraftModel:L,isDraftMode:et,setIsDraftMode:er,draftCards:ea,setDraftCards:es,draftIndexMapping:ei,setDraftIndexMapping:el,selectedDraftIndex:en,setSelectedDraftIndex:eo,isGeneratingFinalCard:ed,setIsGeneratingFinalCard:ec,previewingDraftIndex:em,setPreviewingDraftIndex:eu,draftCompletionShown:eg,setDraftCompletionShown:eh,draftCompletionCount:ep,setDraftCompletionCount:ef,generationProgress:G,setGenerationProgress:H,progressPercentage:eK,setProgressPercentage:eX,isCardCompleted:V,setIsCardCompleted:Q,referenceImages:ej,setReferenceImages:ew,referenceImageUrls:eN,setReferenceImageUrls:ek,imageTransformation:eC,setImageTransformation:eD,isUploading:eS,setIsUploading:eT,userEmail:eE,setUserEmail:eI,isHandwrittenMessage:eF,setIsHandwrittenMessage:eA,isFrontBackOnly:eR,setIsFrontBackOnly:eM,selectedPaperSize:eO,setSelectedPaperSize:eU,isTextareaExpanded:e2,setIsTextareaExpanded:e3,isMessageExpanded:e4,setIsMessageExpanded:e5,showSettings:tl,setShowSettings:tn,showTemplateGallery:to,setShowTemplateGallery:td,showPrintConfirmation:tk,setShowPrintConfirmation:tC,generationDuration:tD,setGenerationDuration:tS,currentElapsedTime:tI,setCurrentElapsedTime:t$,formatGenerationTime:eY,formatCountdown:eH,sendThankYouEmail:eB,chatWithAI:eq,scrollToCardPreview:tq,startElapsedTimeTracking:tW,stopElapsedTimeTracking:tV,handleFileUpload:tQ,handleRemoveReferenceImage:e=>{let t=ej[e],r=eN[e];ew(t=>t.filter((t,r)=>r!==e)),ek(t=>t.filter((t,r)=>r!==e)),console.log("\uD83D\uDD0D DEBUG: Reference image removed:",{fileName:t?.name,url:r,remainingImages:ej.length-1}),m.Am.success(`Reference image removed! ${ej.length-1} photo${ej.length-1!=1?"s":""} remaining.`)},handleGetMessageHelp:tK,addMessageToHistory:tJ,undoMessage:()=>{if(e9>0){let e=e9-1;e7(e),d(e8[e])}},redoMessage:()=>{if(e9<e8.length-1){let e=e9+1;e7(e),d(e8[e])}},saveJobToStorage:tZ,removeJobFromStorage:t1,checkPendingJobs:async()=>{},handleGenerateCardAsync:tX,handleGenerateDraftCards:t0,handleGenerateFinalFromDraft:t2,messageHistory:e8,setMessageHistory:e6,currentMessageIndex:e9,setCurrentMessageIndex:e7,refinementPrompt:te,setRefinementPrompt:tt,isRefiningMessage:tr,setIsRefiningMessage:ta,showRefinementBox:ts,setShowRefinementBox:ti,showTemplateCustomization:tA,setShowTemplateCustomization:tR,selectedTemplate:tM,setSelectedTemplate:tO,templateCustomizations:tU,setTemplateCustomizations:tz,templateSearchQuery:tc,setTemplateSearchQuery:tm,isSearchingTemplates:tu,setIsSearchingTemplates:tg,aiFilteredCards:th,setAiFilteredCards:tp,searchMode:tf,setSearchMode:tx,textFilteredCards:ty,setTextFilteredCards:tb,showPrompts:tv,setShowPrompts:tj,printOption:tw,setPrintOption:tN,handwritingSample:ex,setHandwritingSample:ey,handwritingSampleUrl:eb,setHandwritingSampleUrl:ev,currentJobId:J,setCurrentJobId:K,countdown:Y,setCountdown:B,countdownInterval:q,setCountdownInterval:W,sectionLoadingStates:e_,setSectionLoadingStates:eJ,fastPreviewMode:X,setFastPreviewMode:ee,currentCardId:e$,setCurrentCardId:eP,isInitialLoadComplete:e0,setIsInitialLoadComplete:e1,generationStartTime:tT,setGenerationStartTime:tE,elapsedTimeInterval:tP,setElapsedTimeInterval:tF,cardTones:eW,artisticStyles:eV,paperSizes:eQ,isSocketConnected:t,connectWebSocket:t_,disconnectWebSocket:tL,subscribeToJob:tG,unsubscribeFromJob:tH,handleJobUpdate:tY,handleFinalCardCompletion:tB}}(),[u,h]=(0,s.useState)(!1),[p,f]=(0,s.useState)(!1),x=t=>{e.updateFormData(t)},y=async(t,r)=>{if(!t.type.startsWith("image/")){m.Am.error("Please upload an image file");return}i.setIsUploading(!0);try{let a=new FormData;a.append("file",t);let s=await fetch("https://vibecarding.com/upload",{method:"POST",body:a});if(!s.ok)throw Error(`Upload failed: ${s.status}`);let l=await s.json();if("handwriting"===r)i.setHandwritingSample(t),i.setHandwritingSampleUrl(l.url),m.Am.success("Handwriting sample uploaded!");else{let r=[...e.formData.referenceImages,t],a=[...e.formData.referenceImageUrls,l.url];i.setReferenceImages(r),i.setReferenceImageUrls(a),x({referenceImages:r,referenceImageUrls:a}),console.log("\uD83D\uDD0D DEBUG: Reference image uploaded successfully:",{fileName:t.name,url:l.url,totalImages:r.length}),m.Am.success(`Reference image uploaded! ${r.length} photo${r.length>1?"s":""} ready for character creation.`)}}catch(e){console.error("Upload failed:",e),m.Am.error("Upload failed. Please try again.")}finally{i.setIsUploading(!1)}},b=async()=>{let e=await i.handleGetMessageHelp();e&&x({finalCardMessage:e})},v=()=>{i.undoMessage(),i.currentMessageIndex>0&&x({finalCardMessage:i.messageHistory[i.currentMessageIndex-1]})},j=()=>{i.redoMessage(),i.currentMessageIndex<i.messageHistory.length-1&&x({finalCardMessage:i.messageHistory[i.currentMessageIndex+1]})},w=t=>{x({prompt:t.prompt||"",selectedType:N(t.prompt)||e.formData.selectedType,selectedArtisticStyle:t.styleInfo?.styleName||e.formData.selectedArtisticStyle}),i.setSelectedTemplate(t)},N=e=>{if(!e)return null;let t=e.toLowerCase();return t.includes("birthday")?"birthday":t.includes("thank")||t.includes("grateful")?"thank-you":t.includes("anniversary")?"anniversary":t.includes("congratulat")?"congratulations":t.includes("holiday")||t.includes("christmas")||t.includes("new year")?"holiday":t.includes("love")||t.includes("romantic")?"love":t.includes("wedding")?"wedding":t.includes("graduat")?"graduation":t.includes("baby")?"new-baby":t.includes("sorry")||t.includes("apolog")?"apology":null},k=t=>e.validateStep(t),C=k(t.currentStep),D=()=>e.formData;return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6 px-4 sm:px-6 lg:px-8 safe-area-padding",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Card Wizard"}),(r.hasCompletedCards||r.hasDraftSessions)&&(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>h(!0),className:"flex items-center gap-2",children:[a.jsx(o.Z,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"History"}),(0,a.jsxs)("span",{className:"sm:hidden",children:["(",r.totalCards+r.totalDrafts,")"]})]})]}),r.hasDraftSessions&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(d.Z,{className:"w-4 h-4 text-purple-600"}),(0,a.jsxs)("span",{className:"text-gray-600 dark:text-gray-400",children:[r.totalDrafts," saved session",1!==r.totalDrafts?"s":""]}),a.jsx(n.z,{variant:"outline",size:"sm",onClick:()=>h(!0),className:"text-purple-600 hover:text-purple-700",children:"Resume"})]})]}),a.jsx(g,{steps:e0,currentStep:t.currentStep,completedSteps:t.completedSteps,onStepClick:e=>{if(t.completedSteps.includes(e)){t.goToStep(e);return}if(e===t.currentStep+1&&k(t.currentStep)){t.completedSteps.includes(t.currentStep)||t.markStepCompleted(t.currentStep),t.goToStep(e);return}if(e<t.currentStep){t.goToStep(e);return}}}),(0,a.jsxs)(l.Zb,{className:"shadow-lg",children:[a.jsx(l.Ol,{className:"bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-t-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center shadow-lg",children:t.completedSteps.includes(t.currentStep)?a.jsx(c.Z,{className:"w-6 h-6 text-white"}):a.jsx("span",{className:"text-white font-bold",children:t.currentStep})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[a.jsx(l.ll,{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100",children:e0[t.currentStep-1]?.title}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e0[t.currentStep-1]?.description})]})]}),e0[t.currentStep-1]?.isOptional&&a.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/30 px-2 py-1 rounded-full flex-shrink-0",children:"Optional"})]})}),a.jsx(l.aY,{className:"pt-6 pb-4",children:(()=>{let r=D();switch(t.currentStep){case 1:return a.jsx(A,{formData:r,updateFormData:x,onStepComplete:()=>{t.completedSteps.includes(1)||t.markStepCompleted(1)},onTemplateSelect:w});case 2:return a.jsx(H,{formData:r,updateFormData:x,onStepComplete:()=>{t.completedSteps.includes(2)||t.markStepCompleted(2)},handleGetMessageHelp:b,isGeneratingMessage:i.isGeneratingMessage,messageHistory:i.messageHistory,currentMessageIndex:i.currentMessageIndex,undoMessage:v,redoMessage:j});case 3:return a.jsx(W,{formData:r,updateFormData:x,onStepComplete:()=>{t.completedSteps.includes(3)||t.markStepCompleted(3)},handleFileUpload:y,handleRemoveReferenceImage:t=>{let r=e.formData.referenceImages.filter((e,r)=>r!==t),a=e.formData.referenceImageUrls.filter((e,r)=>r!==t);i.setReferenceImages(r),i.setReferenceImageUrls(a),x({referenceImages:r,referenceImageUrls:a})},isUploading:i.isUploading});case 4:return a.jsx(V,{formData:r,updateFormData:x,onStepComplete:()=>{t.completedSteps.includes(4)||t.markStepCompleted(4)}});case 5:return a.jsx(Q,{formData:r,updateFormData:x,onStepComplete:()=>{t.completedSteps.includes(5)||t.markStepCompleted(5)},isGenerating:i.isGenerating,isGeneratingFinalCard:i.isGeneratingFinalCard,isGeneratingMessage:i.isGeneratingMessage,generationProgress:i.generationProgress,progressPercentage:i.progressPercentage,currentElapsedTime:i.currentElapsedTime,isDraftMode:i.isDraftMode,draftCards:i.draftCards,selectedDraftIndex:i.selectedDraftIndex,formatGenerationTime:i.formatGenerationTime,onGenerateDraftCards:i.handleGenerateDraftCards,onSelectDraft:e=>{i.setSelectedDraftIndex(e),t.completedSteps.includes(5)||t.markStepCompleted(5),t.goToStep(6)}});case 6:return a.jsx(eN,{formData:r,isGeneratingFinalCard:i.isGeneratingFinalCard,generationProgress:i.generationProgress,progressPercentage:i.progressPercentage,currentElapsedTime:i.currentElapsedTime,selectedDraftIndex:i.selectedDraftIndex,draftCards:i.draftCards,generatedCard:i.generatedCard,isCardCompleted:i.isCardCompleted,onGenerateFinalCard:i.handleGenerateFinalFromDraft,formatGenerationTime:i.formatGenerationTime});default:return null}})()})]}),a.jsx(eD,{currentStep:t.currentStep,totalSteps:e0.length,onPrevious:()=>{t.currentStep>1&&t.goToPreviousStep()},onNext:()=>!!k(t.currentStep)&&(t.markStepCompleted(t.currentStep),t.currentStep<e0.length&&t.goToNextStep(),!0),canProceed:C,isGenerating:i.isGenerating}),a.jsx(eU,{isOpen:u,onClose:()=>h(!1),onResumeDraft:a=>{f(!0);let s=r.resumeDraftSession(a);s?(e.updateFormData(s.formData),i.setDraftCards(s.draftCards),i.setSelectedDraftIndex(s.selectedDraftIndex),i.setIsDraftMode(!0),s.draftCards.length>0?t.goToStep(5):t.goToStep(2),m.Am.success("Draft session resumed successfully!"),setTimeout(()=>{f(!1)},100)):f(!1)},onLoadCard:e=>{m.Am.info("Card viewing functionality coming soon!")}})]})}},29753:(e,t,r)=>{"use strict";r.d(t,{r:()=>c});var a=r(17577);let s="https://vibecarding.com",i=`${s}/api/cards/list`,l=null,n=!1,o=new Set,d=()=>{o.forEach(e=>e())},c=()=>{let[e,t]=(0,a.useState)(l),[r,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=()=>t(l);return o.add(e),()=>{o.delete(e)}},[]),(0,a.useEffect)(()=>{},[]);let g=(0,a.useCallback)(async(e=1,t="",r=!1)=>{if(!t&&l?.isComplete&&!r){let t=(e-1)*40;return l.cards.slice(t,t+40)}if(!t&&(r||!l))try{let t=await fetch(`${i}?per_page=1000&template_mode=true`);if(t.ok){let r=await t.json();if("success"===r.status&&r.cards&&Array.isArray(r.cards)){l={cards:r.cards,totalCount:r.pagination?.total||r.cards.length,lastFetched:Date.now(),isComplete:!0},d();let t=(e-1)*40;return r.cards.slice(t,t+40)}}}catch(e){console.warn("List endpoint failed, falling back to paginated API:",e)}c(!0),u(null);try{let a=new URLSearchParams({page:e.toString(),per_page:"40",...t&&{search:t},template_mode:"true"}),i=await fetch(`${s}/api/cards/list?${a}`);if(!i.ok)throw Error(`HTTP ${i.status}: ${i.statusText}`);let n=await i.json();if("success"===n.status){let e=n.cards;if(!t){if(r||!l)l={cards:e,totalCount:n.pagination.total,lastFetched:Date.now(),isComplete:!n.pagination.has_next};else{let t=new Set(l.cards.map(e=>e.id)),r=e.filter(e=>!t.has(e.id));l={...l,cards:[...l.cards,...r],lastFetched:Date.now(),isComplete:!n.pagination.has_next}}d()}return e}throw Error(n.message||"Failed to load cards")}catch(e){return console.error("Error loading cards:",e),u(e instanceof Error?e.message:"Failed to load cards"),[]}finally{c(!1)}},[]),h=(0,a.useCallback)(async()=>{if(!n){if(l?.isComplete&&Date.now()-l.lastFetched<6e5){console.log("⚡ Using fresh cached template data:",l.cards.length,"cards"),console.log("⚡ Using fresh cached data, no preloading needed");return}n=!0,console.log("\uD83D\uDE80 Starting immediate template preload on page load...");try{let e=await fetch(`${i}?per_page=1000&template_mode=true`);if(!e.ok)throw Error(`HTTP ${e.status}: ${e.statusText}`);let t=await e.json();"success"===t.status&&t.cards&&Array.isArray(t.cards)&&(l={cards:t.cards,totalCount:t.pagination?.total||t.cards.length,lastFetched:Date.now(),isComplete:!0},d(),console.log("✅ Page load template preload complete:",t.cards.length,"cards"),console.log("✅ Cards loaded, letting browser handle image loading"))}catch(e){console.error("❌ Static preload failed, falling back to paginated:",e),await p()}finally{n=!1}}},[]),p=async()=>{try{let e=1,t=!0,r=[];for(;t&&e<=5;){let a=await g(e,"",1===e);r=1===e?a:[...r,...a];let i=await fetch(`${s}/api/cards/list?page=${e}&per_page=40&template_mode=true`),l=await i.json();t=l.pagination?.has_next||!1,e++}console.log("✅ Legacy preload complete:",r.length,"cards"),await f(r.slice(0,20))}catch(e){console.error("❌ Legacy preload failed:",e)}},f=async e=>{console.log("\uD83D\uDE80 Skipping image preloading for instant response")};return{cache:e,isLoading:r,error:m,loadCards:g,preloadAllCards:h,getCachedCards:(0,a.useCallback)((e=1,t=40)=>{if(!l)return[];let r=(e-1)*t;return l.cards.slice(r,r+t)},[]),clearCache:(0,a.useCallback)(()=>{l=null,t(null),d()},[]),hasCache:!!l,isComplete:l?.isComplete||!1,totalCards:l?.totalCount||0}}}};
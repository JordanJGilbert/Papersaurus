"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[498],{94104:function(e,t,a){var r=a(2265);t.Z=()=>((0,r.useEffect)(()=>{setTimeout(()=>{["vibecarding.com","fonts.googleapis.com","fonts.gstatic.com"].forEach(e=>{let t=document.createElement("link");t.rel="dns-prefetch",t.href="//".concat(e),document.head.appendChild(t)});let e=document.createElement("link");e.rel="preconnect",e.href="https://vibecarding.com",e.crossOrigin="anonymous",document.head.appendChild(e);let t=document.createElement("link");if(t.rel="prefetch",t.href="https://vibecarding.com/api/cards/list?page=1&per_page=40&template_mode=true",t.as="fetch",t.crossOrigin="anonymous",document.head.appendChild(t),"connection"in navigator)try{var a,r;null===(r=navigator.connection)||void 0===r||null===(a=r.addEventListener)||void 0===a||a.call(r,"change",()=>{let e=navigator.connection;((null==e?void 0:e.effectiveType)==="4g"||(null==e?void 0:e.downlink)>1.5)&&console.log("\uD83D\uDE80 Good connection detected, enabling aggressive preloading")})}catch(e){}},0)},[]),null)},43497:function(e,t,a){var r=a(2265),s=a(55468);t.Z=()=>{let{preloadAllCards:e}=(0,s.r)();return(0,r.useEffect)(()=>{(async()=>{try{await e()}catch(e){console.warn("Early preload failed:",e)}})()},[e]),null}},84190:function(e,t,a){a.d(t,{$F:function(){return m},AW:function(){return u},Ju:function(){return p},VD:function(){return h},Xi:function(){return g},h_:function(){return d}});var r=a(57437),s=a(2265),n=a(70085),i=a(10407),o=a(30401),l=a(40519),c=a(94508);let d=n.fC,m=n.xz;n.ZA,n.Uv,n.Tr,n.Ee,s.forwardRef((e,t)=>{let{className:a,inset:s,children:o,...l}=e;return(0,r.jsxs)(n.fF,{ref:t,className:(0,c.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",a),...l,children:[o,(0,r.jsx)(i.Z,{className:"ml-auto"})]})}).displayName=n.fF.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.tu,{ref:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...s})}).displayName=n.tu.displayName;let u=s.forwardRef((e,t)=>{let{className:a,sideOffset:s=4,...i}=e;return(0,r.jsx)(n.Uv,{children:(0,r.jsx)(n.VY,{ref:t,sideOffset:s,className:(0,c.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...i})})});u.displayName=n.VY.displayName;let g=s.forwardRef((e,t)=>{let{className:a,inset:s,...i}=e;return(0,r.jsx)(n.ck,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",a),...i})});g.displayName=n.ck.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,checked:i,...l}=e;return(0,r.jsxs)(n.oC,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:i,...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})}),s]})}).displayName=n.oC.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(n.Rk,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(l.Z,{className:"h-2 w-2 fill-current"})})}),s]})}).displayName=n.Rk.displayName;let p=s.forwardRef((e,t)=>{let{className:a,inset:s,...i}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...i})});p.displayName=n.__.displayName;let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...s})});h.displayName=n.Z0.displayName},19378:function(e,t,a){a.d(t,{x:function(){return o}});var r=a(57437),s=a(2265),n=a(43643),i=a(94508);let o=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,r.jsxs)(n.fC,{ref:t,className:(0,i.cn)("relative overflow-hidden",a),...o,children:[(0,r.jsx)(n.l_,{className:"h-full w-full rounded-[inherit]",children:s}),(0,r.jsx)(l,{}),(0,r.jsx)(n.Ns,{})]})});o.displayName=n.fC.displayName;let l=s.forwardRef((e,t)=>{let{className:a,orientation:s="vertical",...o}=e;return(0,r.jsx)(n.gb,{ref:t,orientation:s,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...o,children:(0,r.jsx)(n.q4,{className:"relative flex-1 rounded-full bg-border"})})});l.displayName=n.gb.displayName},93022:function(e,t,a){a.d(t,{O:function(){return n}});var r=a(57437),s=a(94508);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-primary/10",t),...a})}},61350:function(e,t,a){a.d(t,{Z:function(){return td}});var r=a(57437),s=a(2265),n=a(66070),i=a(62869),o=a(65621),l=a(99397),c=a(91723),d=a(41671),m=a(14438),u=a(30401);function g(e){var t;let{steps:a,currentStep:n,completedSteps:i,onStepClick:o}=e;return(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 mb-6",children:[(0,r.jsx)("div",{className:"hidden md:flex items-center justify-between",children:a.map((e,t)=>{let l=t+1,c=i.includes(l),d=n===l,m=l<=n||c;return(0,r.jsxs)(s.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("button",{onClick:()=>m&&o(l),disabled:!m,className:"\n                    relative w-10 h-10 rounded-full flex items-center justify-center \n                    transition-all duration-200 mb-2\n                    ".concat(c?"bg-green-500 text-white shadow-lg hover:bg-green-600":d?"bg-blue-500 text-white shadow-lg ring-4 ring-blue-100 dark:ring-blue-900/30":m?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-300 dark:hover:bg-gray-600":"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 cursor-not-allowed","\n                    ").concat(m?"cursor-pointer":"cursor-not-allowed","\n                  "),children:c?(0,r.jsx)(u.Z,{className:"w-5 h-5"}):(0,r.jsx)("span",{className:"text-sm font-medium",children:l})}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"\n                    text-xs font-medium\n                    ".concat(d?"text-blue-600 dark:text-blue-400":c?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400","\n                  "),children:e.title}),e.isOptional&&(0,r.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Optional"})]})]}),t<a.length-1&&(0,r.jsx)("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700 mx-2 mt-5",children:(0,r.jsx)("div",{className:"\n                      h-full transition-all duration-300\n                      ".concat(i.includes(l)?"bg-green-500":"bg-gray-200 dark:bg-gray-700","\n                    ")})})]},e.id)})}),(0,r.jsxs)("div",{className:"md:hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"\n              w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium\n              ".concat(i.includes(n)?"bg-green-500 text-white":"bg-blue-500 text-white","\n            "),children:i.includes(n)?(0,r.jsx)(u.Z,{className:"w-4 h-4"}):n}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Step ",n," of ",a.length]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:null===(t=a[n-1])||void 0===t?void 0:t.title})]})]}),(0,r.jsx)("div",{className:"flex items-center space-x-1.5",children:a.map((e,t)=>{let a=t+1,s=i.includes(a),l=n===a;return(0,r.jsx)("button",{onClick:()=>{(a<=n||s)&&o(a)},className:"\n                    transition-all duration-200 rounded-full touch-manipulation\n                    ".concat(s?"w-3 h-3 bg-green-500":l?"w-4 h-4 bg-blue-500":"w-3 h-3 bg-gray-300 dark:bg-gray-600","\n                  ")},t)})})]}),(0,r.jsx)("div",{className:"overflow-x-auto pb-2",children:(0,r.jsx)("div",{className:"flex items-center space-x-3 min-w-max",children:a.map((e,t)=>{let l=t+1,c=i.includes(l),d=n===l,m=l<=n||c;return(0,r.jsxs)(s.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-center flex-shrink-0",children:[(0,r.jsx)("button",{onClick:()=>m&&o(l),disabled:!m,className:"\n                        relative w-11 h-11 rounded-full flex items-center justify-center \n                        transition-all duration-200 mb-1 touch-manipulation\n                        ".concat(c?"bg-green-500 text-white shadow-sm":d?"bg-blue-500 text-white shadow-sm ring-2 ring-blue-100 dark:ring-blue-900/30":m?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 cursor-not-allowed","\n                        ").concat(m?"cursor-pointer":"cursor-not-allowed","\n                      "),children:c?(0,r.jsx)(u.Z,{className:"w-4 h-4"}):(0,r.jsx)("span",{className:"text-sm font-medium",children:l})}),(0,r.jsx)("div",{className:"text-center max-w-[80px]",children:(0,r.jsx)("div",{className:"\n                        text-xs font-medium leading-tight\n                        ".concat(d?"text-blue-600 dark:text-blue-400":c?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400","\n                      "),children:e.mobileTitle||e.title})})]}),t<a.length-1&&(0,r.jsx)("div",{className:"w-8 h-px bg-gray-200 dark:bg-gray-700 mt-4 flex-shrink-0",children:(0,r.jsx)("div",{className:"\n                          h-full transition-all duration-300\n                          ".concat(i.includes(l)?"bg-green-500":"bg-gray-200 dark:bg-gray-700","\n                        ")})})]},e.id)})})})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[(0,r.jsx)("span",{children:"Progress"}),(0,r.jsxs)("span",{children:[Math.round((i.length+(n>i.length?.5:0))/a.length*100),"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full transition-all duration-500 ease-out",style:{width:"".concat((i.length+(n>i.length?.5:0))/a.length*100,"%")}})})]})]})}var p=a(32660),h=a(76858);function f(e){let{currentStep:t,totalSteps:a,onPrevious:s,onNext:n,canProceed:o,isGenerating:l}=e,c=()=>{n()};return(0,r.jsxs)("div",{className:"mt-6 space-y-4",children:[!o&&!l&&(0,r.jsx)("div",{className:"text-center px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Please complete the required fields to continue"})}),(0,r.jsxs)("div",{className:"flex flex-col sm:hidden gap-3",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:["Step ",t," of ",a]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)(i.z,{variant:"outline",onClick:s,disabled:1===t||l,className:"flex-1 gap-2 h-12 px-4 touch-manipulation text-base",children:[(0,r.jsx)(p.Z,{className:"w-5 h-5"}),"Previous"]}),(0,r.jsxs)(i.z,{onClick:c,disabled:!o||l,className:"flex-1 gap-2 h-12 px-4 touch-manipulation bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-base",children:["Next",(0,r.jsx)(h.Z,{className:"w-5 h-5"})]})]})]}),(0,r.jsxs)("div",{className:"hidden sm:flex items-center justify-between gap-4",children:[(0,r.jsxs)(i.z,{variant:"outline",onClick:s,disabled:1===t||l,className:"gap-2 h-11 px-6 touch-manipulation",children:[(0,r.jsx)(p.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Previous"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:["Step ",t," of ",a]}),(0,r.jsxs)(i.z,{onClick:c,disabled:!o||l,className:"gap-2 h-11 px-6 touch-manipulation bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700",children:[(0,r.jsx)("span",{className:"hidden sm:inline",children:"Next"}),(0,r.jsx)(h.Z,{className:"w-4 h-4"})]})]})]})}var x=a(26110),y=a(35974),b=a(12339),v=a(19378),j=a(48736),w=a(31047),N=a(12805),C=a(53113),k=a(68919),D=a(18930),S=a(33276);let T="vibecarding-card-history",I=()=>{let[e,t]=(0,s.useState)({completedCards:[],draftSessions:[],lastUpdated:Date.now()}),[a,r]=(0,s.useState)(!0);(0,s.useEffect)(()=>{n()},[]);let n=(0,s.useCallback)(()=>{try{let e=localStorage.getItem(T);if(e){let a=JSON.parse(e),r=Date.now(),s=a.completedCards.filter(e=>r-new Date(e.createdAt).getTime()<2592e6),n=a.draftSessions.filter(e=>r-new Date(e.lastModified).getTime()<6048e5);t({completedCards:s,draftSessions:n,lastUpdated:r})}}catch(e){console.error("Failed to load card history:",e)}finally{r(!1)}},[]),i=(0,s.useCallback)(e=>{try{localStorage.setItem(T,JSON.stringify(e))}catch(e){console.error("Failed to save card history:",e)}},[]),o=(0,s.useCallback)(e=>{t(t=>{let a={...t,completedCards:[e,...t.completedCards],lastUpdated:Date.now()};return i(a),a})},[i]),l=(0,s.useCallback)(function(a,r){var s;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,o=arguments.length>3?arguments[3]:void 0,l=new Date,c=o||E(),d=P(a),m={id:c,formData:a,draftCards:r,selectedDraftIndex:n,createdAt:o&&(null===(s=e.draftSessions.find(e=>e.id===o))||void 0===s?void 0:s.createdAt)||l,lastModified:l,title:d};return t(e=>{let t;let a=e.draftSessions.findIndex(e=>e.id===c);a>=0?(t=[...e.draftSessions])[a]=m:t=[m,...e.draftSessions];let r={...e,draftSessions:t,lastUpdated:Date.now()};return i(r),r}),c},[e.draftSessions,i]),c=(0,s.useCallback)(t=>e.draftSessions.find(e=>e.id===t)||null,[e.draftSessions]),d=(0,s.useCallback)(e=>{t(t=>{let a={...t,draftSessions:t.draftSessions.filter(t=>t.id!==e),lastUpdated:Date.now()};return i(a),a})},[i]),m=(0,s.useCallback)(e=>{t(t=>{let a={...t,completedCards:t.completedCards.filter(t=>t.id!==e),lastUpdated:Date.now()};return i(a),a})},[i]),u=(0,s.useCallback)(()=>{let e={completedCards:[],draftSessions:[],lastUpdated:Date.now()};t(e),i(e)},[i]),g=(0,s.useCallback)(()=>e.draftSessions.length>0?e.draftSessions[0]:null,[e.draftSessions]);return{history:e,isLoading:a,addCompletedCard:o,saveDraftSession:l,resumeDraftSession:c,deleteDraftSession:d,deleteCompletedCard:m,clearHistory:u,getActiveDraftSession:g,hasCompletedCards:e.completedCards.length>0,hasDraftSessions:e.draftSessions.length>0,totalCards:e.completedCards.length,totalDrafts:e.draftSessions.length}},E=()=>"draft_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),P=e=>{let t="custom"===e.selectedType?e.customCardType:e.selectedType,a=e.selectedTone,r=new Date().toLocaleString();return t&&a?"".concat(t," (").concat(a,") - ").concat(r):t?"".concat(t," - ").concat(r):"Draft Card - ".concat(r)};function A(e){let{isOpen:t,onClose:a,onResumeDraft:o,onLoadCard:l}=e,{history:d,isLoading:u,deleteDraftSession:g,deleteCompletedCard:p,resumeDraftSession:h,clearHistory:f}=I(),[T,E]=(0,s.useState)("completed"),P=e=>{h(e)?(null==o||o(e),a(),m.Am.success("Draft session resumed!")):m.Am.error("Failed to resume draft session")},A=e=>{g(e),m.Am.success("Draft session deleted")},F=e=>{p(e),m.Am.success("Card deleted from history")},R=async e=>{if(e.shareUrl)try{await navigator.clipboard.writeText(e.shareUrl),m.Am.success("Share link copied to clipboard!")}catch(e){m.Am.error("Failed to copy share link")}else m.Am.error("No share link available for this card")},M=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),O=e=>{let t=Math.floor((new Date().getTime()-new Date(e).getTime())/36e5);return t<1?"Just now":t<24?"".concat(t,"h ago"):t<48?"1 day ago":"".concat(Math.floor(t/24)," days ago")};return(0,r.jsx)(x.Vq,{open:t,onOpenChange:a,children:(0,r.jsxs)(x.cZ,{className:"max-w-4xl max-h-[80vh] p-0",children:[(0,r.jsxs)(x.fK,{className:"p-6 pb-4",children:[(0,r.jsx)(x.$N,{className:"text-xl font-bold",children:"Your Card History"}),(0,r.jsx)(x.Be,{children:"View your completed cards and resume draft sessions"})]}),(0,r.jsxs)(b.mQ,{value:T,onValueChange:e=>E(e),className:"flex-1",children:[(0,r.jsx)("div",{className:"px-6",children:(0,r.jsxs)(b.dr,{className:"grid w-full grid-cols-2",children:[(0,r.jsxs)(b.SP,{value:"completed",className:"flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4"}),"Completed Cards (",d.completedCards.length,")"]}),(0,r.jsxs)(b.SP,{value:"drafts",className:"flex items-center gap-2",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),"Draft Sessions (",d.draftSessions.length,")"]})]})}),(0,r.jsxs)("div",{className:"px-6 pb-6",children:[(0,r.jsx)(b.nU,{value:"completed",className:"mt-4",children:(0,r.jsx)(v.x,{className:"h-96",children:0===d.completedCards.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(j.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No completed cards yet"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Complete your first card to see it here!"})]}):(0,r.jsx)("div",{className:"space-y-4",children:d.completedCards.map(e=>(0,r.jsx)(n.Zb,{className:"hover:shadow-md transition-shadow",children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("img",{src:e.frontCover,alt:"Card preview",className:"w-20 h-28 object-cover rounded-lg border shadow-sm"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:[e.prompt.substring(0,50),e.prompt.length>50&&"..."]}),(0,r.jsx)("div",{className:"flex items-center gap-2 ml-2",children:(0,r.jsxs)(y.C,{variant:"secondary",className:"text-xs",children:[(0,r.jsx)(w.Z,{className:"w-3 h-3 mr-1"}),M(e.createdAt)]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),O(e.createdAt)]}),e.styleInfo&&(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(N.Z,{className:"w-4 h-4"}),e.styleInfo.styleLabel]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>null==l?void 0:l(e.id),className:"flex items-center gap-1",children:[(0,r.jsx)(C.Z,{className:"w-4 h-4"}),"View"]}),e.shareUrl&&(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>R(e),className:"flex items-center gap-1",children:[(0,r.jsx)(k.Z,{className:"w-4 h-4"}),"Share"]}),(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>F(e.id),className:"flex items-center gap-1 text-red-600 hover:text-red-700",children:[(0,r.jsx)(D.Z,{className:"w-4 h-4"}),"Delete"]})]})]})]})})},e.id))})})}),(0,r.jsx)(b.nU,{value:"drafts",className:"mt-4",children:(0,r.jsx)(v.x,{className:"h-96",children:0===d.draftSessions.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(c.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No draft sessions"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Create draft cards to see them here!"})]}):(0,r.jsx)("div",{className:"space-y-4",children:d.draftSessions.map(e=>(0,r.jsx)(n.Zb,{className:"hover:shadow-md transition-shadow",children:(0,r.jsx)(n.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:e.draftCards.length>0?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:e.draftCards[0].frontCover,alt:"Draft preview",className:"w-20 h-28 object-cover rounded-lg border shadow-sm"}),e.draftCards.length>1&&(0,r.jsx)(y.C,{variant:"secondary",className:"absolute -top-2 -right-2 text-xs bg-purple-600 text-white",children:e.draftCards.length})]}):(0,r.jsx)("div",{className:"w-20 h-28 bg-gray-100 dark:bg-gray-800 rounded-lg border flex items-center justify-center",children:(0,r.jsx)(c.Z,{className:"w-6 h-6 text-gray-400"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.title}),(0,r.jsx)("div",{className:"flex items-center gap-2 ml-2",children:(0,r.jsxs)(y.C,{variant:"outline",className:"text-xs",children:[e.draftCards.length," drafts"]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),O(e.lastModified)]}),e.selectedDraftIndex>=0&&(0,r.jsx)("span",{className:"flex items-center gap-1",children:(0,r.jsxs)(y.C,{variant:"secondary",className:"text-xs",children:["Draft ",e.selectedDraftIndex+1," selected"]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(i.z,{variant:"default",size:"sm",onClick:()=>P(e.id),className:"flex items-center gap-1 bg-purple-600 hover:bg-purple-700",children:[(0,r.jsx)(S.Z,{className:"w-4 h-4"}),"Resume"]}),(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>A(e.id),className:"flex items-center gap-1 text-red-600 hover:text-red-700",children:[(0,r.jsx)(D.Z,{className:"w-4 h-4"}),"Delete"]})]})]})]})})},e.id))})})})]})]}),(0,r.jsxs)("div",{className:"border-t p-4 flex items-center justify-between bg-gray-50 dark:bg-gray-800",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d.completedCards.length," completed • ",d.draftSessions.length," drafts"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{f(),m.Am.success("All history cleared")},className:"text-red-600 hover:text-red-700",children:[(0,r.jsx)(D.Z,{className:"w-4 h-4 mr-1"}),"Clear All"]}),(0,r.jsx)(i.z,{variant:"outline",onClick:a,children:"Close"})]})]})]})})}function F(e){let{cardStudio:t,cardForm:a,cardHistory:r,wizardState:n,isResumingDraft:i}=e;return(0,s.useEffect)(()=>{t.checkPendingJobs()},[]),(0,s.useEffect)(()=>{if(n.isInitialLoadComplete&&a.isInitialLoadComplete&&1===n.currentStep&&0===n.completedSteps.length){let e=a.formData;e.userEmail?(console.log("\uD83D\uDD04 Auto-resuming to email step or beyond"),n.markStepCompleted(1),(e.finalCardMessage||e.prompt)&&n.markStepCompleted(2),(e.selectedArtisticStyle||e.referenceImages.length>0)&&n.markStepCompleted(3),n.markStepCompleted(4),t.draftCards.length>0?n.goToStep(5):n.goToStep(4)):e.finalCardMessage||e.prompt?(console.log("\uD83D\uDD04 Auto-resuming to message step"),n.markStepCompleted(1),n.goToStep(2)):e.selectedType&&e.selectedTone&&(console.log("\uD83D\uDD04 Auto-completing step 1"),n.markStepCompleted(1))}},[n.isInitialLoadComplete,a.isInitialLoadComplete]),(0,s.useEffect)(()=>{t.draftCards.length>0&&a.isInitialLoadComplete&&!i&&r.saveDraftSession(a.formData,t.draftCards,t.selectedDraftIndex)},[t.draftCards,t.selectedDraftIndex,a.formData,a.isInitialLoadComplete,i]),(0,s.useEffect)(()=>{t.generatedCard&&t.isCardCompleted&&r.addCompletedCard(t.generatedCard)},[t.generatedCard,t.isCardCompleted]),(0,s.useEffect)(()=>{if(!a.isInitialLoadComplete)return;let{formData:e}=a;t.setSelectedType(e.selectedType),t.setCustomCardType(e.customCardType),t.setSelectedTone(e.selectedTone),t.setToField(e.toField),t.setFromField(e.fromField),t.setPrompt(e.prompt),t.setFinalCardMessage(e.finalCardMessage),t.setIsHandwrittenMessage(e.isHandwrittenMessage),t.setSelectedArtisticStyle(e.selectedArtisticStyle),t.setCustomStyleDescription(e.customStyleDescription),t.setReferenceImages(e.referenceImages),t.setReferenceImageUrls(e.referenceImageUrls),t.setImageTransformation(e.imageTransformation),t.setUserEmail(e.userEmail),t.setSelectedImageModel(e.selectedImageModel),t.setSelectedDraftModel(e.selectedDraftModel),t.setSelectedPaperSize(e.selectedPaperSize),t.setNumberOfCards(e.numberOfCards),t.setIsFrontBackOnly(e.isFrontBackOnly)},[a.formData,a.isInitialLoadComplete]),(0,s.useEffect)(()=>{a.validateStep(1)&&!n.completedSteps.includes(1)&&n.markStepCompleted(1)},[a.formData.selectedType,a.formData.selectedTone,a.formData.customCardType,n]),(0,s.useEffect)(()=>{a.validateStep(4)&&!n.completedSteps.includes(4)&&n.markStepCompleted(4)},[a.formData.userEmail,n]),(0,s.useEffect)(()=>{t.isGeneratingFinalCard&&n.currentStep<6&&(console.log("\uD83D\uDE80 Auto-advancing to Step 6: Final Generation"),n.completedSteps.includes(5)||n.markStepCompleted(5),n.goToStep(6))},[t.isGeneratingFinalCard,n]),null}var R=a(95186),M=a(53647),O=a(94508);let z=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,O.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s})});z.displayName="Textarea";var U=a(29525),G=a(35900),Z=a(31810),_=a(88997),L=a(49474),J=a(53057),H=a(95337),Y=a(23959),B=a(55900),W=a(33741),q=a(34838),V=a(87414),Q=a(99637),K=a(82718),$=a(42208),X=a(62883),ee=a(17689),et=a(32489),ea=a(55468),er=a(51817),es=a(95805),en=a(92369),ei=a(53581);function eo(e){let{isOpen:t,onClose:a,imageUrl:n,imageIndex:i,isAnalyzing:o,analysisResult:l,onSave:c,onSkip:d,toField:m,fromField:g}=e,[p,h]=(0,s.useState)(!0),[f,x]=(0,s.useState)([]),[y,b]=(0,s.useState)(""),[v,j]=(0,s.useState)("");if(s.useEffect(()=>{console.log("\uD83D\uDCF8 PhotoAnalysisModal state:",{isOpen:t,imageUrl:n,imageIndex:i,isAnalyzing:o,hasAnalysisResult:!!l,analysisResultPeopleCount:null==l?void 0:l.peopleCount})},[t,n,i,o,l]),(0,s.useEffect)(()=>{(null==l?void 0:l.people)&&x(l.people.map(e=>({...e,includeInCard:!0,name:"",relationshipToRecipient:""})))},[l]),!t)return null;let w=e=>{x(t=>t.map(t=>t.id===e?{...t,includeInCard:!t.includeInCard}:t)),h(!1)},N=(e,t)=>{x(a=>a.map(a=>a.id===e?{...a,name:t}:a))},C=(e,t)=>{x(a=>a.map(a=>a.id===e?{...a,relationshipToRecipient:t}:a))},k=e=>({"far-left":"Far Left",left:"Left","center-left":"Center Left",center:"Center","center-right":"Center Right",right:"Right","far-right":"Far Right"})[e]||e;return(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 p-0 sm:p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-lg shadow-xl w-full sm:max-w-2xl h-[85vh] sm:h-auto sm:max-h-[85vh] overflow-hidden animate-slide-up sm:animate-none flex flex-col",children:[(0,r.jsxs)("div",{className:"flex-shrink-0 bg-white dark:bg-gray-800 z-10 flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Photo Analysis"}),(0,r.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors touch-target",children:(0,r.jsx)(et.Z,{className:"w-5 h-5"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,r.jsx)("div",{className:"p-4 sm:p-6",children:o?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,r.jsx)(er.Z,{className:"w-12 h-12 animate-spin text-blue-500 mb-4"}),(0,r.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Analyzing your photo..."}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Identifying people and understanding the scene"})]}):l?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,r.jsx)("div",{className:"w-full h-32 sm:h-48 overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)("img",{src:n,alt:"Reference photo",className:"w-full h-full object-cover object-center"})}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 bg-black/70 text-white px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm",children:[(0,r.jsx)(es.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),l.peopleCount," ",1===l.peopleCount?"person":"people"]})]}),(0,r.jsxs)("details",{className:"bg-gray-50 dark:bg-gray-700 p-3 sm:p-4 rounded-lg",children:[(0,r.jsx)("summary",{className:"font-semibold text-sm sm:text-base text-gray-900 dark:text-white cursor-pointer",children:"Scene Details"}),(0,r.jsxs)("div",{className:"mt-2 space-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Setting:"})," ",l.setting]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Mood:"})," ",l.overallMood]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Lighting:"})," ",l.lighting]}),l.hasPets&&(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Pets:"})," ",l.petDescription]})]})]}),l.peopleCount>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-3 text-sm sm:text-base text-gray-900 dark:text-white",children:"Who should appear on the card?"}),(0,r.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,r.jsxs)("label",{className:"flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",checked:p,onChange:()=>h(!0),className:"mr-3 w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm sm:text-base text-gray-700 dark:text-gray-300",children:"Everyone in the photo"})]}),(0,r.jsxs)("label",{className:"flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",checked:!p,onChange:()=>h(!1),className:"mr-3 w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm sm:text-base text-gray-700 dark:text-gray-300",children:"Let me choose specific people"})]})]})]}),(0,r.jsx)("div",{className:"space-y-3",children:f.map((e,t)=>(0,r.jsx)("div",{className:"p-3 border-2 rounded-lg transition-all ".concat(p||e.includeInCard?"border-blue-400 dark:border-blue-500 bg-blue-50/50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 opacity-50"),children:(0,r.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[!p&&(0,r.jsx)("div",{className:"pt-0.5",children:(0,r.jsx)("input",{type:"checkbox",checked:e.includeInCard,onChange:()=>w(e.id),className:"w-5 h-5 cursor-pointer"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(en.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-500"}),(0,r.jsxs)("span",{className:"font-medium text-sm sm:text-base",children:["Person ",t+1," - ",k(e.position)]})]}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-3",children:[e.description," • ",e.apparentAge," • ",e.clothing]}),(!!p||e.includeInCard)&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Name (optional)"}),(0,r.jsx)("input",{type:"text",value:e.name||"",onChange:t=>N(e.id,t.target.value),placeholder:"e.g., John",className:"mt-1 w-full px-2 py-1.5 text-sm border rounded-md dark:bg-gray-700 dark:border-gray-600",style:{fontSize:"16px"}})]}),m&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:["Relationship to ",m," (optional)"]}),(0,r.jsx)("input",{type:"text",value:e.relationshipToRecipient||"",onChange:t=>C(e.id,t.target.value),placeholder:"e.g., son, friend",className:"mt-1 w-full px-2 py-1.5 text-sm border rounded-md dark:bg-gray-700 dark:border-gray-600",style:{fontSize:"16px"}})]})]})]})]})},e.id))}),m&&f.filter(e=>p||e.includeInCard).length>1&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300",children:["How is this group related to ",m,"? (optional)"]}),(0,r.jsx)("input",{type:"text",value:y,onChange:e=>b(e.target.value),placeholder:"e.g., family, friends, colleagues",className:"mt-1 w-full px-3 py-2 text-sm sm:text-base border rounded-md dark:bg-gray-700 dark:border-gray-600",style:{fontSize:"16px"}})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300",children:"Special instructions for this photo (optional)"}),(0,r.jsx)("textarea",{value:v,onChange:e=>j(e.target.value),placeholder:"e.g., Make sure to capture the beach background, focus on the happy expressions",rows:2,className:"mt-1 w-full px-3 py-2 text-sm sm:text-base border rounded-md dark:bg-gray-700 dark:border-gray-600 resize-none",style:{fontSize:"16px"}})]})]}):(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(ei.Z,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),(0,r.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Photo analysis not available"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"You can still use this photo without analysis"})]})})}),(0,r.jsxs)("div",{className:"flex-shrink-0 bg-white dark:bg-gray-800 flex flex-col sm:flex-row gap-2 sm:gap-0 sm:justify-between items-stretch sm:items-center p-4 sm:p-6 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("button",{onClick:d,className:"order-2 sm:order-1 px-4 py-3 sm:py-2 text-sm text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"Skip Analysis"}),(0,r.jsxs)("div",{className:"order-1 sm:order-2 flex gap-2 sm:gap-3",children:[(0,r.jsx)("button",{onClick:a,className:"flex-1 sm:flex-none px-4 py-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),(0,r.jsxs)("button",{onClick:()=>{let e=p?f:f.filter(e=>e.includeInCard);c({imageUrl:n,imageIndex:i,analysisResult:l,selectedPeople:e,includeEveryone:p,groupRelationship:y,excludedCount:l.peopleCount-e.length,specialInstructions:v,analyzed:!0,analysisFailed:!1})},disabled:o||!l,className:"flex-1 sm:flex-none px-4 py-3 sm:py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Confirm"})]})]})]})]})})}let el=[{id:"custom",label:"Custom",description:"Create your own",icon:U.Z,emoji:"✨",color:"from-purple-100 to-purple-200 dark:from-purple-900 dark:to-purple-800"},{id:"birthday",label:"Birthday",description:"Celebrate another year of life",icon:G.Z,emoji:"\uD83C\uDF82",color:"from-pink-100 to-pink-200 dark:from-pink-900 dark:to-pink-800"},{id:"thank-you",label:"Thank You",description:"Express gratitude",icon:Z.Z,emoji:"\uD83D\uDE4F",color:"from-blue-100 to-blue-200 dark:from-blue-900 dark:to-blue-800"},{id:"anniversary",label:"Anniversary",description:"Commemorate special milestones",icon:_.Z,emoji:"\uD83D\uDC91",color:"from-red-100 to-red-200 dark:from-red-900 dark:to-red-800"},{id:"congratulations",label:"Congratulations",description:"Celebrate achievements",icon:L.Z,emoji:"\uD83C\uDF89",color:"from-yellow-100 to-yellow-200 dark:from-yellow-900 dark:to-yellow-800"},{id:"holiday",label:"Holiday",description:"Seasonal and holiday greetings",icon:J.Z,emoji:"\uD83C\uDF84",color:"from-green-100 to-green-200 dark:from-green-900 dark:to-green-800"},{id:"get-well",label:"Get Well Soon",description:"Send healing wishes",icon:H.Z,emoji:"\uD83D\uDC90",color:"from-teal-100 to-teal-200 dark:from-teal-900 dark:to-teal-800"},{id:"sympathy",label:"Sympathy",description:"Offer comfort",icon:Y.Z,emoji:"\uD83D\uDD4A️",color:"from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700"},{id:"love",label:"Love & Romance",description:"Express romantic feelings",icon:_.Z,emoji:"\uD83D\uDC95",color:"from-rose-100 to-rose-200 dark:from-rose-900 dark:to-rose-800"},{id:"graduation",label:"Graduation",description:"Academic achievements",icon:B.Z,emoji:"\uD83C\uDF93",color:"from-indigo-100 to-indigo-200 dark:from-indigo-900 dark:to-indigo-800"},{id:"new-baby",label:"New Baby",description:"Welcome new arrivals",icon:W.Z,emoji:"\uD83D\uDC76",color:"from-cyan-100 to-cyan-200 dark:from-cyan-900 dark:to-cyan-800"},{id:"wedding",label:"Wedding",description:"Celebrate unions and marriages",icon:q.Z,emoji:"\uD83D\uDC92",color:"from-violet-100 to-violet-200 dark:from-violet-900 dark:to-violet-800"},{id:"retirement",label:"Retirement",description:"Honor career achievements",icon:V.Z,emoji:"\uD83C\uDF81",color:"from-amber-100 to-amber-200 dark:from-amber-900 dark:to-amber-800"},{id:"housewarming",label:"Housewarming",description:"Welcome to new homes",icon:Q.Z,emoji:"\uD83C\uDFE1",color:"from-orange-100 to-orange-200 dark:from-orange-900 dark:to-orange-800"},{id:"apology",label:"Apology",description:"Make amends",icon:K.Z,emoji:"\uD83D\uDE4F",color:"from-slate-100 to-slate-200 dark:from-slate-900 dark:to-slate-800"},{id:"thinking-of-you",label:"Thinking of You",description:"Show you care and remember",icon:$.Z,emoji:"\uD83D\uDCAD",color:"from-sky-100 to-sky-200 dark:from-sky-900 dark:to-sky-800"}],ec=[{id:"funny",label:"\uD83D\uDE04 Funny",description:"Humorous and lighthearted",color:"from-yellow-100 to-orange-100 dark:from-yellow-900 dark:to-orange-900"},{id:"genz-humor",label:"\uD83D\uDC80 GenZ Humor",description:"Memes and chaotic vibes",color:"from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900"},{id:"romantic",label:"\uD83D\uDC95 Romantic",description:"Sweet and loving",color:"from-pink-100 to-rose-100 dark:from-pink-900 dark:to-rose-900"},{id:"professional",label:"\uD83D\uDC54 Professional",description:"Formal and business-ready",color:"from-slate-100 to-gray-100 dark:from-slate-900 dark:to-gray-900"},{id:"heartfelt",label:"❤️ Heartfelt",description:"Sincere and emotional",color:"from-red-100 to-pink-100 dark:from-red-900 dark:to-pink-900"},{id:"playful",label:"\uD83C\uDF89 Playful",description:"Fun and energetic",color:"from-cyan-100 to-blue-100 dark:from-cyan-900 dark:to-blue-900"},{id:"elegant",label:"✨ Elegant",description:"Sophisticated and refined",color:"from-violet-100 to-indigo-100 dark:from-violet-900 dark:to-indigo-900"},{id:"casual",label:"\uD83D\uDE0A Casual",description:"Relaxed and friendly",color:"from-green-100 to-teal-100 dark:from-green-900 dark:to-teal-900"},{id:"inspirational",label:"\uD83C\uDF1F Inspirational",description:"Motivating and uplifting",color:"from-amber-100 to-yellow-100 dark:from-amber-900 dark:to-yellow-900"},{id:"quirky",label:"\uD83E\uDD2A Quirky",description:"Unique and unconventional",color:"from-lime-100 to-emerald-100 dark:from-lime-900 dark:to-emerald-900"},{id:"traditional",label:"\uD83C\uDFAD Traditional",description:"Classic and timeless",color:"from-stone-100 to-amber-100 dark:from-stone-900 dark:to-amber-900"}];function ed(e){let{formData:t,updateFormData:a,onStepComplete:n,onTemplateSelect:o,handleFileUpload:l,handleRemoveReferenceImage:c,isUploading:d=!1,photoAnalyses:u=[],isAnalyzing:g=!1,showAnalysisModal:p=!1,pendingAnalysisIndex:h=null,analyzePhoto:f,savePhotoAnalysis:x,skipPhotoAnalysis:y,setShowAnalysisModal:b,referenceImageUrlsFromStudio:v=[]}=e,[j,w]=(0,s.useState)(!1),[N,C]=s.useState(null),{preloadAllCards:k}=(0,ea.r)();(0,s.useEffect)(()=>{k()},[]),s.useEffect(()=>{t.selectedType&&t.selectedTone&&("custom"!==t.selectedType||t.customCardType.trim())&&(null==n||n())},[t.selectedType,t.selectedTone,t.customCardType,n]);let D=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e.size<=1048576*t?e:new Promise((t,a)=>{let r=new FileReader;r.onload=r=>{var s;let n=document.createElement("img");n.onload=()=>{let r=document.createElement("canvas"),s=r.getContext("2d"),{width:i,height:o}=n;i>o&&i>2048?(o=o/i*2048,i=2048):o>2048&&(i=i/o*2048,o=2048),r.width=i,r.height=o,null==s||s.drawImage(n,0,0,i,o),r.toBlob(r=>{r?t(new File([r],e.name,{type:"image/jpeg",lastModified:Date.now()})):a(Error("Failed to compress image"))},"image/jpeg",.85)},n.src=null===(s=r.target)||void 0===s?void 0:s.result},r.onerror=a,r.readAsDataURL(e)})},S=async e=>{if(!l){m.Am.error("File upload not available");return}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)){m.Am.error("Please upload a valid image file (JPG, PNG, GIF, or WebP)");return}try{let t=e;e.size>10485760&&(m.Am.info("Compressing large image..."),t=await D(e,10),m.Am.success("Image compressed from ".concat((e.size/1024/1024).toFixed(1),"MB to ").concat((t.size/1024/1024).toFixed(1),"MB"))),await l(t,"reference")}catch(e){console.error("Error uploading file:",e),m.Am.error("Failed to upload file")}},T=e=>{c&&c(e)};return s.useEffect(()=>{if(p&&null!==h&&f){let e=(v.length>0?v:t.referenceImageUrls)[h];e&&!N&&(C(null),f(e,h).then(e=>{C(e)}).catch(e=>{console.error("Error analyzing photo:",e),m.Am.error("Failed to analyze photo")}))}},[p,h,f,t.referenceImageUrls,v,N]),(0,r.jsxs)("div",{className:"space-y-4 sm:space-y-6 w-full",children:[(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4 w-full",children:[(0,r.jsx)("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200 px-1",children:"Card Type"}),(0,r.jsxs)(M.Ph,{value:t.selectedType,onValueChange:e=>a({selectedType:e}),children:[(0,r.jsx)(M.i4,{className:"w-full h-12 sm:h-14 border-2 hover:border-blue-300 dark:hover:border-blue-700 transition-colors touch-manipulation text-base [&>span]:!line-clamp-none",children:(0,r.jsx)(M.ki,{children:(()=>{let e=el.find(e=>e.id===t.selectedType);return e?(e.icon,(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br ".concat(e.color," rounded-lg flex items-center justify-center shadow-sm flex-shrink-0"),children:(0,r.jsx)("span",{className:"text-sm sm:text-lg",children:e.emoji})}),(0,r.jsx)("span",{className:"font-medium text-gray-900 dark:text-gray-100 text-sm sm:text-base",children:e.label})]})):(0,r.jsx)("span",{className:"text-gray-400",children:"Choose card type"})})()})}),(0,r.jsx)(M.Bw,{className:"max-h-[400px] w-full",position:"popper",sideOffset:5,children:el.map(e=>(e.icon,(0,r.jsx)(M.Ql,{value:e.id,className:"cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br ".concat(e.color," rounded-lg flex items-center justify-center shadow-sm"),children:(0,r.jsx)("span",{className:"text-xl",children:e.emoji})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:e.label}),(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]})},e.id)))})]}),"custom"===t.selectedType&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 animate-in slide-in-from-top-2 duration-300",children:[(0,r.jsxs)("label",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100 mb-3 block flex items-center gap-2",children:[(0,r.jsx)(U.Z,{className:"w-4 h-4"}),"Describe Your Custom Card Type"]}),(0,r.jsx)(R.I,{placeholder:"✨ E.g., 'Promotion at work', 'Moving away', 'First day of school'",value:t.customCardType,onChange:e=>a({customCardType:e.target.value}),className:"h-12 border-2 border-purple-300 dark:border-purple-700 focus:border-purple-500 dark:focus:border-purple-500 touch-manipulation",style:{fontSize:"16px"}}),(0,r.jsx)("p",{className:"text-xs text-purple-700 dark:text-purple-300 mt-2",children:"What type of card is this? This helps personalize the message and style."})]})]}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4 w-full",children:[(0,r.jsx)("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200 px-1",children:"Card Tone & Style"}),(0,r.jsxs)(M.Ph,{value:t.selectedTone,onValueChange:e=>a({selectedTone:e}),children:[(0,r.jsx)(M.i4,{className:"w-full h-12 sm:h-14 border-2 hover:border-purple-300 dark:hover:border-purple-700 transition-colors touch-manipulation text-base [&>span]:!line-clamp-none",children:(0,r.jsx)(M.ki,{children:(()=>{let e=ec.find(e=>e.id===t.selectedTone);return e?(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br ".concat(e.color," rounded-lg flex items-center justify-center shadow-sm flex-shrink-0"),children:(0,r.jsx)("span",{className:"text-sm sm:text-base",children:e.label.split(" ")[0]})}),(0,r.jsx)("span",{className:"font-medium text-sm sm:text-base",children:e.label.split(" ").slice(1).join(" ")})]}):(0,r.jsx)("span",{className:"text-gray-400",children:"Choose card tone"})})()})}),(0,r.jsx)(M.Bw,{className:"max-h-[400px] w-full",position:"popper",sideOffset:5,children:ec.map(e=>(0,r.jsx)(M.Ql,{value:e.id,className:"cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br ".concat(e.color," rounded-lg flex items-center justify-center shadow-sm"),children:(0,r.jsx)("span",{className:"text-xl",children:e.label.split(" ")[0]})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:e.label.split(" ").slice(1).join(" ")}),(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]})},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4 w-full",children:[(0,r.jsx)("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200 px-1",children:"Personalization (Optional)"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"To (Optional)"}),(0,r.jsx)(R.I,{placeholder:"\uD83C\uDFAF To",value:t.toField,onChange:e=>a({toField:e.target.value}),className:"h-12 sm:h-14 touch-manipulation border-2 hover:border-green-300 dark:hover:border-green-700 transition-colors text-base",style:{fontSize:"16px"}})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"From (Optional)"}),(0,r.jsx)(R.I,{placeholder:"\uD83D\uDCDD From",value:t.fromField,onChange:e=>a({fromField:e.target.value}),className:"h-12 sm:h-14 touch-manipulation border-2 hover:border-green-300 dark:hover:border-green-700 transition-colors text-base",style:{fontSize:"16px"}})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4 w-full",children:[(0,r.jsx)("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200 px-1",children:"Reference Photos (Optional)"}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-xl p-4 sm:p-6 border border-indigo-200 dark:border-indigo-800",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(X.Z,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-indigo-900 dark:text-indigo-100 mb-2",children:"Upload photos to create cartoon characters!"}),(0,r.jsx)("p",{className:"text-sm text-indigo-700 dark:text-indigo-300 mb-4",children:"Add photos of people to include them as personalized cartoon characters in your card"}),0===v.length&&0===t.referenceImageUrls.length?(0,r.jsxs)("div",{className:"border-2 border-dashed border-indigo-300 dark:border-indigo-600 rounded-lg p-6 text-center",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return(null===(t=e.target.files)||void 0===t?void 0:t[0])&&S(e.target.files[0])},disabled:d,className:"hidden",id:"reference-upload"}),(0,r.jsxs)("label",{htmlFor:"reference-upload",className:"cursor-pointer ".concat(d?"opacity-50 cursor-not-allowed":""),children:[(0,r.jsx)(ee.Z,{className:"w-8 h-8 mx-auto mb-2 text-indigo-400 ".concat(d?"animate-pulse":"")}),(0,r.jsx)("div",{className:"text-base font-medium text-indigo-600 dark:text-indigo-400",children:d?"Uploading...":"Tap to upload photo"}),(0,r.jsx)("div",{className:"text-xs text-indigo-500 dark:text-indigo-300 mt-1",children:"JPG, PNG up to 10MB"})]})]}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3",children:(v.length>0?v:t.referenceImageUrls).map((e,t)=>(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("img",{src:e,alt:"Reference ".concat(t+1),className:"w-full aspect-square object-cover rounded-lg border-2 border-indigo-200 dark:border-indigo-700"}),(0,r.jsx)(i.z,{variant:"destructive",size:"sm",onClick:()=>T(t),className:"absolute top-2 right-2 h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsx)(et.Z,{className:"w-4 h-4"})})]},t))}),t.referenceImageUrls.length<4&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return(null===(t=e.target.files)||void 0===t?void 0:t[0])&&S(e.target.files[0])},disabled:d,className:"hidden",id:"reference-upload-more"}),(0,r.jsx)("label",{htmlFor:"reference-upload-more",children:(0,r.jsx)(i.z,{variant:"outline",size:"sm",disabled:d,asChild:!0,children:(0,r.jsxs)("span",{className:"cursor-pointer",children:[(0,r.jsx)(ee.Z,{className:"w-4 h-4 mr-2"}),"Add another photo"]})})})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-indigo-800 dark:text-indigo-200 mb-2 block",children:"Character Style Instructions (Optional)"}),(0,r.jsx)(z,{placeholder:"e.g., 'Make us look like anime characters', 'Keep our exact outfits but in watercolor style'",value:t.imageTransformation,onChange:e=>a({imageTransformation:e.target.value}),rows:2,className:"resize-none text-sm",style:{fontSize:"16px"}})]})]})]})]})})]}),(0,r.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-800",children:[(0,r.jsx)("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCA1 Tips"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[(0,r.jsx)("li",{children:"• Pick your card type and tone"}),(0,r.jsx)("li",{children:"• To/From fields help personalize"}),(0,r.jsx)("li",{children:"• All fields are optional"})]})]}),p&&null!==h&&(0,r.jsx)(eo,{isOpen:p,onClose:()=>{null==b||b(!1),C(null)},imageUrl:(v.length>0?v:t.referenceImageUrls)[h],imageIndex:h,isAnalyzing:g||!1,analysisResult:N,onSave:e=>{null==x||x(e),C(null),null==b||b(!1)},onSkip:()=>{null==y||y(),C(null),null==b||b(!1)},toField:t.toField,fromField:t.fromField})]})}var em=a(40875),eu=a(14064),eg=a(18477),ep=a(82431),eh=a(77440),ef=a(93022),ex=a(84190),ey=a(82023);let eb=(e,t)=>{let a={"birthday-funny":["cake disaster \uD83C\uDF82","age jokes","party animals \uD83C\uDF89","embarrassing photo"],"birthday-heartfelt":["childhood memories","growth journey","warm wishes","family gathering"],"birthday-romantic":["romantic dinner","heart balloons","love notes","special surprise"],"anniversary-romantic":["wedding memories","sunset beach","flower garden \uD83C\uDF39","starlit dance"],"anniversary-funny":["first date fail","inside jokes","funny couple","adventure mishaps"],"thank-you-professional":["elegant design","corporate colors","minimalist style","formal appreciation"],"thank-you-heartfelt":["gratitude flowers","helping hands","warm embrace","heartfelt thanks"],"holiday-funny":["ugly sweater","reindeer chaos","gift wrapping fail","santa mishap"],"holiday-heartfelt":["cozy fireplace","family traditions","winter wonderland","holiday warmth"],"congratulations-professional":["achievement medal","success ladder","professional milestone","elegant celebration"],"congratulations-funny":["victory dance","confetti explosion","champagne pop","silly celebration"],"sympathy-heartfelt":["peaceful nature","gentle memories","comforting embrace","serene landscape"],"get-well-funny":["superhero recovery","band-aid warrior","healing humor","get well soon animals"],"get-well-heartfelt":["healing flowers","sunny days ahead","caring thoughts","peaceful recovery"]};return a["".concat(e,"-").concat(t)]||a[e+"-heartfelt"]||["custom design","personal touch","special elements","unique style"]},ev=(e,t,a,r)=>"Generate 4 creative and specific card description ideas for a ".concat(t," ").concat(e," card ").concat(a?"for ".concat(a):"",".").concat(r?"\n\nIMPORTANT: The user has uploaded reference photos with the following context:\n".concat(r,"\n\nIncorporate these specific people and elements into your suggestions."):"","\n  Each idea should be 20-30 words long and paint a vivid picture with specific visual elements, themes, scenes, and artistic details.\n  Make them detailed, unique and imaginative - not generic. Include colors, styles, compositions, and emotional elements.\n  Return as a JSON array of strings.");function ej(e){let{formData:t,onAddToDescription:a,chatWithAI:n,photoAnalyses:o=[]}=e,[l,c]=(0,s.useState)(!1),[d,m]=(0,s.useState)([]),[u,g]=(0,s.useState)(!1),p=(0,s.useMemo)(()=>{let e=eb(t.selectedType,t.selectedTone);if(o&&o.length>0){let t=[],a=o.flatMap(e=>e.selectedPeople||[]);if(a.length>0){if(1===a.length){let e=a[0].name||"them";t.push("".concat(e," portrait \uD83C\uDFA8")),t.push("".concat(e," in action"))}else t.push("group portrait \uD83D\uDC65"),t.push("everyone together");let e=o[0];(null==e?void 0:e.backgroundDescription)&&(e.backgroundDescription.toLowerCase().includes("outdoor")?t.push("outdoor adventure \uD83C\uDF33"):e.backgroundDescription.toLowerCase().includes("indoor")&&t.push("cozy indoor scene \uD83C\uDFE0"))}return[...t,...e].slice(0,6)}return e},[t.selectedType,t.selectedTone,o]),h=e=>{let r=t.prompt||"",s=r.trim()?", ":"";a(r+s+e)},f=async()=>{if(n){c(!0),g(!0);try{let e="";if(o&&o.length>0){let t=o.flatMap(e=>e.selectedPeople||[]);if(t.length>0){let a=t.map(e=>{let t=e.name||e.description,a=[];return e.appearance&&a.push(e.appearance),e.age&&a.push("".concat(e.age," years old")),e.position&&a.push(e.position),e.expression&&a.push(e.expression),"".concat(t,": ").concat(a.join(", "))});e="People in photos: ".concat(a.join("; "),". ");let r=o[0];(null==r?void 0:r.backgroundDescription)&&(e+="Scene: ".concat(r.backgroundDescription,"."))}}let a=ev(t.selectedType,t.selectedTone,t.toField,e),r=await n(a,{model:"gemini-2.5-pro",jsonSchema:{type:"array",items:{type:"string"},minItems:4,maxItems:4}});m(r)}catch(e){console.error("Error generating suggestions:",e),m(["A vibrant celebration scene with colorful balloons, confetti, and joyful characters dancing under sparkling party lights in watercolor style","A personalized cartoon portrait featuring the recipient surrounded by their favorite hobbies, pets, and meaningful symbols in bright cheerful colors","A serene nature-inspired design with blooming wildflowers, butterflies, and soft pastel sunset creating a peaceful, dreamy atmosphere","Modern geometric patterns in bold jewel tones creating an elegant abstract design with gold accents and sophisticated minimalist appeal"])}finally{c(!1)}}};return(0,r.jsxs)("div",{className:"space-y-3 mt-2",children:[(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:p.map((e,t)=>(0,r.jsx)(y.C,{variant:"secondary",className:"cursor-pointer hover:bg-secondary/80 transition-colors text-xs",onClick:()=>h(e),children:e},t))}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:f,disabled:l,className:"gap-1.5",children:[(0,r.jsx)(ey.Z,{className:"w-3.5 h-3.5"}),l?"Thinking...":"Need ideas?"]}),d.length>0&&!l&&(0,r.jsxs)(i.z,{variant:"ghost",size:"sm",onClick:f,className:"gap-1 text-muted-foreground",children:[(0,r.jsx)(ep.Z,{className:"w-3 h-3"}),"New ideas"]})]}),u&&(0,r.jsx)("div",{className:"space-y-2",children:l?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsx)(ef.O,{className:"h-16 w-full"},t))}):d.length>0&&(0,r.jsxs)("div",{className:"bg-muted/50 rounded-lg p-3 space-y-2",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"\uD83D\uDCA1 Click any idea to use it:"}),d.map((e,t)=>(0,r.jsx)("div",{className:"text-sm p-3 bg-background rounded cursor-pointer hover:bg-accent transition-colors leading-relaxed",onClick:()=>a(e),children:e},t))]})})]})}var ew=a(92496);function eN(e){var t;let{formData:a,updateFormData:n,onStepComplete:l,handleGetMessageHelp:c,isGeneratingMessage:d,messageHistory:m=[],currentMessageIndex:u=-1,undoMessage:g,redoMessage:p,photoAnalyses:h=[]}=e,[f,x]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1);s.useEffect(()=>{null==l||l()},[l]);let v=async()=>{c&&await c()},j=(0,s.useMemo)(()=>{if(a.isHandwrittenMessage)return"✍️ Leave blank - you'll handwrite";let{selectedType:e,selectedTone:t}=a;return"birthday"===e&&"funny"===t?"\uD83D\uDC9D Add a joke about their age or a funny memory...":"anniversary"===e&&"romantic"===t?"\uD83D\uDC9D Express your love and cherished memories...":"thank-you"===e&&"professional"===t?"\uD83D\uDC9D Express gratitude professionally...":"funny"===t?"\uD83D\uDC9D Add humor, jokes, or funny memories...":"heartfelt"===t?"\uD83D\uDC9D Share sincere feelings and warm wishes...":"\uD83D\uDC9D Your message here... (or click 'Help me write')"},[a.selectedType,a.selectedTone,a.isHandwrittenMessage]),w=u<m.length-1,N=(null===(t=a.finalCardMessage)||void 0===t?void 0:t.length)||0;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Describe Your Card (Optional)"}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>x(!f),className:"gap-1 text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.Z,{className:"w-3 h-3"}),"Collapse"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.Z,{className:"w-3 h-3 rotate-180"}),"Expand"]})})]}),(0,r.jsx)(z,{placeholder:"\uD83D\uDCA1 Optional: E.g., 'Birthday card with cute cats and rainbow colors'",value:a.prompt,onChange:e=>n({prompt:e.target.value}),rows:f?6:3,className:f?"resize-y":"resize-none",style:{fontSize:"16px"}}),(0,r.jsx)(ej,{formData:a,onAddToDescription:e=>n({prompt:e}),chatWithAI:ew.chatWithAI,photoAnalyses:h}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"Tip:"})," Add colors, style, themes for better results, or leave blank for defaults"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Card Message"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[m.length>0&&(0,r.jsxs)(ex.h_,{children:[(0,r.jsx)(ex.$F,{asChild:!0,children:(0,r.jsxs)(i.z,{variant:"ghost",size:"sm",className:"gap-1 text-xs",disabled:a.isHandwrittenMessage,children:[(0,r.jsx)(o.Z,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"History"})]})}),(0,r.jsxs)(ex.AW,{align:"end",className:"w-80",children:[m.map((e,t)=>(0,r.jsxs)(ex.Xi,{onClick:()=>n({finalCardMessage:e}),className:"block",children:[(0,r.jsx)("div",{className:"text-sm truncate",children:e}),t===u&&(0,r.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:"Current"})]},t)),m.length>5&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ex.VD,{}),(0,r.jsxs)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:["Showing last ",Math.min(5,m.length)," messages"]})]})]})]}),(g||p)&&(0,r.jsxs)("div",{className:"flex gap-0.5",children:[(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:g,disabled:!(u>0)||a.isHandwrittenMessage,className:"px-1.5",title:"Undo",children:(0,r.jsx)(eu.Z,{className:"w-3 h-3"})}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:p,disabled:!w||a.isHandwrittenMessage,className:"px-1.5",title:"Redo",children:(0,r.jsx)(eg.Z,{className:"w-3 h-3"})})]}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>b(!y),className:"gap-1 text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.Z,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Collapse"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.Z,{className:"w-3 h-3 rotate-180"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Expand"})]})}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:v,disabled:d||a.isHandwrittenMessage,className:"gap-1 text-xs",children:a.finalCardMessage?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ep.Z,{className:"w-3 h-3"}),d?"Writing...":(0,r.jsx)("span",{className:"hidden sm:inline",children:"Try another"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eh.Z,{className:"w-3 h-3"}),d?"Writing...":"Help me write"]})})]})]}),(0,r.jsx)("div",{className:"relative",children:d?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(ef.O,{className:"h-16 w-full"}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground animate-pulse",children:"Creating personalized message..."})]}):(0,r.jsx)(z,{placeholder:j,value:a.finalCardMessage,onChange:e=>n({finalCardMessage:e.target.value}),rows:y?6:3,className:y?"resize-y":"resize-none",style:{fontSize:"16px"},disabled:a.isHandwrittenMessage})}),!a.isHandwrittenMessage&&(0,r.jsxs)("div",{className:"mt-1 space-y-0.5",children:[a.finalCardMessage&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[N," characters"]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground/70",children:"\uD83D\uDCA1 Messages typically work best between 50-350 characters"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"handwritten-message",checked:a.isHandwrittenMessage,onChange:e=>{n({isHandwrittenMessage:e.target.checked,finalCardMessage:e.target.checked?"":a.finalCardMessage})},className:"rounded"}),(0,r.jsx)("label",{htmlFor:"handwritten-message",className:"text-sm text-gray-600 dark:text-gray-400",children:"Leave blank space for handwritten message"})]})]}),(0,r.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 border border-green-200 dark:border-green-800",children:[(0,r.jsx)("h4",{className:"font-medium text-green-900 dark:text-green-100 mb-2",children:"✨ Tips"}),(0,r.jsxs)("ul",{className:"text-sm text-green-800 dark:text-green-200 space-y-1",children:[(0,r.jsx)("li",{children:"• Be specific for better results"}),(0,r.jsx)("li",{children:'• Use "Help me write" for AI messages'}),(0,r.jsx)("li",{children:"• Both fields are optional"})]})]})]})}let eC=[{id:"ai-smart-style",label:"✨ Smart Style",description:"Let our experts choose the perfect style for your card",color:"from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900",preview:"✨"},{id:"custom",label:"✨ Custom Style",description:"Define your own unique artistic style",color:"from-violet-100 to-purple-100 dark:from-violet-900 dark:to-purple-900",preview:"\uD83C\uDFAF"},{id:"watercolor",label:"\uD83C\uDFA8 Watercolor",description:"Soft, flowing paint effects (our personal favorite)",color:"from-blue-100 to-cyan-100 dark:from-blue-900 dark:to-cyan-900",preview:"\uD83C\uDFA8"},{id:"minimalist",label:"✨ Minimalist",description:"Clean, simple, elegant design",color:"from-gray-100 to-slate-100 dark:from-gray-900 dark:to-slate-900",preview:"◯"},{id:"botanical",label:"\uD83C\uDF3F Botanical",description:"Beautiful flowers and nature elements",color:"from-green-100 to-emerald-100 dark:from-green-900 dark:to-emerald-900",preview:"\uD83C\uDF3F"},{id:"comic-book",label:"\uD83D\uDCA5 Comic Book",description:"Bold graphic novel style",color:"from-yellow-100 to-red-100 dark:from-yellow-900 dark:to-red-900",preview:"\uD83D\uDCA5"},{id:"dreamy-fantasy",label:"\uD83C\uDF38 Dreamy Fantasy",description:"Enchanting anime-inspired art",color:"from-pink-100 to-purple-100 dark:from-pink-900 dark:to-purple-900",preview:"\uD83C\uDF38"},{id:"modern-geometric",label:"\uD83D\uDD37 Modern Geometric",description:"Clean contemporary shapes",color:"from-indigo-100 to-blue-100 dark:from-indigo-900 dark:to-blue-900",preview:"\uD83D\uDD37"}];function ek(e){let{formData:t,updateFormData:a,onStepComplete:n}=e;return s.useEffect(()=>{t.selectedArtisticStyle&&("custom"!==t.selectedArtisticStyle||t.customStyleDescription.trim())&&(null==n||n())},[t.selectedArtisticStyle,t.customStyleDescription,n]),(0,r.jsxs)("div",{className:"space-y-6",children:[t.referenceImageUrls.length>0&&(0,r.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-green-900 dark:text-green-100 mb-1",children:"✨ Reference photos uploaded!"}),(0,r.jsxs)("p",{className:"text-sm text-green-700 dark:text-green-300",children:[t.referenceImageUrls.length," photo",t.referenceImageUrls.length>1?"s":""," will be used to create personalized cartoon characters"]})]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Artistic Style"}),(0,r.jsxs)(M.Ph,{value:t.selectedArtisticStyle,onValueChange:e=>a({selectedArtisticStyle:e}),children:[(0,r.jsx)(M.i4,{children:(0,r.jsx)(M.ki,{placeholder:"Choose artistic style",children:(()=>{let e=eC.find(e=>e.id===t.selectedArtisticStyle);return e?(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br ".concat(e.color," rounded-lg flex items-center justify-center shadow-sm"),children:(0,r.jsx)("span",{className:"text-lg",children:e.preview})}),(0,r.jsx)("span",{className:"font-medium",children:e.label})]}):(0,r.jsx)("span",{className:"text-gray-400",children:"Choose artistic style"})})()})}),(0,r.jsx)(M.Bw,{className:"max-w-[calc(100vw-2rem)]",children:eC.map(e=>(0,r.jsx)(M.Ql,{value:e.id,className:"cursor-pointer hover:bg-purple-50 dark:hover:bg-purple-900/20 max-w-full",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 py-1 w-full",children:[(0,r.jsx)("div",{className:"w-10 h-10 flex-shrink-0 bg-gradient-to-br ".concat(e.color," rounded-lg flex items-center justify-center shadow-sm"),children:(0,r.jsx)("span",{className:"text-xl",children:e.preview})}),(0,r.jsxs)("div",{className:"flex-1 text-left min-w-0 overflow-hidden",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.label}),(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400 break-words whitespace-normal pr-2",children:e.description})]})]})},e.id))})]}),"custom"===t.selectedArtisticStyle&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:"Describe Your Custom Style"}),(0,r.jsx)(z,{placeholder:"e.g., in vintage 1920s art deco style with gold accents and geometric patterns...",value:t.customStyleDescription,onChange:e=>a({customStyleDescription:e.target.value}),rows:3,className:"resize-none",style:{fontSize:"16px"}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Describe the artistic style you want for your card (colors, techniques, era, mood, etc.)"})]})]}),(0,r.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 border border-purple-200 dark:border-purple-800",children:[(0,r.jsx)("h4",{className:"font-medium text-purple-900 dark:text-purple-100 mb-2",children:"\uD83C\uDFA8 Tips"}),(0,r.jsxs)("ul",{className:"text-sm text-purple-800 dark:text-purple-200 space-y-1",children:[(0,r.jsx)("li",{children:"• Smart Style picks the best style for your card"}),(0,r.jsx)("li",{children:"• Each style brings unique character to your design"}),(0,r.jsx)("li",{children:"• Custom style lets you describe exactly what you want"})]})]})]})}function eD(e){let{formData:t,updateFormData:a,onStepComplete:n}=e;return s.useEffect(()=>{t.userEmail.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.userEmail)&&(null==n||n())},[t.userEmail,n]),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-1.5 h-8 bg-gradient-to-b from-orange-500 to-red-500 rounded-full"}),(0,r.jsx)("label",{className:"text-base font-semibold text-gray-800 dark:text-gray-200",children:"Your Email"})]}),(0,r.jsx)(R.I,{type:"email",placeholder:"\uD83D\uDCE7 your.email@example.com",required:!0,value:t.userEmail,onChange:e=>a({userEmail:e.target.value}),style:{fontSize:"16px"},className:"h-12 sm:h-14 border-2 hover:border-orange-300 dark:hover:border-orange-700 transition-colors touch-manipulation text-base"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"We'll email you when your card is ready!"})]}),(0,r.jsxs)("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3 border border-orange-200 dark:border-orange-800",children:[(0,r.jsx)("h4",{className:"font-medium text-orange-900 dark:text-orange-100 mb-2",children:"\uD83D\uDCE7 Almost There!"}),(0,r.jsx)("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:"Your email is required to generate and deliver your personalized greeting card."})]})]})}function eS(e){var t,a,n,o;let{formData:l,updateFormData:c,onStepComplete:m,isGenerating:u,isGeneratingFinalCard:g,isGeneratingMessage:p,generationProgress:h,progressPercentage:f=0,currentElapsedTime:x=0,isDraftMode:y=!1,draftCards:b=[],selectedDraftIndex:v=-1,formatGenerationTime:j,onGenerateDraftCards:w,onSelectDraft:N}=e,[C,k]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{C&&m&&m()},[C,m]),(0,s.useEffect)(()=>{k(!0)},[]),u&&0===b.length)?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto",children:(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Creating Your Card"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:h||"Generating your personalized card..."})]})]}),(0,r.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/30 dark:to-cyan-900/30 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:h||"Generating your card..."})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full transition-all duration-1000 ease-out",style:{width:"".concat(Math.min(f,100),"%")}})}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[(0,r.jsxs)("span",{className:"font-medium",children:[Math.round(f),"% Complete"]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[x>0&&j&&(0,r.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["⏱️ ",j(x)]}),(0,r.jsx)("span",{className:"text-gray-500",children:y&&!g?"~30-60 sec expected":"~1:30-2:00 min expected"})]})]})]})}),(0,r.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,r.jsx)("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Generating:"}),(0,r.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["custom"===l.selectedType?l.customCardType:l.selectedType," card",l.selectedTone&&" with ".concat(l.selectedTone," tone"),(null===(o=l.referenceImageUrls)||void 0===o?void 0:o.length)>0&&" • ".concat(l.referenceImageUrls.length," reference photo").concat(l.referenceImageUrls.length>1?"s":"")]})]})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Ready to Create Your Card?"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Choose how you'd like to generate your personalized greeting card"})]}),(0,r.jsx)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 border border-purple-200 dark:border-purple-800",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("span",{className:"text-white text-sm",children:"\uD83C\uDFA8"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-purple-900 dark:text-purple-100 mb-1",children:"Draft Mode"}),(0,r.jsxs)("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:["Generate 5 designs, pick your favorite","ai-smart-style"===l.selectedArtisticStyle&&(0,r.jsx)("span",{className:"font-medium",children:" in curated styles"})]})]})]})}),0===b.length&&(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsx)("button",{onClick:w,disabled:u||p||!(null===(t=l.userEmail)||void 0===t?void 0:t.trim()),className:"w-full h-12 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-lg font-medium flex items-center justify-center gap-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Creating 5 design options..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-lg",children:"\uD83C\uDFA8"}),(0,r.jsx)("span",{children:"Create 5 Front Cover Options"})]})})}),b.length>0&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:u?"Preview & Select as They're Ready!":"Choose Your Favorite Design"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:u?"".concat(b.length,"/5 front cover variations complete... You can select one now to proceed!"):"5 front cover variations created with low quality for fast preview. Select your favorite to generate the complete high-quality card!"})]}),u&&(0,r.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/30 dark:to-cyan-900/30 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:h||"Generating remaining variations..."})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full transition-all duration-1000 ease-out",style:{width:"".concat(Math.min(f,100),"%")}})}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[(0,r.jsxs)("span",{className:"font-medium",children:[Math.round(f),"% Complete"]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[x>0&&j&&(0,r.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["⏱️ ",j(x)]}),(0,r.jsx)("span",{className:"text-gray-500",children:"~30-60 sec expected"})]})]})]})}),(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)("div",{className:"flex overflow-x-auto gap-3 pb-4 -mx-4 px-4 snap-x snap-mandatory touch-pan-x",children:Array.from({length:5},(e,t)=>{let a=b[t];return b.length,(0,r.jsx)("div",{className:"flex-shrink-0 w-52 sm:w-56 snap-center rounded-lg border-2 p-3 sm:p-3 transition-all cursor-pointer touch-manipulation ".concat(v===t?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 shadow-lg":a?"border-gray-200 dark:border-gray-700 hover:border-purple-300 hover:bg-purple-50/50 dark:hover:bg-purple-900/10":"border-dashed border-gray-300 dark:border-gray-600"),onClick:()=>a&&N&&N(t),children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"aspect-[2/3] relative overflow-hidden rounded border mb-3",children:[(0,r.jsx)("img",{src:a.frontCover,alt:"Design ".concat(t+1),className:"w-full h-full object-cover"}),v===t&&(0,r.jsx)("div",{className:"absolute inset-0 bg-purple-600/20 flex items-center justify-center",children:(0,r.jsx)("div",{className:"bg-white rounded-full p-2",children:(0,r.jsx)(d.Z,{className:"w-8 h-8 text-purple-600"})})})]}),(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsxs)("h4",{className:"font-medium text-sm",children:["Design ",t+1]}),"ai-smart-style"===l.selectedArtisticStyle&&a.styleInfo&&(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:a.styleInfo.styleLabel}),(0,r.jsxs)("div",{className:"space-y-2",children:[v===t&&(0,r.jsx)("div",{className:"bg-purple-600 text-white text-xs px-3 py-1 rounded-full",children:"✓ Selected"}),(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation()},className:"w-full text-xs h-9 touch-manipulation",children:[(0,r.jsx)("span",{className:"hidden sm:inline",children:"Preview Design"}),(0,r.jsx)("span",{className:"sm:hidden",children:"Preview"})]})]})]})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),(0,r.jsx)("h4",{className:"font-medium text-sm mb-1",children:"Creating..."}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Generating front cover..."})]})},t)})}),-1!==v&&(0,r.jsx)("div",{className:"text-center bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mt-4",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:["✓ Design ",v+1," selected - ready to generate complete card!"]})})]})]}),!(null===(a=l.userEmail)||void 0===a?void 0:a.trim())&&(0,r.jsx)("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-amber-600",children:"⚠️"}),(0,r.jsx)("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"Please enter your email address in the previous steps to generate your card."})]})}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"\uD83D\uDCA1 Generation Tips:"}),(0,r.jsxs)("ul",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-1",children:[(0,r.jsx)("li",{children:"• Draft Mode is recommended for first-time users"}),(0,r.jsx)("li",{children:"• Generation typically takes 1-3 minutes depending on complexity"}),(0,r.jsx)("li",{children:"• You can safely leave this page during generation"}),(null===(n=l.referenceImageUrls)||void 0===n?void 0:n.length)>0&&(0,r.jsxs)("li",{children:["• Your ",l.referenceImageUrls.length," reference photo",l.referenceImageUrls.length>1?"s":""," will be used for character creation"]})]})]})]})}var eT=a(60610);let eI=s.forwardRef((e,t)=>{let{className:a,value:s,...n}=e;return(0,r.jsx)(eT.fC,{ref:t,className:(0,O.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...n,children:(0,r.jsx)(eT.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});eI.displayName=eT.fC.displayName;var eE=a(17625),eP=a(89345),eA=a(49322),eF=a(89227),eR=a(69076),eM=a(47416),eO=a(2207),ez=a(92451),eU=a(10407),eG=a(78867),eZ=a(14368),e_=a(48614),eL=e=>{let{src:t,thumbnailSrc:a,alt:n,className:i="",onLoad:o,onError:l,loading:c="lazy",priority:d=!1,sizes:m,srcSet:u}=e,[g,p]=(0,s.useState)("loading"),[h,f]=(0,s.useState)(""),x=(0,s.useCallback)(e=>new Promise((t,a)=>{let r=new Image;r.onload=()=>t(),r.onerror=e=>a(e),r.src=e}),[]);return(0,s.useEffect)(()=>{let e=!0;return(async()=>{if(!t||""===t.trim()){p("error");return}try{a&&(p("loading"),await x(a),e&&(f(a),p("thumbnail"))),d||"eager"===c||console.log("\uD83D\uDD04 ProgressiveImage: Loading immediately (fixed lazy loading)",t),await x(t),e&&(f(t),p("loaded"),null==o||o())}catch(t){e&&(p("error"),null==l||l())}})(),()=>{e=!1}},[t,a,d,c,x,o,l]),(0,r.jsx)("div",{className:"w-full h-full relative overflow-hidden",children:(()=>{switch(g){case"loading":return(0,r.jsx)("div",{className:"flex items-center justify-center bg-gray-100 dark:bg-gray-800 w-full h-full",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)(er.Z,{className:"w-6 h-6 animate-spin text-gray-400"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Loading..."})]})});case"thumbnail":return(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)("img",{src:h,alt:n,className:"".concat(i," filter blur-sm transition-all duration-300"),draggable:!1,sizes:m,srcSet:u}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"bg-black/20 rounded-full p-2",children:(0,r.jsx)(er.Z,{className:"w-4 h-4 animate-spin text-white"})})})]});case"loaded":return(0,r.jsx)("img",{src:h,alt:n,className:"".concat(i," transition-all duration-300"),draggable:!1,sizes:m,srcSet:u});case"error":return(0,r.jsx)("div",{className:"flex items-center justify-center bg-gray-100 dark:bg-gray-800 w-full h-full",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-red-600 dark:text-red-400 text-xs",children:"✕"})}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Failed to load"})]})});default:return null}})()})};let eJ=()=>"(max-width: 640px) 300px, (max-width: 1024px) 400px, 600px",eH=e=>{e.forEach(e=>{if(e){let t=document.createElement("link");t.rel="preload",t.as="image",t.href=e,document.head.appendChild(t)}})},eY={enter:e=>({x:e>0?1e3:-1e3,opacity:0,scale:.8}),center:{zIndex:1,x:0,opacity:1,scale:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0,scale:.8})},eB=(e,t)=>Math.abs(e)*t;function eW(e){var t,a;let{card:n,onCardUpdate:o,isFrontBackOnly:l=!1,onPrint:c,paperConfig:u,sectionLoadingStates:g,selectedPaperSize:p,onPaperSizeChange:h,paperSizes:f,isCardCompleted:b,fastPreviewMode:v=!1,onViewFullCard:j}=e,w=!n&&g&&Object.values(g).some(e=>"loading"===e),N=n||(w?{id:"loading",prompt:"Loading...",frontCover:"",backCover:"",leftPage:"",rightPage:"",createdAt:new Date}:null);if(!N)return null;let[C,D]=(0,s.useState)(0),[T,I]=(0,s.useState)(0),[E,P]=(0,s.useState)(!1),[A,F]=(0,s.useState)(null),[O,U]=(0,s.useState)(!1),[G,Z]=(0,s.useState)(null),[_,L]=(0,s.useState)(""),[J,H]=(0,s.useState)(!1),[Y,B]=(0,s.useState)({}),[W,q]=(0,s.useState)({}),[V,Q]=(0,s.useState)(!1),[K,ee]=(0,s.useState)(""),[ea,es]=(0,s.useState)(!1),[en,ei]=(0,s.useState)(""),[eo,el]=(0,s.useState)(!1),[ec,ed]=(0,s.useState)(!1),[em,eu]=(0,s.useState)({});(0,s.useEffect)(()=>{if(N&&!w){N.frontCover&&eH([N.frontCover]);let e=[N.backCover,N.leftPage,N.rightPage].filter(Boolean);e.length>0&&setTimeout(()=>{eH(e)},1e3)}},[N,w]);let eg=(e,t)=>{let a=Y[e],r=W[e];return a&&a.length>0&&void 0!==r?a[r]:t},ep=e=>{let t=W[e];return void 0!==t&&t>0},eh=e=>{let t=Y[e],a=W[e];return t&&void 0!==a&&a<t.length-1},ef=e=>{ep(e)&&q(t=>({...t,[e]:t[e]-1}))},ex=e=>{eh(e)&&q(t=>({...t,[e]:t[e]+1}))},ey=(e,t)=>{let a=Y[e]||[],r=W[e]||-1,s=[...a.slice(0,r+1),t];B(t=>({...t,[e]:s})),q(t=>({...t,[e]:s.length-1}))},eb=e=>{switch(e){case"front-cover":return N.frontCover;case"back-cover":return N.backCover;case"left-interior":return N.leftPage;case"right-interior":return N.rightPage;default:return null}},ev=[{id:"front-cover",title:"Front Cover",subtitle:"What recipients see first",image:eg("front-cover",N.frontCover),originalImage:N.frontCover,description:"The front cover design that recipients will see first.",color:"bg-blue-500",type:"single",editLabel:"Edit Front Cover"},{id:"left-interior",title:"Left Interior",subtitle:"Decorative page",image:eg("left-interior",N.leftPage),originalImage:N.leftPage,description:"The decorative left page when the card is opened.",color:"bg-emerald-500",type:"single",editLabel:"Edit Left Interior"},{id:"right-interior",title:"Right Interior",subtitle:"Message page",image:eg("right-interior",N.rightPage),originalImage:N.rightPage,description:"The right page with your message when the card is opened.",color:"bg-emerald-600",type:"single",editLabel:"Edit Right Interior"},{id:"back-cover",title:"Back Cover",subtitle:"What's on the back",image:eg("back-cover",N.backCover),originalImage:N.backCover,description:"The back of the card with subtle design elements.",color:"bg-gray-500",type:"single",editLabel:"Edit Back Cover"}],ej=l?ev.filter(e=>!e.id.includes("interior")):ev,ew=e=>{I(e),D(t=>1===e?t===ej.length-1?0:t+1:0===t?ej.length-1:t-1)},eN=e=>{I(e>C?1:-1),D(e)},eC=()=>{E?(A&&(clearInterval(A),F(null)),P(!1)):(F(setInterval(()=>{ew(1)},3e3)),P(!0))};(0,s.useEffect)(()=>()=>{A&&clearInterval(A)},[A]);let ek=()=>{U(!0),document.body.style.overflow="hidden"},eD=()=>{U(!1),document.body.style.overflow="unset"};(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&O&&eD()};if(O)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[O]);let eS=e=>{if(w){m.Am.error("Please wait for the card to finish generating before editing");return}Z(e),L("")},eT=async()=>{if(!G||!_.trim()){m.Am.error("Please enter an edit prompt");return}let e=eb(G);if(!e){m.Am.error("Could not find source image for editing");return}H(!0);try{var t;let a;let r="";if(N.generatedPrompts)switch(G){case"front-cover":r=N.generatedPrompts.frontCover||"";break;case"back-cover":r=N.generatedPrompts.backCover||"";break;case"left-interior":r=N.generatedPrompts.leftInterior||"";break;case"right-interior":r=N.generatedPrompts.rightInterior||""}let s="";if(r){let e="You are an expert AI prompt engineer specializing in image generation prompts for greeting cards. Your task is to modify an existing image generation prompt based on a user's edit request.\n\nORIGINAL PROMPT:\n\"".concat(r,'"\n\nUSER\'S EDIT REQUEST:\n"').concat(_,"\"\n\nCRITICAL INSTRUCTIONS:\n1. You MUST return the ENTIRE modified prompt, not just the changes\n2. Keep ALL the original formatting, style instructions, and technical details\n3. Only modify the specific elements mentioned in the user's edit request\n4. Preserve all portrait format requirements and greeting card specifications\n5. Maintain the same level of detail and descriptiveness as the original\n6. Keep all safety instructions and content guidelines from the original\n7. Ensure the modified prompt will generate the same type of image (greeting card ").concat(G.replace("-"," "),') with only the requested changes\n\nEXAMPLES OF WHAT TO MODIFY:\n- Colors: If user says "make it blue", change color references in the prompt\n- Style: If user says "more cartoonish", adjust style descriptors\n- Elements: If user says "add flowers", incorporate flower elements\n- Text: If user says "change the message", update text content\n- Mood: If user says "make it happier", adjust mood descriptors\n\nWHAT TO PRESERVE:\n- All technical specifications (portrait format, dimensions, etc.)\n- All safety and content guidelines\n- The basic structure and purpose of the image\n- All printing and edge safety requirements\n- The greeting card context and purpose\n\nReturn the ENTIRE modified prompt that incorporates the user\'s requested changes while preserving everything else from the original prompt. Do not provide explanations or summaries - just return the complete modified prompt.');try{let t;let a=await fetch("/internal/call_mcp_tool",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"ai_chat",arguments:{messages:e,model:"gemini-2.5-pro",include_thoughts:!1}})});if(!a.ok)throw Error("AI prompt modification failed: ".concat(a.status));let n=await a.json();if(n.error&&"None"!==n.error&&null!==n.error)throw Error(n.error);if("string"==typeof n.result)try{t=JSON.parse(n.result)}catch(e){throw Error("Invalid JSON response from AI")}else t=n.result;if("error"===t.status)throw Error(t.message);s=t.response||r}catch(e){console.warn("AI prompt modification failed, using fallback approach:",e),s="CRITICAL: This is a greeting card ".concat(G.replace("-"," "),' in portrait format.\n\nORIGINAL IMAGE DESCRIPTION: The current image was created with this prompt: "').concat(r,'"\n\nYour edit request: "').concat(_,'"\n\nIMPORTANT INSTRUCTIONS:\n- This is a portrait (vertical) image for a greeting card\n- You must PRESERVE the portrait format and dimensions\n- Only modify what was specifically requested in the edit\n- Keep the overall layout structure intact - do not crop or cut off any sections\n- Maintain the aspect ratio and size of the original image\n- Ensure the edited result is suitable for printing as part of a greeting card\n- Position any text elements safely away from edges with generous margins\n- The image should remain focused on its specific purpose: ').concat(G.replace("-"," "),"\n- Base your edits on the original design described above, making only the requested changes\n\nApply the requested changes while preserving the complete image structure and portrait format.")}}else s="CRITICAL: This is a greeting card ".concat(G.replace("-"," "),' in portrait format.\n\nYour edit request: "').concat(_,'"\n\nIMPORTANT INSTRUCTIONS:\n- This is a portrait (vertical) image for a greeting card\n- You must PRESERVE the portrait format and dimensions\n- Only modify what was specifically requested in the edit\n- Keep the overall layout structure intact - do not crop or cut off any sections\n- Maintain the aspect ratio and size of the original image\n- Ensure the edited result is suitable for printing as part of a greeting card\n- Position any text elements safely away from edges with generous margins\n- The image should remain focused on its specific purpose: ').concat(G.replace("-"," "),"\n\nApply the requested changes while preserving the complete image structure and portrait format.");let n=await fetch("/internal/call_mcp_tool",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"edit_images",arguments:{images:[e],edit_prompt:s,user_number:"+17145986105",model:"gpt-image-1",output_format:"jpeg",quality:"auto",output_compression:100,size:(null==u?void 0:u.dimensions)||"1024x1536",n:1}})});if(!n.ok)throw Error("HTTP ".concat(n.status));let i=await n.json();if(i.error&&"None"!==i.error&&null!==i.error)throw Error(i.error);if("string"==typeof i.result)try{a=JSON.parse(i.result)}catch(e){throw Error("Invalid JSON response")}else a=i.result;if("error"===a.status)throw Error(a.message);let l=a.results[0];if("error"===l.status)throw Error(l.message);let c=l.edited_url;if(!c)throw Error("No edited image URL returned");if(ey(G,c),o&&!w){let e={...N};switch(G){case"front-cover":e.frontCover=c;break;case"back-cover":e.backCover=c;break;case"left-interior":e.leftPage=c;break;case"right-interior":e.rightPage=c}if(e.generatedPrompts&&s)switch(e.generatedPrompts={...e.generatedPrompts},G){case"front-cover":e.generatedPrompts.frontCover=s;break;case"back-cover":e.generatedPrompts.backCover=s;break;case"left-interior":e.generatedPrompts.leftInterior=s;break;case"right-interior":e.generatedPrompts.rightInterior=s}o(e)}m.Am.success("✨ ".concat(null===(t=ej.find(e=>e.id===G))||void 0===t?void 0:t.title," edited successfully!")),Z(null),L("")}catch(e){console.error("Edit failed:",e),m.Am.error("Failed to edit image: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{H(!1)}},eI=e=>{B(t=>{let a={...t};return delete a[e],a}),q(t=>{let a={...t};return delete a[e],a}),m.Am.success("Reset to original image")},eW=e=>{if(!g)return"idle";switch(e){case"front-cover":return g.frontCover;case"back-cover":return g.backCover;case"left-interior":return g.leftInterior;case"right-interior":return g.rightInterior;case"interior":let t=g.leftInterior,a=g.rightInterior;if("loading"===t||"loading"===a)return"loading";if("error"===t||"error"===a)return"error";if("completed"===t&&"completed"===a)return"completed";return"idle";default:return"idle"}},eq=e=>{switch(e){case"loading":return(0,r.jsx)("div",{className:"absolute top-3 left-16 bg-blue-500/90 text-white rounded-full p-2 shadow-lg",children:(0,r.jsx)(er.Z,{className:"w-4 h-4 animate-spin"})});case"completed":return(0,r.jsx)("div",{className:"absolute top-3 left-16 bg-green-500/90 text-white rounded-full p-2 shadow-lg",children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})});case"error":return(0,r.jsx)("div",{className:"absolute top-3 left-16 bg-red-500/90 text-white rounded-full p-2 shadow-lg",children:(0,r.jsx)(eA.Z,{className:"w-4 h-4"})});default:return null}},eV=async()=>{if(w){m.Am.error("Please wait for the card to finish generating before sharing");return}Q(!0);try{if(N.shareUrl){ee(N.shareUrl),es(!0),m.Am.success("Card is ready to share!"),Q(!1);return}let e=await fetch("/api/cards/store",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:N.prompt,frontCover:N.frontCover,backCover:N.backCover,leftPage:N.leftPage,rightPage:N.rightPage,generatedPrompts:N.generatedPrompts||null})});if(!e.ok)throw Error("Failed to store card");let t=await e.json();ee(t.share_url),o&&!w&&o({...N,shareUrl:t.share_url}),es(!0),m.Am.success("Card is ready to share!")}catch(e){console.error("Error sharing card:",e),m.Am.error("Failed to prepare card for sharing")}finally{Q(!1)}},eQ=async()=>{try{await navigator.clipboard.writeText(K),m.Am.success("Link copied to clipboard!")}catch(e){m.Am.error("Failed to copy link")}},eK=async()=>{if(!en.trim()){m.Am.error("Please enter an email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(en)){m.Am.error("Please enter a valid email address");return}el(!0);try{let e=await fetch("https://vibecarding.com/send_email_nodejs_style",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:en,from:"vibecarding@ast.engineer",subject:"\uD83C\uDF89 Someone shared a beautiful card with you!",body:"Hi there!\n\nSomeone thought you'd love to see this beautiful greeting card created with VibeCarding!\n\nView the card: ".concat(K,"\n\nThis card was created with love using our AI-powered greeting card platform. You can create your own cards at https://vibecarding.com\n\nBest regards,\nThe VibeCarding Team\nvibecarding@ast.engineer")})});if(e.ok)m.Am.success("✉️ Card sent successfully via email!"),es(!1),ei("");else{let t=await e.text();console.error("Email send failed:",e.status,t),m.Am.error("Failed to send email. Please try again.")}}catch(e){console.error("Error sending email:",e),m.Am.error("Failed to send email. Please try again.")}finally{el(!1)}},e$=async()=>{if(w){m.Am.error("Please wait for the card to finish generating before sending to factory");return}ed(!0);try{var e,t,a,r;let s="\nFront Cover Prompt:\n".concat((null===(e=N.generatedPrompts)||void 0===e?void 0:e.frontCover)||"Not available","\n\nBack Cover Prompt:\n").concat((null===(t=N.generatedPrompts)||void 0===t?void 0:t.backCover)||"Not available","\n\n").concat(!l&&(null===(a=N.generatedPrompts)||void 0===a?void 0:a.leftInterior)?"Left Interior Prompt:\n".concat(N.generatedPrompts.leftInterior,"\n\n"):"").concat(!l&&(null===(r=N.generatedPrompts)||void 0===r?void 0:r.rightInterior)?"Right Interior Prompt:\n".concat(N.generatedPrompts.rightInterior,"\n\n"):""),n=await fetch("https://vibecarding.com/send_email_nodejs_style",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:"cards1@ast.engineer",from:"vibecarding@ast.engineer",subject:"New Card Request",body:s})});if(!n.ok)throw Error("HTTP ".concat(n.status));let i=await n.json();if("success"===i.status)m.Am.success("\uD83C\uDFED Card sent to factory successfully!");else throw Error(i.message||"Failed to send to factory")}catch(e){console.error("Error sending to factory:",e),m.Am.error("Failed to send to factory. Please try again.")}finally{ed(!1)}};return v&&N.frontCover?(0,r.jsxs)(eZ.E.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-1",children:"Quick Preview"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Front cover preview - loading faster for you"})]}),(0,r.jsxs)("div",{className:"relative bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl p-6 shadow-lg",children:[(0,r.jsx)("div",{className:"relative aspect-[2/3] max-w-sm mx-auto",children:(0,r.jsxs)("div",{className:"w-full h-full relative bg-white rounded-lg overflow-hidden shadow-xl group",children:[(0,r.jsx)(eL,{src:N.frontCover,thumbnailSrc:void 0,alt:"Card front cover",className:"w-full h-full object-contain",priority:!0,sizes:eJ()}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-all duration-200 flex items-center justify-center",children:(0,r.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:j&&(0,r.jsxs)(i.z,{onClick:j,className:"bg-white/90 hover:bg-white text-gray-700 shadow-lg",children:[(0,r.jsx)($.Z,{className:"w-4 h-4 mr-2"}),"View Full Card"]})})}),eq(eW("front-cover"))]})}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center mt-4",children:"The front cover design that recipients will see first"})]}),j&&(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsxs)(i.z,{onClick:j,variant:"outline",className:"border-blue-500 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20",children:[(0,r.jsx)($.Z,{className:"w-4 h-4 mr-2"}),"View Complete Card"]})})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(eZ.E.div,{className:"text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Card Preview"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l?"Swipe through your card: front cover and back cover":"Swipe through your card: front cover, left interior, right interior, and back cover"})]}),(0,r.jsxs)(eZ.E.div,{className:"relative bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl p-6 overflow-hidden shadow-xl",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.2},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:ej.map((e,t)=>(0,r.jsx)(eZ.E.button,{className:"w-3 h-3 rounded-full transition-all duration-300 ".concat(t===C?"bg-blue-500 scale-125":"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400"),onClick:()=>eN(t),whileHover:{scale:1.2},whileTap:{scale:.9}},t))}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[C+1," / ",ej.length]}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:eC,className:"h-8 w-8 p-0",children:E?(0,r.jsx)(eF.Z,{className:"w-4 h-4"}):(0,r.jsx)(S.Z,{className:"w-4 h-4"})}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>D(0),className:"h-8 w-8 p-0",children:(0,r.jsx)(eR.Z,{className:"w-4 h-4"})}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:ek,className:"h-8 w-8 p-0",title:"View in fullscreen",children:(0,r.jsx)(eM.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsx)("div",{className:"relative h-[60vh] sm:h-80 md:h-96 overflow-hidden rounded-xl",children:(0,r.jsx)(e_.M,{initial:!1,custom:T,children:(0,r.jsx)(eZ.E.div,{custom:T,variants:eY,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2},scale:{duration:.2}},drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(e,t)=>{let{offset:a,velocity:r}=t,s=eB(a.x,r.x);s<-1e4?ew(1):s>1e4&&ew(-1)},className:"absolute inset-0 cursor-grab active:cursor-grabbing",children:(0,r.jsxs)("div",{className:"h-full flex flex-col",children:[(0,r.jsx)(eZ.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,r.jsxs)(y.C,{className:"".concat(ej[C].color," text-white w-full justify-center py-2 mb-4 text-sm font-medium"),children:[ej[C].title," (",ej[C].subtitle,")"]})}),(0,r.jsx)(eZ.E.div,{className:"flex-1 relative border-2 border-white/20 rounded-lg overflow-hidden shadow-2xl bg-white group",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.4,duration:.4},children:ej[C].image?(0,r.jsxs)("div",{className:"w-full h-full relative cursor-pointer group/image",onClick:ek,title:"Click to view fullscreen",children:[(0,r.jsx)(eL,{src:ej[C].image,thumbnailSrc:void 0,alt:ej[C].title,className:"w-full h-full object-contain bg-white",priority:0===C,sizes:eJ()}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover/image:bg-black/10 transition-all duration-200 flex items-center justify-center",children:(0,r.jsx)("div",{className:"opacity-0 group-hover/image:opacity-100 transition-opacity duration-200 bg-white/90 rounded-full p-3 shadow-lg",children:(0,r.jsx)(eM.Z,{className:"w-6 h-6 text-gray-700"})})}),(0,r.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute top-3 left-3 pointer-events-auto",children:eq(eW(ej[C].id))}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),eS(ej[C].id)},className:"absolute top-3 right-3 bg-white/90 hover:bg-white text-gray-700 rounded-full p-2 shadow-lg transition-all duration-200 pointer-events-auto",title:ej[C].editLabel,children:(0,r.jsx)(eO.Z,{className:"w-4 h-4"})}),Y[ej[C].id]&&Y[ej[C].id].length>0&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),eI(ej[C].id)},className:"absolute top-3 left-3 bg-amber-500/90 hover:bg-amber-500 text-white rounded-full p-2 shadow-lg transition-all duration-200 pointer-events-auto",title:"Reset to original",children:(0,r.jsx)(eR.Z,{className:"w-3 h-3"})}),Y[ej[C].id]&&Y[ej[C].id].length>0&&(0,r.jsxs)("div",{className:"absolute bottom-3 left-3 bg-white/90 rounded-lg shadow-lg p-2 flex items-center gap-2 pointer-events-auto",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ef(ej[C].id)},disabled:!ep(ej[C].id),className:"p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Previous version",children:(0,r.jsx)(ez.Z,{className:"w-3 h-3"})}),(0,r.jsxs)("span",{className:"text-xs text-gray-700 px-1",children:[(W[ej[C].id]||0)+1,"/",Y[ej[C].id].length]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ex(ej[C].id)},disabled:!eh(ej[C].id),className:"p-1 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Next version",children:(0,r.jsx)(eU.Z,{className:"w-3 h-3"})})]}),Y[ej[C].id]&&Y[ej[C].id].length>0&&(0,r.jsxs)("div",{className:"absolute bottom-3 right-3 bg-emerald-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1 pointer-events-auto",children:[(0,r.jsx)(X.Z,{className:"w-3 h-3"}),"Edited"]})]})]}):(0,r.jsx)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-800",children:(0,r.jsxs)("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-lg p-8 flex flex-col items-center gap-4",children:[(0,r.jsx)(er.Z,{className:"w-8 h-8 animate-spin text-gray-400"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"loading"===eW(ej[C].id)?"Generating...":"Loading section..."}),(0,r.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:ej[C].title})]})]})})}),(0,r.jsx)(eZ.E.p,{className:"text-sm text-gray-600 dark:text-gray-400 text-center mt-3 px-4 leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:ej[C].description})]})},C)})}),(0,r.jsx)(eZ.E.button,{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-full p-2 shadow-lg hover:bg-white dark:hover:bg-gray-700 transition-colors z-10",onClick:()=>ew(-1),whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,r.jsx)(ez.Z,{className:"w-5 h-5"})}),(0,r.jsx)(eZ.E.button,{className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-full p-2 shadow-lg hover:bg-white dark:hover:bg-gray-700 transition-colors z-10",onClick:()=>ew(1),whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,r.jsx)(eU.Z,{className:"w-5 h-5"})})]}),(0,r.jsx)(eZ.E.div,{className:"grid ".concat(l?"grid-cols-2":"grid-cols-2 sm:grid-cols-4"," gap-3"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:ej.map((e,t)=>{let a=eW(e.id);return(0,r.jsxs)(eZ.E.button,{onClick:()=>eN(t),className:"p-3 rounded-lg border-2 transition-all duration-300 text-left relative ".concat(t===C?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,r.jsxs)("div",{className:"absolute top-2 right-2",children:["loading"===a&&(0,r.jsx)(er.Z,{className:"w-3 h-3 animate-spin text-blue-500"}),"completed"===a&&(0,r.jsx)(d.Z,{className:"w-3 h-3 text-green-500"}),"error"===a&&(0,r.jsx)(eA.Z,{className:"w-3 h-3 text-red-500"})]}),(0,r.jsx)("div",{className:"w-3 h-3 rounded-full mb-2 ".concat(e.color)}),(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.title}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.subtitle})]},e.id)})}),b&&f&&h&&(0,r.jsx)(eZ.E.div,{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Print Size"}),(0,r.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Change the paper size for printing (doesn't affect your images)"})]}),(0,r.jsx)("div",{className:"w-48",children:(0,r.jsxs)(M.Ph,{value:p,onValueChange:h,children:[(0,r.jsx)(M.i4,{className:"border-blue-300 dark:border-blue-700",children:(0,r.jsx)(M.ki,{placeholder:"Choose paper size"})}),(0,r.jsx)(M.Bw,{children:f.map(e=>(0,r.jsx)(M.Ql,{value:e.id,children:(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"font-medium",children:e.label}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id))})]})})]})}),(0,r.jsxs)(eZ.E.div,{className:"flex flex-col sm:flex-row gap-3 pt-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},children:[c&&(0,r.jsxs)(i.z,{onClick:c,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white",children:[(0,r.jsx)(eE.Z,{className:"w-4 h-4 mr-2"}),"Print Card",u&&(0,r.jsxs)("span",{className:"ml-2 text-xs opacity-75",children:["(",u.printWidth," \xd7 ",u.printHeight,")"]})]}),(0,r.jsx)(i.z,{onClick:e$,disabled:ec||w,variant:"outline",className:"flex-1 border-orange-500 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 disabled:opacity-50",children:ec?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(er.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(er.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,r.jsxs)(r.Fragment,{children:["\uD83C\uDFED",(0,r.jsx)("span",{className:"ml-2",children:"Send to Factory"})]})}),(0,r.jsx)(i.z,{onClick:eV,disabled:V||w,variant:"outline",className:"flex-1 border-blue-500 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 disabled:opacity-50",children:V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(er.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Preparing..."]}):w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(er.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.Z,{className:"w-4 h-4 mr-2"}),"Share Card"]})})]}),(0,r.jsx)(x.Vq,{open:ea,onOpenChange:es,children:(0,r.jsxs)(x.cZ,{className:"sm:max-w-md",children:[(0,r.jsxs)(x.fK,{children:[(0,r.jsxs)(x.$N,{className:"flex items-center gap-2",children:[(0,r.jsx)(k.Z,{className:"w-5 h-5"}),"Share Your Card"]}),(0,r.jsx)(x.Be,{children:"Your card is ready to share! Copy the link or send it via email."})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Share URL"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(R.I,{value:K,readOnly:!0,className:"flex-1"}),(0,r.jsx)(i.z,{onClick:eQ,variant:"outline",size:"sm",children:(0,r.jsx)(eG.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Send via Email"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(R.I,{type:"email",placeholder:"recipient@example.com",value:en,onChange:e=>ei(e.target.value),className:"flex-1"}),(0,r.jsx)(i.z,{onClick:eK,variant:"outline",size:"sm",disabled:!en.trim()||eo,children:eo?(0,r.jsx)(er.Z,{className:"w-4 h-4 animate-spin"}):(0,r.jsx)(eP.Z,{className:"w-4 h-4"})})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:eo?"Sending email...":"Sends the card directly via email"})]})]})]})}),(0,r.jsx)(e_.M,{children:O&&(0,r.jsx)(eZ.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/95 backdrop-blur-sm",onClick:eD,children:(0,r.jsxs)("div",{className:"h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(y.C,{className:"".concat(ej[C].color," text-white px-4 py-2"),children:ej[C].title}),(0,r.jsx)("span",{className:"text-white/80 text-sm hidden md:block",children:ej[C].subtitle})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("span",{className:"text-white/80 text-sm",children:[C+1," / ",ej.length]}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),eC()},className:"h-9 w-9 p-0 text-white hover:bg-white/10",children:E?(0,r.jsx)(eF.Z,{className:"w-5 h-5"}):(0,r.jsx)(S.Z,{className:"w-5 h-5"})}),(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),eD()},className:"h-9 w-9 p-0 text-white hover:bg-white/10",children:(0,r.jsx)(et.Z,{className:"w-5 h-5"})})]})]}),(0,r.jsx)("div",{className:"flex-1 relative px-4 md:px-6 pb-6",children:(0,r.jsxs)("div",{className:"h-full relative",children:[(0,r.jsx)(e_.M,{initial:!1,custom:T,children:(0,r.jsx)(eZ.E.div,{custom:T,variants:eY,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2},scale:{duration:.2}},drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(e,t)=>{let{offset:a,velocity:r}=t,s=eB(a.x,r.x);s<-1e4?ew(1):s>1e4&&ew(-1)},className:"absolute inset-0 cursor-grab active:cursor-grabbing",onClick:e=>e.stopPropagation(),children:(0,r.jsx)("div",{className:"h-full flex items-center justify-center",children:ej[C].image?(0,r.jsx)("div",{className:"max-w-full max-h-full",children:(0,r.jsx)(eL,{src:ej[C].image,thumbnailSrc:void 0,alt:ej[C].title,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",priority:!0})}):(0,r.jsx)("div",{className:"flex items-center justify-center bg-gray-800 rounded-lg p-8",children:(0,r.jsx)("p",{className:"text-white/70",children:"Loading section..."})})})},"fullscreen-".concat(C))}),(0,r.jsx)(eZ.E.button,{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 backdrop-blur-sm rounded-full p-3 text-white hover:bg-black/70 transition-colors z-10",onClick:e=>{e.stopPropagation(),ew(-1)},whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,r.jsx)(ez.Z,{className:"w-6 h-6"})}),(0,r.jsx)(eZ.E.button,{className:"absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 backdrop-blur-sm rounded-full p-3 text-white hover:bg-black/70 transition-colors z-10",onClick:e=>{e.stopPropagation(),ew(1)},whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,r.jsx)(eU.Z,{className:"w-6 h-6"})})]})}),(0,r.jsx)("div",{className:"flex items-center justify-center gap-3 pb-6",children:ej.map((e,t)=>(0,r.jsx)(eZ.E.button,{className:"transition-all duration-300 ".concat(t===C?"w-8 h-3 bg-white rounded-full":"w-3 h-3 bg-white/40 rounded-full hover:bg-white/60"),onClick:e=>{e.stopPropagation(),eN(t)},whileHover:{scale:1.2},whileTap:{scale:.9}},"fullscreen-indicator-".concat(e.id)))}),(0,r.jsx)("div",{className:"px-6 pb-6",children:(0,r.jsx)(eZ.E.p,{className:"text-white/80 text-center text-sm md:text-base leading-relaxed max-w-2xl mx-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:ej[C].description})})]})})}),(0,r.jsx)(x.Vq,{open:!!G,onOpenChange:e=>!e&&Z(null),children:(0,r.jsxs)(x.cZ,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(x.fK,{children:[(0,r.jsxs)(x.$N,{className:"flex items-center gap-2",children:[(0,r.jsx)(X.Z,{className:"w-5 h-5 text-blue-600"}),G?null===(t=ej.find(e=>e.id===G))||void 0===t?void 0:t.editLabel:"Edit Section"]}),(0,r.jsx)(x.Be,{children:"interior"===G?(0,r.jsxs)(r.Fragment,{children:["Describe how you'd like to modify this section of your card. This interior has ",(0,r.jsx)("strong",{children:"two areas"}),": decorative artwork on the left and your message on the right. Be specific about which area you want to change and what modifications you want.",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsxs)("span",{className:"text-amber-600 dark:text-amber-400 text-sm",children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"Tip:"}),' Specify "left side" for decorative changes or "right side" for message changes to ensure both areas are preserved.']})]}):"Describe how you'd like to modify this section of your card. Be specific about colors, style, content, or any changes you want to make."})]}),(0,r.jsxs)("div",{className:"space-y-4 py-4",children:[G&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Current Image","left-interior"===G||"right-interior"===G?"s":""]}),(0,r.jsx)("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white",children:"left-interior"===G||"right-interior"===G?(0,r.jsxs)("div",{className:"flex h-64",children:[(0,r.jsxs)("div",{className:"w-1/2 relative",children:[(0,r.jsx)(eL,{src:eg("left-interior",n.leftPage),thumbnailSrc:void 0,alt:"Left Interior",className:"w-full h-full object-contain"}),"left-interior"===G&&(0,r.jsx)("div",{className:"absolute inset-0 border-4 border-blue-500 bg-blue-500/10"})]}),(0,r.jsx)("div",{className:"w-px bg-gray-300"}),(0,r.jsxs)("div",{className:"w-1/2 relative",children:[(0,r.jsx)(eL,{src:eg("right-interior",n.rightPage),thumbnailSrc:void 0,alt:"Right Interior",className:"w-full h-full object-contain"}),"right-interior"===G&&(0,r.jsx)("div",{className:"absolute inset-0 border-4 border-blue-500 bg-blue-500/10"})]})]}):(0,r.jsx)(eL,{src:(null===(a=ej.find(e=>e.id===G))||void 0===a?void 0:a.image)||"",thumbnailSrc:void 0,alt:"Current section",className:"w-full h-64 object-contain"})}),("left-interior"===G||"right-interior"===G)&&(0,r.jsx)("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"The highlighted area shows which side you're editing. Both sides are shown for context."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Edit Instructions"}),(0,r.jsx)(z,{placeholder:"e.g., Change the background to a sunset sky, make the flowers more colorful, add sparkles, change the text style to handwritten...",value:_,onChange:e=>L(e.target.value),rows:4,className:"resize-none",style:{fontSize:"16px"}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Be specific about what you want to change. Only the areas you describe will be modified while keeping the rest intact."})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)(i.z,{onClick:()=>Z(null),variant:"outline",className:"flex-1",disabled:J,children:"Cancel"}),(0,r.jsx)(i.z,{onClick:eT,disabled:!_.trim()||J,className:"flex-1 bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700",children:J?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(er.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Editing..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X.Z,{className:"w-4 h-4 mr-2"}),"Apply Edit"]})})]})]})]})})]})}let eq=[{id:"standard",label:"5\xd77 Card (Standard)",description:"Standard 5\xd77 greeting card (10\xd77 print layout)",aspectRatio:"9:16",dimensions:"1024x1536",printWidth:"10in",printHeight:"7in"},{id:"compact",label:"4\xd76 Card (Compact)",description:"Compact 4\xd76 greeting card (8\xd76 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8in",printHeight:"6in"},{id:"a6",label:"A6 Card (4\xd76)",description:"A6 paper size (8.3\xd75.8 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8.3in",printHeight:"5.8in"}];function eV(e){let{formData:t,isGeneratingFinalCard:a,generationProgress:o,progressPercentage:l,currentElapsedTime:u,selectedDraftIndex:g,draftCards:p,generatedCard:h,isCardCompleted:f,onGenerateFinalCard:y,formatGenerationTime:b}=e,[v,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)("physical"),[C,k]=(0,s.useState)("standard"),[D,S]=(0,s.useState)(!1);(0,s.useEffect)(()=>{!(g>=0)||a||f||h||S(!0)},[g,a,f,h]);let T=p[g],I=async()=>{var e;if(!h){m.Am.error("No card available to print");return}if(!(null===(e=t.userEmail)||void 0===e?void 0:e.trim())){m.Am.error("Please enter your email address before printing"),j(!1);return}j(!1);try{if(!h.frontCover){m.Am.error("Card is missing front cover image. Please regenerate the card.");return}if(!h.backCover){m.Am.error("Card is missing back cover image. Please regenerate the card.");return}if(!t.isFrontBackOnly&&(!h.leftPage||!h.rightPage)){m.Am.error("Card is missing interior pages. Please regenerate the card or use front-back only mode.");return}let e={front_cover:h.frontCover,back_cover:h.backCover,left_page:h.leftPage,right_page:h.rightPage,card_name:(h.prompt||"Custom Card").substring(0,50)+((h.prompt||"").length>50?"...":""),paper_size:C,is_front_back_only:t.isFrontBackOnly,copies:1,color_mode:"color",quality:"high"};if("email"===w){let a={...e,user_email:t.userEmail.trim(),send_pdf:!0},r=await fetch("/api/send-pdf-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){let e=await r.text();throw Error("HTTP ".concat(r.status,": ").concat(e))}let s=await r.json();if("success"===s.status)m.Am.success("\uD83D\uDCE7 PDF sent to ".concat(t.userEmail,"! Check your inbox."));else throw Error(s.error||"Failed to send PDF")}else{let t=await fetch("/api/print-queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("HTTP ".concat(t.status));let a=await t.json();if("queued"===a.status)m.Am.success("\uD83D\uDDA8️ Your card is now printing! You can pick it up shortly."),setTimeout(async()=>{try{let e=await fetch("/api/print-status/".concat(a.job_id));if(e.ok){let t=await e.json();"found"===t.status&&("completed"===t.job.status?m.Am.success("✅ Your card has been added to the print queue and should be available for pickup shortly."):"failed"===t.job.status&&m.Am.error("❌ There was an issue with printing. Please try again or contact us for help."))}}catch(e){console.log("Could not check print status:",e)}},1e4);else throw Error(a.error||"Unknown error")}}catch(e){console.error("Print/Email error:",e),m.Am.error("email"===w?"Failed to send PDF email":"Failed to queue print job")}};return(0,r.jsxs)("div",{className:"space-y-6",children:[T&&(0,r.jsxs)(n.Zb,{className:"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800",children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"text-lg flex items-center gap-2",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5 text-green-600"}),"Selected Design"]})}),(0,r.jsx)(n.aY,{children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("img",{src:T.frontCover,alt:"Selected draft",className:"w-24 h-36 object-cover rounded-lg border shadow-sm"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Creating your complete card"}),(0,r.jsx)("p",{className:"text-sm text-green-700 dark:text-green-300 font-medium",children:"✓ Ready to generate final version"})]})]})})]}),a&&(0,r.jsxs)(n.Zb,{children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"text-xl flex items-center gap-2",children:[(0,r.jsx)(ey.Z,{className:"w-6 h-6 text-blue-600"}),"Generating Your Complete Card"]})}),(0,r.jsxs)(n.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Progress"}),(0,r.jsxs)("span",{className:"font-medium",children:[Math.round(l),"%"]})]}),(0,r.jsx)(eI,{value:l,className:"h-3"})]}),o&&(0,r.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:(0,r.jsx)("p",{className:"text-center text-blue-800 dark:text-blue-200 font-medium",children:o})}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:["Elapsed: ",b(u)]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"\uD83D\uDCA1 While you wait:"}),(0,r.jsxs)("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[(0,r.jsx)("li",{children:"• High-quality generation typically takes 1-3 minutes"}),(0,r.jsx)("li",{children:"• You can safely leave this page during generation"}),(0,r.jsx)("li",{children:"• Your card will be ready when you return"}),(0,r.jsxs)("li",{children:["• We'll send email updates to ",t.userEmail]})]})]})]})]}),f&&h&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(n.Zb,{className:"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800",children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"text-xl flex items-center gap-2 text-green-800 dark:text-green-200",children:[(0,r.jsx)(d.Z,{className:"w-6 h-6"}),"Your Card is Ready!"]})}),(0,r.jsx)(n.aY,{children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("p",{className:"text-green-700 dark:text-green-300",children:"\uD83C\uDF89 Your complete high-quality card has been generated successfully!"})})})]}),(0,r.jsx)(eW,{card:h,isFrontBackOnly:t.isFrontBackOnly,isCardCompleted:!0,onPrint:()=>{var e;if(h){if(!(null===(e=t.userEmail)||void 0===e?void 0:e.trim())){m.Am.error("Please enter your email address before printing");return}N("physical"),j(!0)}},paperConfig:eq.find(e=>e.id===C)||eq[0],selectedPaperSize:C,onPaperSizeChange:k,paperSizes:eq})]}),!a&&!f&&!h&&g>=0&&(0,r.jsxs)(n.Zb,{className:"border-amber-200 bg-amber-50 dark:bg-amber-900/20 dark:border-amber-800",children:[(0,r.jsx)(n.Ol,{children:(0,r.jsxs)(n.ll,{className:"text-lg flex items-center gap-2 text-amber-800 dark:text-amber-200",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5"}),"Ready to Generate"]})}),(0,r.jsx)(n.aY,{children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Ready to create your final high-quality card?"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"This will generate your final card based on the selected design."}),D&&!a&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)(i.z,{onClick:()=>{S(!1),y(g)},className:"bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700",size:"lg",children:[(0,r.jsx)(ey.Z,{className:"w-5 h-5 mr-2"}),"Generate Final Card"]}),(0,r.jsx)("div",{children:(0,r.jsx)(i.z,{variant:"outline",onClick:()=>S(!1),size:"sm",children:"Not ready yet"})})]})]})})]}),(0,r.jsx)(x.Vq,{open:v,onOpenChange:j,children:(0,r.jsxs)(x.cZ,{className:"sm:max-w-md",children:[(0,r.jsxs)(x.fK,{children:[(0,r.jsxs)(x.$N,{className:"flex items-center gap-2",children:[(0,r.jsx)(eE.Z,{className:"w-5 h-5"}),"Print Your Card"]}),(0,r.jsx)(x.Be,{children:"Choose how you'd like to print your greeting card."})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h4",{className:"text-sm font-medium",children:"Print Options"}),(0,r.jsx)("div",{className:"border rounded-lg p-4 cursor-pointer transition-all ".concat("physical"===w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"),onClick:()=>N("physical"),children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("input",{type:"radio",checked:"physical"===w,onChange:()=>N("physical"),className:"mt-1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eE.Z,{className:"w-4 h-4 text-blue-600"}),(0,r.jsx)("span",{className:"font-medium",children:"Physical Print"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Print directly to our office printer. Pick up your card shortly."})]})]})}),(0,r.jsx)("div",{className:"border rounded-lg p-4 cursor-pointer transition-all ".concat("email"===w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"),onClick:()=>N("email"),children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("input",{type:"radio",checked:"email"===w,onChange:()=>N("email"),className:"mt-1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eP.Z,{className:"w-4 h-4 text-green-600"}),(0,r.jsx)("span",{className:"font-medium",children:"Email PDF"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Get a PDF version sent to your email for printing at home."})]})]})})]}),"physical"===w&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h4",{className:"text-sm font-medium",children:"Print Settings"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2 block",children:"Paper Size"}),(0,r.jsxs)(M.Ph,{value:C,onValueChange:k,children:[(0,r.jsx)(M.i4,{children:(0,r.jsx)(M.ki,{})}),(0,r.jsx)(M.Bw,{children:eq.map(e=>(0,r.jsx)(M.Ql,{value:e.id,children:(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"font-medium",children:e.label}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id))})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Email Address"}),(0,r.jsx)(R.I,{value:t.userEmail||"",disabled:!0,className:"bg-gray-50 dark:bg-gray-800"}),"email"===w&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"PDF will be sent to this email address"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(i.z,{variant:"outline",onClick:()=>j(!1),className:"flex-1",children:"Cancel"}),(0,r.jsx)(i.z,{onClick:I,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700",children:"email"===w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eP.Z,{className:"w-4 h-4 mr-2"}),"Send PDF"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eE.Z,{className:"w-4 h-4 mr-2"}),"Print Card"]})})]})]})]})})]})}function eQ(e){let{currentStep:t,formData:a,updateFormData:s,cardStudio:n,wizardState:i,handleFileUploadWrapper:o,handleGetMessageHelpWrapper:l,undoMessageWrapper:c,redoMessageWrapper:d,handleTemplateSelect:m}=e;switch(t){case 1:return(0,r.jsx)(ed,{formData:a,updateFormData:s,onStepComplete:()=>{i.completedSteps.includes(1)||i.markStepCompleted(1)},onTemplateSelect:m,handleFileUpload:o,handleRemoveReferenceImage:e=>{let t=a.referenceImages.filter((t,a)=>a!==e),r=a.referenceImageUrls.filter((t,a)=>a!==e);n.setReferenceImages(t),n.setReferenceImageUrls(r),n.handleRemoveReferenceImage(e),s({referenceImages:t,referenceImageUrls:r})},isUploading:n.isUploading,photoAnalyses:n.photoAnalyses,isAnalyzing:n.isAnalyzing,showAnalysisModal:n.showAnalysisModal,pendingAnalysisIndex:n.pendingAnalysisIndex,analyzePhoto:n.analyzePhoto,savePhotoAnalysis:n.savePhotoAnalysis,skipPhotoAnalysis:n.skipPhotoAnalysis,setShowAnalysisModal:n.setShowAnalysisModal,referenceImageUrlsFromStudio:n.referenceImageUrls});case 2:return(0,r.jsx)(eN,{formData:a,updateFormData:s,onStepComplete:()=>{i.completedSteps.includes(2)||i.markStepCompleted(2)},handleGetMessageHelp:l,isGeneratingMessage:n.isGeneratingMessage,messageHistory:n.messageHistory,currentMessageIndex:n.currentMessageIndex,undoMessage:c,redoMessage:d,photoAnalyses:n.photoAnalyses});case 3:return(0,r.jsx)(ek,{formData:a,updateFormData:s,onStepComplete:()=>{i.completedSteps.includes(3)||i.markStepCompleted(3)}});case 4:return(0,r.jsx)(eD,{formData:a,updateFormData:s,onStepComplete:()=>{i.completedSteps.includes(4)||i.markStepCompleted(4)}});case 5:return(0,r.jsx)(eS,{formData:a,updateFormData:s,onStepComplete:()=>{i.completedSteps.includes(5)||i.markStepCompleted(5)},isGenerating:n.isGenerating,isGeneratingFinalCard:n.isGeneratingFinalCard,isGeneratingMessage:n.isGeneratingMessage,generationProgress:n.generationProgress,progressPercentage:n.progressPercentage,currentElapsedTime:n.currentElapsedTime,isDraftMode:n.isDraftMode,draftCards:n.draftCards,selectedDraftIndex:n.selectedDraftIndex,formatGenerationTime:n.formatGenerationTime,onGenerateDraftCards:n.handleGenerateDraftCards,onSelectDraft:e=>{n.setSelectedDraftIndex(e),i.completedSteps.includes(5)||i.markStepCompleted(5),i.goToStep(6)}});case 6:return(0,r.jsx)(eV,{formData:a,isGeneratingFinalCard:n.isGeneratingFinalCard,generationProgress:n.generationProgress,progressPercentage:n.progressPercentage,currentElapsedTime:n.currentElapsedTime,selectedDraftIndex:n.selectedDraftIndex,draftCards:n.draftCards,generatedCard:n.generatedCard,isCardCompleted:n.isCardCompleted,onGenerateFinalCard:n.handleGenerateFinalFromDraft,formatGenerationTime:n.formatGenerationTime});default:return null}}let eK=e=>{if(!e)return null;let t=e.toLowerCase();return t.includes("birthday")?"birthday":t.includes("thank")||t.includes("grateful")?"thank-you":t.includes("anniversary")?"anniversary":t.includes("congratulat")?"congratulations":t.includes("holiday")||t.includes("christmas")||t.includes("new year")?"holiday":t.includes("love")||t.includes("romantic")?"love":t.includes("wedding")?"wedding":t.includes("graduat")?"graduation":t.includes("baby")?"new-baby":t.includes("sorry")||t.includes("apolog")?"apology":null},e$=(e,t,a)=>async(r,s)=>{let n=t.formData.referenceImages||[];t.formData.referenceImageUrls,await e.handleFileUpload(r,s),"reference"===s&&(await new Promise(e=>setTimeout(e,0)),e.referenceImages.length>n.length&&(console.log("\uD83D\uDD04 Syncing reference images to form data:",{images:e.referenceImages.length,urls:e.referenceImageUrls}),a({referenceImages:e.referenceImages,referenceImageUrls:e.referenceImageUrls})))},eX=(e,t)=>async()=>{let a=await e.handleGetMessageHelp();a&&t({finalCardMessage:a})},e0=(e,t)=>()=>{e.undoMessage(),e.currentMessageIndex>0&&t({finalCardMessage:e.messageHistory[e.currentMessageIndex-1]})},e1=(e,t)=>()=>{e.redoMessage(),e.currentMessageIndex<e.messageHistory.length-1&&t({finalCardMessage:e.messageHistory[e.currentMessageIndex+1]})},e3=(e,t,a)=>{var r;t({prompt:e.prompt||"",selectedType:eK(e.prompt)||a.selectedType,selectedArtisticStyle:(null===(r=e.styleInfo)||void 0===r?void 0:r.styleName)||a.selectedArtisticStyle}),a.setSelectedTemplate(e)},e2=(e,t,a,r,s,n)=>{n(!0);let i=t.resumeDraftSession(e);i?(a.updateFormData(i.formData),r.setDraftCards(i.draftCards),r.setSelectedDraftIndex(i.selectedDraftIndex),r.setIsDraftMode(!0),i.draftCards.length>0?s.goToStep(5):s.goToStep(2),m.Am.success("Draft session resumed successfully!"),setTimeout(()=>{n(!1)},100)):n(!1)};var e4=a(68680),e8=a(85505),e5=a(93837);let e6={sympathy:{back:5,leftInterior:20,rightInterior:10},"get-well":{back:10,leftInterior:30,rightInterior:15},"thank-you":{back:15,leftInterior:35,rightInterior:20},wedding:{back:10,leftInterior:30,rightInterior:15},birthday:{back:20,leftInterior:40,rightInterior:20},anniversary:{back:15,leftInterior:35,rightInterior:15},congratulations:{back:20,leftInterior:40,rightInterior:20},"new-baby":{back:15,leftInterior:35,rightInterior:20},holiday:{back:20,leftInterior:40,rightInterior:25},default:{back:15,leftInterior:35,rightInterior:20}};class e9{static getVisualDensity(e){return e6[e]||e6.default}static getEnhancedReferencePhotoInstructions(e){if(!e||0===e.length)return"\nCRITICAL CHARACTER REFERENCE INSTRUCTIONS:\n- The attached photos show the exact people/characters to include\n- Create cartoon/illustrated versions of these specific individuals\n- Capture their unique features, hair, clothing style\n- Do NOT create generic characters - use the reference photos\n- Match their appearance while adapting to the artistic style".trim();let t=e.filter(e=>e.analyzed&&!e.analysisFailed);if(0===t.length)return this.getEnhancedReferencePhotoInstructions();let a=t.flatMap(e=>e.selectedPeople.filter(e=>e.includeInCard)),r=t.reduce((e,t)=>e+t.excludedCount,0),s="\nCRITICAL CHARACTER REFERENCE INSTRUCTIONS:\n- Create cartoon/illustrated versions of EXACTLY ".concat(a.length," specific ").concat(1===a.length?"person":"people",":");a.forEach((e,t)=>{s+="\n\nPerson ".concat(t+1,": ").concat(e.name||e.positionDescription,"\n- Position: ").concat(e.positionDescription,"\n- Appearance: ").concat(e.description,"\n- Age: ").concat(e.apparentAge,"\n- Hair: ").concat(e.hairColor," ").concat(e.hairStyle,"\n- Clothing: ").concat(e.clothing,"\n- Expression: Keep their ").concat(e.expression," expression"),e.distinguishingFeatures&&(s+="\n- Features: ".concat(e.distinguishingFeatures)),e.relationshipToRecipient&&(s+="\n- Relationship: ".concat(e.relationshipToRecipient))}),r>0&&(s+="\n\nIMPORTANT: ".concat(r," other ").concat(1===r?"person was":"people were"," in the reference photos but should NOT be included in the card."));let n=t.filter(e=>e.specialInstructions).map(e=>e.specialInstructions).join(" ");return n&&(s+="\n\nSpecial instructions: ".concat(n)),(s+="\n\n- Match their exact appearance while adapting to the artistic style\n- Keep their relative positions if they appear together\n- Maintain their expressions and mood").trim()}static generateCardPrompts(e){var t,a,r;let s=e.customCardType||e.cardType,n=e.theme||"A beautiful ".concat(s," card"),i=(null===(t=e.artisticStyle)||void 0===t?void 0:t.promptModifier)||"",o=(0,e5.Z)();'\nTheme: "'.concat(n,'"\nStyle: ').concat((null===(a=e.artisticStyle)||void 0===a?void 0:a.label)||"Default","\n").concat(e.toField?"To: ".concat(e.toField):"","\n").concat(e.fromField?"From: ".concat(e.fromField):"","\n").concat(!e.isFrontBackOnly&&e.message?'Message: "'.concat(e.message,'"'):"","\n").concat((null===(r=e.referenceImageUrls)||void 0===r?void 0:r.length)?"Reference Photos: ".concat(e.referenceImageUrls.length," photo(s) provided for character creation"):"","\nUnique ID: ").concat(o).trim();let l={frontCover:this.generateFrontCoverPrompt(s,n,i,e),backCover:this.generateBackCoverPrompt(i,e.cardType)};return e.isFrontBackOnly||(l.leftInterior=this.generateLeftInteriorPrompt(i,e.cardType),l.rightInterior=this.generateRightInteriorPrompt(e.message||"",e.isHandwrittenMessage||!1,i,e.cardType)),l}static generateDraftPrompt(e){var t,a,r,s;let n=e.customCardType||e.cardType,i=e.theme||"A beautiful ".concat(n," card"),o=(null===(t=e.artisticStyle)||void 0===t?void 0:t.promptModifier)||"",l=(0,e5.Z)();if(e.isDraftVariation&&void 0!==e.variationIndex){let t=["watercolor painting style with flowing colors and soft edges","beautiful botanical illustration with natural elements","comic book style with bold colors and dynamic composition","dreamy fantasy art with magical ethereal elements","clean minimalist design with simple elegant shapes"];e.variationIndex<t.length&&(o=t[e.variationIndex])}return"You are an expert AI greeting card designer. Create a front cover prompt for a ".concat(n,' greeting card.\n\nTheme: "').concat(i,'"\nStyle: ').concat((null===(a=e.artisticStyle)||void 0===a?void 0:a.label)||"Default","\nTone: ").concat(e.toneLabel," - ").concat(e.toneDescription,"\n").concat(e.toField?"To: ".concat(e.toField):"","\n").concat(e.fromField?"From: ".concat(e.fromField):"","\n").concat((null===(r=e.referenceImageUrls)||void 0===r?void 0:r.length)?"Reference Photos: I have attached ".concat(e.referenceImageUrls.length," reference photo").concat(e.referenceImageUrls.length>1?"s":""," for character creation."):"","\nUnique ID: ").concat(l,'\n\nFront Cover Requirements:\n- Include "').concat(n,'" greeting text positioned safely in center area (avoid top/bottom 10%)\n- Use beautiful, readable handwritten cursive script\n- ').concat((null===(s=e.referenceImageUrls)||void 0===s?void 0:s.length)?this.getEnhancedReferencePhotoInstructions(e.photoAnalyses):"Create charming cartoon-style figures if needed","\n- Be creative and unique, avoid generic designs\n- Flat 2D artwork for printing\n- Style: ").concat(o,"\n\nReturn ONLY the front cover prompt as plain text.")}static generateMessagePrompt(e){let t=e.customCardType||e.cardType,a=e.theme||"A beautiful ".concat(t," card with ").concat(e.toneDescription," style"),r="";if(e.photoAnalyses&&e.photoAnalyses.length>0){let t=e.photoAnalyses.flatMap(e=>e.selectedPeople||[]);if(t.length>0){let e=t.map(e=>e.name||e.description).join(", ");r="\nPhoto Context: The card features ".concat(e," from the uploaded photo(s).")}}return"Create a ".concat(e.toneDescription," message for a ").concat(t,' greeting card.\n\nCard Theme/Description: "').concat(a,'"\n').concat(e.toField?"Recipient: ".concat(e.toField):"Recipient: [not specified]","\n").concat(e.fromField?"Sender: ".concat(e.fromField):"Sender: [not specified]","\nCard Tone: ").concat(e.toneLabel," - ").concat(e.toneDescription).concat(r,"\n\nInstructions:\n- Write a message that is ").concat(e.toneDescription," and feels personal and genuine\n- ").concat(e.toField?"Address the message to ".concat(e.toField," directly, using their name naturally"):"Write in a way that could be personalized to any recipient","\n- ").concat(e.fromField?"Write as if ".concat(e.fromField," is personally writing this message"):"Write in a ".concat(e.toneDescription," tone"),"\n- Match the ").concat(e.toneDescription," tone and occasion of the ").concat(t,' card type\n- Be inspired by the theme: "').concat(a,'"\n').concat(r?"- Reference the people from the photos naturally in your message if appropriate":"","\n- Keep it concise but meaningful (2-4 sentences ideal)\n- Make it feel authentic, not generic\n").concat(this.SAFETY_REQUIREMENTS,"\n").concat(this.getToneSpecificInstructions(e.tone),"\n- ").concat(e.toField&&e.fromField?"Show the relationship between ".concat(e.fromField," and ").concat(e.toField," through the ").concat(e.toneDescription," message tone"):"","\n- ").concat(e.fromField?'End the message with a signature line like "Love, '.concat(e.fromField,'" or "- ').concat(e.fromField,'" or similar, naturally integrated into the message.'):"","\n\nReturn ONLY the message text that should appear inside the card - no quotes, no explanations, no markdown formatting (no *bold*, _italics_, or other markdown), just the complete ").concat(e.toneDescription," message in plain text.\n\nIMPORTANT: Wrap your final message in <MESSAGE> </MESSAGE> tags. Everything outside these tags will be ignored.")}static generateFinalFromDraftPrompts(e){var t;e.customCardType||e.cardType,e.theme;let a=(null===(t=e.artisticStyle)||void 0===t?void 0:t.promptModifier)||"",r=this.generateBackCoverPromptFromFront(e.frontCoverPrompt,a,e.cardType),s={frontCover:e.frontCoverPrompt,backCover:r};return e.isFrontBackOnly||(s.leftInterior=this.generateLeftInteriorPromptFromFront(e.frontCoverPrompt,a,e.cardType),s.rightInterior=this.generateRightInteriorPromptFromFront(e.frontCoverPrompt,e.message||"",e.isHandwrittenMessage||!1,a,e.cardType)),s}static async generateFinalFromDraftPromptsCombined(e){var t;let r=e.customCardType||e.cardType,s=this.getVisualDensity(e.cardType),{chatWithAI:n}=await Promise.resolve().then(a.bind(a,92496)),i="Generate prompts for the remaining panels of a ".concat(r,' greeting card.\n\nCONTEXT - FRONT COVER (already designed):\n"').concat(e.frontCoverPrompt,'"\n\nIMPORTANT: The above front cover description is provided as CONTEXT ONLY. You should extract the color palette, artistic style, and overall aesthetic from it, but DO NOT copy characters, people, or specific scenes to other panels.\n\nCARD DETAILS:\n- Card Type: ').concat(r,'\n- Message to display: "').concat(e.message||"No message - handwritten space needed",'"\n- Is Handwritten: ').concat(e.isHandwrittenMessage?"Yes":"No","\n- Style Modifier: ").concat((null===(t=e.artisticStyle)||void 0===t?void 0:t.promptModifier)||"Default style","\n\nVISUAL DENSITY REQUIREMENTS:\n- Back Cover: ").concat(s.back,"% decoration (very minimal)\n- Left Interior: ").concat(s.leftInterior,"% decoration (subtle, complementary)\n- Right Interior: ").concat(s.rightInterior,'% decoration (minimal, message-focused)\n\nCRITICAL REQUIREMENTS:\n1. NO PEOPLE, CHARACTERS, OR FIGURES on any interior pages or back cover\n2. NO GREETING TEXT (like "Happy Birthday", "Thank You", etc.) on back cover or left interior - only decorative elements\n3. Extract ONLY colors and artistic style from the front cover context\n4. Each panel should feel cohesive but serve its specific purpose\n5. Back cover must leave bottom-right corner clear for QR code\n6. Right interior must prioritize message legibility if message is provided\n7. NEVER include the card type greeting text anywhere except the front cover\n\n').concat(this.LAYOUT_REQUIREMENTS,"\n").concat(this.SAFETY_REQUIREMENTS);try{let t=await n(i,{systemPrompt:"You are an expert greeting card designer. Generate cohesive image prompts for the back cover, left interior, and right interior of a greeting card. The front cover has already been designed, and you need to create prompts that complement it while following specific design requirements.",model:"gemini-2.5-pro",jsonSchema:{type:"object",properties:{backCover:{type:"string",description:"Complete prompt for back cover image generation"},leftInterior:{type:"string",description:"Complete prompt for left interior image generation"},rightInterior:{type:"string",description:"Complete prompt for right interior image generation"}},required:["backCover","leftInterior","rightInterior"]}}),a={frontCover:e.frontCoverPrompt,backCover:t.backCover};return e.isFrontBackOnly||(a.leftInterior=t.leftInterior,a.rightInterior=t.rightInterior),a}catch(t){return console.error("Failed to generate combined prompts, falling back to individual generation:",t),this.generateFinalFromDraftPrompts(e)}}static generateFrontCoverPrompt(e,t,a,r){var s;let n=(0,e5.Z)(),i="Create a beautiful front cover for a ".concat(e," greeting card. ").concat(t,'. Include "').concat(e,'" greeting text in elegant handwritten script positioned in the center area. ').concat(a," ").concat(this.LAYOUT_REQUIREMENTS," Unique ID: ").concat(n);return(null===(s=r.referenceImageUrls)||void 0===s?void 0:s.length)&&(i+=" ".concat(this.getEnhancedReferencePhotoInstructions(r.photoAnalyses))),i}static generateBackCoverPrompt(e,t){let a=this.getVisualDensity(t),r=(0,e5.Z)();return"Create a very minimal back cover design for a greeting card. Use only ".concat(a.back,"% decoration - perhaps a single small motif, a subtle pattern border, or gentle color wash. The design should be understated and elegant, leaving most of the space clean and peaceful. Think of it as a quiet ending to the card experience. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES, NO TEXT, NO WORDS, NO GREETING - only minimal abstract decorative elements. ").concat(e," ").concat(this.LAYOUT_REQUIREMENTS," ").concat(this.QR_CODE_SPACE," Unique ID: ").concat(r)}static generateLeftInteriorPrompt(e,t){let a=this.getVisualDensity(t),r=(0,e5.Z)();return"Create subtle, complementary decorative art for the left interior page of a greeting card. Use soft, muted versions of the card's color palette. Keep decoration minimal and elegant - think ".concat(a.leftInterior,"% visual density compared to the front cover. Focus on gentle patterns, soft watercolor washes, delicate florals, or abstract elements that won't compete with the message on the facing page. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES, NO TEXT, NO WORDS, NO GREETING - only decorative and artistic elements. ").concat(e," ").concat(this.LAYOUT_REQUIREMENTS," Unique ID: ").concat(r)}static generateRightInteriorPrompt(e,t,a,r){let s=this.getVisualDensity(r),n=100-s.rightInterior,i=(0,e5.Z)();return t?"Create an elegant writing space for the right interior page. Add very subtle decorative elements - perhaps just delicate corner flourishes or a faint border. Keep ".concat(n,"% of the page clean white/cream space for handwriting. The decoration should whisper, not shout. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES - only minimal decorative elements. ").concat(a," ").concat(this.LAYOUT_REQUIREMENTS," Unique ID: ").concat(i):'Create the right interior page with this exact message as the absolute focal point: "'.concat(e,'". \n    \n').concat(this.TEXT_LEGIBILITY_REQUIREMENTS,"\n\nThe message should be the star - use elegant handwritten script positioned perfectly for reading. Add only minimal decoration (").concat(s.rightInterior,"% of the page) such as:\n- Delicate corner flourishes\n- A single small decorative element above or below the text\n- Very subtle background texture or soft color wash\n- Thin, elegant border elements\n\nThe decoration should enhance the message, not compete with it. Think of a premium wedding invitation - mostly white space with perfect typography. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES - only minimal decorative elements. ").concat(a," ").concat(this.LAYOUT_REQUIREMENTS," Unique ID: ").concat(i)}static generateBackCoverPromptFromFront(e,t,a){let r=this.getVisualDensity(a);return'Create a very minimal back cover for a greeting card. Extract ONLY the color palette and artistic style from this description BUT create a much simpler design: "'.concat(e,'". \n    \nUse only ').concat(r.back,"% visual density - perhaps a single small element, subtle corner detail, or soft color gradient. Most of the back should be clean, peaceful space. Think elegant minimalism. IMPORTANT: DO NOT include any people, characters, figures, text, words, or greeting messages. NO TEXT AT ALL - only minimal decorative elements. ").concat(t," ").concat(this.LAYOUT_REQUIREMENTS," ").concat(this.QR_CODE_SPACE)}static generateLeftInteriorPromptFromFront(e,t,a){let r=this.getVisualDensity(a);return"Create subtle left interior page art for a greeting card. Extract the color palette and artistic style from this description BUT create a much softer, more minimal design (".concat(r.leftInterior,'% visual density): "').concat(e,'". \n    \nUse muted, pastel versions of the colors. Focus on gentle elements like soft watercolor washes, delicate patterns, or subtle textures. This page should complement but not compete with the message on the facing page. IMPORTANT: NO PEOPLE, NO CHARACTERS, NO FIGURES, NO TEXT, NO WORDS, NO GREETING MESSAGES. Only decorative elements. ').concat(t," ").concat(this.LAYOUT_REQUIREMENTS)}static generateRightInteriorPromptFromFront(e,t,a,r,s){return a?'Create an elegant, minimal writing space for the right interior of a greeting card. Extract ONLY subtle style hints from: "'.concat(e,'". \n      \nKeep 80% of the page as clean white/cream space for handwriting. Add only whisper-light decoration - perhaps faint corner flourishes or a delicate border. The page should feel premium and understated. NO PEOPLE, NO CHARACTERS, NO FIGURES. ').concat(r," ").concat(this.LAYOUT_REQUIREMENTS):'Create a right interior page where this message is the absolute star: "'.concat(t,'". \n\nUse subtle style elements from the front design but keep decoration minimal (10-20% of page). Extract color hints from: "').concat(e,'".\n\n').concat(this.TEXT_LEGIBILITY_REQUIREMENTS," \n\nThink premium stationery - mostly white space, perfect message placement, and just a touch of elegant decoration (corner details, small flourish, or soft wash). The message should dominate the visual hierarchy. NO PEOPLE, NO CHARACTERS, NO FIGURES. ").concat(r," ").concat(this.LAYOUT_REQUIREMENTS)}static getToneSpecificInstructions(e){return({funny:"- Include appropriate humor that fits the occasion","genz-humor":'- Use GenZ humor with internet slang, memes, and chaotic energy - think "no cap", "periodt", "it\'s giving...", "slay", etc. Be unhinged but endearing',professional:"- Keep it formal and business-appropriate",romantic:"- Include loving and romantic language",playful:"- Use fun and energetic language"})[e]||""}static enhancePromptWithReferencePhotos(e,t,a){return t&&"gpt-image-1"===a?"".concat(e,"\n\n").concat(this.REFERENCE_PHOTO_INSTRUCTIONS):e}static formatPromptGenerationQuery(e,t,a){return"Create prompts for a greeting card.\n\n".concat(e,"\n\nRequirements:\n").concat(this.LAYOUT_REQUIREMENTS,"\n").concat(this.SAFETY_REQUIREMENTS,"\n").concat(t,"\n\nReturn JSON:\n").concat(a)}}e9.SAFETY_REQUIREMENTS="\n- SAFETY: Never include brand names, character names, trademarked terms, or inappropriate content\n- Keep content family-friendly and appropriate for all ages\n- If the theme references trademarked content, use generic alternatives or focus on the emotions/concepts instead".trim(),e9.LAYOUT_REQUIREMENTS='\n- Flat 2D artwork for printing\n- Full-bleed backgrounds extending to edges\n- Keep text, faces, and key elements at least 10% away from top/bottom edges\n- Keep text/faces 0.5" from left/right edges for safe printing'.trim(),e9.REFERENCE_PHOTO_INSTRUCTIONS="\n- Reference photos provided for character creation\n- Characters should only appear on the front cover\n- Transform real people into artistic cartoon/illustrated versions matching the style\n- Maintain recognizable features while adapting to the artistic style".trim(),e9.TEXT_LEGIBILITY_REQUIREMENTS="\n- EXACT TEXT REPRODUCTION: The message text must be reproduced EXACTLY as written - every word, punctuation mark, and character must be perfect\n- PUT TEXT IN QUOTES: Always enclose the message text in double quotes to make it clear this is literal text to be rendered exactly\n- CRYSTAL CLEAR LEGIBILITY: The handwriting must be extremely readable - prioritize clarity over artistic flourishes\n- NO SPELLING ERRORS: Every word must be spelled correctly exactly as provided\n- PROPER SPACING: Use appropriate letter spacing, word spacing, and line spacing for easy reading\n- CONTRAST: Ensure high contrast between text and background for maximum readability\n- SIZE: Make text large enough to read easily - avoid cramped or tiny text\n- COMPLETE MESSAGE: Include the ENTIRE message text - do not truncate, abbreviate, or omit any part\n- Use beautiful, clearly readable handwritten cursive script that feels elegant and personal\n- Position the message text in the optimal location for readability (center area, avoid top/bottom 10%)".trim(),e9.QR_CODE_SPACE="\n- IMPORTANT: Leave the bottom-right corner area (approximately 1 inch square) completely clear and undecorated for QR code placement".trim();let e7={selectedType:"birthday",customCardType:"",selectedTone:"funny",toField:"",fromField:"",prompt:"",finalCardMessage:"",isHandwrittenMessage:!1,selectedArtisticStyle:"watercolor",customStyleDescription:"",referenceImages:[],referenceImageUrls:[],imageTransformation:"",userEmail:"",selectedImageModel:"gpt-image-1",selectedDraftModel:"gpt-image-1",selectedPaperSize:"standard",numberOfCards:1,isFrontBackOnly:!1},te="vibecarding-wizard-form-data",tt=(e,t)=>{try{return localStorage.setItem(e,t),!0}catch(t){return console.warn("Failed to save ".concat(e," to localStorage:"),t),!1}},ta=e=>{try{return localStorage.getItem(e)}catch(t){return console.warn("Failed to retrieve ".concat(e," from localStorage:"),t),null}},tr=e=>{let{referenceImages:t,...a}=e;return a},ts=()=>{try{let e=ta(te);if(!e)return e7;let t=JSON.parse(e);return{...e7,...t,referenceImages:[]}}catch(e){return console.warn("Failed to restore form data from localStorage:",e),e7}},tn="vibecarding-wizard-state",ti=(e,t)=>{try{return localStorage.setItem(e,t),!0}catch(t){return console.warn("Failed to save ".concat(e," to localStorage:"),t),!1}},to=e=>{try{return localStorage.getItem(e)}catch(t){return console.warn("Failed to retrieve ".concat(e," from localStorage:"),t),null}},tl=()=>{try{let e=to(tn);if(!e)return{currentStep:1,completedSteps:[],timestamp:Date.now()};let t=JSON.parse(e);if(Date.now()-t.timestamp>864e5)return{currentStep:1,completedSteps:[],timestamp:Date.now()};return{currentStep:t.currentStep||1,completedSteps:Array.isArray(t.completedSteps)?t.completedSteps:[],timestamp:t.timestamp||Date.now()}}catch(e){return console.warn("Failed to restore wizard state from localStorage:",e),{currentStep:1,completedSteps:[],timestamp:Date.now()}}},tc=[{id:"basics",title:"Card Basics",mobileTitle:"Basics",description:"Choose your card type and tone"},{id:"content",title:"Content & Message",mobileTitle:"Content",description:"Describe your card and write your message"},{id:"personalization",title:"Personalization",mobileTitle:"Style",description:"Choose artistic style and add photos",isOptional:!0},{id:"details",title:"Email Address",mobileTitle:"Email",description:"Where to send your finished card"},{id:"drafts",title:"Draft Selection",mobileTitle:"Drafts",description:"Choose from 5 design variations"},{id:"generate",title:"Final Generation",mobileTitle:"Generate",description:"Creating your complete card"}];function td(){var e,t,a;let u=function(){let[e,t]=(0,s.useState)(e7),[a,r]=(0,s.useState)(!1);(0,s.useEffect)(()=>{a||(t(ts()),r(!0))},[a]),(0,s.useEffect)(()=>{if(!a)return;let t=setTimeout(()=>{tt(te,JSON.stringify(tr(e)))},500);return()=>clearTimeout(t)},[e,a]);let n=(0,s.useCallback)(e=>{t(t=>({...t,...e}))},[]),i=(0,s.useCallback)(()=>{t(e7);try{localStorage.removeItem(te)}catch(e){console.warn("Failed to clear form data from localStorage:",e)}},[]),o=(0,s.useCallback)(()=>{try{localStorage.removeItem(te),localStorage.removeItem("vibecarding-wizard-state")}catch(e){console.warn("Failed to clear stored data:",e)}},[]),l=(0,s.useCallback)(t=>{switch(t){case 1:if(!e.selectedType||"custom"===e.selectedType&&!e.customCardType.trim()||!e.selectedTone)return!1;return!0;case 2:return!0;case 3:if("custom"===e.selectedArtisticStyle&&!e.customStyleDescription.trim()||e.referenceImageUrls.length>0&&"gpt-image-1"!==e.selectedImageModel)return!1;return!0;case 4:if(!e.userEmail.trim()||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.userEmail))return!1;return!0;case 5:return l(1)&&l(2)&&l(3)&&l(4);default:return!1}},[e]),c=(0,s.useCallback)(t=>{let a=[];switch(t){case 1:let r="custom"===e.selectedType?e.customCardType:e.selectedType;a.push("Card Type: ".concat(r||"Not selected")),a.push("Tone: ".concat(e.selectedTone||"Not selected")),e.toField&&a.push("To: ".concat(e.toField)),e.fromField&&a.push("From: ".concat(e.fromField));break;case 2:e.prompt&&a.push("Description: ".concat(e.prompt.substring(0,50),"...")),e.finalCardMessage&&a.push("Message: ".concat(e.finalCardMessage.substring(0,50),"...")),e.isHandwrittenMessage&&a.push("Handwritten message space included");break;case 3:a.push("Style: ".concat(e.selectedArtisticStyle)),e.referenceImageUrls.length>0&&a.push("Reference photos: ".concat(e.referenceImageUrls.length," uploaded"));break;case 4:a.push("Email: ".concat(e.userEmail)),a.push("Model: ".concat(e.selectedImageModel)),a.push("Paper: ".concat(e.selectedPaperSize)),e.isFrontBackOnly&&a.push("Front/back only")}return a},[e]),d=(0,s.useCallback)(t=>{let a=[];switch(t){case 1:e.selectedType||a.push("Please select a card type"),"custom"!==e.selectedType||e.customCardType.trim()||a.push("Please describe your custom card type"),e.selectedTone||a.push("Please select a tone");break;case 3:"custom"!==e.selectedArtisticStyle||e.customStyleDescription.trim()||a.push("Please describe your custom artistic style"),e.referenceImageUrls.length>0&&"gpt-image-1"!==e.selectedImageModel&&a.push("Reference photos are only supported with GPT Image 1 model");break;case 4:e.userEmail.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.userEmail)||a.push("Please enter a valid email address"):a.push("Email address is required")}return a},[e]);return{formData:e,updateFormData:n,resetForm:i,clearStoredData:o,validateStep:l,getStepSummary:c,getValidationErrors:d,isInitialLoadComplete:a}}(),p=function(){let[e,t]=(0,s.useState)({currentStep:1,completedSteps:[],timestamp:Date.now()}),[a,r]=(0,s.useState)(!1);(0,s.useEffect)(()=>{a||(t(tl()),r(!0))},[a]),(0,s.useEffect)(()=>{if(!a)return;let t=setTimeout(()=>{ti(tn,JSON.stringify({...e,timestamp:Date.now()}))},300);return()=>clearTimeout(t)},[e,a]);let n=(0,s.useCallback)(e=>{t(t=>({...t,currentStep:e}))},[]),i=(0,s.useCallback)(e=>{t(t=>({...t,completedSteps:e}))},[]),o=(0,s.useCallback)(e=>{t(t=>({...t,completedSteps:t.completedSteps.includes(e)?t.completedSteps:[...t.completedSteps,e].sort((e,t)=>e-t)}))},[]),l=(0,s.useCallback)(e=>{t(t=>({...t,completedSteps:t.completedSteps.filter(t=>t!==e)}))},[]),c=(0,s.useCallback)(()=>{t({currentStep:1,completedSteps:[],timestamp:Date.now()});try{localStorage.removeItem(tn)}catch(e){console.warn("Failed to clear wizard state from localStorage:",e)}},[]),d=(0,s.useCallback)(()=>{try{localStorage.removeItem(tn)}catch(e){console.warn("Failed to clear stored wizard state:",e)}},[]),m=(0,s.useCallback)(()=>{t(e=>({...e,currentStep:e.currentStep+1}))},[]),u=(0,s.useCallback)(()=>{t(e=>({...e,currentStep:Math.max(1,e.currentStep-1)}))},[]),g=(0,s.useCallback)(e=>{t(t=>({...t,currentStep:e}))},[]);return{currentStep:e.currentStep,completedSteps:e.completedSteps,setCurrentStep:n,setCompletedSteps:i,markStepCompleted:o,markStepIncomplete:l,resetWizardState:c,clearStoredWizardState:d,goToNextStep:m,goToPreviousStep:u,goToStep:g,isInitialLoadComplete:a}}(),h=I(),x=function(){let[e,t]=(0,s.useState)(""),[a,r]=(0,s.useState)(""),[n,i]=(0,s.useState)(""),[o,l]=(0,s.useState)("birthday"),[c,d]=(0,s.useState)(""),[u,g]=(0,s.useState)("funny"),[p,h]=(0,s.useState)(!1),[f,x]=(0,s.useState)("watercolor"),[y,b]=(0,s.useState)(""),[v,j]=(0,s.useState)("gpt-image-1"),[w,N]=(0,s.useState)("gpt-image-1"),[C,k]=(0,s.useState)(!0),[D,S]=(0,s.useState)(""),[T,I]=(0,s.useState)(1),[E,P]=(0,s.useState)(!1),[A,F]=(0,s.useState)(!1),[R,M]=(0,s.useState)("standard"),[O,z]=(0,s.useState)(!1),[U,G]=(0,s.useState)(!1),[Z,_]=(0,s.useState)(!1),[L,J]=(0,s.useState)(!1),[H,Y]=(0,s.useState)(!1),[B,W]=(0,s.useState)(!1),[q,V]=(0,s.useState)(null),[Q,K]=(0,s.useState)(!1),[$,X]=(0,s.useState)(""),[ee,et]=(0,s.useState)(!1),[ea,er]=(0,s.useState)([]),[es,en]=(0,s.useState)("text"),[ei,eo]=(0,s.useState)([]),[el,ec]=(0,s.useState)(!1),[ed,em]=(0,s.useState)("physical"),[eu,eg]=(0,s.useState)({promptChanges:"",messageChanges:"",useReferenceImage:!1,referenceImageFile:null,referenceImageUrls:[],referenceImageTransformation:""}),[ep,eh]=(0,s.useState)({frontCover:"idle",backCover:"idle",leftInterior:"idle",rightInterior:"idle"}),[ef,ex]=(0,s.useState)(0),[ey,eb]=(0,s.useState)(null),ev=function(){let e=(0,s.useRef)(null),[t,a]=(0,s.useState)(!1),r=(0,s.useRef)(null),n=(0,s.useRef)(Date.now()),i=(0,s.useRef)(null),o=(0,s.useRef)(0),l=(0,s.useRef)(!1),c=(0,s.useCallback)(()=>{var t;if(null===(t=e.current)||void 0===t?void 0:t.connected){console.log("✅ WebSocket already connected");return}if(i.current&&Date.now()-i.current>3e5){console.log("⏰ Connection attempt is stale (>5 minutes), stopping reconnection"),o.current=0,i.current=null,l.current||(m.Am.error("Connection timed out. Please refresh the page if needed."),l.current=!0);return}i.current||(i.current=Date.now()),o.current++;try{console.log("\uD83D\uDD0C Connecting to WebSocket...");let t=(0,e4.ZP)(e8.Ye,{transports:["websocket","polling"],timeout:12e4,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:20,reconnectionDelayMax:5e3,forceNew:!0});t.on("connect",()=>{console.log("✅ WebSocket connected:",t.id),a(!0),m.Am.success("\uD83D\uDD17 Real-time updates connected"),i.current=null,o.current=0,l.current=!1,r.current&&(console.log("\uD83D\uDD04 Resubscribing to job:",r.current),t.emit("subscribe_job",{job_id:r.current}))}),t.on("disconnect",e=>{console.log("❌ WebSocket disconnected:",e),a(!1),"io server disconnect"===e&&t.connect()}),t.on("connect_error",e=>{console.error("❌ WebSocket connection error:",e),a(!1),i.current&&Date.now()-i.current>3e5&&(console.log("⏰ Stopping reconnection attempts after 5 minutes"),t.disconnect(),i.current=null,o.current=0)}),e.current=t}catch(e){console.error("❌ Failed to connect WebSocket:",e),m.Am.error("Failed to connect real-time updates. Using fallback mode.")}},[]),d=(0,s.useCallback)(()=>{e.current&&(console.log("\uD83D\uDD0C Disconnecting WebSocket..."),e.current.disconnect(),e.current=null,a(!1),i.current=null,o.current=0)},[]),u=(0,s.useCallback)(t=>{var a;r.current=t,(null===(a=e.current)||void 0===a?void 0:a.connected)?(console.log("\uD83D\uDCE1 Subscribing to job updates:",t),e.current.emit("subscribe_job",{job_id:t})):console.log("⏳ WebSocket not connected, will subscribe when connected")},[]),g=(0,s.useCallback)(t=>{var a;r.current===t&&(r.current=null),(null===(a=e.current)||void 0===a?void 0:a.connected)&&(console.log("\uD83D\uDCE1 Unsubscribing from job updates:",t),e.current.emit("unsubscribe_job",{job_id:t}))},[]),p=(0,s.useCallback)(t=>{e.current&&(e.current.off("job_update"),e.current.on("job_update",e=>{console.log("\uD83D\uDCE6 Job update received:",e),n.current=Date.now(),i.current||(i.current=Date.now()),t(e)}))},[]);return(0,s.useEffect)(()=>(c(),()=>{d()}),[c,d]),{isSocketConnected:t,connectWebSocket:c,disconnectWebSocket:d,subscribeToJob:u,unsubscribeFromJob:g,setJobUpdateHandler:p,currentJobRef:r,lastJobUpdateRef:n}}(),ej=function(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(""),[n,i]=(0,s.useState)(0),[o,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(0),[m,u]=(0,s.useState)(null),[g,p]=(0,s.useState)(null),h=(0,s.useCallback)((e,t)=>{let a=e||Date.now();l(a),localStorage.setItem("generation-start-time",a.toString()),m&&clearInterval(m),u(setInterval(()=>{let e=(Date.now()-a)/1e3;d(e);let r=Math.min(e/(t||150)*100,90);i(e=>e>0&&e<r?Math.max(e,r):0===e?r:e)},1e3))},[m]),f=(0,s.useCallback)(()=>{m&&(clearInterval(m),u(null)),localStorage.removeItem("generation-start-time")},[m]);return{currentJobId:e,setCurrentJobId:t,generationProgress:a,setGenerationProgress:r,progressPercentage:n,setProgressPercentage:i,generationStartTime:o,setGenerationStartTime:l,currentElapsedTime:c,setCurrentElapsedTime:d,elapsedTimeInterval:m,setElapsedTimeInterval:u,generationDuration:g,setGenerationDuration:p,saveJobToStorage:(e,t)=>{try{localStorage.setItem("cardJob_".concat(e),JSON.stringify({...t,id:e,status:"processing",createdAt:Date.now()}));let a=JSON.parse(localStorage.getItem("pendingCardJobs")||"[]");a.includes(e)||(a.push(e),localStorage.setItem("pendingCardJobs",JSON.stringify(a)))}catch(e){console.error("Failed to save job to localStorage:",e)}},removeJobFromStorage:e=>{try{localStorage.removeItem("cardJob_".concat(e));let t=JSON.parse(localStorage.getItem("pendingCardJobs")||"[]").filter(t=>t!==e);localStorage.setItem("pendingCardJobs",JSON.stringify(t))}catch(e){console.error("Failed to remove job from localStorage:",e)}},startElapsedTimeTracking:h,stopElapsedTimeTracking:f,checkPendingJobs:async()=>{try{let e=JSON.parse(localStorage.getItem("pendingCardJobs")||"[]"),t=[];for(let a of e){let e=localStorage.getItem("cardJob_".concat(a));if(!e)continue;let r=JSON.parse(e);t.push({jobId:a,job:r})}return t}catch(e){return console.error("Failed to check pending jobs:",e),[]}}}}(),eN=function(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),[n,i]=(0,s.useState)([]),[o,l]=(0,s.useState)([]),[c,d]=(0,s.useState)(""),[u,g]=(0,s.useState)(!1),[p,h]=(0,s.useState)([]),[f,x]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),w=(0,s.useCallback)(async(e,a)=>{if(!e.type.startsWith("image/")){m.Am.error("Please upload an image file");return}g(!0);try{let s=new FormData;s.append("file",e);let o=await fetch("".concat(e8.Ye,"/upload"),{method:"POST",body:s});if(!o.ok)throw Error("Upload failed: ".concat(o.status));let c=await o.json();if("handwriting"===a)t(e),r(c.url),m.Am.success("Handwriting sample uploaded!");else{let t=n.length;i(t=>[...t,e]),l(e=>[...e,c.url]),console.log("\uD83D\uDD0D DEBUG: Reference image uploaded successfully:",{fileName:e.name,url:c.url,newImageIndex:t,totalImages:n.length+1}),m.Am.success("Reference image uploaded! ".concat(n.length+1," photo").concat(n.length+1>1?"s":""," ready for character creation.")),setTimeout(()=>{console.log("\uD83D\uDD0D Opening analysis modal for index:",t),j(t),b(!0)},100)}}catch(e){m.Am.error("Upload failed. Please try again.")}finally{g(!1)}},[n.length]),N=(0,s.useCallback)(e=>{let t=n[e],a=o[e];i(t=>t.filter((t,a)=>a!==e)),l(t=>t.filter((t,a)=>a!==e)),h(t=>t.filter((t,a)=>a!==e)),console.log("\uD83D\uDD0D DEBUG: Reference image removed:",{fileName:null==t?void 0:t.name,url:a,remainingImages:n.length-1}),m.Am.success("Reference image removed! ".concat(n.length-1," photo").concat(n.length-1!=1?"s":""," remaining."))},[n,o]),C=(0,s.useCallback)(async(e,t)=>{console.log("\uD83D\uDCF8 Starting photo analysis for:",e),x(!0);try{let t,a=e;e.startsWith("/")&&(a="".concat(window.location.origin).concat(e)),console.log("\uD83D\uDCF8 Using full image URL:",a);let r=await fetch("/internal/call_mcp_tool",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"analyze_images",arguments:{urls:[a],analysis_prompt:'Analyze this photo and provide a detailed JSON response with the following structure:\n{\n  "peopleCount": <number of people in photo>,\n  "people": [\n    {\n      "id": "person-1",\n      "position": <one of: "far-left", "left", "center-left", "center", "center-right", "right", "far-right">,\n      "positionDescription": <natural description like "person on the far left wearing blue">,\n      "description": <overall appearance description>,\n      "apparentAge": <age range like "20-25" or "40s">,\n      "gender": <apparent gender if identifiable>,\n      "hairColor": <hair color>,\n      "hairStyle": <hair style/length>,\n      "distinguishingFeatures": <notable features like glasses, beard, etc.>,\n      "clothing": <what they\'re wearing>,\n      "expression": <facial expression/mood>\n    }\n  ],\n  "hasPets": <boolean>,\n  "petDescription": <description of pets if present>,\n  "backgroundDescription": <description of the background/environment>,\n  "setting": <type of setting like "outdoor park", "beach", "indoor", etc.>,\n  "overallMood": <overall mood/atmosphere of the photo>,\n  "lighting": <lighting conditions>\n}\n\nFor each person:\n1. Describe their position in the image using the enum values\n2. Provide a brief description of their appearance  \n3. Estimate their apparent age range\n4. Note their hair color and style\n5. Describe their clothing\n6. Note any distinguishing features\n7. Describe their expression/mood\n\nReturn ONLY the JSON response, no additional text.'}})});if(!r.ok){let e=await r.text();throw console.error("analyze_images error response:",e),Error("HTTP ".concat(r.status,": ").concat(e))}let s=await r.json();if(console.log("\uD83E\uDD16 analyze_images response data:",s),s.error&&"None"!==s.error&&null!==s.error)throw Error(s.error);if("string"==typeof s.result)try{t=JSON.parse(s.result)}catch(e){t={status:"error",message:"Invalid JSON response from MCP"}}else t=s.result;if("error"===t.status)throw Error(t.message);if(!t.results||!(t.results.length>0))return console.error("No results returned from analyze_images"),x(!1),null;{let e=t.results[0];if("success"!==e.status||!e.analysis)return console.error("Image analysis failed:",e.message),x(!1),null;console.log("\uD83D\uDCF8 Raw analysis text:",e.analysis);try{let t=e.analysis,a=t.match(/```json\s*([\s\S]*?)\s*```/);a&&(t=a[1]);let r=JSON.parse(t);if(console.log("\uD83D\uDCF8 Parsed analysis data:",r),"number"==typeof r.peopleCount&&Array.isArray(r.people))return x(!1),r;return console.error("Analysis data doesn't match expected structure"),x(!1),null}catch(t){return console.error("Failed to parse analysis as JSON:",t),console.error("Raw analysis:",e.analysis),x(!1),null}}}catch(e){return console.error("Failed to analyze photo:",e),m.Am.error("Failed to analyze photo. You can still use it without analysis."),x(!1),null}},[]),k=(0,s.useCallback)(e=>{h(t=>{let a=[...t];return a[e.imageIndex]=e,a}),b(!1),j(null)},[]),D=(0,s.useCallback)(()=>{null!==v&&k({imageUrl:o[v],imageIndex:v,analysisResult:{peopleCount:0,people:[],hasPets:!1,backgroundDescription:"",setting:"",overallMood:"",lighting:""},selectedPeople:[],includeEveryone:!0,excludedCount:0,analyzed:!1,analysisFailed:!1}),b(!1),j(null)},[v,o,k]),S=(0,s.useCallback)(()=>{let e=p.filter(e=>e.analyzed&&!e.analysisFailed);if(0===e.length)return null;let t=e.flatMap(e=>e.selectedPeople),a=e.reduce((e,t)=>e+t.analysisResult.peopleCount,0),r=t.length;return{analyzedPhotos:e,allSelectedPeople:t,totalPeopleCount:a,totalSelectedCount:r,totalExcludedCount:a-r,hasMultiplePhotos:e.length>1}},[p]);return{handwritingSample:e,setHandwritingSample:t,handwritingSampleUrl:a,setHandwritingSampleUrl:r,referenceImages:n,setReferenceImages:i,referenceImageUrls:o,setReferenceImageUrls:l,imageTransformation:c,setImageTransformation:d,isUploading:u,setIsUploading:g,handleFileUpload:w,handleRemoveReferenceImage:N,photoAnalyses:p,setPhotoAnalyses:h,isAnalyzing:f,showAnalysisModal:y,setShowAnalysisModal:b,pendingAnalysisIndex:v,setPendingAnalysisIndex:j,analyzePhoto:C,savePhotoAnalysis:k,skipPhotoAnalysis:D,getCombinedPhotoAnalysis:S}}(),eC=function(e,t,a,r,n,i,o){let[l,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1),[g,p]=(0,s.useState)([]),[h,f]=(0,s.useState)(-1),[x,y]=(0,s.useState)(""),[b,v]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),N=e=>{if(""===e.trim())return;let t=e.replace(/<\/?MESSAGE>/g,"").trim();if(""===t)return;let a=g.slice(0,h+1);a.push(t),a.length>10?a.shift():f(h+1),p(a),f(a.length-1)},C=(0,s.useCallback)(async()=>{if("custom"===e&&!t.trim()){m.Am.error("Please describe your custom card type first!");return}u(!0);try{let s="custom"===e?t:e,d=e8.zh.find(e=>e.id===a),u=d?d.description.toLowerCase():"heartfelt and sincere",g=r.trim()||"A beautiful ".concat(s," card with ").concat(u," style"),p={cardType:e,customCardType:t,tone:a,toneLabel:d?d.label:"Heartfelt",toneDescription:u,theme:g,toField:n,fromField:i,photoAnalyses:o},h=e9.generateMessagePrompt(p),f=await (0,ew.chatWithAI)(h,{model:"gemini-2.5-pro",includeThoughts:!1});if(null==f?void 0:f.trim()){let e=f.match(/<MESSAGE>([\s\S]*?)<\/MESSAGE>/),t=e?e[1].trim():f.trim();return t=t.replace(/<\/?MESSAGE>/g,"").trim(),l.trim()&&l.trim()!==t&&N(l),c(t),N(t),m.Am.success("✨ Personalized message created!"),t}}catch(e){return m.Am.error("Failed to generate message. Please try again."),null}finally{u(!1)}},[e,t,a,r,n,i,l,o]);return{finalCardMessage:l,setFinalCardMessage:c,isGeneratingMessage:d,setIsGeneratingMessage:u,messageHistory:g,setMessageHistory:p,currentMessageIndex:h,setCurrentMessageIndex:f,refinementPrompt:x,setRefinementPrompt:y,isRefiningMessage:b,setIsRefiningMessage:v,showRefinementBox:j,setShowRefinementBox:w,handleGetMessageHelp:C,addMessageToHistory:N,undoMessage:()=>{if(h>0){let e=h-1;f(e),c(g[e])}},redoMessage:()=>{if(h<g.length-1){let e=h+1;f(e),c(g[e])}}}}(o,c,u,e,a,n,eN.photoAnalyses),ek=function(e){let[t,a]=(0,s.useState)(!1),[r,n]=(0,s.useState)([]),[i,o]=(0,s.useState)([]),[l,c]=(0,s.useState)(-1),[d,u]=(0,s.useState)(!1),[g,p]=(0,s.useState)(-1),[h,f]=(0,s.useState)(!1),[x,y]=(0,s.useState)(0),[b,v]=(0,s.useState)(!1),[j,w]=(0,s.useState)(""),[N,C]=(0,s.useState)(0),[k,D]=(0,s.useState)(null),[S,T]=(0,s.useState)([]),[I,E]=(0,s.useState)(!1),[P,A]=(0,s.useState)(null),F=(0,s.useCallback)(async()=>{let{userEmail:t,selectedArtisticStyle:r,customStyleDescription:s,referenceImageUrls:i,selectedDraftModel:l,selectedType:d,customCardType:u,selectedTone:g,prompt:p,toField:h,fromField:x,selectedPaperSize:b,saveJobToStorage:j,subscribeToJob:N,startElapsedTimeTracking:k}=e;if(!t.trim()){m.Am.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){m.Am.error("Please enter a valid email address");return}if("custom"===r&&!s.trim()){m.Am.error("Please describe your custom artistic style");return}if(i.length>0&&"gpt-image-1"!==l){m.Am.error("Reference photos are only supported with GPT Image 1 model. Please switch to GPT Image 1 for draft mode or remove reference photos.");return}e.stopElapsedTimeTracking(),a(!0),v(!0),k(void 0,45),w("\uD83C\uDFA8 Creating 5 front cover variations for you to choose from..."),C(0),n([]),o([]),c(-1),f(!1),y(0),D(null),T([]),E(!1);try{console.log("\uD83D\uDE80 Starting draft mode generation with 5 variations");let a="custom"===d?u:d,s=e8.zh.find(e=>e.id===g),n=s?s.description.toLowerCase():"heartfelt and sincere",o=p.trim()||"A beautiful ".concat(a," card with ").concat(n," style"),c=Array.from({length:5},async(c,p)=>{try{var f,y;let c;console.log("\uD83C\uDFA8 Starting draft variation ".concat(p+1)),"ai-smart-style"===r&&(c=["watercolor","botanical","comic-book","dreamy-fantasy","minimalist"][p]);let m=e8.jK.find(e=>e.id===(c||r)),v={cardType:d,customCardType:u,tone:g,toneLabel:s?s.label:"Heartfelt",toneDescription:n,theme:o,toField:h,fromField:x,artisticStyle:m,referenceImageUrls:i,photoAnalyses:e.photoAnalyses,isDraftVariation:"smart"===r,variationIndex:p},j=e9.generateDraftPrompt(v),w=await (0,ew.chatWithAI)(j,{model:"gemini-2.5-pro",attachments:i});if(!(null==w?void 0:w.trim()))throw Error("Failed to generate front cover prompt");let C=w.trim();C=e9.enhancePromptWithReferencePhotos(C,i.length>0,l);let k="draft-".concat(p,"-").concat((0,e5.Z)()),D=[];i.length>0&&"gpt-image-1"===l&&D.push(...i);let S=await fetch("/api/generate-card-async",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:k,prompts:{frontCover:C},config:{userNumber:"+17145986105",modelVersion:l,aspectRatio:(null===(f=e8._$.find(e=>e.id===b))||void 0===f?void 0:f.aspectRatio)||"9:16",quality:"low",outputFormat:"jpeg",outputCompression:100,moderation:"low",dimensions:(null===(y=e8._$.find(e=>e.id===b))||void 0===y?void 0:y.dimensions)||"1024x1536",isFrontBackOnly:!0,userEmail:t,cardType:a,toField:h,fromField:x,isDraftMode:!0,...D.length>0&&{input_images:D,input_images_mode:"front_cover_only"}}})});if(!S.ok)throw Error("Server error: ".concat(S.status));let T=await S.json();if("processing"!==T.status)throw Error(T.message||"Failed to start draft generation");console.log("✅ Draft variation ".concat(p+1," job started:"),k),N(k)}catch(e){console.error("❌ Draft variation ".concat(p+1," failed:"),e),m.Am.error("Draft variation ".concat(p+1," failed: ").concat(e instanceof Error?e.message:"Unknown error"))}});await Promise.allSettled(c),console.log("\uD83D\uDE80 All draft variations started")}catch(t){console.error("Draft card generation error:",t),m.Am.error("Failed to start draft generation: ".concat(t instanceof Error?t.message:"Unknown error")),v(!1),a(!1),f(!1),y(0),w(""),e.stopElapsedTimeTracking()}},[e]),R=(0,s.useCallback)(async t=>{if(d){console.log("⚠️ Final card generation already in progress, skipping duplicate call");return}if(t<0||t>=r.length||!r[t]){m.Am.error("Invalid draft selection");return}let{selectedType:a,customCardType:s,selectedTone:n,prompt:o,toField:l,fromField:g,finalCardMessage:p,isHandwrittenMessage:h,selectedArtisticStyle:f,customStyleDescription:x,isFrontBackOnly:y,selectedImageModel:b,selectedPaperSize:v,userEmail:j,referenceImageUrls:N,startElapsedTimeTracking:C,subscribeToJob:k}=e;if(void 0===i[t]){m.Am.error("Could not find original draft data");return}e.stopElapsedTimeTracking(),u(!0),c(t),C(void 0,120),w("\uD83C\uDFA8 Creating high-quality version of your selected design...");try{var D,S,T;let e;let i=r[t],c=(0,e5.Z)(),d=null===(D=i.generatedPrompts)||void 0===D?void 0:D.frontCover;if(!d)throw Error("Selected draft is missing frontCover prompt");let u=e8.zh.find(e=>e.id===n),x=u?u.description.toLowerCase():"heartfelt and sincere",w=o.trim()||"A beautiful ".concat("custom"===a?s:a," card with ").concat(x," style"),C=p;h&&(C="[Blank space for handwritten message]");let I=i.styleInfo;e=I&&I.styleName?e8.jK.find(e=>e.id===I.styleName):e8.jK.find(e=>e.id===f);let E={frontCoverPrompt:d,cardType:a,customCardType:s,theme:w,tone:n,toneDescription:x,toField:l,fromField:g,message:C,isHandwrittenMessage:h,artisticStyle:e,isFrontBackOnly:y},P=await e9.generateFinalFromDraftPromptsCombined(E);if(!P||!P.frontCover||!P.backCover)throw Error("Failed to generate complete prompts for final card");let F=[];N.length>0&&"gpt-image-1"===b&&F.push(...N);let R=await fetch("/api/generate-card-async",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:c,prompts:P,config:{userNumber:"+17145986105",modelVersion:b,aspectRatio:(null===(S=e8._$.find(e=>e.id===v))||void 0===S?void 0:S.aspectRatio)||"9:16",quality:"high",outputFormat:"jpeg",outputCompression:100,moderation:"low",dimensions:(null===(T=e8._$.find(e=>e.id===v))||void 0===T?void 0:T.dimensions)||"1024x1536",isFrontBackOnly:y,userEmail:j,cardType:"custom"===a?s:a,toField:l,fromField:g,isDraftMode:!1,...F.length>0&&{input_images:F,input_images_mode:"front_cover_only"}}})});if(!R.ok)throw Error("Server error: ".concat(R.status));let M=await R.json();if("processing"!==M.status)throw Error(M.message||"Failed to start final card generation");A(c),m.Am.success("\uD83C\uDFA8 Generating high-quality version of your selected design!"),k(c)}catch(t){console.error("Final card generation error:",t),m.Am.error("Failed to generate final card. Please try again."),u(!1),w(""),e.stopElapsedTimeTracking()}},[r,i,d,e]);return{isDraftMode:t,setIsDraftMode:a,draftCards:r,setDraftCards:n,draftIndexMapping:i,setDraftIndexMapping:o,selectedDraftIndex:l,setSelectedDraftIndex:c,isGeneratingFinalCard:d,setIsGeneratingFinalCard:u,previewingDraftIndex:g,setPreviewingDraftIndex:p,draftCompletionShown:h,setDraftCompletionShown:f,draftCompletionCount:x,setDraftCompletionCount:y,handleGenerateDraftCards:F,handleGenerateFinalFromDraft:R,isGenerating:b,setIsGenerating:v,generationProgress:j,setGenerationProgress:w,progressPercentage:N,setProgressPercentage:C,generatedCard:k,setGeneratedCard:D,generatedCards:S,setGeneratedCards:T,isCardCompleted:I,setIsCardCompleted:E,currentJobId:P,setCurrentJobId:A}}({selectedType:o,customCardType:c,selectedTone:u,selectedArtisticStyle:f,customStyleDescription:y,selectedDraftModel:w,selectedImageModel:v,selectedPaperSize:R,prompt:e,toField:a,fromField:n,userEmail:D,finalCardMessage:eC.finalCardMessage,isHandwrittenMessage:E,isFrontBackOnly:A,referenceImageUrls:eN.referenceImageUrls,photoAnalyses:eN.photoAnalyses,saveJobToStorage:ej.saveJobToStorage,subscribeToJob:ev.subscribeToJob,startElapsedTimeTracking:ej.startElapsedTimeTracking,stopElapsedTimeTracking:ej.stopElapsedTimeTracking}),eD=function(e){let[t,a]=(0,s.useState)(!1),[r,n]=(0,s.useState)(null),[i,o]=(0,s.useState)([]),[l,c]=(0,s.useState)(0),[d,u]=(0,s.useState)(!1),[g,p]=(0,s.useState)(""),[h,f]=(0,s.useState)(0),[x,y]=(0,s.useState)(null),[b,v]=(0,s.useState)(null),j=(0,s.useCallback)(async t=>{console.log("\uD83C\uDFAF handleFinalCardCompletion called with cardData:",t),console.log("\uD83C\uDFAF Current userEmail state:",e.userEmail);let r={...t};r.createdAt?("string"==typeof r.createdAt||"number"==typeof r.createdAt)&&(r.createdAt=new Date(r.createdAt)):r.createdAt=new Date,r.id||(r.id="card-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))),console.log("\uD83D\uDD04 Final card data prepared:",r),console.log("✅ Card completion processing finished - QR codes handled by backend"),console.log("\uD83C\uDFAF Setting final card state:",r),n(r),o([r]),c(0),u(!0),a(!1),e.setIsGeneratingFinalCard(!1),e.setIsDraftMode(!1),e.setDraftCompletionShown(!1),e.setDraftCompletionCount(0),p(""),(0,ew.C)(),t.generationTimeSeconds&&v(t.generationTimeSeconds),e.stopElapsedTimeTracking(),f(100),p("Card generation complete!"),m.Am.success("\uD83C\uDF89 Your card is ready!"),e.userEmail.trim()&&m.Am.success("✉️ Card sent to ".concat(e.userEmail),{duration:5e3}),console.log("\uD83D\uDCE7 Email sending disabled - backend handles email notifications"),console.log("✅ Final card completion process finished successfully")},[e]),w=(0,s.useCallback)(async()=>{let{userEmail:t,selectedType:r,customCardType:s,selectedTone:i,selectedArtisticStyle:l,customStyleDescription:d,selectedImageModel:g,referenceImageUrls:h,prompt:b,toField:v,fromField:j,finalCardMessage:w,isHandwrittenMessage:N,isFrontBackOnly:C,selectedPaperSize:k,numberOfCards:D,saveJobToStorage:S,subscribeToJob:T,startElapsedTimeTracking:I,setCurrentJobId:E,setIsDraftMode:P,setDraftCards:A,setDraftIndexMapping:F,setSelectedDraftIndex:R,setIsGeneratingFinalCard:M,setPreviewingDraftIndex:O,setDraftCompletionShown:z,setDraftCompletionCount:U}=e;if(!t.trim()){m.Am.error("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){m.Am.error("Please enter a valid email address");return}if("custom"===l&&!d.trim()){m.Am.error("Please describe your custom artistic style");return}if(h.length>0&&"gpt-image-1"!==g){m.Am.error("Reference photos are only supported with GPT Image 1 model. Please switch to GPT Image 1 in Advanced Options or remove reference photos.");return}P(!1),A([]),F([]),R(-1),M(!1),O(-1),z(!1),U(0),o([]),n(null),c(0),y(null),u(!1),e.stopElapsedTimeTracking(),a(!0),I(void 0,120),p("Creating your personalized card..."),f(0);try{let a=(0,e5.Z)();E(a);let n="custom"===r?s:r,o=e8.zh.find(e=>e.id===i),c=w;if(N)c="[Blank space for handwritten message]";else if(!c.trim()&&!C){p("✍️ Writing the perfect message...");let e="Create a heartfelt message for a ".concat(n,' greeting card.\n\nCard Theme/Description: "').concat(b||"A beautiful ".concat(n," card"),'"\n').concat(v?"Recipient: ".concat(v):"Recipient: [not specified]","\n").concat(j?"Sender: ".concat(j):"Sender: [not specified]","\n\nInstructions:\n- Write a message that feels personal and genuine\n- Keep it concise but meaningful (2-4 sentences ideal)\n- Make it feel authentic, not generic\n- Keep content family-friendly and appropriate for all ages\n- ").concat(j?'End the message with a signature line like "Love, '.concat(j,'" or "- ').concat(j,'" or similar, naturally integrated into the message.'):"","\n\nReturn ONLY the message text that should appear inside the card.\n\nIMPORTANT: Wrap your final message in <MESSAGE> </MESSAGE> tags."),t=await (0,ew.chatWithAI)(e,{model:"gemini-2.5-pro",includeThoughts:!1});if(null==t?void 0:t.trim()){let e=t.match(/<MESSAGE>([\s\S]*?)<\/MESSAGE>/);e&&e[1]&&(c=e[1].trim())}}let u=e8.jK.find(e=>e.id===l);"custom"===l||null==u||u.promptModifier;let f=e8._$.find(e=>e.id===k)||e8._$[0];p("\uD83C\uDFA8 Creating artistic vision for your card...");let x={cardType:r,customCardType:s,tone:i,toneDescription:(null==o?void 0:o.description.toLowerCase())||"heartfelt and sincere",theme:b||"A beautiful ".concat(n," card"),toField:v,fromField:j,message:c,isHandwrittenMessage:N,artisticStyle:u,referenceImageUrls:h,photoAnalyses:e.photoAnalyses,isFrontBackOnly:C,selectedImageModel:g},y=e9.generateCardPrompts(x);h.length>0&&"gpt-1"===g&&(y.frontCover=e9.enhancePromptWithReferencePhotos(y.frontCover,!0,g));let I={frontCover:y.frontCover,backCover:y.backCover,...C?{}:{leftInterior:y.leftInterior,rightInterior:y.rightInterior}};if(!I||!I.frontCover)throw Error("Failed to generate image prompts");let P={prompt:b||"A beautiful ".concat(n," card"),selectedType:r,customCardType:s,selectedTone:i,finalCardMessage:c,toField:v,fromField:j,userEmail:t,selectedArtisticStyle:l,customStyleDescription:d,selectedImageModel:g,isFrontBackOnly:C,numberOfCards:D,selectedPaperSize:k,prompts:I,paperConfig:f};S(a,P),p("\uD83D\uDE80 Starting background generation...");let A=[];h.length>0&&"gpt-image-1"===g&&A.push(...h);let F=await fetch("/api/generate-card-async",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:a,prompts:I,config:{userNumber:"+17145986105",modelVersion:g,aspectRatio:f.aspectRatio,quality:"high",outputFormat:"jpeg",outputCompression:100,moderation:"low",dimensions:f.dimensions,isFrontBackOnly:C,userEmail:t,cardType:n,toField:v,fromField:j,isDraftMode:!1,...A.length>0&&{input_images:A,input_images_mode:"front_cover_only"}}})});if(!F.ok)throw Error("Server error: ".concat(F.status));let R=await F.json();if("processing"!==R.status)throw Error(R.message||"Failed to start card generation");p("✨ Bringing your vision to life..."),m.Am.success("\uD83C\uDF89 Card generation started!"),T(a)}catch(t){console.error("Card generation error:",t),m.Am.error("Failed to generate card. Please try again."),x&&(e.removeJobFromStorage(x),y(null)),a(!1),p(""),e.stopElapsedTimeTracking()}},[e,x]);return{isGenerating:t,setIsGenerating:a,generatedCard:r,setGeneratedCard:n,generatedCards:i,setGeneratedCards:o,selectedCardIndex:l,setSelectedCardIndex:c,isCardCompleted:d,setIsCardCompleted:u,generationProgress:g,setGenerationProgress:p,progressPercentage:h,setProgressPercentage:f,currentCardId:x,setCurrentCardId:y,generationDuration:b,setGenerationDuration:v,handleGenerateCardAsync:w,handleFinalCardCompletion:j}}({selectedType:o,customCardType:c,selectedTone:u,selectedArtisticStyle:f,customStyleDescription:y,selectedImageModel:v,selectedPaperSize:R,prompt:e,toField:a,fromField:n,userEmail:D,finalCardMessage:eC.finalCardMessage,isHandwrittenMessage:E,isFrontBackOnly:A,referenceImageUrls:eN.referenceImageUrls,photoAnalyses:eN.photoAnalyses,numberOfCards:T,saveJobToStorage:ej.saveJobToStorage,removeJobFromStorage:ej.removeJobFromStorage,subscribeToJob:ev.subscribeToJob,startElapsedTimeTracking:ej.startElapsedTimeTracking,stopElapsedTimeTracking:ej.stopElapsedTimeTracking,setCurrentJobId:ej.setCurrentJobId,setIsDraftMode:ek.setIsDraftMode,setDraftCards:ek.setDraftCards,setDraftIndexMapping:ek.setDraftIndexMapping,setSelectedDraftIndex:ek.setSelectedDraftIndex,setIsGeneratingFinalCard:ek.setIsGeneratingFinalCard,setPreviewingDraftIndex:ek.setPreviewingDraftIndex,setDraftCompletionShown:ek.setDraftCompletionShown,setDraftCompletionCount:ek.setDraftCompletionCount}),eS=(0,s.useCallback)(e=>{let{job_id:t,status:a,progress:r,cardData:s,error:n,completedAt:i}=e;if(!t)return;let o=t.startsWith("draft-"),l=o?parseInt(t.split("-")[1]):-1;if(console.log("\uD83D\uDD04 Processing job update:",{job_id:t,status:a,isDraftJob:o,draftIndex:l,progress:r}),r){eD.setGenerationProgress(r),ek.setGenerationProgress(r);let e=r.match(/(\d+)%/);if(e){let t=parseInt(e[1]);ej.setProgressPercentage(t),eD.setProgressPercentage(t),ek.setProgressPercentage(t),console.log("\uD83D\uDCCA Progress update: ".concat(t,"% - ").concat(r))}else r.toLowerCase().includes("complete")&&(ej.setProgressPercentage(100),eD.setProgressPercentage(100),ek.setProgressPercentage(100),console.log("\uD83D\uDCCA Progress update: 100% - ".concat(r)))}if("completed"===a&&s){if(console.log("\uD83C\uDF89 Job completed! Card data:",s,"isDraftJob:",o),o&&l>=0){var c;let e;if(console.log("\uD83C\uDFA8 Draft variation ".concat(l+1," completed!")),"ai-smart-style"===f){let t=["watercolor","botanical","comic-book","dreamy-fantasy","minimalist"];l>=0&&l<t.length&&(e={styleName:t[l],styleLabel:["\uD83C\uDFA8 Watercolor","\uD83C\uDF3F Botanical","\uD83D\uDCA5 Comic Book","\uD83C\uDF38 Dreamy Fantasy","✨ Minimalist"][l]})}let a={id:"draft-".concat(l+1,"-").concat(Date.now()),prompt:s.prompt||"Draft Variation ".concat(l+1),frontCover:s.frontCover||"",backCover:"",leftPage:"",rightPage:"",createdAt:new Date,generatedPrompts:{frontCover:(null===(c=s.generatedPrompts)||void 0===c?void 0:c.frontCover)||""},styleInfo:e};ek.setDraftCards(e=>{let t=[...e];return t.push(a),t}),ek.setDraftIndexMapping(e=>{let t=[...e];return t.push(l),t}),ek.setDraftCompletionCount(e=>{let t=e+1;if(console.log("\uD83D\uDCCA Draft progress: ".concat(t,"/5 front cover variations complete")),1===t&&(0,ew.C)(),5===t)ek.isGeneratingFinalCard||(ek.setIsGenerating(!1),eD.setIsGenerating(!1),ek.setGenerationProgress(""),eD.setGenerationProgress(""),ej.setProgressPercentage(100),ej.stopElapsedTimeTracking()),ek.setDraftCompletionShown(e=>e||ek.isGeneratingFinalCard?e:(m.Am.success("\uD83C\uDFA8 All 5 front cover variations ready! Choose your favorite below."),!0));else{let e="✨ ".concat(t,"/5 front cover variations complete... ").concat(t>=2?"You can select one now to proceed!":"");ek.setGenerationProgress(e),eD.setGenerationProgress(e),ej.setProgressPercentage(t/5*100)}return t}),ej.removeJobFromStorage(t)}else eD.handleFinalCardCompletion(s),ej.removeJobFromStorage(t),ej.setCurrentJobId(null),ev.unsubscribeFromJob(t)}else"failed"===a?(console.error("❌ Job failed:",n),o&&l>=0?m.Am.error("Draft variation ".concat(l+1," failed. Continuing with others...")):(m.Am.error("❌ Card generation failed. Please try again."),eD.setIsGenerating(!1),ek.setIsGeneratingFinalCard(!1),ej.stopElapsedTimeTracking(),eD.setGenerationProgress(""),ej.setProgressPercentage(0),ej.setCurrentJobId(null),ev.unsubscribeFromJob(t)),ej.removeJobFromStorage(t)):"not_found"===a&&(console.warn("⚠️ Job not found on server, cleaning up stale reference:",t),ev.currentJobRef.current===t&&(ev.currentJobRef.current=null),ej.currentJobId===t&&(ej.setCurrentJobId(null),eD.setIsGenerating(!1),ek.setIsGeneratingFinalCard(!1),eD.setGenerationProgress(""),ej.setProgressPercentage(0),ej.stopElapsedTimeTracking()),ej.removeJobFromStorage(t),ev.unsubscribeFromJob(t))},[f,ek,eD,ej,ev]);(0,s.useEffect)(()=>{ev.setJobUpdateHandler(eS)},[ev,eS]);let eT=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(!ev.isSocketConnected&&(eD.isGenerating||ek.isGeneratingFinalCard)&&ev.currentJobRef.current){if(ej.generationStartTime&&Date.now()-ej.generationStartTime>3e5){if(!eT.current){console.log("⏰ Job is older than 5 minutes, stopping reconnection attempts"),eT.current=!0;let e=ev.currentJobRef.current;e&&(console.log("\uD83E\uDDF9 Cleaning up stale job:",e),e.startsWith("draft-")||ej.removeJobFromStorage(e),eD.setIsGenerating(!1),ek.setIsGeneratingFinalCard(!1),ek.setIsDraftMode(!1),ek.setDraftCards([]),ek.setDraftCompletionCount(0),ek.setDraftCompletionShown(!1),ej.setCurrentJobId(null),ej.setGenerationProgress(""),ej.setProgressPercentage(0),ej.stopElapsedTimeTracking(),ev.unsubscribeFromJob(e),m.Am.error("Card generation timed out. Please try again."))}return}console.log("\uD83D\uDD04 WebSocket disconnected during generation, attempting reconnect...");let e=setTimeout(()=>{ev.connectWebSocket();let e=ev.currentJobRef.current;e&&setTimeout(()=>{console.log("\uD83D\uDCE1 Re-subscribing to job after reconnect:",e),ev.subscribeToJob(e)},1e3)},2e3);return()=>clearTimeout(e)}},[ev,eD.isGenerating,ek.isGeneratingFinalCard,ej.generationStartTime]),(0,s.useEffect)(()=>{(eD.isGenerating||ek.isGeneratingFinalCard)&&(eT.current=!1)},[eD.isGenerating,ek.isGeneratingFinalCard]),(0,s.useEffect)(()=>{if((eD.isGenerating||ek.isGeneratingFinalCard)&&ev.currentJobRef.current){let e=setInterval(async()=>{let e=Date.now()-ev.lastJobUpdateRef.current,t=ev.currentJobRef.current;if(ej.progressPercentage>=95&&e>5e3){if(console.warn("⚠️ No updates for ".concat(Math.round(e/1e3),"s at ").concat(ej.progressPercentage,"% progress - checking job status...")),t)try{let e=await fetch("/api/job-status/".concat(t));if(e.ok){let a=await e.json();if(console.log("\uD83D\uDCCA Direct job status check:",a),"completed"===a.status&&a.cardData){console.log("✅ Job is actually completed! Processing result..."),eS({job_id:t,status:"completed",progress:"Card generation complete!",cardData:a.cardData});return}}}catch(e){console.error("Failed to check job status:",e)}}else if(ej.progressPercentage>=90&&e>1e4&&(console.warn("⚠️ No updates for ".concat(Math.round(e/1e3),"s at ").concat(ej.progressPercentage,"% progress")),t))try{let e=await fetch("/api/job-status/".concat(t));if(e.ok){let a=await e.json();if(console.log("\uD83D\uDCCA Direct job status check:",a),"completed"===a.status&&a.cardData){console.log("✅ Job is actually completed! Processing result..."),eS({job_id:t,status:"completed",progress:"Card generation complete!",cardData:a.cardData});return}}}catch(e){console.error("Failed to check job status:",e)}e>3e4&&(console.warn("⚠️ No job updates for 30 seconds, checking connection..."),ev.isSocketConnected?t&&(console.log("\uD83D\uDCE1 Re-subscribing to job due to stale updates:",t),ev.subscribeToJob(t)):(console.log("\uD83D\uDD04 WebSocket disconnected, reconnecting..."),ev.connectWebSocket()),ev.lastJobUpdateRef.current=Date.now())},3e3);return()=>clearInterval(e)}},[eD.isGenerating,ek.isGeneratingFinalCard,ev,ej.progressPercentage,eS]);let eI=(0,s.useCallback)(async()=>{for(let{jobId:e,job:t}of(await ej.checkPendingJobs())){eD.setIsGenerating(!0),ej.setCurrentJobId(e),eD.setGenerationProgress("Resuming card generation...");let a=t.createdAt?new Date(t.createdAt).getTime():Date.now();ej.startElapsedTimeTracking(a),m.Am.info("\uD83D\uDD04 Resuming card generation where you left off..."),ev.subscribeToJob(e)}},[ej,eD,ev]);return(0,s.useEffect)(()=>{eI()},[]),{prompt:e,setPrompt:t,finalCardMessage:eC.finalCardMessage,setFinalCardMessage:eC.setFinalCardMessage,toField:a,setToField:r,fromField:n,setFromField:i,selectedType:o,setSelectedType:l,customCardType:c,setCustomCardType:d,selectedTone:u,setSelectedTone:g,isGenerating:eD.isGenerating||ek.isGenerating,setIsGenerating:eD.setIsGenerating,isGeneratingMessage:eC.isGeneratingMessage,setIsGeneratingMessage:eC.setIsGeneratingMessage,generatedCard:eD.generatedCard,setGeneratedCard:eD.setGeneratedCard,numberOfCards:T,setNumberOfCards:I,generatedCards:eD.generatedCards,setGeneratedCards:eD.setGeneratedCards,selectedCardIndex:eD.selectedCardIndex,setSelectedCardIndex:eD.setSelectedCardIndex,showAdvanced:p,setShowAdvanced:h,selectedArtisticStyle:f,setSelectedArtisticStyle:x,customStyleDescription:y,setCustomStyleDescription:b,selectedImageModel:v,setSelectedImageModel:j,selectedDraftModel:w,setSelectedDraftModel:N,isDraftMode:ek.isDraftMode,setIsDraftMode:ek.setIsDraftMode,draftCards:ek.draftCards,setDraftCards:ek.setDraftCards,draftIndexMapping:ek.draftIndexMapping,setDraftIndexMapping:ek.setDraftIndexMapping,selectedDraftIndex:ek.selectedDraftIndex,setSelectedDraftIndex:ek.setSelectedDraftIndex,isGeneratingFinalCard:ek.isGeneratingFinalCard,setIsGeneratingFinalCard:ek.setIsGeneratingFinalCard,previewingDraftIndex:ek.previewingDraftIndex,setPreviewingDraftIndex:ek.setPreviewingDraftIndex,draftCompletionShown:ek.draftCompletionShown,setDraftCompletionShown:ek.setDraftCompletionShown,draftCompletionCount:ek.draftCompletionCount,setDraftCompletionCount:ek.setDraftCompletionCount,generationProgress:ek.isGenerating?ek.generationProgress:eD.generationProgress,setGenerationProgress:eD.setGenerationProgress,progressPercentage:ej.progressPercentage,setProgressPercentage:ej.setProgressPercentage,isCardCompleted:eD.isCardCompleted,setIsCardCompleted:eD.setIsCardCompleted,referenceImages:eN.referenceImages,setReferenceImages:eN.setReferenceImages,referenceImageUrls:eN.referenceImageUrls,setReferenceImageUrls:eN.setReferenceImageUrls,imageTransformation:eN.imageTransformation,setImageTransformation:eN.setImageTransformation,isUploading:eN.isUploading,setIsUploading:eN.setIsUploading,userEmail:D,setUserEmail:S,isHandwrittenMessage:E,setIsHandwrittenMessage:P,isFrontBackOnly:A,setIsFrontBackOnly:F,selectedPaperSize:R,setSelectedPaperSize:M,isTextareaExpanded:O,setIsTextareaExpanded:z,isMessageExpanded:U,setIsMessageExpanded:G,showSettings:Z,setShowSettings:_,showTemplateGallery:L,setShowTemplateGallery:J,showPrintConfirmation:H,setShowPrintConfirmation:Y,generationDuration:eD.generationDuration,setGenerationDuration:eD.setGenerationDuration,currentElapsedTime:ej.currentElapsedTime,setCurrentElapsedTime:ej.setCurrentElapsedTime,formatGenerationTime:e8.bD,formatCountdown:e8.D,sendThankYouEmail:ew.Q,chatWithAI:ew.chatWithAI,scrollToCardPreview:ew.C,startElapsedTimeTracking:ej.startElapsedTimeTracking,stopElapsedTimeTracking:ej.stopElapsedTimeTracking,handleFileUpload:eN.handleFileUpload,handleRemoveReferenceImage:eN.handleRemoveReferenceImage,photoAnalyses:eN.photoAnalyses,setPhotoAnalyses:eN.setPhotoAnalyses,isAnalyzing:eN.isAnalyzing,showAnalysisModal:eN.showAnalysisModal,setShowAnalysisModal:eN.setShowAnalysisModal,pendingAnalysisIndex:eN.pendingAnalysisIndex,setPendingAnalysisIndex:eN.setPendingAnalysisIndex,analyzePhoto:eN.analyzePhoto,savePhotoAnalysis:eN.savePhotoAnalysis,skipPhotoAnalysis:eN.skipPhotoAnalysis,getCombinedPhotoAnalysis:eN.getCombinedPhotoAnalysis,handleGetMessageHelp:eC.handleGetMessageHelp,addMessageToHistory:eC.addMessageToHistory,undoMessage:eC.undoMessage,redoMessage:eC.redoMessage,saveJobToStorage:ej.saveJobToStorage,removeJobFromStorage:ej.removeJobFromStorage,checkPendingJobs:eI,handleGenerateCardAsync:eD.handleGenerateCardAsync,handleGenerateDraftCards:ek.handleGenerateDraftCards,handleGenerateFinalFromDraft:ek.handleGenerateFinalFromDraft,messageHistory:eC.messageHistory,setMessageHistory:eC.setMessageHistory,currentMessageIndex:eC.currentMessageIndex,setCurrentMessageIndex:eC.setCurrentMessageIndex,refinementPrompt:eC.refinementPrompt,setRefinementPrompt:eC.setRefinementPrompt,isRefiningMessage:eC.isRefiningMessage,setIsRefiningMessage:eC.setIsRefiningMessage,showRefinementBox:eC.showRefinementBox,setShowRefinementBox:eC.setShowRefinementBox,showTemplateCustomization:B,setShowTemplateCustomization:W,selectedTemplate:q,setSelectedTemplate:V,templateCustomizations:eu,setTemplateCustomizations:eg,templateSearchQuery:$,setTemplateSearchQuery:X,isSearchingTemplates:ee,setIsSearchingTemplates:et,aiFilteredCards:ea,setAiFilteredCards:er,searchMode:es,setSearchMode:en,textFilteredCards:ei,setTextFilteredCards:eo,showPrompts:el,setShowPrompts:ec,printOption:ed,setPrintOption:em,handwritingSample:eN.handwritingSample,setHandwritingSample:eN.setHandwritingSample,handwritingSampleUrl:eN.handwritingSampleUrl,setHandwritingSampleUrl:eN.setHandwritingSampleUrl,currentJobId:ej.currentJobId,setCurrentJobId:ej.setCurrentJobId,countdown:ef,setCountdown:ex,countdownInterval:ey,setCountdownInterval:eb,sectionLoadingStates:ep,setSectionLoadingStates:eh,fastPreviewMode:C,setFastPreviewMode:k,currentCardId:eD.currentCardId,setCurrentCardId:eD.setCurrentCardId,isInitialLoadComplete:Q,setIsInitialLoadComplete:K,generationStartTime:ej.generationStartTime,setGenerationStartTime:ej.setGenerationStartTime,elapsedTimeInterval:ej.elapsedTimeInterval,setElapsedTimeInterval:ej.setElapsedTimeInterval,cardTones:e8.zh,artisticStyles:e8.jK,paperSizes:e8._$,isSocketConnected:ev.isSocketConnected,connectWebSocket:ev.connectWebSocket,disconnectWebSocket:ev.disconnectWebSocket,subscribeToJob:ev.subscribeToJob,unsubscribeFromJob:ev.unsubscribeFromJob,handleJobUpdate:eS,handleFinalCardCompletion:eD.handleFinalCardCompletion}}(),[y,b]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),w=e=>{u.updateFormData(e)},N=e$(x,u,w),C=eX(x,w),k=e0(x,w),D=e1(x,w),S=e=>u.validateStep(e),T=S(p.currentStep);return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6 px-4 sm:px-6 lg:px-8 safe-area-padding",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Card Wizard"}),(h.hasCompletedCards||h.hasDraftSessions)&&(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>b(!0),className:"flex items-center gap-2",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"History"}),(0,r.jsxs)("span",{className:"sm:hidden",children:["(",h.totalCards+h.totalDrafts,")"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{(p.currentStep>1||u.formData.selectedType||u.formData.selectedTone)&&window.confirm("Are you sure you want to start over? All current progress will be lost.")&&(u.resetForm(),p.resetWizardState(),x.setDraftCards([]),x.setGeneratedCard(null),x.setIsGenerating(!1),x.setGenerationProgress(""),x.setSelectedDraftIndex(-1),m.Am.success("Started new card"))},className:"flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"New Card"})]}),h.hasDraftSessions&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 text-purple-600"}),(0,r.jsxs)("span",{className:"text-gray-600 dark:text-gray-400 hidden sm:inline",children:[h.totalDrafts," saved"]}),(0,r.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>b(!0),className:"text-purple-600 hover:text-purple-700",children:"Resume"})]})]})]}),(0,r.jsx)(g,{steps:tc,currentStep:p.currentStep,completedSteps:p.completedSteps,onStepClick:e=>{if(p.completedSteps.includes(e)){p.goToStep(e);return}if(e===p.currentStep+1&&S(p.currentStep)){p.completedSteps.includes(p.currentStep)||p.markStepCompleted(p.currentStep),p.goToStep(e);return}if(e<p.currentStep){p.goToStep(e);return}}}),(0,r.jsxs)(n.Zb,{className:"shadow-lg",children:[(0,r.jsx)(n.Ol,{className:"bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-t-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center shadow-lg",children:p.completedSteps.includes(p.currentStep)?(0,r.jsx)(d.Z,{className:"w-6 h-6 text-white"}):(0,r.jsx)("span",{className:"text-white font-bold",children:p.currentStep})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)(n.ll,{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100",children:null===(e=tc[p.currentStep-1])||void 0===e?void 0:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:null===(t=tc[p.currentStep-1])||void 0===t?void 0:t.description})]})]}),(null===(a=tc[p.currentStep-1])||void 0===a?void 0:a.isOptional)&&(0,r.jsx)("div",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/30 px-2 py-1 rounded-full flex-shrink-0",children:"Optional"})]})}),(0,r.jsx)(n.aY,{className:"pt-6 pb-4",children:(0,r.jsx)(eQ,{currentStep:p.currentStep,formData:u.formData,updateFormData:w,cardStudio:x,wizardState:p,handleFileUploadWrapper:N,handleGetMessageHelpWrapper:C,undoMessageWrapper:k,redoMessageWrapper:D,handleTemplateSelect:e=>{e3(e,w,x)}})})]}),(0,r.jsx)(f,{currentStep:p.currentStep,totalSteps:tc.length,onPrevious:()=>{p.currentStep>1&&p.goToPreviousStep()},onNext:()=>!!S(p.currentStep)&&(p.markStepCompleted(p.currentStep),p.currentStep<tc.length&&p.goToNextStep(),!0),canProceed:T,isGenerating:x.isGenerating}),(0,r.jsx)(A,{isOpen:y,onClose:()=>b(!1),onResumeDraft:e=>{e2(e,h,u,x,p,j)},onLoadCard:e=>{m.Am.info("Card viewing functionality coming soon!")}}),(0,r.jsx)(F,{cardStudio:x,cardForm:u,cardHistory:h,wizardState:p,isResumingDraft:v})]})}},85505:function(e,t,a){a.d(t,{D:function(){return l},Ye:function(){return i},_$:function(){return n},bD:function(){return o},jK:function(){return s},zh:function(){return r}});let r=[{id:"funny",label:"\uD83D\uDE04 Funny",description:"Humorous and lighthearted"},{id:"genz-humor",label:"\uD83D\uDC80 GenZ Humor",description:"Internet memes, chaotic energy, and unhinged vibes"},{id:"romantic",label:"\uD83D\uDC95 Romantic",description:"Sweet and loving"},{id:"professional",label:"\uD83D\uDC54 Professional",description:"Formal and business-appropriate"},{id:"heartfelt",label:"❤️ Heartfelt",description:"Sincere and emotional"},{id:"playful",label:"\uD83C\uDF89 Playful",description:"Fun and energetic"},{id:"elegant",label:"✨ Elegant",description:"Sophisticated and refined"},{id:"casual",label:"\uD83D\uDE0A Casual",description:"Relaxed and friendly"},{id:"inspirational",label:"\uD83C\uDF1F Inspirational",description:"Motivating and uplifting"},{id:"quirky",label:"\uD83E\uDD2A Quirky",description:"Unique and unconventional"},{id:"traditional",label:"\uD83C\uDFAD Traditional",description:"Classic and timeless"}],s=[{id:"ai-smart-style",label:"✨ Smart Style",description:"Let our experts choose the perfect style for your card",promptModifier:""},{id:"custom",label:"✨ Custom Style",description:"Define your own unique artistic style",promptModifier:""},{id:"watercolor",label:"\uD83C\uDFA8 Watercolor",description:"Soft, flowing paint effects (our personal favorite)",promptModifier:"in watercolor painting style, with soft flowing colors, artistic brush strokes, paper texture, and organic paint bleeds"},{id:"minimalist",label:"✨ Minimalist",description:"Clean, simple, elegant design",promptModifier:"in minimalist style with clean lines, simple shapes, plenty of white space, sophisticated typography, and elegant simplicity"},{id:"botanical",label:"\uD83C\uDF3F Botanical",description:"Beautiful flowers and nature elements",promptModifier:"in botanical illustration style with detailed flowers, leaves, and natural elements, soft organic shapes, elegant floral arrangements, and nature-inspired designs perfect for greeting cards"},{id:"comic-book",label:"\uD83D\uDCA5 Comic Book",description:"Bold graphic novel style",promptModifier:"in comic book art style with bold outlines, vibrant colors, dynamic poses, speech bubble aesthetics, halftone patterns, and superhero comic book visual elements that create an exciting and energetic feel"},{id:"dreamy-fantasy",label:"\uD83C\uDF38 Dreamy Fantasy",description:"Enchanting anime-inspired art",promptModifier:"in dreamy fantasy anime style, with soft pastels, magical atmosphere, detailed nature elements, whimsical characters, and enchanting fairy-tale qualities"},{id:"art-deco",label:"✨ Art Deco",description:"Elegant 1920s geometric luxury",promptModifier:"in vintage Art Deco style with geometric patterns, gold accents, elegant typography, luxurious details, and 1920s glamour"},{id:"vintage-illustration",label:"\uD83D\uDCDA Vintage Illustration",description:"Classic storybook charm",promptModifier:"in vintage illustration style like classic children's books, with warm nostalgic colors, charming characters, whimsical details, and timeless fairy-tale aesthetics"},{id:"modern-geometric",label:"\uD83D\uDD37 Modern Geometric",description:"Clean contemporary shapes",promptModifier:"in modern geometric style with clean shapes, contemporary design elements, balanced compositions, and sophisticated color palettes perfect for modern greeting cards"},{id:"soft-pastel",label:"\uD83C\uDF38 Soft Pastel",description:"Gentle, soothing colors",promptModifier:"in soft pastel style with gentle colors, dreamy atmosphere, delicate textures, and calming visual elements that create a peaceful and heartwarming feeling"},{id:"retro-vintage",label:"\uD83D\uDCFB Retro Vintage",description:"Classic 1950s-60s nostalgia",promptModifier:"in retro vintage style with 1950s-60s aesthetics, classic typography, warm nostalgic colors, and mid-century design elements"}],n=[{id:"standard",label:"5\xd77 Card (Standard)",description:"Standard 5\xd77 greeting card (10\xd77 print layout)",aspectRatio:"9:16",dimensions:"1024x1536",printWidth:"10in",printHeight:"7in"},{id:"compact",label:"4\xd76 Card (Compact)",description:"Compact 4\xd76 greeting card (8\xd76 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8in",printHeight:"6in"},{id:"a6",label:"A6 Card (4\xd76)",description:"A6 paper size (8.3\xd75.8 print layout)",aspectRatio:"2:3",dimensions:"768x1152",printWidth:"8.3in",printHeight:"5.8in"}],i="https://vibecarding.com",o=e=>{let t=Math.floor(e/60),a=Math.floor(e%60);return t>0?"".concat(t,"m ").concat(a,"s"):"".concat(a,"s")},l=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0"))},92496:function(e,t,a){a.d(t,{C:function(){return o},Q:function(){return n},chatWithAI:function(){return i}});var r=a(14438),s=a(85505);async function n(e,t,a){if(console.log("\uD83D\uDCE7 sendThankYouEmail called with:",{toEmail:e,cardType:t,cardUrl:a}),!e.trim()){console.log("\uD83D\uDCE7 sendThankYouEmail - toEmail is empty, returning");return}try{let n='\n      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; color: #333;">\n        <div style="text-align: center; margin-bottom: 30px;">\n          <h1 style="color: #2563eb; margin-bottom: 10px;">\uD83C\uDF89 Your Card is Ready!</h1>\n        </div>\n        \n        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">Hi there!</p>\n        \n        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">\n          Thank you for using VibeCarding to create your beautiful <strong>'.concat(t,'</strong> card!\n        </p>\n        \n        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">\n          We hope you love how it turned out. Your card has been generated and is ready for printing or sharing.\n        </p>\n        \n        <div style="text-align: center; margin: 30px 0;">\n          <a href="').concat(a,'" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;">\n            View Your Card\n          </a>\n        </div>\n        \n        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">\n          If you have any questions or feedback, feel free to reach out to us.\n        </p>\n        \n        <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">\n          Happy card making!\n        </p>\n        \n        <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280;">\n          <p style="margin-bottom: 5px;"><strong>Best regards,</strong></p>\n          <p style="margin-bottom: 5px;">The VibeCarding Team</p>\n          <p style="margin: 0;">\n            <a href="mailto:vibecarding@ast.engineer" style="color: #2563eb; text-decoration: none;">vibecarding@ast.engineer</a>\n          </p>\n        </div>\n      </div>\n    '),i="Hi there!\n\nThank you for using VibeCarding to create your beautiful ".concat(t," card!\n\nWe hope you love how it turned out. Your card has been generated and is ready for printing or sharing.\n\nView your card: ").concat(a,"\n\nIf you have any questions or feedback, feel free to reach out to us.\n\nHappy card making!\n\nBest regards,\nThe VibeCarding Team\nvibecarding@ast.engineer");console.log("\uD83D\uDCE7 Attempting to send email to user:",e);let o=await fetch("".concat(s.Ye,"/send_email_nodejs_style"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({to:e,from:"vibecarding@ast.engineer",subject:"Your ".concat(t," card is ready!"),body:n,text:i,html:n})});if(console.log("\uD83D\uDCE7 User email response status:",o.status),o.ok){let e=await o.json();console.log("\uD83D\uDCE7 User email response data:",e)}await fetch("".concat(s.Ye,"/send_email_nodejs_style"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:"jordan@ast.engineer",from:"vibecarding@ast.engineer",subject:"Card Created - ".concat(t," for ").concat(e),body:'<div style="font-family: Arial, sans-serif; padding: 20px;">\n          <h3 style="color: #2563eb;">New Card Created on VibeCarding</h3>\n          <p><strong>User:</strong> '.concat(e,"</p>\n          <p><strong>Card Type:</strong> ").concat(t,'</p>\n          <p><strong>Card URL:</strong> <a href="').concat(a,'">').concat(a,'</a></p>\n          <p style="margin-top: 20px; color: #6b7280; font-size: 14px;">\n            This is an automated notification of card creation activity.\n          </p>\n        </div>'),text:"New card created on VibeCarding:\n\nUser: ".concat(e,"\nCard Type: ").concat(t,"\nCard URL: ").concat(a,"\n\nThis is an automated notification of card creation activity.")})}),o.ok&&r.Am.success("✉️ Thank you email sent!")}catch(e){console.error("Failed to send thank you email:",e)}}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{systemPrompt:a=null,model:r="gemini-2.5-pro",includeThoughts:s=!1,jsonSchema:n=null,attachments:i=[]}=t;console.log("\uD83E\uDD16 chatWithAI called with:",{messageLength:e.length,model:r,hasAttachments:i.length>0,attachmentCount:i.length,hasJsonSchema:!!n});try{let t;let o=await fetch("/internal/call_mcp_tool",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"ai_chat",arguments:{messages:e,system_prompt:a,model:r,include_thoughts:s,json_schema:n,...i.length>0&&{attachments:i}}})});if(!o.ok){let e=await o.text();throw console.error("chatWithAI error response:",e),Error("HTTP ".concat(o.status,": ").concat(e))}let l=await o.json();if(console.log("\uD83E\uDD16 chatWithAI response data:",l),l.error&&"None"!==l.error&&null!==l.error)throw Error(l.error);if("string"==typeof l.result)try{t=JSON.parse(l.result)}catch(e){t={status:"error",message:"Invalid JSON response"}}else t=l.result;if("error"===t.status)throw Error(t.message);return t.response}catch(e){throw console.error("AI chat failed:",e),e}}let o=()=>{setTimeout(()=>{let e=document.querySelector("[data-card-preview]");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},500)}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[796],{18069:function(e,t,s){Promise.resolve().then(s.bind(s,83168))},83168:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return e$}});var a=s(57437),r=s(2265),n=s(11696),l=s(62869),o=s(95186),i=s(19378),c=s(53647),d=s(61312),m=s(94508);let u=d.zt,p=d.fC,h=d.xz,f=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...n}=e;return(0,a.jsx)(d.h_,{children:(0,a.jsx)(d.VY,{ref:t,sideOffset:r,className:(0,m.cn)("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",s),...n})})});f.displayName=d.VY.displayName;var x=s(93022),g=s(58293),y=s(82222),w=s(11239),b=s(82023),v=s(98728),j=s(51817),N=s(40875),_=s(96362),k=s(76980),S=s(83774),C=s(20265),T=s(27648),E=s(57970),A=s(18848),P=s(93837),Z=s(14438),D=s(41671),F=s(99388),z=s(25330),O=s(48736),R=s(22289),L=s(25922),M=e=>{let{original:t,modified:s,language:n="python",filename:l="file.py",height:o="400px",className:i=""}=e,{theme:c}=(0,L.F)(),d=(0,r.useRef)(null);return(0,a.jsxs)("div",{className:"monaco-diff-container border rounded-md overflow-hidden ".concat(i),children:[(0,a.jsxs)("div",{className:"bg-muted px-3 py-2 border-b flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-foreground",children:l}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Before vs After)"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Removed"]}),(0,a.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Added"]})]})]}),(0,a.jsx)("div",{style:{height:o},children:(0,a.jsx)(R.SV,{original:t,modified:s,language:n,theme:"dark"===c?"vs-dark":"light",options:{readOnly:!0,automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderSideBySide:!0,renderOverviewRuler:!1,enableSplitViewResizing:!0,fontFamily:"JetBrains Mono, Fira Code, Consolas, Monaco, monospace",fontSize:13,lineHeight:18,wordWrap:"on",scrollbar:{vertical:"auto",horizontal:"auto",verticalScrollbarSize:8,horizontalScrollbarSize:8},diffWordWrap:"on",ignoreTrimWhitespace:!1,renderIndicators:!0,originalEditable:!1,modifiedEditable:!1},onMount:e=>{d.current=e,setTimeout(()=>{try{let t=e.getLineChanges();t&&t.length>0&&e.revealLineInCenter(t[0].modifiedStartLineNumber||1)}catch(e){console.warn("Could not navigate to first diff:",e)}},100)},loading:(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Loading diff viewer..."})})})})]})},U=e=>{var t;let{toolCall:s,renderSanitizedMarkdown:n}=e,[l,o]=(0,r.useState)("diff");console.log("[ToolCallDisplay] Rendering tool: ".concat(s.name,", call_id: ").concat(s.call_id)),console.log("[ToolCallDisplay] sampleCallPairs:",s.sampleCallPairs),console.log("[ToolCallDisplay] sampleCallPairs length:",(null===(t=s.sampleCallPairs)||void 0===t?void 0:t.length)||0);let i=(()=>{if("edit_mcp_server"!==s.name||!s.result)return null;try{let e=JSON.parse(s.result);if(e.original_code&&e.modified_code)return{original:e.original_code,modified:e.modified_code,serverName:e.server_name||"unknown_server",changesApplied:e.changes_applied||0,status:e.status,message:e.message,reloadResult:e.reload_result}}catch(e){console.warn("Failed to parse edit_mcp_server result:",e)}return null})(),c="edit_mcp_server"===s.name;return(0,a.jsxs)("details",{className:"tool-call-display my-2 rounded-lg border border-border bg-muted/20 shadow-sm",open:!1,children:[(0,a.jsxs)("summary",{className:"tool-call-summary cursor-pointer p-3 list-none flex items-center justify-between text-sm font-medium text-foreground hover:bg-muted/40 rounded-t-lg",children:[(0,a.jsxs)("div",{className:"flex items-center",children:["Completed"!==s.status||s.is_error?s.is_error?(0,a.jsx)(F.Z,{className:"w-4 h-4 text-red-500"}):"Pending..."===s.status||"Streaming..."===s.status?(0,a.jsx)(j.Z,{className:"w-4 h-4 animate-spin text-muted-foreground"}):null:(0,a.jsx)(D.Z,{className:"w-4 h-4 text-green-500"}),(0,a.jsxs)("span",{className:"ml-2 font-mono text-xs sm:text-sm",children:["Tool: ",s.name]}),"Streaming..."===s.status&&(0,a.jsx)("span",{className:"ml-2 text-xs italic text-muted-foreground",children:"streaming result..."})]}),(0,a.jsx)(N.Z,{className:"w-5 h-5 transition-transform duration-200 details-arrow"})]}),(0,a.jsxs)("div",{className:"tool-call-content p-3 border-t border-border bg-background rounded-b-lg space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-semibold uppercase text-muted-foreground mb-1",children:"Arguments:"}),(0,a.jsx)("pre",{className:"w-full max-w-full p-2 border rounded-md bg-muted/30 text-xs overflow-x-auto overflow-y-auto max-h-96 min-w-0",style:{wordBreak:"break-all",whiteSpace:"pre-wrap",overflowWrap:"anywhere",hyphens:"auto"},children:s.arguments})]}),s.result&&(0,a.jsx)("div",{children:c&&i?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"bg-muted/40 rounded-lg p-3 border",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-foreground",children:"Server Edit Summary"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>o("diff"),className:"inline-flex items-center px-2 py-1 text-xs rounded-md transition-colors ".concat("diff"===l?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[(0,a.jsx)(z.Z,{className:"w-3 h-3 mr-1"}),"Diff View"]}),(0,a.jsxs)("button",{onClick:()=>o("raw"),className:"inline-flex items-center px-2 py-1 text-xs rounded-md transition-colors ".concat("raw"===l?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[(0,a.jsx)(O.Z,{className:"w-3 h-3 mr-1"}),"Raw Output"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-muted-foreground",children:"Server:"}),(0,a.jsxs)("span",{className:"ml-1 font-mono",children:[i.serverName,".py"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-muted-foreground",children:"Status:"}),(0,a.jsx)("span",{className:"ml-1 px-1.5 py-0.5 rounded text-xs font-medium ".concat("success"===i.status?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"error"===i.status?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300"),children:i.status})]})]}),i.message&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:i.message}),i.reloadResult&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-background rounded border text-xs",children:[(0,a.jsx)("span",{className:"font-medium",children:"Reload Status:"}),(0,a.jsx)("span",{className:"ml-1 ".concat("success"===i.reloadResult.status?"text-green-600":"text-red-600"),children:i.reloadResult.message})]})]}),"diff"===l?(0,a.jsx)(M,{original:i.original,modified:i.modified,language:"python",filename:"".concat(i.serverName,".py"),height:"500px",className:"w-full"}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-xs font-semibold uppercase text-muted-foreground mb-1",children:["Raw Result (","Streaming..."!==s.status||s.is_error?s.status:"Streaming...","):"]}),(0,a.jsx)("div",{className:"w-full max-w-full p-2 border rounded-md overflow-x-auto overflow-y-auto max-h-96 text-xs min-w-0 ".concat(s.is_error?"border-red-500 bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300":"border-border bg-muted/30"),style:{wordBreak:"break-all",overflowWrap:"anywhere",hyphens:"auto"},dangerouslySetInnerHTML:{__html:n(s.result)}})]})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-xs font-semibold uppercase text-muted-foreground mb-1",children:["Result (","Streaming..."!==s.status||s.is_error?s.status:"Streaming...","):"]}),(0,a.jsx)("div",{className:"w-full max-w-full p-2 border rounded-md overflow-x-auto overflow-y-auto max-h-96 text-xs min-w-0 ".concat(s.is_error?"border-red-500 bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300":"border-border bg-muted/30"),style:{wordBreak:"break-all",overflowWrap:"anywhere",hyphens:"auto"},dangerouslySetInnerHTML:{__html:n(s.result)}})]})}),s.sampleCallPairs&&s.sampleCallPairs.length>0&&(console.log("[ToolCallDisplay] About to render ".concat(s.sampleCallPairs.length," sampleCallPairs for ").concat(s.name)),s.sampleCallPairs.map((e,t)=>(0,a.jsxs)(r.Fragment,{children:[e.thoughts&&(console.log("[ToolCallDisplay] Rendering thoughts for pair ".concat(t+1,":"),e.thoughts.substring(0,100)),(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-dashed border-border/50",children:[(0,a.jsxs)("h4",{className:"font-medium text-blue-500 dark:text-blue-400 text-xs mb-1",children:["↳ LLM Sampling Thoughts (#",t+1,"):"]}),(0,a.jsx)("pre",{className:"mt-1 p-2 border rounded-md border-blue-500/30 bg-blue-500/5 whitespace-pre-wrap text-xs font-mono w-full max-w-full overflow-x-auto overflow-y-auto max-h-96 min-w-0",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:e.thoughts})]})),e.output&&(console.log("[ToolCallDisplay] Rendering output for pair ".concat(t+1,":"),e.output.substring(0,100)),(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-dashed border-border/50",children:[(0,a.jsxs)("h4",{className:"font-medium text-green-600 dark:text-green-400 text-xs mb-1",children:["↳ LLM Sampling Output (#",t+1,"):"]}),(0,a.jsx)("pre",{className:"mt-1 p-2 border rounded-md border-green-500/30 bg-green-500/5 whitespace-pre-wrap text-xs font-mono w-full max-w-full overflow-x-auto overflow-y-auto max-h-96 min-w-0",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:e.output})]}))]},"".concat(e.id||t,"-").concat(s.call_id,"-").concat(t)))),"Pending..."===s.status&&!s.result&&(!s.sampleCallPairs||0===s.sampleCallPairs.length)&&(0,a.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground pt-2",children:[(0,a.jsx)(j.Z,{className:"w-3 h-3 mr-1 animate-spin"}),"Awaiting first tool output..."]})]})]},s.call_id)},J=s(1322);let B={name:"Modern Light",mapTypeStyles:[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}],routeColor:"#4285F4"},G={name:"Modern Dark",mapTypeStyles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],routeColor:"#80CBC4"},I=e=>window.google&&window.google.maps&&window.google.maps.geometry?window.google.maps.geometry.encoding.decodePath(e).map(e=>({lat:e.lat(),lng:e.lng()})):(console.warn("[MapDisplay.tsx] Google Maps Geometry library not loaded yet for polyline decoding."),[]),X={width:"100%",height:"400px"},V={lat:39.8283,lng:-98.5795},W=e=>{let{directionsResponse:t,routeColor:s=B.routeColor}=e,a=(0,J.Sx)(),[n,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(a){if(n&&n.setMap(null),t&&t.routes&&t.routes[0]){let e=t.routes[0];if(e.overview_polyline&&e.overview_polyline.points){if(window.google&&window.google.maps&&window.google.maps.geometry){let t=I(e.overview_polyline.points);if(t.length>0){l(new window.google.maps.Polyline({path:t,strokeColor:s,strokeOpacity:.75,strokeWeight:5,map:a}));let e=new window.google.maps.LatLngBounds;t.forEach(t=>e.extend(t)),a.fitBounds(e),setTimeout(()=>{if(a.getProjection()&&"number"==typeof a.getZoom()){let e=a.getZoom();t.length>1&&a.getZoom(),a.setZoom(Math.min(e,16)),1===t.length&&(a.setCenter(t[0]),a.setZoom(14))}else console.warn("[MapDisplay.tsx] Map projection or zoom not available for adjustment after fitBounds.")},100)}else l(null)}else console.warn("[MapDisplay.tsx] Geometry library not ready for polyline decoding.")}else l(null)}else l(null);return()=>{n&&n.setMap(null)}}},[a,t,s]),null},H=e=>{let{showTraffic:t}=e,s=(0,J.Sx)(),[a,n]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(s){if(t){if(a)a.setMap(s),console.log("[MapDisplay.tsx] Traffic layer re-enabled on map.");else{let e=new window.google.maps.TrafficLayer;e.setMap(s),n(e),console.log("[MapDisplay.tsx] Traffic layer enabled.")}}else a&&(a.setMap(null),console.log("[MapDisplay.tsx] Traffic layer disabled."))}},[s,t,a]),null};var Y=(0,r.memo)(e=>{var t,s,r,n,l,o,i,c;let{directionsResponse:d,googleMapsApiKey:m,showTraffic:u,theme:p=B}=e;return m?(0,a.jsx)(J.un,{apiKey:m,libraries:["geometry"],onLoad:()=>console.log("[MapDisplay.tsx] APIProvider loaded with libraries."),children:(0,a.jsxs)(J.D5,{style:X,defaultCenter:V,defaultZoom:5,gestureHandling:"greedy",disableDefaultUI:!1,styles:p.mapTypeStyles,onCameraChanged:e=>console.log("[MapDisplay.tsx] Map camera changed:",e.detail.center,e.detail.zoom),children:[(null==d?void 0:null===(n=d.routes)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:null===(s=r.legs)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.start_location)&&(0,a.jsx)(J.Jx,{position:d.routes[0].legs[0].start_location,title:"Start: ".concat(d.routes[0].legs[0].start_address)}),(null==d?void 0:null===(c=d.routes)||void 0===c?void 0:null===(i=c[0])||void 0===i?void 0:null===(o=i.legs)||void 0===o?void 0:null===(l=o[0])||void 0===l?void 0:l.end_location)&&(0,a.jsx)(J.Jx,{position:d.routes[0].legs[0].end_location,title:"End: ".concat(d.routes[0].legs[0].end_address)}),(0,a.jsx)(W,{directionsResponse:d,routeColor:p.routeColor}),(0,a.jsx)(H,{showTraffic:u})]})}):(0,a.jsx)("div",{style:{color:"red",padding:"20px",border:"1px solid red"},children:"Error: Google Maps API Key is missing. Please set NEXT_PUBLIC_GOOGLE_MAPS_API_KEY."})}),q=e=>{let{steps:t,totalDuration:s,totalDistance:r}=e;return t&&0!==t.length?(0,a.jsxs)("div",{className:"mt-4 p-3 border rounded-lg shadow bg-muted/30 max-h-96 overflow-y-auto text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Directions"}),(s||r)&&(0,a.jsxs)("div",{className:"text-xs text-primary font-medium",children:[r&&(0,a.jsx)("span",{children:r}),r&&s&&(0,a.jsx)("span",{className:"mx-1",children:"|"}),s&&(0,a.jsx)("span",{children:s})]})]}),(0,a.jsx)("ol",{className:"list-decimal list-inside space-y-2",children:t.map((e,t)=>(0,a.jsxs)("li",{className:"text-muted-foreground leading-relaxed",children:[(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e.html_instructions}}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground/80 mt-1",children:[(0,a.jsx)("span",{children:e.distance.text})," | ",(0,a.jsx)("span",{children:e.duration.text})]})]},t))})]}):null},K=s(92735),$=s(87769),Q=e=>{let{imageUrls:t,className:s=""}=e,[n,o]=(0,r.useState)(null),[i,c]=(0,r.useState)({}),[d,m]=(0,r.useState)({}),u=e=>{c(t=>({...t,[e]:!1}))},p=e=>{c(t=>({...t,[e]:!1})),m(t=>({...t,[e]:!0}))},h=e=>{o(e)},f=async(e,t)=>{t.stopPropagation();try{let t=await fetch(e),s=await t.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a;let n=e.split("/"),l=n[n.length-1]||"generated-image-".concat(Date.now(),".png");r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}catch(e){console.error("Failed to download image:",e)}},x=(e,t)=>{t.stopPropagation(),window.open(e,"_blank","noopener,noreferrer")};return t&&0!==t.length?(0,a.jsxs)("div",{className:"image-display ".concat(s),children:[(0,a.jsx)("div",{className:"grid gap-3 ".concat(1===t.length?"grid-cols-1":2===t.length?"grid-cols-1 sm:grid-cols-2":"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"),children:t.map((e,s)=>(0,a.jsxs)("div",{className:"relative group cursor-pointer rounded-lg overflow-hidden border border-border bg-muted/10 hover:shadow-lg transition-all duration-200",onClick:()=>h(e),children:[i[e]&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/50 z-10",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),d[e]&&(0,a.jsx)("div",{className:"aspect-square flex items-center justify-center bg-muted text-muted-foreground",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl mb-2",children:"\uD83D\uDDBC️"}),(0,a.jsx)("div",{className:"text-sm",children:"Failed to load image"})]})}),!d[e]&&(0,a.jsx)("img",{src:e,alt:"Generated image ".concat(s+1),className:"w-full aspect-square object-cover transition-transform duration-200 group-hover:scale-105",onLoad:()=>u(e),onError:()=>p(e),onLoadStart:()=>c(t=>({...t,[e]:!0})),loading:"lazy"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(l.z,{size:"sm",variant:"secondary",onClick:t=>x(e,t),className:"bg-white/90 hover:bg-white text-black",children:(0,a.jsx)(_.Z,{className:"w-4 h-4"})}),(0,a.jsx)(l.z,{size:"sm",variant:"secondary",onClick:t=>f(e,t),className:"bg-white/90 hover:bg-white text-black",children:(0,a.jsx)(K.Z,{className:"w-4 h-4"})})]})}),t.length>1&&(0,a.jsx)("div",{className:"absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded-full",children:s+1})]},"".concat(e,"-").concat(s)))}),n&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>o(null),children:(0,a.jsxs)("div",{className:"relative max-w-[95vw] max-h-[95vh]",children:[(0,a.jsx)(l.z,{variant:"secondary",size:"icon",className:"absolute -top-12 right-0 bg-white/90 hover:bg-white text-black",onClick:()=>o(null),children:(0,a.jsx)($.Z,{className:"w-4 h-4"})}),(0,a.jsx)("img",{src:n,alt:"Expanded view",className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),(0,a.jsxs)("div",{className:"absolute -bottom-12 left-0 right-0 flex justify-center space-x-2",children:[(0,a.jsxs)(l.z,{size:"sm",variant:"secondary",onClick:e=>x(n,e),className:"bg-white/90 hover:bg-white text-black",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"Open"]}),(0,a.jsxs)(l.z,{size:"sm",variant:"secondary",onClick:e=>f(n,e),className:"bg-white/90 hover:bg-white text-black",children:[(0,a.jsx)(K.Z,{className:"w-4 h-4 mr-2"}),"Download"]})]})]})}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground mt-2 text-center",children:1===t.length?"1 image generated":"".concat(t.length," images generated")})]}):null};let ee=()=>{let[e,t]=(0,r.useState)(new Map),s=(0,r.useCallback)((e,s,a,r,n)=>{t(t=>{let l=new Map(t),o=l.get(e),i=Date.now(),c={id:e,type:s,data:a,toolCall:n,messageId:r,createdAt:(null==o?void 0:o.createdAt)||i,updatedAt:i};return l.set(e,c),l})},[]),a=(0,r.useCallback)((e,s)=>{t(t=>{let a=new Map(t),r=a.get(e);return r&&a.set(e,{...r,data:{...r.data,...s},updatedAt:Date.now()}),a})},[]),n=(0,r.useCallback)(t=>e.get(t),[e]),l=(0,r.useCallback)(t=>Array.from(e.values()).filter(e=>e.messageId===t),[e]),o=(0,r.useCallback)(e=>{t(t=>{let s=new Map(t);return s.delete(e),s})},[]),i=(0,r.useCallback)(()=>{t(new Map)},[]);return{previews:Array.from(e.values()),upsertPreview:s,updatePreview:a,getPreview:n,getPreviewsForMessage:l,removePreview:o,clearPreviews:i}};var et=s(42208),es=s(30401),ea=s(78867),er=e=>{let{original:t,modified:s,filename:n="file",language:l="text",className:o=""}=e,[i,c]=r.useState(!1),d=async()=>{try{let e=m.map(e=>{let t="added"===e.type?"+":"removed"===e.type?"-":" ";return"".concat(t," ").concat(e.content)}).join("\n");await navigator.clipboard.writeText(e),c(!0),setTimeout(()=>c(!1),2e3)}catch(e){console.error("Failed to copy diff:",e)}},m=((e,t)=>{let s=e.split("\n"),a=t.split("\n"),r=[];s.length,a.length;let n=0,l=0;for(;n<s.length||l<a.length;){let e=s[n],t=a[l];n>=s.length?(r.push({type:"added",content:t,lineNumber:l+1}),l++):l>=a.length?(r.push({type:"removed",content:e,lineNumber:n+1}),n++):(e===t?r.push({type:"unchanged",content:e,lineNumber:n+1}):(r.push({type:"removed",content:e,lineNumber:n+1}),r.push({type:"added",content:t,lineNumber:l+1})),n++,l++)}return r})(t,s),u=e=>{switch(e){case"added":return"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500";case"removed":return"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500";default:return"bg-background"}},p=e=>{switch(e){case"added":return"text-green-800 dark:text-green-200";case"removed":return"text-red-800 dark:text-red-200";default:return"text-foreground"}},h=e=>{switch(e){case"added":return"+";case"removed":return"-";default:return" "}};return(0,a.jsxs)("div",{className:"bg-background border rounded-lg overflow-hidden ".concat(o),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-border bg-muted/30",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:n}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",l,")"]})]}),(0,a.jsxs)("button",{onClick:d,className:"inline-flex items-center px-2 py-1 text-xs bg-muted text-muted-foreground rounded-md hover:bg-muted/80 transition-colors",children:[i?(0,a.jsx)(es.Z,{className:"w-3 h-3 mr-1"}):(0,a.jsx)(ea.Z,{className:"w-3 h-3 mr-1"}),i?"Copied!":"Copy Diff"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"font-mono text-sm",children:m.map((e,t)=>(0,a.jsxs)("div",{className:"flex ".concat(u(e.type)),children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 px-2 py-1 text-center text-xs text-muted-foreground bg-muted/20",children:h(e.type)}),(0,a.jsx)("div",{className:"flex-1 px-3 py-1 ".concat(p(e.type)),children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap break-words",children:e.content||" "})})]},t))})}),(0,a.jsxs)("div",{className:"px-3 py-2 border-t border-border bg-muted/20 text-xs text-muted-foreground",children:[m.filter(e=>"added"===e.type).length," additions, "," ",m.filter(e=>"removed"===e.type).length," deletions"]})]})},en=s(71769),el=s(86574),eo=s(9880),ei=s(1479),ec=e=>{let{content:t,filename:s="untitled",fileSize:n,lines:l,encoding:o="utf-8",className:i=""}=e,[c,d]=(0,r.useState)("formatted"),[m,u]=(0,r.useState)(!1),{theme:p}=(0,L.F)(),h=(e=>{let t=e.toLowerCase().split(".").pop()||"";return({js:{type:"code",language:"javascript",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},jsx:{type:"code",language:"jsx",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},ts:{type:"code",language:"typescript",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},tsx:{type:"code",language:"tsx",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},py:{type:"code",language:"python",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},java:{type:"code",language:"java",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},cpp:{type:"code",language:"cpp",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},c:{type:"code",language:"c",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},cs:{type:"code",language:"csharp",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},php:{type:"code",language:"php",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},rb:{type:"code",language:"ruby",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},go:{type:"code",language:"go",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},rs:{type:"code",language:"rust",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},swift:{type:"code",language:"swift",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},kt:{type:"code",language:"kotlin",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},html:{type:"code",language:"markup",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},htm:{type:"code",language:"markup",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},css:{type:"code",language:"css",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},scss:{type:"code",language:"scss",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},sass:{type:"code",language:"sass",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},less:{type:"code",language:"less",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},json:{type:"code",language:"json",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},xml:{type:"code",language:"xml",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},yaml:{type:"code",language:"yaml",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},yml:{type:"code",language:"yaml",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},toml:{type:"code",language:"toml",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},csv:{type:"table",language:"csv",icon:(0,a.jsx)(O.Z,{className:"w-4 h-4"})},sh:{type:"code",language:"bash",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},bash:{type:"code",language:"bash",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},zsh:{type:"code",language:"bash",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},fish:{type:"code",language:"bash",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},ps1:{type:"code",language:"powershell",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},bat:{type:"code",language:"batch",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},cmd:{type:"code",language:"batch",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},md:{type:"markdown",language:"markdown",icon:(0,a.jsx)(en.Z,{className:"w-4 h-4"})},markdown:{type:"markdown",language:"markdown",icon:(0,a.jsx)(en.Z,{className:"w-4 h-4"})},txt:{type:"text",language:"text",icon:(0,a.jsx)(O.Z,{className:"w-4 h-4"})},log:{type:"text",language:"log",icon:(0,a.jsx)(O.Z,{className:"w-4 h-4"})},sql:{type:"code",language:"sql",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},dockerfile:{type:"code",language:"docker",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})},gitignore:{type:"text",language:"gitignore",icon:(0,a.jsx)(O.Z,{className:"w-4 h-4"})},env:{type:"text",language:"properties",icon:(0,a.jsx)(O.Z,{className:"w-4 h-4"})}})[t]||{type:"text",language:"text",icon:(0,a.jsx)(O.Z,{className:"w-4 h-4"})}})(s),f=async()=>{try{await navigator.clipboard.writeText(t),u(!0),setTimeout(()=>u(!1),2e3)}catch(e){console.error("Failed to copy:",e)}},x=e=>{let t=E.TU.parse(e,{gfm:!0,breaks:!0});return A.Z.sanitize(t)},g=e=>{let t=e.trim().split("\n");if(0===t.length)return(0,a.jsx)("div",{children:"Empty CSV file"});let s=t[0].split(",").map(e=>e.trim().replace(/"/g,"")),r=t.slice(1).map(e=>e.split(",").map(e=>e.trim().replace(/"/g,"")));return(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"min-w-full divide-y divide-border",children:[(0,a.jsx)("thead",{className:"bg-muted",children:(0,a.jsx)("tr",{children:s.map((e,t)=>(0,a.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-foreground uppercase tracking-wider",children:e},t))})}),(0,a.jsx)("tbody",{className:"bg-background divide-y divide-border",children:r.slice(0,100).map((e,t)=>(0,a.jsx)("tr",{children:e.map((e,t)=>(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-muted-foreground",children:e},t))},t))})]}),r.length>100&&(0,a.jsxs)("div",{className:"p-3 text-center text-sm text-muted-foreground bg-muted/50",children:["Showing first 100 rows of ",r.length," total rows"]})]})},y="markdown"===h.type||"table"===h.type||"code"===h.type;return(0,a.jsxs)("div",{className:"mt-4 border rounded-lg shadow-md bg-muted/40 overflow-hidden ".concat(i),children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 bg-background border-b border-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[h.icon,(0,a.jsx)("span",{className:"text-sm font-semibold text-foreground truncate",children:s})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground flex-wrap",children:[n&&(0,a.jsx)("span",{className:"px-2 py-1 bg-muted rounded-md whitespace-nowrap",children:n<1024?"".concat(n," B"):n<1048576?"".concat((n/1024).toFixed(1)," KB"):"".concat((n/1048576).toFixed(1)," MB")}),l&&(0,a.jsxs)("span",{className:"px-2 py-1 bg-muted rounded-md whitespace-nowrap",children:[l," lines"]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-muted rounded-md whitespace-nowrap",children:o}),(0,a.jsx)("span",{className:"px-2 py-1 bg-muted rounded-md whitespace-nowrap",children:h.language})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[y&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)("button",{onClick:()=>d("formatted"),className:"inline-flex items-center px-2 py-1 text-xs rounded-md transition-colors ".concat("formatted"===c?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[(0,a.jsx)(et.Z,{className:"w-3 h-3 mr-1"}),"Formatted"]}),(0,a.jsxs)("button",{onClick:()=>d("raw"),className:"inline-flex items-center px-2 py-1 text-xs rounded-md transition-colors ".concat("raw"===c?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[(0,a.jsx)(z.Z,{className:"w-3 h-3 mr-1"}),"Raw"]})]}),(0,a.jsxs)("button",{onClick:f,className:"inline-flex items-center px-2 py-1 text-xs bg-muted text-muted-foreground rounded-md hover:bg-muted/80 transition-colors",children:[m?(0,a.jsx)(es.Z,{className:"w-3 h-3 mr-1"}):(0,a.jsx)(ea.Z,{className:"w-3 h-3 mr-1"}),m?"Copied!":"Copy"]}),(0,a.jsxs)("button",{onClick:()=>{let e=new Blob([t],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},className:"inline-flex items-center px-2 py-1 text-xs bg-muted text-muted-foreground rounded-md hover:bg-muted/80 transition-colors",children:[(0,a.jsx)(K.Z,{className:"w-3 h-3 mr-1"}),"Download"]})]})]}),(0,a.jsx)("div",{className:"bg-background",children:y&&"formatted"===c?(()=>{switch(h.type){case"markdown":return(0,a.jsx)("div",{className:"prose dark:prose-invert max-w-none p-4",dangerouslySetInnerHTML:{__html:x(t)}});case"table":return(0,a.jsx)("div",{className:"p-4",children:g(t)});case"code":return(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(el.Z,{language:h.language,style:"dark"===p?eo.Z:ei.Z,customStyle:{margin:0,borderRadius:0,background:"transparent",fontSize:"0.875rem",lineHeight:"1.5"},showLineNumbers:!!(l&&l>10),wrapLines:!0,wrapLongLines:!0,children:t})});default:return(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap text-sm font-mono text-foreground overflow-x-auto",children:t})})}})():(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("pre",{className:"p-4 overflow-x-auto text-sm bg-muted/30 font-mono whitespace-pre-wrap",children:(0,a.jsx)("code",{children:t})})})})]})},ed=e=>{let{id:t,type:s,data:n,toolCall:l,onUpdate:o}=e,[i,c]=(0,r.useState)("preview"),[d,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null),[h,f]=(0,r.useState)(!1),{theme:x}=(0,L.F)();if("file_content"===s)return(0,a.jsx)(ec,{content:n.content,filename:n.filename,fileSize:n.fileSize,lines:n.lines,encoding:n.encoding});let g=r.useMemo(()=>{let e=[];return"web_app"===s?(e.push({key:"preview",label:"Preview",icon:(0,a.jsx)(et.Z,{className:"w-4 h-4"})}),e.push({key:"code",label:"Code",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})})):"code"===s?e.push({key:"code",label:"Code",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})}):"diff"===s&&(n.url&&e.push({key:"preview",label:"Preview",icon:(0,a.jsx)(et.Z,{className:"w-4 h-4"})}),e.push({key:"code",label:"Code",icon:(0,a.jsx)(z.Z,{className:"w-4 h-4"})}),e.push({key:"diff",label:"Diff",icon:(0,a.jsx)(O.Z,{className:"w-4 h-4"})})),e},[s,n]);(0,r.useEffect)(()=>{g.length>0&&!g.find(e=>e.key===i)&&c(g[0].key)},[g,i]);let y=async e=>{if(!u&&!h){f(!0);try{let t=await fetch(e);if(t.ok){let e=await t.text();p(e)}else p("// Failed to fetch HTML content")}catch(e){console.error("Failed to fetch HTML:",e),p("// Error fetching HTML content")}finally{f(!1)}}};(0,r.useEffect)(()=>{"web_app"!==s||"code"!==i||h||n.htmlContent||u||!n.url||y(n.url)},[i,s,u,h,n]);let w=async e=>{try{await navigator.clipboard.writeText(e),m(!0),setTimeout(()=>m(!1),2e3)}catch(e){console.error("Failed to copy:",e)}},b=e=>(0,a.jsx)("div",{className:"bg-background",children:(0,a.jsx)("iframe",{src:e.url,className:"w-full h-64 sm:h-80 md:h-96",title:"Web App Preview: ".concat(e.appName||"Untitled"),sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation-by-user-activation",loading:"lazy"})}),v=e=>(0,a.jsxs)("div",{className:"bg-background",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(z.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:e.filename||"".concat(e.language||"text"," code")})]}),(0,a.jsxs)("button",{onClick:()=>w(e.content),className:"inline-flex items-center px-2 py-1 text-xs bg-muted text-muted-foreground rounded-md hover:bg-muted/80 transition-colors",children:[d?(0,a.jsx)(es.Z,{className:"w-3 h-3 mr-1"}):(0,a.jsx)(ea.Z,{className:"w-3 h-3 mr-1"}),d?"Copied!":"Copy"]})]}),(0,a.jsx)("div",{className:"p-0",children:(0,a.jsx)("pre",{className:"p-4 overflow-x-auto text-sm bg-muted/30 font-mono",children:(0,a.jsx)("code",{children:e.content})})})]}),j=()=>{let e=n.htmlContent||u||"// No HTML content available";return!n.htmlContent&&h?(0,a.jsxs)("div",{className:"bg-background p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading HTML source..."})]}):(0,a.jsxs)("div",{className:"bg-background",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(z.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[n.appName||"Web App",".html"]})]}),(0,a.jsxs)("button",{onClick:()=>w(e),className:"inline-flex items-center px-2 py-1 text-xs bg-muted text-muted-foreground rounded-md hover:bg-muted/80 transition-colors",children:[d?(0,a.jsx)(es.Z,{className:"w-3 h-3 mr-1"}):(0,a.jsx)(ea.Z,{className:"w-3 h-3 mr-1"}),d?"Copied!":"Copy"]})]}),(0,a.jsx)("div",{className:"p-0",children:(0,a.jsx)("pre",{className:"p-4 overflow-x-auto text-sm bg-muted/30 font-mono",children:(0,a.jsx)("code",{children:e})})})]})},N=e=>e.original&&e.modified?(0,a.jsx)(er,{original:e.original,modified:e.modified,language:e.language||"text",filename:e.filename||"file",className:"w-full"}):(0,a.jsxs)("div",{className:"p-4 text-center text-muted-foreground",children:[(0,a.jsx)(O.Z,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No diff data available"})]}),k=()=>"web_app"===s?n.url:"diff"===s&&n.url||null;return(0,a.jsxs)("div",{className:"mt-4 border rounded-lg shadow-md bg-muted/40 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-background border-b border-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-foreground",children:"web_app"===s?n.appName||"Web Application":"code"===s?n.filename||"".concat(n.language||"Code"," Preview"):"diff"===s?n.url&&n.appName?"".concat(n.appName," (Edited)"):n.filename||"".concat(n.language||"Code"," Diff"):"Content Preview"}),g.length>1&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:g.map(e=>(0,a.jsxs)("button",{onClick:()=>c(e.key),className:"inline-flex items-center px-3 py-1 text-xs rounded-md transition-colors ".concat(i===e.key?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[e.icon,(0,a.jsx)("span",{className:"ml-1",children:e.label})]},e.key))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[k()&&(0,a.jsxs)("button",{onClick:()=>window.open(k(),"_blank"),className:"inline-flex items-center px-3 py-1 text-xs bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3 mr-1"}),"Open"]}),l&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:l.name})]})]}),(()=>{switch(i){case"preview":if("web_app"===s)return b(n);if("diff"===s&&n.url)return b({url:n.url,appName:n.appName,status:n.status||"success",message:n.message||"",backup_created:n.backup_created});break;case"code":if("web_app"===s)return j();if("code"===s)return v(n);if("diff"===s)return v({content:n.modified||"",language:n.language,filename:n.filename});break;case"diff":if("diff"===s)return N(n)}return(0,a.jsx)("div",{className:"p-4 text-center text-muted-foreground",children:(0,a.jsx)("p",{children:"Content not available for this tab"})})})()]})};let em=e=>{if(!["create_web_app","edit_web_app"].includes(e.name)||!e.result||e.is_error||e.is_partial)return null;try{let t=JSON.parse(e.result);if("success"===t.status&&t.url){let s="Web Application";try{s=JSON.parse(e.arguments).app_name||s}catch(e){console.warn("Failed to parse tool arguments for app name:",e)}let a=s.replace(/[^a-zA-Z0-9_-]/g,"_").toLowerCase();if("edit_web_app"===e.name&&t.original_html&&t.modified_html)return{id:"".concat(a,"_diff"),type:"diff",data:{original:t.original_html,modified:t.modified_html,filename:"".concat(s,".html"),language:"html",url:t.url,appName:s,status:t.status,message:t.message,backup_created:t.backup_created},shouldShow:!0};return{id:a,type:"web_app",data:{url:t.url,appName:s,status:t.status,message:t.message,backup_created:t.backup_created,htmlContent:t.html_content},shouldShow:!0}}}catch(e){console.warn("Failed to parse web app tool result:",e)}return null},eu=e=>{if("edit_mcp_server"!==e.name||!e.result||e.is_error||e.is_partial)return null;try{let t=JSON.parse(e.result);if(t.original_code&&t.modified_code){let e=t.server_name||"unknown_server";return{id:"mcp_server_".concat(e),type:"diff",data:{original:t.original_code,modified:t.modified_code,filename:"".concat(e,".py"),language:"python",serverName:e,status:t.status,message:t.message,changesApplied:t.changes_applied,reloadResult:t.reload_result},shouldShow:!0}}}catch(e){console.warn("Failed to parse edit_mcp_server tool result:",e)}return null},ep=e=>{if("read_file_content"!==e.name||!e.result||e.is_error||e.is_partial)return null;try{let t=JSON.parse(e.result);if("success"===t.status&&t.content){let s="unknown_file";try{s=JSON.parse(e.arguments).file_path||s}catch(e){console.warn("Failed to parse tool arguments for file path:",e)}return{id:"file_".concat(s.replace(/[^a-zA-Z0-9_-]/g,"_")),type:"file_content",data:{content:t.content,filename:s.split("/").pop()||s,fullPath:s,fileSize:t.size,lines:t.lines,encoding:t.encoding||"utf-8",absolutePath:t.absolute_path},shouldShow:!0}}}catch(e){console.warn("Failed to parse read_file_content tool result:",e)}return null},eh=e=>null,ef=e=>{for(let t of[em,eu,ep,eh]){let s=t(e);if(s)return s}return null},ex=e=>{let t=["create_web_app","edit_web_app","edit_mcp_server","read_file_content"].includes(e.name),s=!e.is_error,a=!e.is_partial,r="Completed"===e.status;return console.log("[shouldExtractPreview] Tool: ".concat(e.name,", Valid: ").concat(t,", No errors: ").concat(s,", Not partial: ").concat(a,", Valid status: ").concat(r," (actual: ").concat(e.status,")")),t&&s&&a&&r};var eg=s(26110),ey=s(12339),ew=s(35974),eb=s(66070);let ev=(0,s(90535).j)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ej=r.forwardRef((e,t)=>{let{className:s,variant:r,...n}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,m.cn)(ev({variant:r}),s),...n})});ej.displayName="Alert";let eN=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h5",{ref:t,className:(0,m.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})});eN.displayName="AlertTitle";let e_=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,m.cn)("text-sm [&_p]:leading-relaxed",s),...r})});e_.displayName="AlertDescription";var ek=s(71947),eS=s(64935),eC=s(2207),eT=s(18930),eE=s(31047),eA=s(65621),eP=s(32489),eZ=s(82431),eD=s(49322),eF=s(53136),ez=s(99397),eO=s(13781),eR=s(42488),eL=s(64972),eM=s(44743),eU=s(21468),eJ=s.n(eU),eB=s(84190);function eG(e){let{value:t,language:s="html",height:n="400px",readOnly:l=!0,minimap:o=!1,className:i=""}=e,{theme:c}=(0,L.F)(),d=(0,r.useRef)(null),[m,u]=(0,r.useState)(n);return(0,r.useEffect)(()=>{if("100%"===n&&d.current){let e=()=>{let e=d.current;if(e){let t=e.getBoundingClientRect();t.height>0&&u("".concat(t.height,"px"))}};e();let t=new ResizeObserver(e);return t.observe(d.current),()=>{t.disconnect()}}u(n)},[n]),(0,a.jsx)("div",{ref:d,className:"overflow-hidden ".concat(i),style:{height:"100%"===n?"100%":n},children:(0,a.jsx)(R.ZP,{height:m,language:s,value:t,theme:"dark"===c?"vs-dark":"light",options:{readOnly:l,minimap:{enabled:o},scrollBeyondLastLine:!1,wordWrap:"on",automaticLayout:!0,fontSize:13,lineNumbers:"on",renderWhitespace:"selection",folding:!0,lineDecorationsWidth:0,lineNumbersMinChars:3,glyphMargin:!1,contextmenu:!1,selectOnLineNumbers:!0,roundedSelection:!1,cursorStyle:"line",smoothScrolling:!0,scrollbar:{verticalScrollbarSize:8,horizontalScrollbarSize:8}},loading:(0,a.jsx)("div",{className:"flex items-center justify-center h-full bg-background",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Loading editor..."})})})})}var eI=s(40257);E.TU.setOptions({breaks:!0,gfm:!0,async:!1});let eX=e=>{let{content:t,className:s=""}=e;return(0,a.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert prose-pre:bg-muted prose-pre:border prose-code:bg-muted prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm ".concat(s),dangerouslySetInnerHTML:(e=>{try{let t=E.TU.parse(e,{async:!1});return{__html:A.Z.sanitize(t)}}catch(e){return console.error("Error rendering markdown:",e),{__html:"<pre>".concat(t,"</pre>")}}})(t)})},eV=eI.env.NEXT_PUBLIC_BACKEND_API_URL||"http://localhost:5001";function eW(e){let{artifacts:t,type:s,emptyTitle:r,emptyDescription:n,emptyHint:o,onSelect:c,onDelete:d,deletingApp:m,formatDate:u}=e,p=()=>{switch(s){case"pdf_document":return"Download PDF";case"mcp_server":return"View Info";default:return"Open"}};return 0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(()=>{switch(s){case"web_app":return(0,a.jsx)(_.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"});case"pdf_document":default:return(0,a.jsx)(ek.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"});case"mcp_server":return(0,a.jsx)(eS.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"})}})(),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:r}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:n}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:o})]}):(0,a.jsx)(i.x,{className:"h-full",children:(0,a.jsx)("div",{className:"grid gap-4 sm:gap-6",children:t.map(e=>(0,a.jsxs)(eb.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow border-2 hover:border-primary/50",onClick:()=>c(e),children:[(0,a.jsx)(eb.Ol,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eb.ll,{className:"text-base sm:text-lg truncate",children:e.name.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),(0,a.jsxs)(ew.C,{variant:"outline",className:"text-xs",children:["v",e.current_version]}),(0,a.jsx)(ew.C,{variant:"secondary",className:"text-xs",children:"web_app"===s?"App":"pdf_document"===s?"PDF":"MCP"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["mcp_server"!==s&&(0,a.jsx)(l.z,{variant:"ghost",size:"sm",asChild:!0,onClick:e=>e.stopPropagation(),className:"gap-1",children:(0,a.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:p()})]})}),(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),c(e)},className:"gap-1",children:[(0,a.jsx)(eC.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]}),(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:t=>d(e.name,e.type,t),disabled:m===e.name,className:"gap-1 text-red-600 hover:text-red-700 border-red-200 hover:border-red-300 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:border-red-800 dark:hover:border-red-700 dark:hover:bg-red-950",children:[m===e.name?(0,a.jsx)(j.Z,{className:"w-3 h-3 animate-spin"}):(0,a.jsx)(eT.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:m===e.name?"Deleting...":"Delete"})]})]})]})}),(0,a.jsxs)(eb.aY,{className:"pt-0",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description||"No description available"}),e.latest_commit_summary&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mb-3 bg-muted/50 p-2 rounded italic",children:["Latest: ",e.latest_commit_summary]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(eE.Z,{className:"w-3 h-3"}),u(e.last_updated)]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(eA.Z,{className:"w-3 h-3"}),e.total_versions," version",1!==e.total_versions?"s":""]}),e.line_count&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(ek.Z,{className:"w-3 h-3"}),e.line_count," lines"]}),e.size&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(K.Z,{className:"w-3 h-3"}),(e.size/1024).toFixed(1),"KB"]}),e.pdf_size&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(K.Z,{className:"w-3 h-3"}),(e.pdf_size/1024).toFixed(1),"KB PDF"]})]})]})]},e.name))})})}function eH(e){let{artifactType:t,artifactName:s,artifactUrl:n,userNumber:o="+17145986105",trigger:c,open:d,onOpenChange:m,createMode:x=!1,onAppCreated:g}=e,[y,b]=(0,r.useState)(x?"editor":"preview"),[v,S]=(0,r.useState)(null),[C,T]=(0,r.useState)(""),[E,A]=(0,r.useState)(!1),[Z,z]=(0,r.useState)(null),[O,R]=(0,r.useState)({}),[L,M]=(0,r.useState)(""),[U,J]=(0,r.useState)(!1),[B,G]=(0,r.useState)("idle"),[I,X]=(0,r.useState)([]),[V,W]=(0,r.useState)(""),[H,Y]=(0,r.useState)([]),[q,K]=(0,r.useState)(""),[$,Q]=(0,r.useState)(null),[ee,er]=(0,r.useState)(null),[en,el]=(0,r.useState)(null),[eo,ei]=(0,r.useState)(!1),[ec,ed]=(0,r.useState)(!1),[em,eu]=(0,r.useState)("web_app"),[ep,eh]=(0,r.useState)(null),[ef,ex]=(0,r.useState)(null),[ev,eT]=(0,r.useState)([]),[eI,eW]=(0,r.useState)([]),[eH,eY]=(0,r.useState)(!1),[eq,eK]=(0,r.useState)(null),e$=r.useRef(null),[eQ,e0]=(0,r.useState)(!1),[e1,e4]=(0,r.useState)(""),[e2,e3]=(0,r.useState)(!1),[e5,e8]=(0,r.useState)([]),[e9,e6]=(0,r.useState)([]),[e7,te]=(0,r.useState)(!1),[tt,ts]=(0,r.useState)(null);(0,r.useEffect)(()=>{d&&(ts((0,P.Z)().substring(0,12)),x?d&&x&&tr(!0):(er(null),tn(),tr()))},[d,s,t,x,o]),(0,r.useEffect)(()=>{I.length>0&&setTimeout(()=>{let e=document.querySelector("[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)},100)},[I]),(0,r.useEffect)(()=>{if(eQ&&L.trim()&&!x){let e=setTimeout(()=>{tg()},500);return()=>clearTimeout(e)}},[L,eQ,x,null==v?void 0:v.current_version]);let ta=()=>{G("idle"),W(""),z(null)},tr=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(o){te(!0);try{let a=await fetch("".concat(eV,"/users/").concat(o.replace("+",""),"/tools"));if(a.ok){let r=await a.json();if(r&&Array.isArray(r.tools)){let a=r.tools.map(e=>({name:e.name,description:e.description||""}));if(e8(a),x&&e)e6(a.map(e=>e.name));else if(!x){let r="artifactEditorToolSelection_".concat(t,"_").concat(s),n=localStorage.getItem(r);n?e6(JSON.parse(n)):e?e6(a.map(e=>e.name)):e6([])}}}else console.warn("Failed to fetch tools list for ArtifactEditor"),e8([]),e6([])}catch(e){console.warn("Error fetching tools list for ArtifactEditor:",e),e8([]),e6([])}finally{te(!1)}}};(0,r.useEffect)(()=>{if(d&&!x&&s&&t){let e="artifactEditorToolSelection_".concat(t,"_").concat(s);localStorage.setItem(e,JSON.stringify(e9))}},[e9,d,x,s,t]);let tn=async()=>{A(!0),z(null);try{let e,a;"pdf_document"===t?(e="get_pdf_versions",a="doc_name"):"mcp_server"===t?(e="get_mcp_server_versions",a="server_name"):(e="get_app_versions",a="app_name");let r=await fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:e,arguments:{user_number:o,[a]:s}})});if(!r.ok)throw Error("Failed to load metadata: ".concat(r.status));let l=await r.json();if(l.error)throw Error(l.error);let i="string"==typeof l.result?JSON.parse(l.result):l.result;"success"===i.status&&S(i);let c=!1;if(i.current_version&&("web_app"===t||"pdf_document"===t||"mcp_server"===t))try{let e="",a="";"pdf_document"===t?(e="view_pdf_version",a="doc_name"):"mcp_server"===t?(e="view_mcp_server_version",a="server_name"):(e="view_web_app_version",a="app_name"),console.log("[ArtifactEditor] Loading source code via backend tool:",e,"for version:",i.current_version);let r=await fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:e,arguments:{user_number:o,[a]:s,version_number:i.current_version,include_content:!0}})});if(r.ok){let e=await r.json();if(!e.error){let s="string"==typeof e.result?JSON.parse(e.result):e.result,a="mcp_server"===t?s.python_code:s.html_content||s.content;"success"===s.status&&a&&(T(a),console.log("[ArtifactEditor] Loaded source code via backend tool, length:",a.length,"for version:",i.current_version),c=!0)}}}catch(e){console.warn("[ArtifactEditor] Failed to load source code via backend tool:",e)}if(!c&&("web_app"===t||"pdf_document"===t))try{let e=n;"pdf_document"===t&&(e=n.replace("current.pdf","current.html"));let s="?t=".concat(Date.now());e+=s,console.log("[ArtifactEditor] Fallback: Loading source code from URL:",e);let a=await fetch(e);if(a.ok){let e=await a.text();T(e),console.log("[ArtifactEditor] Fallback: Loaded source code, length:",e.length,"for version:",i.current_version)}else console.warn("Failed to fetch source code via URL:",a.status)}catch(e){console.warn("Could not load source code via URL:",e)}}catch(e){z(e instanceof Error?e.message:"Failed to load artifact data")}finally{A(!1)}},tl=async(e,t)=>{try{await navigator.clipboard.writeText(e),R(e=>({...e,[t]:!0})),setTimeout(()=>{R(e=>({...e,[t]:!1}))},2e3)}catch(e){console.error("Failed to copy:",e)}},to=e=>{try{return new Date(e).toLocaleString()}catch(t){return e}},ti=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},tc=async e=>{if(e.target.files){let t=Array.from(e.target.files);eT(e=>[...e,...t]),e.target.value=""}},td=async e=>Promise.all(e.map(async e=>{let t=new FormData;t.append("file",e);try{let e=await fetch("".concat(eV,"/upload"),{method:"POST",body:t});if(!e.ok)throw Error("Upload failed: ".concat(e.status));return(await e.json()).url}catch(t){throw console.error("Failed to upload ".concat(e.name,":"),t),t}})),tm=async()=>{if(0!==ev.length){eY(!0),eK(null);try{console.log("[ArtifactEditor] Uploading files:",ev.map(e=>e.name));let e=await td(ev);console.log("[ArtifactEditor] Files uploaded successfully:",e),eW(t=>[...t,...e]),eT([])}catch(e){console.error("[ArtifactEditor] File upload failed:",e),eK(e instanceof Error?e.message:"Upload failed")}finally{eY(!1)}}},tu=async()=>{if(!L.trim()||U)return;if(J(!0),X(e=>[...e,{id:(0,P.Z)(),output:"\uD83D\uDC64 **You:**\n".concat(L),lastChunkType:"user_prompt"}]),ev.length>0)try{await tm()}catch(e){console.error("[ArtifactEditor] Failed to upload files before edit:",e),J(!1);return}if(!x){let e=await tf();T(e),K(e),console.log("[ArtifactEditor] Before edit content captured, length:",e.length,"- This is the version AI will edit"),e&&console.log("[ArtifactEditor] Content preview:",e.substring(0,200)+"...")}ta(),G("pending");let e=tx(L,q||C||""),a=null;if(tt){let e=x?"new_artifact_".concat(t):s;a="".concat(o,"-").concat(t,"-").concat(e,"-").concat(tt)}console.log("[ArtifactEditor] Starting ".concat(x?"create":"edit"," request:"),L),console.log("[ArtifactEditor] ✅ Using SHARED query building logic - identical to preview"),console.log("[ArtifactEditor] Query length:",e.length,"characters"),console.log("[ArtifactEditor] Attachment URLs:",eI);try{let s=await fetch("".concat(eV,"/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sender:o,query:e,timestamp:Date.now(),stream:!0,attachment_urls:eI.length>0?eI:void 0,system_prompt:"pdf_document"===t?"pdf_document":"mcp_server"===t?"mcp_server":"artifact_editor",allowed_tools:e9.length>0?e9:void 0,conversation_id:a})});if(console.log("[ArtifactEditor] Response received:",s.status,s.ok),!s.ok){let e=await s.text(),t="HTTP error! status: ".concat(s.status);try{let s=JSON.parse(e);t=s.error||s.detail||t}catch(s){e&&(t+=" - ".concat(e))}throw Error(t)}if(!s.body)throw Error("Response body is null");console.log("[ArtifactEditor] Starting to read stream...");let r=s.body.getReader(),n=new TextDecoder,l="",i=0;for(;;){let e;let{done:t,value:s}=await r.read();if(t){if(console.log("[ArtifactEditor] Stream finished. Total chunks processed:",i),""!==l.trim()){console.log("[ArtifactEditor] Processing final buffer:",l.substring(0,100));try{let e=JSON.parse(l);tp(e),i++}catch(e){console.error("[ArtifactEditor] Error parsing final stream chunk:",e,"Buffer:",l.substring(0,200))}}break}for(l+=n.decode(s,{stream:!0});(e=l.indexOf("\n"))>=0;){let t=l.substring(0,e);if(l=l.substring(e+1),""!==t.trim()){console.log("[ArtifactEditor] Processing line:",t.substring(0,100)+"...");try{let e=JSON.parse(t);console.log("[ArtifactEditor] Parsed chunk:",e.type,e),tp(e),i++}catch(e){console.error("[ArtifactEditor] Error parsing stream chunk:",e,"Line:",t.substring(0,200))}}}}console.log("[ArtifactEditor] Stream processing completed"),M(""),x&&ef&&"completed"===B&&"mcp_server"!==t?(console.log("[ArtifactEditor] Transitioning from create mode to edit mode for non-MCP artifact:",ef),setTimeout(async()=>{try{m&&(m(!1),setTimeout(()=>{},500))}catch(e){}},1e3)):x&&"mcp_server"===t&&"completed"===B&&console.log("[ArtifactEditor] MCP Server creation completed in createMode. Dialog remains open for agent iteration.")}catch(e){console.error("[ArtifactEditor] Error editing artifact:",e),z(e instanceof Error?e.message:"Failed to edit artifact"),G("error")}finally{J(!1)}},tp=e=>{if(console.log("[ArtifactEditor] Processing chunk:",e.type,e),"text_chunk"===e.type&&e.content)console.log("[ArtifactEditor] Text chunk:",e.content.substring(0,100)),th(e.content,"output","text_chunk");else if("tool_sample_text_chunk"===e.type&&e.content)console.log("[ArtifactEditor] Tool sample text chunk:",e.content.substring(0,100)),th(e.content,"output","tool_sample_text_chunk");else if("tool_sample_thought_chunk"===e.type&&e.content)console.log("[ArtifactEditor] Tool sample thought chunk:",e.content.substring(0,100)),th(e.content,"thoughts","tool_sample_thought_chunk");else if("thought_summary"===e.type&&e.content)console.log("[ArtifactEditor] Thought summary:",e.content.substring(0,100)),th(e.content,"thoughts","thought_summary");else if("tool_call_pending"===e.type&&e.name)console.log("[ArtifactEditor] Tool call pending:",e.name),W(e.name),X(t=>[...t,{id:(0,P.Z)(),output:"\uD83D\uDD27 Calling tool: ".concat(e.name).concat(e.arguments?"\nArguments: ".concat(JSON.stringify(e.arguments,null,2)):""),lastChunkType:"tool_call_pending"}]);else if("tool_result"===e.type&&e.call_id){console.log("[ArtifactEditor] Tool result:",e.name,typeof e.result),W("");let s="",a=!1,r=e.name||(e.tool_call?e.tool_call.name:null);if(r&&("create_web_app"===r||"edit_web_app"===r||"create_pdf_document"===r||"edit_pdf_document"===r||"create_mcp_server"===r||"edit_mcp_server"===r))try{let n="string"==typeof e.result?JSON.parse(e.result):e.result;if("success"===n.status){G("completed"),a=!0,s="✅ ".concat("create_pdf_document"===r||"edit_pdf_document"===r?"PDF document":"create_mcp_server"===r||"edit_mcp_server"===r?"MCP Server":"Web app"," ").concat(x?"created":"edited"," successfully!\n\n\uD83D\uDCDD ").concat(n.commit_summary||"No commit summary"),n.url&&(s+="\n\uD83D\uDD17 URL: ".concat(n.url)),n.pdf_url&&(s+="\n\uD83D\uDCC4 PDF: ".concat(n.pdf_url)),n.html_url&&(s+="\n\uD83C\uDF10 HTML: ".concat(n.html_url)),n.search_replace_results&&(s+="\n\nSearch/Replace Results:\n- Total blocks: ".concat(n.search_replace_results.total_blocks,"\n- Successful: ").concat(n.search_replace_results.successful,"\n- Failed: ").concat(n.search_replace_results.failed));let e=n.app_name||n.doc_name||n.server_name,l=n.url||n.pdf_url||n.server_url;x&&e&&l&&(console.log("[ArtifactEditor] Capturing created artifact details:",e,l),ex({name:e,url:l})),x&&e&&l&&g&&"mcp_server"!==t?(console.log("[ArtifactEditor] Calling onAppCreated for non-MCP artifact:",e,l),setTimeout(()=>{g(e,l)},1500)):x&&"mcp_server"===t&&console.log("[ArtifactEditor] MCP Server created in createMode. Deferring onAppCreated/dialog close for agent iteration."),x||setTimeout(async()=>{try{let e=n.version_number,s="";if(e)s=await tw(e);else if(l&&("web_app"===t||"pdf_document"===t)){let e=l;"pdf_document"===t&&(e=e.replace(/current\.pdf(\?.*)?$/,"current.html"));let a=await fetch("".concat(e,"?t=").concat(Date.now()));a.ok&&(s=await a.text())}if(s&&q!==s&&q.length>0){let e={id:(0,P.Z)(),timestamp:new Date().toISOString(),before:q,after:s,commit_summary:n.commit_summary||"Code updated",search_replace_results:n.search_replace_results};Y(t=>[...t,e]),T(s)}}catch(e){console.error("[ArtifactEditor] Failed to capture diff:",e)}},1e3)}else G("error"),z(n.message||"Unknown error"),s="❌ ".concat(x?"Creation":"Edit"," failed: ").concat(n.message||"Unknown error")}catch(t){s="✅ Tool completed: ".concat(e.name)}else{let t="string"==typeof e.result?e.result:JSON.stringify(e.result,null,2);s="✅ Tool: ".concat(e.name||"Unknown","\n\nResult:\n").concat(t.substring(0,1e3)).concat(t.length>1e3?"...":"")}X(e=>[...e,{id:(0,P.Z)(),output:s,lastChunkType:"tool_result"}]),a&&(console.log("[ArtifactEditor] Switching to preview after successful tool result"),x||"create_mcp_server"===r||"edit_mcp_server"===r?"create_mcp_server"===r||"edit_mcp_server"===r?console.log("[ArtifactEditor] MCP Server operation: Tab switch and auto-reload deferred for agent iteration."):x&&("create_web_app"===r||"create_pdf_document"===r)&&(b("preview"),setTimeout(()=>{tn()},500)):setTimeout(()=>{tn()},500))}else"stream_end"===e.type?(console.log("[ArtifactEditor] Stream end"),"pending"===B&&G("completed")):"error"===e.type?(console.log("[ArtifactEditor] Error chunk:",e.content),G("error"),z(e.content),X(t=>[...t,{id:(0,P.Z)(),output:"❌ Error: ".concat(e.content),lastChunkType:"error"}])):console.log("[ArtifactEditor] Unknown chunk type:",e.type,e)},th=(e,t,s)=>{X(a=>{let r=a[a.length-1];return r&&r.lastChunkType===s&&"user_prompt"!==r.lastChunkType?a.map((s,r)=>r===a.length-1?{...s,[t]:(s[t]||"")+e}:s):[...a,{id:(0,P.Z)(),[t]:e,lastChunkType:s}]})},tf=async()=>{let e="";if(v&&v.current_version)try{let a="pdf_document"===t?"view_pdf_version":"view_web_app_version",r="pdf_document"===t?"doc_name":"app_name";console.log("[ArtifactEditor] Fetching current version content via backend tool:",a,"version:",v.current_version);let n=await fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:a,arguments:{user_number:o,[r]:s,version_number:v.current_version,include_content:!0}})});if(n.ok){let t=await n.json();if(!t.error){let s="string"==typeof t.result?JSON.parse(t.result):t.result,a=s.html_content||s.content;"success"===s.status&&a&&(e=a,console.log("[ArtifactEditor] Successfully loaded version-specific content via backend tool, length:",e.length))}}}catch(e){console.warn("[ArtifactEditor] Failed to load content via backend tool:",e)}if(!e)try{let s=n;"pdf_document"===t&&(s=n.replace("current.pdf","current.html"));let a="?t=".concat(Date.now());s+=a,console.log("[ArtifactEditor] Fallback: Loading fresh current content before edit from:",s);let r=await fetch(s);if(r.ok)e=await r.text(),console.log("[ArtifactEditor] Fallback: Loaded fresh content, length:",e.length,"for current version:",null==v?void 0:v.current_version);else throw Error("Failed to fetch content: ".concat(r.status))}catch(t){console.warn("[ArtifactEditor] Failed to load current content via URL:",t),e=q||C||""}return e},tx=(e,a)=>{let r=e;if(!x&&a&&v){var n,l,o,i;let c=(null===(n=v.versions)||void 0===n?void 0:n.slice(-3))||[],d=c.length>0?c.map(e=>"  v".concat(e.version,": ").concat(e.commit_summary)).join("\n"):"  (No previous versions)";r="pdf_document"===t?"Context: I'm editing the PDF document \"".concat(s,'".\n\nDocument Info:\n- Current Version: ').concat(v.current_version,"\n- Total Versions: ").concat((null===(l=v.versions)||void 0===l?void 0:l.length)||0,"\n- Last Updated: ").concat(v.last_updated?new Date(v.last_updated).toLocaleDateString():"Unknown","\n\nRecent Changes:\n").concat(d,"\n\nCurrent HTML Content (will be converted to PDF):\n```html\n").concat(a,"\n```\n\nUser Request: ").concat(e):"mcp_server"===t?"Context: I'm editing the MCP Server \"".concat(s,'".\n\nServer Info:\n- Current Version: ').concat(v.current_version,"\n- Total Versions: ").concat((null===(o=v.versions)||void 0===o?void 0:o.length)||0,"\n- Last Updated: ").concat(v.last_updated?new Date(v.last_updated).toLocaleDateString():"Unknown","\n\nRecent Changes:\n").concat(d,"\n\nCurrent Python Code:\n```python\n").concat(a,"\n```\n\nUser Request: ").concat(e):"Context: I'm editing the web app \"".concat(s,'".\n\nApp Info:\n- Current Version: ').concat(v.current_version,"\n- Total Versions: ").concat((null===(i=v.versions)||void 0===i?void 0:i.length)||0,"\n- Last Updated: ").concat(v.last_updated?new Date(v.last_updated).toLocaleDateString():"Unknown","\n\nRecent Changes:\n").concat(d,"\n\nCurrent HTML Content:\n```html\n").concat(a,"\n```\n\nUser Request: ").concat(e)}return eI.length>0&&(r+="\n\nI've attached ".concat(eI.length," file").concat(eI.length>1?"s":""," as visual references that may be helpful.")),r},tg=async()=>{if(x||!L.trim()){e4("No content preview available in create mode or with empty prompt.");return}e3(!0);try{let e=await tf(),t=tx(L,e);e4(t),e&&(console.log("[ArtifactEditor] Preview content loaded, length:",e.length),console.log("[ArtifactEditor] Preview content sample:",e.substring(0,200)+"..."),console.log("[ArtifactEditor] ✅ Preview using SHARED functions - guaranteed identical to submission"),console.log("[ArtifactEditor] Preview query length:",t.length,"characters"))}catch(e){console.error("[ArtifactEditor] Failed to generate query preview:",e),e4("Error generating preview: "+(e instanceof Error?e.message:"Unknown error"))}finally{e3(!1)}},ty=async e=>{if(!$&&v&&e!==v.current_version){Q(e),er(null);try{let a,r;"mcp_server"===t?(a="switch_mcp_server_version",r="server_name"):"pdf_document"===t?(a="switch_web_app_version",r="doc_name"):(a="switch_web_app_version",r="app_name");let n=await fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:a,arguments:{[r]:s,target_version:e,user_number:o}})});if(!n.ok)throw Error("Failed to switch version: ".concat(n.status));let l=await n.json();if(l.error)throw Error(l.error);let i="string"==typeof l.result?JSON.parse(l.result):l.result;if("success"===i.status)await new Promise(e=>setTimeout(e,500)),await tn(),b("preview"),er(null),console.log("[ArtifactEditor] Successfully switched to version",e,"- sourceCode updated by loadArtifactData");else throw Error(i.message||"Failed to switch version")}catch(e){console.error("Version switch failed:",e),er(e instanceof Error?e.message:"Failed to switch version")}finally{Q(null)}}},tw=async e=>{try{let a,r,n;"mcp_server"===t?(a="view_mcp_server_version",r="server_name",n="python_code"):("pdf_document"===t?(a="view_pdf_version",r="doc_name"):(a="view_web_app_version",r="app_name"),n="html_content");let l=await fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:a,arguments:{user_number:o,[r]:s,version_number:e,include_content:!0}})});if(!l.ok)throw Error("Failed to fetch version ".concat(e,": ").concat(l.status));let i=await l.json();if(i.error)throw Error(i.error);let c="string"==typeof i.result?JSON.parse(i.result):i.result;if("success"===c.status&&c[n])return c[n];throw Error("Failed to get version content")}catch(t){throw console.error("Error fetching version ".concat(e,":"),t),t}},tb=async(e,t)=>{el({version1:e,version2:t,content1:"",content2:"",loading:!0});try{let[s,a]=await Promise.all([tw(e),tw(t)]);el({version1:e,version2:t,content1:s,content2:a,loading:!1})}catch(e){console.error("Error comparing versions:",e),el(null),er(e instanceof Error?e.message:"Failed to compare versions")}},tv=async(e,a)=>{ei(!0);try{let r,n,l,i,c;let d=a||"".concat(s,"_copy"),u=new Date().toISOString().split("T")[0].replace(/-/g,""),p="".concat(d,"_").concat(u);"mcp_server"===t?(r="clone_mcp_server",n="source_server_name",l="new_server_name"):(r="clone_web_app",n="source_app_name",l="new_app_name"),i="source_version",c="description_override";let h=await fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:r,arguments:{[n]:s,[l]:p,user_number:o,[i]:e,[c]:e?"Clone of ".concat(s," v").concat(e," - Created from artifact editor"):"Clone of ".concat(s," (current) - Created from artifact editor")}})});if(!h.ok)throw Error("Failed to clone app: ".concat(h.status));let f=await h.json();if(f.error)throw Error(f.error);let x="string"==typeof f.result?JSON.parse(f.result):f.result;if("success"===x.status)window.confirm('New web app "'.concat(p,'" cloned successfully!\n\nWould you like to open it in a new tab?'))&&x.url&&window.open(x.url,"_blank"),window.confirm('Would you like to edit the new app "'.concat(p,'"?'))&&m&&m(!1);else throw Error(x.message||"Failed to clone web app")}catch(e){console.error("Error cloning web app:",e),er(e instanceof Error?e.message:"Failed to clone web app")}finally{ei(!1)}};return l.z,eC.Z,(0,a.jsxs)(eg.Vq,{open:d,onOpenChange:e=>{console.log("[ArtifactEditor] Dialog onOpenChange called with:",e),m&&m(e)},children:[c&&(0,a.jsx)(eg.hg,{asChild:!0,children:c}),(0,a.jsxs)(eg.cZ,{className:"max-w-7xl h-[85vh] sm:h-[90vh] sm:max-w-7xl w-full max-h-[85vh] sm:max-h-[90vh] flex flex-col overflow-hidden p-0 sm:p-0 my-2 sm:my-auto [&>button]:hidden",onEscapeKeyDown:e=>{console.log("[ArtifactEditor] Escape key pressed"),m&&m(!1)},onPointerDownOutside:e=>{console.log("[ArtifactEditor] Clicked outside dialog"),m&&m(!1)},children:[(0,a.jsx)(eg.fK,{className:"px-2 pt-1 pb-0 sm:px-3 sm:pt-1 sm:pb-0 border-b flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(eg.$N,{className:"flex items-center gap-1 text-sm flex-1 min-w-0",children:[(0,a.jsx)(eC.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"truncate text-xs sm:text-sm",children:x?"Create New ".concat("pdf_document"===t?"PDF Document":"mcp_server"===t?"MCP Server":"Web App"):s}),!x&&v&&(0,a.jsxs)(ew.C,{variant:"outline",className:"text-xs h-4 px-1",children:["v",v.current_version]})]}),(0,a.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("[ArtifactEditor] Mobile close button clicked"),m&&m(!1)},className:"flex items-center justify-center w-6 h-6 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors touch-manipulation",style:{WebkitTapHighlightColor:"transparent"},"aria-label":"Close dialog",children:(0,a.jsx)(eP.Z,{className:"w-3 h-3 text-gray-500 dark:text-gray-400"})})]})}),E?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(j.Z,{className:"w-8 h-8 animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading artifact data..."})]})}):Z&&!U?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-destructive mb-4",children:Z}),(0,a.jsxs)(l.z,{onClick:tn,variant:"outline",className:"gap-2",children:[(0,a.jsx)(eZ.Z,{className:"w-4 h-4"}),"Retry"]})]})}):(0,a.jsxs)(ey.mQ,{value:y,onValueChange:b,className:"flex-1 flex flex-col min-h-0",children:[(0,a.jsxs)(ey.dr,{className:"grid w-full grid-cols-4 flex-shrink-0 h-6 p-0 mx-0 border-t-0 rounded-t-none -mt-px",children:[(0,a.jsxs)(ey.SP,{value:"preview",className:"gap-0.5 text-xs px-0.5 py-0.5 h-6 rounded-t-none",children:[(0,a.jsx)(et.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-0.5",children:"Preview"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Prev"})]}),(0,a.jsxs)(ey.SP,{value:"code",className:"gap-0.5 text-xs px-0.5 py-0.5 h-6 rounded-t-none",children:[(0,a.jsx)(eS.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-0.5",children:"Code"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Code"})]}),(0,a.jsxs)(ey.SP,{value:"versions",className:"gap-0.5 text-xs px-0.5 py-0.5 h-6 rounded-t-none",children:[(0,a.jsx)(eA.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-0.5",children:"History"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Hist"})]}),(0,a.jsxs)(ey.SP,{value:"editor",className:"gap-0.5 text-xs px-0.5 py-0.5 h-6 rounded-t-none",children:[(0,a.jsx)(eC.Z,{className:"w-3 h-3"}),(0,a.jsxs)("span",{className:"flex items-center gap-0.5",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Chat"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Chat"}),U&&(()=>{switch(B){case"completed":return(0,a.jsx)(D.Z,{className:"w-4 h-4 text-green-500"});case"error":return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-red-500"});case"pending":return(0,a.jsx)(j.Z,{className:"w-4 h-4 animate-spin text-blue-500"});default:return null}})()]})]})]}),(0,a.jsxs)("div",{className:"flex-1 min-h-0 overflow-hidden px-1 sm:px-2 pb-1 sm:pb-2 pt-0",children:[(0,a.jsx)(ey.nU,{value:"preview",className:"h-full m-0",children:(0,a.jsxs)(eb.Zb,{className:"h-full",children:[(0,a.jsx)(eb.Ol,{className:"pb-3 px-4 pt-3 sm:px-6 sm:pt-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(eb.ll,{className:"text-base sm:text-lg",children:"pdf_document"===t?"PDF Preview":"mcp_server"===t?"Server Info":"Live Preview"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["pdf_document"===t&&(0,a.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:n.replace("current.pdf","current.html"),target:"_blank",rel:"noopener noreferrer",className:"gap-2 text-xs sm:text-sm",children:[(0,a.jsx)(eS.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"View HTML"]})}),"mcp_server"!==t&&(0,a.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"gap-2 text-xs sm:text-sm",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"pdf_document"===t?"Download PDF":"Open in New Tab"]})})]})]})}),(0,a.jsx)(eb.aY,{className:"h-[calc(100%-4rem)] sm:h-[calc(100%-5rem)] p-0",children:"pdf_document"===t?(0,a.jsx)("div",{className:"w-full h-full bg-gray-100 dark:bg-gray-800 rounded-b-lg flex items-center justify-center",children:(0,a.jsx)("embed",{src:n,type:"application/pdf",className:"w-full h-full rounded-b-lg",title:"PDF Preview of ".concat(s)})}):"mcp_server"===t?(0,a.jsx)("div",{className:"w-full h-full bg-muted/20 rounded-b-lg flex items-center justify-center text-center p-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(eS.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"No Live Preview Available"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"MCP Servers are backend components and do not have a visual interface."}),(0,a.jsx)(l.z,{variant:"link",className:"mt-2",onClick:()=>b("code"),children:"View Source Code"})]})}):(0,a.jsx)("iframe",{src:n,className:"w-full h-full border-0 rounded-b-lg",title:"Preview of ".concat(s)},null==v?void 0:v.current_version)})]})}),(0,a.jsx)(ey.nU,{value:"code",className:"h-full m-0",children:(0,a.jsxs)(eb.Zb,{className:"h-full flex flex-col",children:[(0,a.jsx)(eb.Ol,{className:"pb-3 px-4 pt-1 sm:px-6 sm:pt-2 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eb.ll,{className:"text-base sm:text-lg",children:"pdf_document"===t?"HTML Source (for PDF)":"Source Code"}),(0,a.jsxs)(eb.SZ,{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm mt-1",children:[(0,a.jsxs)("span",{children:["Current (v",(null==v?void 0:v.current_version)||"?",")"]}),C&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(ew.C,{variant:"outline",className:"text-xs",children:[C.split("\n").length," lines"]}),(0,a.jsx)(ew.C,{variant:"outline",className:"text-xs",children:ti(new Blob([C]).size)})]})]})]}),C&&(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>tl(C,"source"),className:"gap-2 text-xs sm:text-sm mt-2 sm:mt-0",children:O.source?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(es.Z,{className:"w-4 h-4"}),"Copied"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4"}),"Copy"]})})]})}),(0,a.jsx)(eb.aY,{className:"flex-1 p-0 min-h-0 overflow-hidden",children:C?(0,a.jsx)("div",{className:"h-full w-full min-h-0",style:{minHeight:"400px"},children:(0,a.jsx)(eG,{value:C,language:"mcp_server"===t?"python":"html",height:"100%",readOnly:!0,minimap:C.split("\n").length>100,className:"h-full w-full"})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-center text-muted-foreground py-8",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(eS.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No source code available"})]})})})]})}),(0,a.jsx)(ey.nU,{value:"versions",className:"h-full m-0",children:(0,a.jsxs)(eb.Zb,{className:"h-full",children:[(0,a.jsxs)(eb.Ol,{className:"pb-3 px-4 pt-1 sm:px-6 sm:pt-2",children:[(0,a.jsx)(eb.ll,{className:"text-base sm:text-lg",children:"Version History"}),(0,a.jsxs)(eb.SZ,{className:"text-xs sm:text-sm mt-1",children:[v?"".concat(v.versions.length," versions"):"Loading...",en&&(0,a.jsxs)("span",{className:"ml-2",children:["• Comparing v",en.version1," vs v",en.version2]})]})]}),(0,a.jsx)(eb.aY,{className:"h-[calc(100%-5rem)] sm:h-[calc(100%-6rem)] p-0",children:(0,a.jsxs)(i.x,{className:"h-full w-full px-3 sm:px-6 pb-3 sm:pb-6",children:[ee&&(0,a.jsxs)(ej,{variant:"destructive",className:"mb-3 sm:mb-4",children:[(0,a.jsx)(eD.Z,{className:"h-4 w-4"}),(0,a.jsx)(eN,{children:"Error"}),(0,a.jsx)(e_,{children:ee})]}),en&&(0,a.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[(0,a.jsxs)("h3",{className:"text-sm sm:text-base font-semibold",children:["v",en.version1," → v",en.version2]}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>el(null),className:"text-xs h-7 px-2",children:"✕"})]}),en.loading?(0,a.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Loading..."})]}):(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsx)(eJ(),{oldValue:en.content1,newValue:en.content2,splitView:!1,compareMethod:eU.DiffMethod.WORDS,leftTitle:"",rightTitle:"",disableWordDiff:!1,extraLinesSurroundingDiff:0,renderContent:e=>(0,a.jsx)("pre",{style:{display:"inline",margin:0,padding:0,whiteSpace:"pre-wrap",fontSize:"11px",lineHeight:"1.3"},children:e.replace(/^[\+\-\s]/,"")}),styles:{variables:{dark:{diffViewerBackground:"#1e1e1e",diffViewerColor:"#d4d4d4",addedBackground:"#1e3a1e",addedColor:"#4ec9b0",removedBackground:"#3a1e1e",removedColor:"#f48771",wordAddedBackground:"#2ea04326",wordRemovedBackground:"#f8514926",addedGutterBackground:"transparent",removedGutterBackground:"transparent",gutterBackground:"transparent",gutterBackgroundDark:"transparent",highlightBackground:"#2a2d2e",highlightGutterBackground:"transparent",codeFoldGutterBackground:"transparent",codeFoldBackground:"transparent",emptyLineBackground:"#1e1e1e",gutterColor:"transparent",addedGutterColor:"transparent",removedGutterColor:"transparent",codeFoldContentColor:"transparent",diffViewerTitleBackground:"transparent",diffViewerTitleColor:"transparent",diffViewerTitleBorderColor:"transparent"}},diffContainer:{fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace',fontSize:"10px",lineHeight:"1.3"},marker:{display:"none"},gutter:{display:"none"},codeFold:{display:"none"},codeFoldGutter:{display:"none"}},useDarkTheme:!0,hideLineNumbers:!0})})]}),(null==v?void 0:v.versions)?(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4",children:[...v.versions].reverse().map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-lg p-3 sm:p-4 ".concat(e.version===v.current_version?"border-primary bg-primary/5":"border-border"),children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between mb-2 gap-2 sm:gap-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(ew.C,{variant:e.version===v.current_version?"default":"secondary",children:["v",e.version]}),e.version===v.current_version&&(0,a.jsx)(ew.C,{variant:"outline",className:"text-xs",children:"Current"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2",children:[(0,a.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2 sm:gap-3",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(ek.Z,{className:"w-3 h-3"}),e.line_count||"N/A"," lines"]}),(0,a.jsx)("span",{children:ti(e.size)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[t<v.versions.length-1&&(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>{tb([...v.versions].reverse()[t+1].version,e.version)},className:"gap-1 text-xs px-2 py-1 h-7",children:[(0,a.jsx)(eF.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"vs Prev"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Prev"})]}),e.version!==v.current_version&&(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>tb(e.version,v.current_version),className:"gap-1 text-xs px-2 py-1 h-7",children:[(0,a.jsx)(eF.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"vs Curr"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Curr"})]}),(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>tv(e.version),disabled:eo,className:"gap-1 text-xs px-2 py-1 h-7",children:[(0,a.jsx)(ez.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"New App"}),(0,a.jsx)("span",{className:"sm:hidden",children:"New"})]})]}),e.version!==v.current_version&&(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>ty(e.version),disabled:null!==$,className:"gap-1 text-xs px-2 py-1 h-7",children:$===e.version?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"w-3 h-3 animate-spin"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Switching..."}),(0,a.jsx)("span",{className:"sm:hidden",children:"..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eZ.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Switch"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Switch"})]})})]})]}),(0,a.jsx)("h4",{className:"font-medium text-sm mb-1",children:e.commit_summary}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mb-2 sm:mb-3 line-clamp-2 sm:line-clamp-3",children:e.user_request}),(0,a.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(eE.Z,{className:"w-3 h-3"}),to(e.timestamp)]}),e.edit_type&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(eO.Z,{className:"w-3 h-3"}),e.edit_type]})]})]},e.version))}):(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,a.jsx)(eA.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No version history available"})]})]})})]})}),(0,a.jsx)(ey.nU,{value:"editor",className:"h-full m-0",children:(0,a.jsxs)("div",{className:"h-full flex flex-col bg-background border rounded-lg",children:[(0,a.jsx)("div",{className:"px-3 py-2 border-b bg-muted/40 rounded-t-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(eB.h_,{children:[(0,a.jsx)(eB.$F,{asChild:!0,children:(0,a.jsxs)(l.z,{variant:"outline",size:"sm",className:"gap-1 text-xs h-7 px-2",disabled:U||e7,children:[(0,a.jsx)(w.Z,{className:"w-3 h-3"}),"Tools (",e9.length,")",e7&&(0,a.jsx)(j.Z,{className:"w-3 h-3 animate-spin ml-1"})]})}),(0,a.jsxs)(eB.AW,{className:"max-h-60 overflow-y-auto w-56",children:[(0,a.jsx)(eB.Ju,{children:"Allowed Tools"}),(0,a.jsxs)(eB.Xi,{className:"text-xs font-medium",onSelect:e=>{e.preventDefault(),e6(e5.map(e=>e.name))},children:["Select All (",e5.length,")"]}),(0,a.jsx)(eB.Xi,{className:"text-xs font-medium",onSelect:e=>{e.preventDefault(),e6([])},children:"Deselect All"}),(0,a.jsx)(eB.VD,{}),e5.length>0?e5.map(e=>(0,a.jsxs)(eB.Xi,{className:"gap-2",onSelect:e=>{e.preventDefault()},children:[(0,a.jsx)("input",{type:"checkbox",className:"flex-shrink-0 h-3 w-3 accent-primary mr-1",checked:e9.includes(e.name),onChange:t=>{let s=t.target.checked;e6(t=>s?[...t,e.name]:t.filter(t=>t!==e.name))}}),(0,a.jsx)(u,{delayDuration:300,children:(0,a.jsxs)(p,{children:[(0,a.jsx)(h,{asChild:!0,children:(0,a.jsx)("span",{className:"text-xs truncate cursor-default",children:e.name})}),(0,a.jsx)(f,{side:"right",align:"start",className:"max-w-xs",children:(0,a.jsx)("p",{className:"text-xs",children:e.description||"No description"})})]})})]},e.name)):(0,a.jsx)(eB.Xi,{disabled:!0,className:"text-xs text-muted-foreground",children:"No tools available"})]})]}),U&&(0,a.jsxs)(ew.C,{variant:"secondary",className:"gap-1",children:[(0,a.jsx)(eR.Z,{className:"w-3 h-3 animate-pulse"}),B]}),!U&&!x&&(0,a.jsx)(ew.C,{variant:"outline",className:"text-xs",children:"Editor"})]}),!x&&L.trim()&&(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>{tg(),e0(!0)},className:"gap-2 text-xs",disabled:U||e2,children:e2?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"w-3 h-3 animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(et.Z,{className:"w-3 h-3"}),"View Full Query"]})})]})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,a.jsx)("div",{className:"flex-1 min-h-0 overflow-auto p-3",children:U||I.length>0?(0,a.jsx)("div",{className:"space-y-3",children:I.length>0&&(0,a.jsx)("div",{className:"space-y-3",children:I.map((e,t)=>(0,a.jsxs)("div",{className:"space-y-2",children:[e.thoughts&&(0,a.jsxs)("details",{className:"rounded-lg border border-border bg-muted/20 shadow-sm",children:[(0,a.jsxs)("summary",{className:"cursor-pointer p-3 list-none flex items-center justify-between text-sm font-medium text-muted-foreground hover:bg-muted/40 rounded-t-lg",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(eL.Z,{className:"w-4 h-4 mr-2"}),(0,a.jsxs)("span",{className:"italic",children:["AST. thinking (#",t+1,")"]})]}),(0,a.jsx)(N.Z,{className:"w-4 h-4 transition-transform duration-200"})]}),(0,a.jsx)("div",{className:"p-3 border-t border-border bg-background rounded-b-lg",children:(0,a.jsx)("div",{className:"prose prose-sm italic text-muted-foreground dark:prose-invert",children:(0,a.jsx)(eX,{content:e.thoughts,className:"prose-xs"})})})]}),e.output&&(()=>{let t=e.output.startsWith("\uD83D\uDD27 Calling tool:");if(e.output.startsWith("✅ Web app")||e.output.startsWith("❌"),!t)return(0,a.jsx)("div",{className:"w-full self-start py-1 text-foreground",children:(0,a.jsx)("div",{className:"prose dark:prose-invert w-full max-w-full min-w-0 ".concat("user_prompt"===e.lastChunkType?"bg-blue-50 dark:bg-blue-900/30 p-3 rounded-lg":""),style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:(0,a.jsx)(eX,{content:e.output,className:"prose-xs"})})});{let t=e.output.match(/🔧 Calling tool: (\w+)/),s=t?t[1]:"Unknown";return(0,a.jsxs)("details",{className:"my-2 rounded-lg border border-border bg-muted/20 shadow-sm",children:[(0,a.jsxs)("summary",{className:"cursor-pointer p-3 list-none flex items-center justify-between text-sm font-medium text-foreground hover:bg-muted/40 rounded-t-lg",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 animate-spin text-muted-foreground"}),(0,a.jsxs)("span",{className:"ml-2 font-mono text-xs",children:["\uD83D\uDD27 ",s]})]}),(0,a.jsx)(N.Z,{className:"w-4 h-4 transition-transform duration-200"})]}),(0,a.jsx)("div",{className:"p-3 border-t border-border bg-background rounded-b-lg",children:(0,a.jsx)("div",{className:"prose dark:prose-invert w-full max-w-full min-w-0",style:{wordBreak:"break-word",overflowWrap:"anywhere"},children:(0,a.jsx)(eX,{content:e.output,className:"prose-xs"})})})]})}})()]},e.id))})}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-center",children:(0,a.jsxs)("div",{className:"text-muted-foreground",children:[(0,a.jsx)(eC.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsxs)("p",{className:"text-sm",children:[x?"Describe what you want to build and I'll create it for you":"mcp_server"===t?"Describe changes to the MCP server...":"Tell me what changes you'd like to make",".",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs",children:"(Conversation will be persisted in this session)"})]})]})})}),(0,a.jsxs)("div",{className:"flex-shrink-0 p-3 border-t bg-muted/40",children:[(ev.length>0||eI.length>0||eq)&&(0,a.jsxs)("div",{className:"mb-3 space-y-2",children:[eq&&(0,a.jsxs)(ej,{variant:"destructive",children:[(0,a.jsx)(eD.Z,{className:"h-4 w-4"}),(0,a.jsxs)(e_,{className:"text-xs",children:["Upload failed: ",eq,(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>eK(null),className:"ml-2 h-6",children:"Dismiss"})]})]}),ev.length>0&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground bg-background rounded-md p-2 border",children:[ev.length," file",ev.length>1?"s":""," selected",(0,a.jsx)(l.z,{type:"button",variant:"default",size:"sm",onClick:tm,disabled:eH||U,className:"gap-1 ml-2 h-6 text-xs",children:eH?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"w-3 h-3 animate-spin"}),"Uploading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eM.Z,{className:"w-3 h-3"}),"Upload"]})})]}),eI.length>0&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground bg-background rounded-md p-2 border",children:[eI.length," file",eI.length>1?"s":""," attached"]})]}),(0,a.jsxs)("div",{className:"flex items-center bg-background border border-input rounded-xl shadow-sm p-2 focus-within:ring-2 focus-within:ring-ring",children:[(0,a.jsx)(l.z,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var e;return null===(e=e$.current)||void 0===e?void 0:e.click()},disabled:U,className:"text-muted-foreground hover:text-foreground h-8 w-8 flex-shrink-0",children:(0,a.jsx)(k.Z,{className:"w-4 h-4"})}),(0,a.jsx)("textarea",{id:"editor-prompt",value:L,onChange:e=>M(e.target.value),placeholder:x?"Describe what you want to build...":"mcp_server"===t?"Edit MCP server: add a tool, modify parameters...":"What would you like to change?",className:"flex-grow p-2 bg-transparent focus:outline-none border-0 focus:ring-0 placeholder:text-muted-foreground text-base resize-none min-h-8 max-h-32",disabled:U,rows:1,onInput:e=>{let t=e.target;t.style.height="auto",t.style.height=Math.min(t.scrollHeight,128)+"px"}}),(0,a.jsx)(l.z,{onClick:tu,disabled:!L.trim()||U,className:"gap-2 h-8 px-3 flex-shrink-0",size:"sm",children:U?(0,a.jsx)(j.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(eM.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("input",{type:"file",multiple:!0,ref:e$,onChange:tc,style:{display:"none"},accept:"image/*,.heic,.heif,application/pdf,.txt,.md,.py,.js,.html,.css,.json,.csv"}),Z&&"error"===B&&(0,a.jsxs)(ej,{variant:"destructive",className:"mt-3",children:[(0,a.jsx)(eD.Z,{className:"h-4 w-4"}),(0,a.jsx)(eN,{children:"Edit Failed"}),(0,a.jsxs)(e_,{className:"mt-2 text-xs",children:[Z,(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>{ta(),tu()},children:[(0,a.jsx)(eZ.Z,{className:"w-3 h-3 mr-1"}),"Retry"]}),(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>{M("Please make some small improvements")},children:[(0,a.jsx)(eC.Z,{className:"w-3 h-3 mr-1"}),"Simplify Request"]})]})]})]})]})]})]})})]})]})]}),(0,a.jsx)(eg.Vq,{open:eQ,onOpenChange:e0,children:(0,a.jsxs)(eg.cZ,{className:"max-w-4xl h-[80vh] w-full flex flex-col overflow-hidden",children:[(0,a.jsxs)(eg.fK,{className:"px-6 py-4 border-b",children:[(0,a.jsxs)(eg.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(et.Z,{className:"w-5 h-5"}),"Query Content Preview"]}),(0,a.jsxs)(eg.Be,{className:"text-sm text-muted-foreground",children:["This is the exact content that will be sent to the AI when you submit your edit request.",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"✅ Guaranteed identical:"})," Uses the same functions as the actual submission."]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden p-6",children:(0,a.jsx)(i.x,{className:"h-full",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold",children:"Full Query Content"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(ew.C,{variant:"outline",className:"text-xs",children:[e1.length.toLocaleString()," characters"]}),(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:tg,disabled:e2||!L.trim(),className:"gap-2 text-xs",children:[(0,a.jsx)(eZ.Z,{className:"w-3 h-3"}),"Refresh"]}),(0,a.jsxs)(l.z,{variant:"outline",size:"sm",onClick:async()=>{alert(tx(L,await tf())===e1?"✅ Verified: Preview is identical to what will be sent!":"⚠️ Warning: Preview differs from what would be sent. Try refreshing.")},disabled:e2||!e1,className:"gap-2 text-xs",children:[(0,a.jsx)(D.Z,{className:"w-3 h-3"}),"Verify"]}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>tl(e1,"query-preview"),disabled:!e1||e2,className:"gap-2 text-xs",children:O["query-preview"]?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(es.Z,{className:"w-3 h-3"}),"Copied"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{className:"w-3 h-3"}),"Copy"]})})]})]}),(0,a.jsx)("div",{className:"border rounded-lg bg-muted/20 p-4",children:e2?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{className:"text-sm",children:"Generating query preview..."})]})}):(0,a.jsx)("pre",{className:"text-xs font-mono text-foreground whitespace-pre-wrap break-words overflow-x-auto",children:e1||"No content to preview. Enter a prompt and try again."})}),e1&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Note:"})," This preview shows the complete context that will be sent to the AI, including:"]}),(0,a.jsxs)("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[(0,a.jsx)("li",{children:"Artifact metadata (version info, recent changes)"}),(0,a.jsx)("li",{children:"Complete HTML source code of the current version"}),(0,a.jsx)("li",{children:"Your edit request"}),eI.length>0&&(0,a.jsxs)("li",{children:["References to ",eI.length," attached file(s)"]})]}),(0,a.jsx)("div",{className:"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-md p-2 mt-3",children:(0,a.jsxs)("p",{className:"text-green-800 dark:text-green-200 font-medium",children:["✅ ",(0,a.jsx)("strong",{children:"Accuracy Guarantee:"})," This preview uses the exact same `getCurrentVersionContent()` and `buildQueryContext()` functions as the actual submission. What you see here is precisely what the AI will receive."]})})]})]})})})]})})]})}function eY(e){let{userNumber:t="+17145986105",trigger:s,open:n,onOpenChange:o,onSelectApp:i}=e,[c,d]=(0,r.useState)([]),[m,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null),[f,x]=(0,r.useState)(!1),[g,y]=(0,r.useState)("web_app"),[w,b]=(0,r.useState)(null),v=async()=>{u(!0),h(null);try{let e=await Promise.all([fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"list_web_apps",arguments:{user_number:t,limit:50}})}),fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"list_pdf_documents",arguments:{user_number:t,limit:50}})}),fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:"list_mcp_servers",arguments:{user_number:t,limit:50}})})]),[s,a,r]=e;if(!s.ok)throw Error("Failed to load web apps: ".concat(s.status));if(!a.ok)throw Error("Failed to load PDF documents: ".concat(a.status));if(!r.ok)throw Error("Failed to load MCP servers: ".concat(r.status));let[n,l,o]=await Promise.all(e.map(e=>e.json()));if(n.error)throw Error(n.error);if(l.error)throw Error(l.error);if(o.error)throw Error(o.error);let i="string"==typeof n.result?JSON.parse(n.result):n.result,c="string"==typeof l.result?JSON.parse(l.result):l.result,m="string"==typeof o.result?JSON.parse(o.result):o.result,u=(i.web_apps||[]).map(e=>({name:e.app_name,type:"web_app",url:e.url,current_version:e.current_version,created_at:e.created_at,last_updated:e.last_updated,description:e.description,total_versions:e.total_versions,latest_commit_summary:e.latest_commit_summary,line_count:e.line_count,size:e.size})),p=(c.pdf_documents||[]).map(e=>({name:e.doc_name,type:"pdf_document",url:e.pdf_url,current_version:e.current_version,created_at:e.created_at,last_updated:e.last_updated,description:e.description,total_versions:e.total_versions,latest_commit_summary:e.latest_commit_summary,pdf_size:e.pdf_size})),h=(m.mcp_servers||[]).map(e=>({name:e.server_name,type:"mcp_server",url:e.server_url,current_version:e.current_version,created_at:e.created_at,last_updated:e.last_updated,description:e.description,total_versions:e.total_versions,latest_commit_summary:e.latest_commit_summary})),f=[...u,...p,...h];f.sort((e,t)=>new Date(t.last_updated).getTime()-new Date(e.last_updated).getTime()),d(f)}catch(e){h(e instanceof Error?e.message:"Failed to load artifacts")}finally{u(!1)}};(0,r.useEffect)(()=>{n&&v()},[n,t]);let N=e=>{i&&i(e.name,e.url,e.type),o&&o(!1)},k=async(e,s,a)=>{if(a.stopPropagation(),window.confirm('Are you sure you want to delete "'.concat(e,'"?\n\nThis action cannot be undone. All versions and history will be permanently lost.'))){b(e);try{let a,r;if("mcp_server"===s)a="delete_mcp_server",r="server_name";else if("pdf_document"===s){alert("PDF document deletion is not yet implemented."),b(null);return}else a="delete_web_app",r="app_name";let n=await fetch("".concat(eV,"/internal/call_mcp_tool"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:a,arguments:{[r]:e,user_number:t,confirm:!0}})});if(!n.ok)throw Error("Failed to delete app: ".concat(n.status));let l=await n.json();if(l.error)throw Error(l.error);let o="string"==typeof l.result?JSON.parse(l.result):l.result;if("success"===o.status)d(t=>t.filter(t=>t.name!==e)),alert('Artifact "'.concat(e,'" has been successfully deleted.'));else throw Error(o.message||"Failed to delete artifact")}catch(t){console.error("Error deleting artifact:",t),alert('Failed to delete "'.concat(e,'": ').concat(t instanceof Error?t.message:"Unknown error"))}finally{b(null)}}},S=e=>{try{return new Date(e).toLocaleDateString()}catch(t){return e}},C=e=>{y(e),x(!0)},T=(0,a.jsxs)(l.z,{variant:"outline",size:"sm",className:"gap-2",children:[(0,a.jsx)(ek.Z,{className:"w-4 h-4"}),"My Artifacts"]});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eg.Vq,{open:n,onOpenChange:o,children:[s&&(0,a.jsx)(eg.hg,{asChild:!0,children:s}),!s&&(0,a.jsx)(eg.hg,{asChild:!0,children:T}),(0,a.jsxs)(eg.cZ,{className:"max-w-4xl h-[80vh] sm:max-w-4xl sm:h-[80vh] w-full h-full max-h-screen sm:max-h-[80vh] flex flex-col overflow-hidden",children:[(0,a.jsx)(eg.fK,{className:"px-4 py-2 sm:px-6 sm:py-4 border-b",children:(0,a.jsxs)(eg.$N,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,a.jsx)(ek.Z,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"My Artifacts",(0,a.jsx)("div",{className:"ml-auto",children:(0,a.jsxs)(eB.h_,{children:[(0,a.jsx)(eB.$F,{asChild:!0,children:(0,a.jsxs)(l.z,{variant:"default",size:"sm",className:"gap-2",children:[(0,a.jsx)(ez.Z,{className:"w-4 h-4"}),"Create New"]})}),(0,a.jsxs)(eB.AW,{align:"end",children:[(0,a.jsx)(eB.Ju,{children:"Choose Artifact Type"}),(0,a.jsx)(eB.VD,{}),(0,a.jsxs)(eB.Xi,{onClick:()=>C("web_app"),children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"Web Application"]}),(0,a.jsxs)(eB.Xi,{onClick:()=>C("pdf_document"),children:[(0,a.jsx)(ek.Z,{className:"w-4 h-4 mr-2"}),"PDF Document"]}),(0,a.jsxs)(eB.Xi,{onClick:()=>C("mcp_server"),children:[(0,a.jsx)(eS.Z,{className:"w-4 h-4 mr-2"}),"MCP Server"]})]})]})})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:m?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(j.Z,{className:"w-8 h-8 animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading your artifacts..."})]})}):p?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-destructive mb-4",children:p}),(0,a.jsxs)(l.z,{onClick:()=>{h(null),v()},variant:"outline",className:"gap-2",children:[(0,a.jsx)(eZ.Z,{className:"w-4 h-4"}),"Retry"]})]})}):(0,a.jsxs)(ey.mQ,{defaultValue:"web_apps",className:"h-full flex flex-col",children:[(0,a.jsxs)(ey.dr,{className:"grid w-full grid-cols-3 mx-4 sm:mx-6 mt-2",children:[(0,a.jsxs)(ey.SP,{value:"web_apps",className:"gap-2 text-xs sm:text-sm",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Web Apps"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Apps"}),(0,a.jsx)(ew.C,{variant:"secondary",className:"text-xs ml-1",children:c.filter(e=>"web_app"===e.type).length})]}),(0,a.jsxs)(ey.SP,{value:"pdf_documents",className:"gap-2 text-xs sm:text-sm",children:[(0,a.jsx)(ek.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"PDF Docs"}),(0,a.jsx)("span",{className:"sm:hidden",children:"PDFs"}),(0,a.jsx)(ew.C,{variant:"secondary",className:"text-xs ml-1",children:c.filter(e=>"pdf_document"===e.type).length})]}),(0,a.jsxs)(ey.SP,{value:"mcp_servers",className:"gap-2 text-xs sm:text-sm",children:[(0,a.jsx)(eS.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"MCP Servers"}),(0,a.jsx)("span",{className:"sm:hidden",children:"MCP"}),(0,a.jsx)(ew.C,{variant:"secondary",className:"text-xs ml-1",children:c.filter(e=>"mcp_server"===e.type).length})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden px-4 sm:px-6 pb-4 sm:pb-6",children:[(0,a.jsx)(ey.nU,{value:"web_apps",className:"h-full m-0 mt-4",children:(0,a.jsx)(eW,{artifacts:c.filter(e=>"web_app"===e.type),type:"web_app",emptyTitle:"No Web Apps Yet",emptyDescription:"You haven't created any web applications yet.",emptyHint:"Ask the AI to create a web app for you to get started!",onSelect:N,onDelete:k,deletingApp:w,formatDate:S})}),(0,a.jsx)(ey.nU,{value:"pdf_documents",className:"h-full m-0 mt-4",children:(0,a.jsx)(eW,{artifacts:c.filter(e=>"pdf_document"===e.type),type:"pdf_document",emptyTitle:"No PDF Documents Yet",emptyDescription:"You haven't created any PDF documents yet.",emptyHint:"Ask the AI to create a PDF document for you to get started!",onSelect:N,onDelete:k,deletingApp:w,formatDate:S})}),(0,a.jsx)(ey.nU,{value:"mcp_servers",className:"h-full m-0 mt-4",children:(0,a.jsx)(eW,{artifacts:c.filter(e=>"mcp_server"===e.type),type:"mcp_server",emptyTitle:"No MCP Servers Yet",emptyDescription:"You haven't created any MCP servers yet.",emptyHint:"Ask the AI to create an MCP server for you to get started!",onSelect:N,onDelete:k,deletingApp:w,formatDate:S})})]})]})})]})]}),(0,a.jsx)(eH,{artifactType:g,artifactName:"new_artifact",artifactUrl:"",userNumber:t,open:f,onOpenChange:e=>{x(e),e||v()},createMode:!0,onAppCreated:(e,t)=>{console.log("[ArtifactsList] Artifact created successfully:",e,t),x(!1),v(),i&&setTimeout(()=>{i(e,t,g)},500)}})]})}var eq=s(40257);E.TU.setOptions({async:!1});let eK=eq.env.NEXT_PUBLIC_BACKEND_API_URL||"http://localhost:5001";function e$(){var e;let[t,d]=(0,r.useState)(""),[m,D]=(0,r.useState)([]),[F,z]=(0,r.useState)([]),O=(0,r.useRef)(null),[R,M]=(0,r.useState)(null),[J,I]=(0,r.useState)(!1),[X,V]=(0,r.useState)(!0),W=(0,r.useRef)(null),[H,K]=(0,r.useState)("Ready"),[$]=(0,r.useState)("+17145986105"),[et,es]=(0,r.useState)(null),[ea,er]=(0,r.useState)(!1),[en,el]=(0,r.useState)(null),[eo]=(0,r.useState)(eq.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY||""),[ei,ec]=(0,r.useState)(0),[em,eu]=(0,r.useState)(!1),[ep,eh]=(0,r.useState)(!1),[eg,ey]=(0,r.useState)([]),[ev,ej]=(0,r.useState)([]),{theme:eN}=(0,L.F)(),{upsertPreview:e_,updatePreview:ek,getPreviewsForMessage:eS,removePreview:eC}=ee(),eT=[{value:"gemini-2.5-flash-preview-05-20",label:"Gemini 2.5 Flash"},{value:"gemini-2.5-flash-lite-preview-06-17",label:"Gemini 2.5 Flash Lite"},{value:"gemini-2.5-pro-preview-05-06",label:"Gemini 2.5 Pro"}],[eE,eA]=(0,r.useState)(eT[1].value),eP=[{value:"default",label:"Default",description:"Standard AI assistant"},{value:"artifact_editor",label:"Artifact Editor",description:"Specialized for creating/editing web apps"},{value:"professional",label:"Professional",description:"Formal business communication"},{value:"web_chat",label:"Web Chat",description:"Casual conversational style"}],[eZ,eD]=(0,r.useState)(eP[0].value),eF=(e,t)=>{if(console.log("[PAGE.TSX] Processing tool call for preview: ".concat(e.name,", status: ").concat(e.status,", call_id: ").concat(e.call_id)),ex(e)){let s=ef(e);console.log("[PAGE.TSX] Extracted preview for tool ".concat(e.name,":"),s),s&&s.shouldShow?(console.log("[PAGE.TSX] Upserting preview with id: ".concat(s.id,", type: ").concat(s.type)),e_(s.id,s.type,s.data,t,{name:e.name,call_id:e.call_id,status:e.status})):console.log("[PAGE.TSX] Preview extraction returned null or shouldShow=false for ".concat(e.name))}else console.log("[PAGE.TSX] Tool ".concat(e.name," should not extract preview (status: ").concat(e.status,")"))},ez=async e=>{if(!(e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif")||"image/heic"===e.type||"image/heif"===e.type))return e;try{console.log('\uD83D\uDD04 Converting HEIC file "'.concat(e.name,'" to JPEG...'));let{default:t}=await s.e(156).then(s.t.bind(s,39140,23)),a=await t({blob:e,toType:"image/jpeg",quality:.85}),r=e.name.replace(/\.(heic|heif)$/i,""),n="".concat(r,".jpg"),l=new File([a],n,{type:"image/jpeg",lastModified:e.lastModified});return console.log('✅ Successfully converted "'.concat(e.name,'" to "').concat(n,'" (').concat(Math.round(l.size/1024),"KB)")),l}catch(t){console.warn('⚠️ Frontend HEIC conversion failed for "'.concat(e.name,'":'),t);try{console.log('\uD83D\uDD04 Attempting Canvas API fallback for "'.concat(e.name,'"...'));let t=await createImageBitmap(e),s=document.createElement("canvas"),a=s.getContext("2d");if(!a)throw Error("Could not get canvas context");s.width=t.width,s.height=t.height,a.drawImage(t,0,0);let r=await new Promise((e,t)=>{s.toBlob(s=>{s?e(s):t(Error("Canvas toBlob failed"))},"image/jpeg",.85)}),n=e.name.replace(/\.(heic|heif)$/i,""),l="".concat(n,".jpg"),o=new File([r],l,{type:"image/jpeg",lastModified:e.lastModified});return console.log('✅ Canvas API fallback succeeded for "'.concat(e.name,'" → "').concat(l,'"')),o}catch(s){console.warn('⚠️ Canvas API fallback also failed for "'.concat(e.name,'":'),s),console.log('\uD83D\uDD04 Will upload "'.concat(e.name,'" for server-side conversion...'));let t=new File([e],e.name,{type:e.type||"image/heic",lastModified:e.lastModified});return t.needsServerConversion=!0,t}}},eO=(e,t)=>e,eR=e=>{let t=/\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|tiff)(\?[^)\s"']*)?$/i,s=/\.(mp4|webm|ogg|mov|avi|wmv|flv|m4v)(\?[^)\s"']*)?$/i,a=RegExp("(?<!!\\[)(?<!\\]\\()(?<!\\[.*?\\]\\()https?:\\/\\/[^\\s<>\"'\\]\\)]+","g"),r=e.replace(a,e=>{let a=e.replace(/[.,;:!?)"']+$/,"");if(t.test(a))return"![Image](".concat(a,")");if(s.test(a)){var r;return'<video controls style="max-width: 100%; height: auto; max-height: 400px; border-radius: 0.375rem; margin: 0.5em auto; display: block;">\n          <source src="'.concat(a,'" type="video/').concat((null===(r=a.split(".").pop())||void 0===r?void 0:r.split("?")[0])||"mp4",'">\n          Your browser does not support the video tag.\n          <a href="').concat(a,'" target="_blank" rel="noopener noreferrer">View video</a>\n        </video>')}return e});return r=r.replace(/https?:\/\/[^\s<>"'\]\)\}]+\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|tiff|mp4|webm|ogg|mov|avi|wmv|flv|m4v)(\?[^\s<>"'\]\)\}]*)?/gi,e=>{if(r.includes("![Image](".concat(e,")")))return e;let t=e.replace(/[.,;:!?)"'\}]+$/,"");return"![Image](".concat(t,")")})},eL=e=>{let t=eR(e),s=E.TU.parse(t,{gfm:!0,breaks:!0});return A.Z.sanitize(s)},eM=()=>(console.log("[PAGE.TSX] getCurrentLocation called"),new Promise((e,t)=>{if(!navigator.geolocation){console.error("[PAGE.TSX] Geolocation not supported"),t("Geolocation is not supported by your browser.");return}let s=setTimeout(()=>{console.error("[PAGE.TSX] Geolocation timeout"),t("Failed to get location: Timeout.")},1e4);navigator.geolocation.getCurrentPosition(t=>{clearTimeout(s);let a="".concat(t.coords.latitude,",").concat(t.coords.longitude);console.log("[PAGE.TSX] Geolocation success:",a),es(a),e(a)},e=>{clearTimeout(s),console.error("[PAGE.TSX] Geolocation error:",e);let a="Unable to retrieve your location. Please ensure location services are enabled.";switch(e.code){case e.PERMISSION_DENIED:a="Location permission denied. Please enable it in your browser settings.";break;case e.POSITION_UNAVAILABLE:a="Location information is unavailable.";break;case e.TIMEOUT:a="Request to get user location timed out."}t(a)},{enableHighAccuracy:!0,timeout:8e3,maximumAge:0})})),eU=async e=>{if(e.target.files){let t=Array.from(e.target.files),s=t.filter(e=>e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif")||"image/heic"===e.type||"image/heif"===e.type);s.length>0&&M("Converting ".concat(s.length," HEIC file").concat(s.length>1?"s":""," to JPEG..."));try{let e=await Promise.all(t.map(e=>ez(e))),s=e.filter(e=>e.needsServerConversion);s.length>0?M("\uD83D\uDCE4 Sending ".concat(s.length," HEIC file").concat(s.length>1?"s":""," for server-side conversion...")):M(null),z(t=>[...t,...e])}catch(e){console.error("Error processing selected files:",e),e instanceof Error&&e.message.includes("Unable to convert HEIC")?(M("❌ HEIC conversion failed. Please try a different image format."),setTimeout(()=>M(null),5e3)):(z(e=>[...e,...t]),M(null))}e.target.value=""}},eJ=e=>{z(t=>t.filter(t=>t.name!==e))},eG=(0,r.useCallback)(async e=>{var t;let s=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!s)return;let a=[];for(let e=0;e<s.length;e++){let t=s[e];if(t.type.startsWith("image/")){let e=t.getAsFile();if(e){let s=new Date().toISOString().replace(/[:.]/g,"-"),r=t.type.split("/")[1]||"png",n="pasted-image-".concat(s,".").concat(r),l=new File([e],n,{type:e.type,lastModified:e.lastModified});a.push(l),console.log("\uD83D\uDCCB Pasted image: ".concat(n," (").concat(Math.round(e.size/1024),"KB)"))}}}if(a.length>0){e.preventDefault();try{M("Processing ".concat(a.length," pasted image").concat(a.length>1?"s":"","..."));let e=await Promise.all(a.map(e=>ez(e)));z(t=>[...t,...e]),M(null),Z.Am.success("Added ".concat(a.length," image").concat(a.length>1?"s":""," from clipboard"),{description:"".concat(a.map(e=>e.name).join(", "))})}catch(e){console.error("Error processing pasted images:",e),M(null),Z.Am.error("Failed to process pasted images",{description:e instanceof Error?e.message:"Unknown error occurred"})}}},[ez,M,z]),eI=async e=>Promise.all(e.map(async e=>{let t=new FormData;t.append("file",e),e.needsServerConversion&&(t.append("convert_heic","true"),console.log('\uD83D\uDCE4 Uploading "'.concat(e.name,'" for server-side HEIC conversion...')));try{let e=await fetch("".concat(eK,"/upload"),{method:"POST",body:t});if(!e.ok)throw Error("Upload failed: ".concat(e.status));let s=await e.json();return s.converted_from_heic&&console.log('✅ Server converted HEIC file "'.concat(s.original_filename,'" to JPEG: "').concat(s.filename,'"')),s.url}catch(t){throw console.error("Failed to upload ".concat(e.name,":"),t),t}})),eX=async e=>{let s;e&&"function"==typeof e.preventDefault&&e.preventDefault();let a=t.trim();if(!a&&0===F.length)return;let r=[];if(F.length>0)try{K("Uploading files..."),Z.Am.loading("Uploading ".concat(F.length," file").concat(F.length>1?"s":"","..."),{id:"file-upload"}),r=await eI(F),console.log("Files uploaded successfully:",r),Z.Am.success("Successfully uploaded ".concat(F.length," file").concat(F.length>1?"s":""),{id:"file-upload"})}catch(e){console.error("File upload failed:",e),K("Ready"),Z.Am.error("Upload failed. Please try again.",{id:"file-upload",description:e instanceof Error?e.message:"Unknown error occurred"});return}if(ea){if(et)s=et;else try{console.log("Attempting to get current location because toggle is on...");let e=await eM();s=e,console.log("Current location obtained for query:",e)}catch(e){console.error("Error getting location for query:",e),Z.Am.error("Location Error",{description:e.toString()}),X&&V(!1),d(""),z([]),K("Ready");return}s&&(a="".concat(a," (My current location is: ").concat(s,")"))}if(r.length>0){let e=r.map((e,t)=>{var s;let a=(null===(s=F[t])||void 0===s?void 0:s.name)||"Attachment ".concat(t+1);return"- ".concat(a,": ").concat(e)}).join("\n");a+="\n\nAttached files:\n".concat(e)}let n=(0,P.Z)(),l=[];a&&l.push({type:"text",id:(0,P.Z)(),content:a});let o={id:n,sender:"user",parts:l,timestamp:Date.now()};D(e=>[...e,o]),d(""),X&&V(!1);let i=(0,P.Z)();D(e=>[...e,{id:i,sender:"bot",parts:[{type:"thought_summary",id:(0,P.Z)(),content:""}],timestamp:Date.now(),thinking:!0}]);try{let e={sender:$,query:a,timestamp:Date.now(),stream:!0,model:eE,attachment_urls:r.length>0?r:void 0,system_prompt:"default"!==eZ?eZ:void 0,allowed_tools:ev};z([]),K("Processing...");let t=await fetch("".concat(eK,"/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text(),s="HTTP error! status: ".concat(t.status);try{let t=JSON.parse(e);s=t.error||t.detail||s}catch(t){e&&(s+=" - ".concat(e))}throw Error(s)}if(!t.body)throw Error("Response body is null");let s=t.body.getReader(),n=new TextDecoder,l="";for(;;){let e;let{done:t,value:a}=await s.read();if(t){if(""!==l.trim())try{let e=JSON.parse(l);if(console.log("[PAGE.TSX] Final Buffer Chunk:",JSON.stringify(e)),"text_chunk"===e.type&&e.content)D(t=>t.map(t=>{if(t.id===i){let s=e.content,a=[...t.parts],r=a.length>0?a[a.length-1]:null;return r&&"text"===r.type?(s=eO(s,r.content),r.content+=s):(s=eO(s,""),a.push({type:"text",id:(0,P.Z)(),content:s})),{...t,parts:a,thinking:!0}}return t}));else if("thought_summary"===e.type&&e.content)D(t=>t.map(t=>{if(t.id===i){let s=t.parts.map(t=>{if("thought_summary"===t.type){let s=eO(e.content,t.content);return{...t,content:t.content+s}}return t});return{...t,parts:s,thinking:!0}}return t}));else if("tool_call_pending"===e.type&&e.name&&e.arguments){let t=e.call_id||"tool-".concat((0,P.Z)());D(s=>s.map(s=>{if(s.id===i){if(s.parts.find(e=>"tool_call"===e.type&&e.toolCall.call_id===t))return console.log("[PAGE.TSX] (final buffer) Tool call with ID ".concat(t," already exists. Ignoring duplicate pending.")),s;let a={call_id:t,name:e.name,arguments:"string"==typeof e.arguments?e.arguments:JSON.stringify(e.arguments),status:"Pending..."};console.log("[PAGE.TSX] (final buffer) Tool Call Pending (New):",JSON.parse(JSON.stringify(a)));let r=[...s.parts];return r.push({type:"tool_call",id:(0,P.Z)(),toolCall:a}),r.push({type:"text",id:(0,P.Z)(),content:""}),{...s,parts:r,thinking:!0}}return s}))}else"tool_result"===e.type&&e.call_id&&void 0!==e.result?D(t=>t.map(t=>{if(t.id===i){"get_directions"===e.name&&console.log("[PAGE.TSX] (Final Buffer) RAW get_directions tool_result CHUNK:",JSON.stringify(e));let s=!1,a=t.parts.map(a=>{if("tool_call"===a.type&&a.toolCall.call_id===e.call_id){s=!0;let r=a.toolCall,n="string"==typeof e.result?e.result:JSON.stringify(e.result),l="boolean"==typeof e.is_partial&&e.is_partial,o="boolean"==typeof e.is_error&&e.is_error,i=l?"Streaming...":o?"Error":"Completed",c={...r,result:l&&r.result&&"Streaming..."===r.status?r.result+"\n---\n"+n:n,status:i,is_error:o,is_partial:l},d=null;if("get_directions"===r.name&&e.result&&"object"==typeof e.result){let t="".concat(r.name,"_response");e.result[t]?(d=e.result[t],console.log("[PAGE.TSX] (Stream Loop) Using wrapped format for directions, toolResponse:",JSON.stringify(d).substring(0,200)+"...")):(d=e.result,console.log("[PAGE.TSX] (Stream Loop) Using direct format for directions, toolResponse:",JSON.stringify(d).substring(0,200)+"..."))}if("get_directions"===r.name&&d&&"success"===d.status&&d.data&&!o&&!l?(console.log("[PAGE.TSX] (Final Buffer) Setting directionsData with:",JSON.stringify(d.data).substring(0,200)+"..."),el(d.data),ec(e=>e+1),eh(!0)):"get_directions"!==r.name||d||console.error("[PAGE.TSX] (Final Buffer) ERROR: get_directions_response missing!"),eF(c,t.id),("create_web_app"===r.name||"edit_web_app"===r.name)&&!o&&!l&&r.result)try{let e="string"==typeof r.result?JSON.parse(r.result):r.result;"success"===e.status&&e.url&&console.log("[PAGE.TSX] (Final Buffer) Setting webAppUrl with:",e.url)}catch(e){console.warn("[PAGE.TSX] (Final Buffer) Failed to parse web app result:",e)}if("generate_images_with_prompts"===r.name&&!o&&!l&&r.result)try{let e="string"==typeof r.result?JSON.parse(r.result):r.result;if("success"===e.status&&e.results){let t=[];e.results.forEach(e=>{Array.isArray(e)&&t.push(...e)}),t.length>0&&console.log("[PAGE.TSX] (Stream Loop) Setting generatedImageUrls with:",t.length,"images")}}catch(e){console.warn("[PAGE.TSX] (Stream Loop) Failed to parse image generation result:",e)}return{...a,toolCall:c}}return a});s||console.warn("[PAGE.TSX] (Final Buffer) Tool call id ".concat(e.call_id," not found in ").concat(t.id));let r=null;if("get_directions"===e.name&&e.result&&"object"==typeof e.result){let t="".concat(e.name,"_response");r=e.result[t]?e.result[t]:e.result}let n={...t,parts:a,thinking:!0};if("get_directions"===e.name&&r&&!("boolean"==typeof e.is_partial&&e.is_partial)&&!("boolean"==typeof e.is_error&&e.is_error)&&"success"===r.status&&r.data&&(n.showMapToggleForThisMessage=!0,n.directionsData=r.data,console.log("[PAGE.TSX] (Final Buffer) Setting message directions data:",JSON.stringify(r.data).substring(0,200)+"...")),("create_web_app"===e.name||"edit_web_app"===e.name)&&!("boolean"==typeof e.is_partial&&e.is_partial)&&!("boolean"==typeof e.is_error&&e.is_error)&&e.result)try{let t="string"==typeof e.result?JSON.parse(e.result):e.result;"success"===t.status&&t.url&&(n.showWebAppForThisMessage=!0,n.webAppUrl=t.url)}catch(e){console.warn("[PAGE.TSX] (Final Buffer) Failed to parse web app result for message:",e)}if("generate_images_with_prompts"===e.name&&!("boolean"==typeof e.is_partial&&e.is_partial)&&!("boolean"==typeof e.is_error&&e.is_error)&&e.result)try{let t="string"==typeof e.result?JSON.parse(e.result):e.result;if("success"===t.status&&t.results){let e=[];t.results.forEach(t=>{Array.isArray(t)&&e.push(...t)}),e.length>0&&(n.showImagesForThisMessage=!0,n.generatedImageUrls=e,console.log("[PAGE.TSX] (Final Buffer) Setting generatedImageUrls with:",e.length,"images"))}}catch(e){console.warn("[PAGE.TSX] (Final Buffer) Failed to parse image generation result for message:",e)}return n}return t})):"tool_sample_text_chunk"===e.type&&e.parent_tool_call_id&&"string"==typeof e.content?D(t=>t.map(t=>{if(t.id===i){let s=t.parts.map(t=>{if("tool_call"===t.type&&t.toolCall.call_id===e.parent_tool_call_id){let s;let a=t.toolCall,r=a.sampleCallPairs||[];if(r.length>0){let t=r[r.length-1],a={...t,output:(t.output||"")+e.content};s=[...r.slice(0,-1),a]}else s=[{id:(0,P.Z)(),output:e.content}];return console.log("[PAGE.TSX] (Final Buffer) Updated sampleCallPairs (output) for ".concat(e.parent_tool_call_id,":"),JSON.parse(JSON.stringify(s))),{...t,toolCall:{...a,sampleCallPairs:s}}}return t});return{...t,parts:s,thinking:!0}}return t})):"tool_sample_thought_chunk"===e.type&&e.parent_tool_call_id&&"string"==typeof e.content?D(t=>t.map(t=>{if(t.id===i){let s=t.parts.map(t=>{if("tool_call"===t.type&&t.toolCall.call_id===e.parent_tool_call_id){let s;let a=t.toolCall,r=a.sampleCallPairs||[];if(r.length>0){let t=r[r.length-1];if(void 0===t.output){let a={...t,thoughts:(t.thoughts||"")+e.content};s=[...r.slice(0,-1),a]}else s=[...r,{id:(0,P.Z)(),thoughts:e.content}]}else s=[{id:(0,P.Z)(),thoughts:e.content}];return console.log("[PAGE.TSX] (Final Buffer) Updated sampleCallPairs (thoughts) for ".concat(e.parent_tool_call_id,":"),JSON.parse(JSON.stringify(s))),{...t,toolCall:{...a,sampleCallPairs:s}}}return t});return{...t,parts:s,thinking:!0}}return t})):"stream_end"===e.type?(D(e=>e.map(e=>e.id===i?{...e,thinking:!1}:e)),K("Ready")):"error"===e.type&&e.content&&(D(t=>t.map(t=>{if(t.id===i){let s={type:"text",id:(0,P.Z)(),content:'<strong style="color: red;">Stream Error:</strong> '.concat(eL(e.content))},a=[...t.parts,s];return{...t,parts:a,thinking:!1,is_error_message:!0}}return t})),K("Ready"))}catch(e){console.error("Error parsing final stream chunk JSON:",e,"Raw final buffer:",l)}console.log("[PAGE.TSX] HTTP Response Stream Reader finished."),D(e=>e.map(e=>e.id===i&&e.thinking?{...e,thinking:!1}:e)),"Ready"!==H&&K("Ready");break}for(l+=n.decode(a,{stream:!0});(e=l.indexOf("\n"))>=0;){let t=l.substring(0,e);if(l=l.substring(e+1),""!==t.trim())try{let e=JSON.parse(t);if("text_chunk"===e.type&&e.content)D(t=>t.map(t=>{if(t.id===i){console.log("[PAGE.TSX] Updating message ".concat(t.id," with text_chunk (stream loop). Current parts:"),JSON.parse(JSON.stringify(t.parts)));let s=[...t.parts],a=s.length>0?s.length-1:-1,r=-1!==a?s[a]:null,n=eO(e.content,r&&"text"===r.type?r.content:"");return r&&"text"===r.type?s[a]={...r,content:r.content+n}:s.push({type:"text",id:(0,P.Z)(),content:n}),{...t,parts:s,thinking:!0}}return t}));else if("thought_summary"===e.type&&e.content)D(t=>t.map(t=>{if(t.id===i){console.log("[PAGE.TSX] Updating message ".concat(t.id," with thought_summary. Current parts:"),JSON.parse(JSON.stringify(t.parts)));let s=[...t.parts],a=s.length>0?s.length-1:-1,r=-1!==a?s[a]:null,n=eO(e.content,r&&"thought_summary"===r.type?r.content:"");return r&&"thought_summary"===r.type?s[a]={...r,content:r.content+n}:s.push({type:"thought_summary",id:(0,P.Z)(),content:n}),{...t,parts:s,thinking:!0}}return t}));else if("tool_call_pending"===e.type&&e.name&&e.arguments){let t=e.call_id||"tool-".concat((0,P.Z)());D(s=>s.map(s=>{if(s.id===i){if(s.parts.find(e=>"tool_call"===e.type&&e.toolCall.call_id===t))return console.log("[PAGE.TSX] (stream loop) Tool call with ID ".concat(t," already exists in pending state. Ignoring duplicate pending message.")),s;let a={call_id:t,name:e.name,arguments:"string"==typeof e.arguments?e.arguments:JSON.stringify(e.arguments),status:"Pending..."};console.log("[PAGE.TSX] Tool Call Pending (New):",JSON.parse(JSON.stringify(a)));let r=[...s.parts];return r.push({type:"tool_call",id:(0,P.Z)(),toolCall:a}),r.push({type:"text",id:(0,P.Z)(),content:""}),{...s,parts:r,thinking:!0}}return s}))}else"tool_result"===e.type&&e.call_id&&void 0!==e.result?(console.log("[PAGE.TSX] Received tool_result chunk:",JSON.parse(JSON.stringify(e))),"get_directions"===e.name&&console.log("[PAGE.TSX] RAW get_directions tool_result CHUNK (repeated block):",JSON.stringify(e)),D(t=>t.map(t=>{if(t.id===i){console.log("[PAGE.TSX] Updating message ".concat(t.id," with tool_result. Current parts:"),JSON.parse(JSON.stringify(t.parts)));let s=!1,a=t.parts.map(a=>{if("tool_call"===a.type&&a.toolCall.call_id===e.call_id){s=!0;let r=a.toolCall,n="string"==typeof e.result?e.result:JSON.stringify(e.result),l="boolean"==typeof e.is_partial&&e.is_partial,o="boolean"==typeof e.is_error&&e.is_error,i=l?"Streaming...":o?"Error":"Completed",c={...r,result:l&&r.result&&"Streaming..."===r.status?r.result+"\n---\n"+n:n,status:i,is_error:o,is_partial:l},d=null;if("get_directions"===r.name&&e.result&&"object"==typeof e.result){let t="".concat(r.name,"_response");e.result[t]?(d=e.result[t],console.log("[PAGE.TSX] (Stream Loop) Using wrapped format for directions, toolResponse:",JSON.stringify(d).substring(0,200)+"...")):(d=e.result,console.log("[PAGE.TSX] (Stream Loop) Using direct format for directions, toolResponse:",JSON.stringify(d).substring(0,200)+"..."))}if("get_directions"===r.name&&d&&"success"===d.status&&d.data&&!o&&!l?(console.log("[PAGE.TSX] (Stream Loop) Setting directionsData with:",JSON.stringify(d.data).substring(0,200)+"..."),el(d.data),ec(e=>e+1),eh(!0)):"get_directions"!==r.name||d||console.error("[PAGE.TSX] ERROR (stream loop): get_directions_response missing in parsedChunk.result!"),("create_web_app"===r.name||"edit_web_app"===r.name)&&!o&&!l&&r.result)try{let e="string"==typeof r.result?JSON.parse(r.result):r.result;"success"===e.status&&e.url&&console.log("[PAGE.TSX] (Final Buffer) Setting webAppUrl with:",e.url)}catch(e){console.warn("[PAGE.TSX] (Final Buffer) Failed to parse web app result:",e)}if("generate_images_with_prompts"===r.name&&!o&&!l&&r.result)try{let e="string"==typeof r.result?JSON.parse(r.result):r.result;if("success"===e.status&&e.results){let t=[];e.results.forEach(e=>{Array.isArray(e)&&t.push(...e)}),t.length>0&&console.log("[PAGE.TSX] (Stream Loop) Setting generatedImageUrls with:",t.length,"images")}}catch(e){console.warn("[PAGE.TSX] (Stream Loop) Failed to parse image generation result:",e)}return eF(c,t.id),{...a,toolCall:c}}return a});s||console.warn("[PAGE.TSX] (stream loop) Tool call with id ".concat(e.call_id," not found in message ").concat(t.id," parts"));let r=null;if("get_directions"===e.name&&e.result&&"object"==typeof e.result){let t="".concat(e.name,"_response");e.result[t]?(r=e.result[t],console.log("[PAGE.TSX] (Stream Loop Message) Using wrapped format for directions, toolResponse:",JSON.stringify(r).substring(0,200)+"...")):(r=e.result,console.log("[PAGE.TSX] (Stream Loop Message) Using direct format for directions, toolResponse:",JSON.stringify(r).substring(0,200)+"..."))}let n={...t,parts:a,thinking:!0};if("get_directions"===e.name&&r&&!("boolean"==typeof e.is_partial&&e.is_partial)&&!("boolean"==typeof e.is_error&&e.is_error)&&"success"===r.status&&r.data&&(n.showMapToggleForThisMessage=!0,n.directionsData=r.data,console.log("[PAGE.TSX] (Stream Loop Message) Setting message directions data:",JSON.stringify(r.data).substring(0,200)+"...")),("create_web_app"===e.name||"edit_web_app"===e.name)&&!("boolean"==typeof e.is_partial&&e.is_partial)&&!("boolean"==typeof e.is_error&&e.is_error)&&e.result)try{let t="string"==typeof e.result?JSON.parse(e.result):e.result;"success"===t.status&&t.url&&(n.showWebAppForThisMessage=!0,n.webAppUrl=t.url)}catch(e){console.warn("[PAGE.TSX] (Stream Loop) Failed to parse web app result for message:",e)}if("generate_images_with_prompts"===e.name&&!("boolean"==typeof e.is_partial&&e.is_partial)&&!("boolean"==typeof e.is_error&&e.is_error)&&e.result)try{let t="string"==typeof e.result?JSON.parse(e.result):e.result;if("success"===t.status&&t.results){let e=[];t.results.forEach(t=>{Array.isArray(t)&&e.push(...t)}),e.length>0&&(n.showImagesForThisMessage=!0,n.generatedImageUrls=e,console.log("[PAGE.TSX] (Final Buffer) Setting generatedImageUrls with:",e.length,"images"))}}catch(e){console.warn("[PAGE.TSX] (Final Buffer) Failed to parse image generation result for message:",e)}return n}return t}))):"stream_end"===e.type?(console.log("[PAGE.TSX] Stream ended for botMessageId:",i),D(e=>e.map(e=>e.id===i?{...e,thinking:!1}:e)),K("Ready")):"error"===e.type&&e.content?(console.error("[PAGE.TSX] Received stream error chunk:",e),D(t=>t.map(t=>{if(t.id===i){let s={type:"text",id:(0,P.Z)(),content:'<strong style="color: red;">Stream Error:</strong> '.concat(eL(e.content))},a=[...t.parts,s];return{...t,parts:a,thinking:!1,is_error_message:!0}}return t})),K("Ready")):"tool_sample_text_chunk"===e.type&&e.parent_tool_call_id&&"string"==typeof e.content?D(t=>t.map(t=>{if(t.id===i){let s=t.parts.map(t=>{if("tool_call"===t.type&&t.toolCall.call_id===e.parent_tool_call_id){let s;let a=t.toolCall,r=a.sampleCallPairs||[];if(r.length>0){let t=r[r.length-1],a={...t,output:(t.output||"")+e.content};s=[...r.slice(0,-1),a]}else s=[{id:(0,P.Z)(),output:e.content}];return console.log("[PAGE.TSX] (Stream Line) Updated sampleCallPairs (output) for ".concat(e.parent_tool_call_id,":"),JSON.parse(JSON.stringify(s))),{...t,toolCall:{...a,sampleCallPairs:s}}}return t});return{...t,parts:s,thinking:!0}}return t})):"tool_sample_thought_chunk"===e.type&&e.parent_tool_call_id&&"string"==typeof e.content&&D(t=>t.map(t=>{if(t.id===i){let s=t.parts.map(t=>{if("tool_call"===t.type&&t.toolCall.call_id===e.parent_tool_call_id){let s;let a=t.toolCall,r=a.sampleCallPairs||[];if(r.length>0){let t=r[r.length-1];if(void 0===t.output){let a={...t,thoughts:(t.thoughts||"")+e.content};s=[...r.slice(0,-1),a]}else s=[...r,{id:(0,P.Z)(),thoughts:e.content}]}else s=[{id:(0,P.Z)(),thoughts:e.content}];return console.log("[PAGE.TSX] (Stream Line) Updated sampleCallPairs (thoughts) for ".concat(e.parent_tool_call_id,":"),JSON.parse(JSON.stringify(s))),{...t,toolCall:{...a,sampleCallPairs:s}}}return t});return{...t,parts:s,thinking:!0}}return t}))}catch(e){console.error("Error parsing stream chunk JSON:",e,"Raw line:",t)}}}}catch(s){console.error("Error sending message or processing stream:",s);let e=eL(s instanceof Error?s.message:"Sorry, I encountered an error processing your request."),t=!1;D(s=>s.map(s=>{if(s.id===i){t=!0;let a={type:"text",id:(0,P.Z)(),content:e},r=[...s.parts||[],a];return{...s,parts:r,thinking:!1,is_error_message:!0}}return s})),t||D(t=>[...t,{id:(0,P.Z)(),sender:"bot",parts:[{type:"text",id:(0,P.Z)(),content:e}],timestamp:Date.now(),thinking:!1,is_error_message:!0}])}finally{}},eV=(e,t)=>{d("".concat(e," ").concat(t))};(0,r.useEffect)(()=>{let e=W.current;e&&(e.scrollTop=e.scrollHeight)},[m]),(0,r.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      .animated-ellipsis span {\n        opacity: 0;\n        animation: an_ellipsis 1.2s infinite;\n        animation-fill-mode: forwards; /* Keep the final state of the animation */\n      }\n      .animated-ellipsis span:nth-child(1) { animation-delay: 0.1s; }\n      .animated-ellipsis span:nth-child(2) { animation-delay: 0.25s; }\n      .animated-ellipsis span:nth-child(3) { animation-delay: 0.4s; }\n      @keyframes an_ellipsis {\n        0% { opacity: 0; transform: translateY(-0.1em);}\n        30% { opacity: 1; transform: translateY(0);}\n        70% { opacity: 1; transform: translateY(0);}\n        100% { opacity: 0; transform: translateY(0.1em);}\n      }\n      /* Add CSS for thought summary details arrow rotation */\n      .thought-summary-details[open] > summary .details-arrow {\n        transform: rotate(180deg);\n      }\n      /* Add CSS for tool call details arrow rotation */\n      .tool-call-display[open] > summary .details-arrow {\n        transform: rotate(180deg);\n      }\n      /* Ensure tool call displays don't cause horizontal overflow */\n      .tool-call-display {\n        max-width: 100%;\n        overflow-wrap: break-word;\n        word-break: break-all;\n      }\n      .tool-call-display pre {\n        max-width: 100%;\n        overflow-x: auto;\n        word-break: break-all;\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n      }\n      .tool-call-display .tool-call-content {\n        max-width: 100%;\n        overflow-wrap: break-word;\n      }\n      /* Add some basic prose styling for markdown content if not already globally available */\n      .prose {\n        line-height: 1.35; /* Increased for better readability */\n        font-size: 0.94rem;\n        word-wrap: break-word; /* Force word wrapping */\n        overflow-wrap: break-word; /* Modern equivalent */\n        word-break: break-word; /* Break long words */\n      }\n      .prose p { \n        margin-bottom: 0.5em; /* Reduced for tighter spacing */\n        word-wrap: break-word;\n        overflow-wrap: break-word;\n      }\n      /* Specific URL and link handling to prevent overflow */\n      .prose a {\n        word-break: break-all; /* Break URLs aggressively */\n        overflow-wrap: break-word;\n        hyphens: auto;\n      }\n      /* Line clamp utilities for text truncation */\n      .line-clamp-1 {\n        overflow: hidden;\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 1;\n      }\n      .line-clamp-2 {\n        overflow: hidden;\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 2;\n      }\n      .line-clamp-3 {\n        overflow: hidden;\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 3;\n      }\n      .prose ul {\n        list-style-type: disc;\n        margin-block-start: 0;\n        margin-block-end: 0.5em; /* Reduced */\n        padding-inline-start: 1.25rem;\n      }\n      .prose ul ul {\n        list-style-type: circle;\n      }\n      .prose ul ul ul {\n        list-style-type: square;\n      }\n      .prose ol {\n        list-style-type: decimal;\n        margin-block-start: 0;\n        margin-block-end: 0.5em; /* Reduced */\n        padding-inline-start: 1.25rem;\n      }\n      .prose li p {\n        display: inline;\n        margin-bottom: 0.2em;\n      }\n      .prose li {\n        overflow-wrap: break-word;\n        word-break: break-word; \n        white-space: normal; \n      }\n      .prose pre {\n        background-color: hsl(var(--muted));\n        color: hsl(var(--muted-foreground));\n        padding: 1em;\n        border-radius: 0.375rem; \n        overflow-x: auto; /* Horizontal scroll for wide code */\n        font-size: 0.875em;\n        border: 1px solid hsl(var(--border));\n        /* NEW: Add vertical scrolling for very tall code blocks */\n        max-height: 60vh; /* Limit height to 60% of viewport height */\n        overflow-y: auto; /* Add vertical scrollbar if content exceeds max-height */\n        word-break: break-all; /* Ensure long lines without spaces can break */\n        white-space: pre-wrap; /* Allow wrapping and preserve whitespace */\n      }\n      .prose code:not(pre code) {\n        background-color: hsl(var(--muted));\n        color: hsl(var(--primary)); /* Using primary color for inline code for better visibility */\n        padding: 0.2em 0.4em;\n        margin: 0 0.1em;\n        font-size: 0.85em;\n        border-radius: 0.25rem;\n      }\n      .dark .prose pre {\n        background-color: hsl(var(--secondary)); /* A slightly different dark for pre blocks */\n         border: 1px solid hsl(var(--border));\n      }\n       .dark .prose code:not(pre code) {\n        background-color: hsl(var(--secondary));\n      }\n      /* Responsive images in prose */\n      .prose img {\n        max-width: 100%; /* Ensure images are responsive by default */\n        height: auto;    /* Allow image to set its own height based on aspect ratio */\n        min-height: 150px; /* Reserve some minimum space to reduce layout shift on mobile */\n        max-height: 350px; /* Prevent images from becoming excessively tall */\n        object-fit: contain; /* Ensure the image fits within bounds & maintains aspect ratio */\n        display: block;  /* Allows margin auto to work for centering */\n        margin-left: auto;\n        margin-right: auto;\n        margin-top: 0.5em;\n        margin-bottom: 0.5em;\n        border-radius: 0.375rem; /* Add a slight rounding to images */\n        background-color: hsl(var(--muted-foreground) / 0.05); /* Subtle background for loading state */\n      }\n\n      .dark .prose img {\n        background-color: hsl(var(--muted-foreground) / 0.1); /* Slightly more visible on dark for loading */\n      }\n\n      /* Video styling to match images */\n      .prose video {\n        max-width: 100%;\n        height: auto;\n        max-height: 400px;\n        border-radius: 0.375rem;\n        margin: 0.5em auto;\n        display: block;\n        background-color: hsl(var(--muted-foreground) / 0.05);\n        border: 1px solid hsl(var(--border));\n      }\n\n      .dark .prose video {\n        background-color: hsl(var(--muted-foreground) / 0.1);\n        border: 1px solid hsl(var(--border));\n      }\n\n      @media (min-width: 1024px) { /* Desktop screens */\n        .prose img {\n          max-width: 60%; /* Make images smaller on desktop */\n          max-height: 500px; /* Allow larger images on desktop */\n        }\n        \n        .prose video {\n          max-width: 70%; /* Make videos slightly larger than images on desktop */\n          max-height: 600px; /* Allow larger videos on desktop */\n        }\n      }\n \n      /* Ensure ScrollArea Viewport takes full height of its ScrollAreaRoot parent */\n      /* We assume ScrollAreaRoot is correctly sized by flex (e.g. flex-1 h-full min-h-0) */\n      .scroll-area-viewport-target div[data-radix-scroll-area-viewport] {\n        height: 100%; /* Try without !important first */\n        /* overflow-y: auto; /* Ensure it can scroll its content */ /* This should be default */\n      }\n\n      /* Global style for all Radix ScrollArea Viewports */\n      div[data-radix-scroll-area-viewport] {\n        width: 100% !important;\n        height: 100% !important;\n        overflow-y: auto !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,r.useEffect)(()=>{let e=()=>{document.documentElement.style.setProperty("--vh","".concat(window.innerHeight,"px"))};window.addEventListener("resize",e),e(),document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",document.documentElement.style.height="100%",document.body.style.height="100%",document.documentElement.style.overscrollBehaviorY="contain",document.body.style.overscrollBehaviorY="contain",document.addEventListener("paste",eG);let t=e=>{(e.ctrlKey||e.metaKey)&&"v"===e.key&&I(!0)},s=e=>{("Control"===e.key||"Meta"===e.key||"v"===e.key)&&I(!1)};return document.addEventListener("keydown",t),document.addEventListener("keyup",s),()=>{window.removeEventListener("resize",e),document.removeEventListener("paste",eG),document.removeEventListener("keydown",t),document.removeEventListener("keyup",s),document.documentElement.style.overflow="",document.body.style.overflow="",document.documentElement.style.height="",document.body.style.height="",document.documentElement.style.overscrollBehaviorY="",document.body.style.overscrollBehaviorY=""}},[eG]),(0,r.useEffect)(()=>{ec(e=>e+1)},[eN]);let[eW,e$]=(0,r.useState)(!1),[eQ,e0]=(0,r.useState)(null),[e1,e4]=(0,r.useState)(!1),e2=(e,t,s)=>{e0({type:e,name:t,url:s}),e$(!0)};return(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat(eK,"/users/").concat($.replace("+",""),"/tools"));if(!e.ok)return;let t=await e.json();if(t&&Array.isArray(t.tools)){let e=t.tools.map(e=>({name:e.name,description:e.description||""}));ey(e),ej(e.map(e=>e.name))}}catch(e){console.warn("Failed to fetch tools list",e)}})()},[$]),(0,a.jsxs)("div",{className:"fixed inset-0 flex flex-col bg-background text-foreground transition-colors duration-300 overflow-hidden",children:[(0,a.jsxs)("header",{className:"px-2 py-2 sm:px-4 sm:py-3 border-b border-border flex justify-between items-center bg-muted/40 transition-colors duration-300 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1",children:[(0,a.jsxs)(eB.h_,{children:[(0,a.jsx)(eB.$F,{asChild:!0,children:(0,a.jsx)(l.z,{variant:"ghost",size:"icon",className:"hover:bg-muted flex-shrink-0",children:(0,a.jsx)(g.Z,{className:"w-5 h-5"})})}),(0,a.jsxs)(eB.AW,{align:"start",className:"w-56",children:[(0,a.jsxs)(eB.Ju,{className:"flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),"AST. Chat Settings"]}),(0,a.jsx)(eB.VD,{}),(0,a.jsx)(eB.Ju,{children:"Style"}),(0,a.jsx)("div",{className:"px-2 py-1",children:(0,a.jsxs)(c.Ph,{value:eZ,onValueChange:eD,children:[(0,a.jsx)(c.i4,{className:"w-full h-8",children:(0,a.jsx)(c.ki,{placeholder:"Select style"})}),(0,a.jsx)(c.Bw,{children:eP.map(e=>(0,a.jsx)(c.Ql,{value:e.value,className:"text-sm",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(w.Z,{className:"w-3 h-3"}),e.label]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]})},e.value))})]})}),(0,a.jsx)(eB.VD,{}),(0,a.jsx)(eB.Xi,{asChild:!0,children:(0,a.jsxs)(T.default,{href:"/card-studio",className:"flex items-center",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Buddy's Card Studio"]})}),(0,a.jsx)(eB.VD,{}),(0,a.jsxs)(eB.Xi,{children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),"Preferences"]}),(0,a.jsxs)(eB.Xi,{children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 mr-2"}),"Keyboard Shortcuts"]}),(0,a.jsx)(eB.VD,{}),(0,a.jsx)(eB.Xi,{children:"Clear Chat History"})]})]}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center space-x-2",children:[(0,a.jsx)(ew.C,{variant:"secondary",className:"text-xs",children:"Model"}),(0,a.jsxs)(c.Ph,{value:eE,onValueChange:eA,children:[(0,a.jsx)(c.i4,{className:"w-[180px] h-8",children:(0,a.jsx)(c.ki,{placeholder:"Select model"})}),(0,a.jsx)(c.Bw,{children:eT.map(e=>(0,a.jsx)(c.Ql,{value:e.value,className:"text-sm",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"w-3 h-3"}),e.label]})},e.value))})]})]}),"default"!==eZ&&(0,a.jsx)(ew.C,{variant:"outline",className:"text-xs flex-shrink-0",children:null===(e=eP.find(e=>e.value===eZ))||void 0===e?void 0:e.label}),(0,a.jsxs)(eB.h_,{children:[(0,a.jsx)(eB.$F,{asChild:!0,children:(0,a.jsxs)(l.z,{variant:"ghost",size:"sm",className:"gap-1",children:["Tools (",ev.length,")"]})}),(0,a.jsxs)(eB.AW,{className:"max-h-64 overflow-y-auto w-56",children:[(0,a.jsx)(eB.Ju,{children:"Select Tools"}),(0,a.jsx)(eB.Xi,{className:"text-xs font-medium gap-2",onSelect:e=>{e.preventDefault(),ej(eg.map(e=>e.name))},children:"Select All"}),(0,a.jsx)(eB.Xi,{className:"text-xs font-medium gap-2",onSelect:e=>{e.preventDefault(),ej([])},children:"Deselect All"}),(0,a.jsx)(eB.VD,{}),eg.map(e=>(0,a.jsxs)(eB.Xi,{className:"gap-2",onSelect:e=>{e.preventDefault()},children:[(0,a.jsx)("input",{type:"checkbox",className:"flex-shrink-0 h-3 w-3 accent-primary mr-1",checked:ev.includes(e.name),onChange:t=>{let s=t.target.checked;ej(t=>s?[...t,e.name]:t.filter(t=>t!==e.name))}}),(0,a.jsx)("span",{className:"text-xs truncate",title:e.description,children:e.name})]},e.name))]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(eY,{userNumber:$,open:e1,onOpenChange:e4,onSelectApp:(e,t,s)=>{e2(s,e,t)}}),(0,a.jsx)(n.l,{})]})]}),(0,a.jsx)("main",{className:"flex-grow flex flex-col relative transition-colors duration-300 overflow-hidden min-h-0",children:X?(0,a.jsxs)("div",{id:"initialView",className:"text-center w-full px-2 flex-grow flex flex-col justify-center items-center",children:[(0,a.jsx)("h1",{className:"text-3xl sm:text-4xl font-semibold text-foreground mb-2 transition-colors duration-300",children:"AST. Chat"}),(0,a.jsx)("p",{className:"text-md sm:text-lg text-muted-foreground mb-6 sm:mb-10 transition-colors duration-300",children:"How can I help you today?"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 max-w-4xl lg:max-w-5xl xl:max-w-7xl mx-auto w-full",children:[(0,a.jsx)(T.default,{href:"/card-studio",className:"col-span-1 sm:col-span-2",children:(0,a.jsx)(l.z,{variant:"outline",className:"h-auto text-left p-4 sm:p-6 border-border rounded-lg shadow hover:shadow-md dark:hover:bg-muted transition w-full bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-950/20 dark:to-purple-950/20 border-pink-200 dark:border-pink-800",children:(0,a.jsxs)("div",{className:"flex items-center gap-4 w-full",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(b.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-foreground text-base sm:text-lg",children:"\uD83C\uDFA8 Buddy's Card Studio"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Create beautiful AI-powered greeting cards for birthdays, holidays, and special occasions"})]})]})})}),[{title:"What are the advantages",detail:"of using Next.js?"},{title:"Write code to",detail:"demonstrate dijkstra\\'s algorithm"},{title:"Help me write an essay",detail:"about silicon valley"},{title:"What is the weather",detail:"in San Francisco?"}].map((e,t)=>(0,a.jsxs)(l.z,{variant:"outline",className:"h-auto text-left p-3 sm:p-4 border-border rounded-lg shadow hover:shadow-md dark:hover:bg-muted transition",onClick:()=>eV(e.title,e.detail),children:[(0,a.jsx)("h3",{className:"font-semibold text-foreground text-sm sm:text-base",children:e.title}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:e.detail})]},t))]})]}):(0,a.jsx)(i.x,{className:"w-full mx-auto flex-1 min-h-0",ref:W,children:(0,a.jsx)("div",{id:"chatLog",className:"space-y-3 sm:space-y-4 flex flex-col pb-[calc(68px+env(safe-area-inset-bottom))] max-w-4xl lg:max-w-5xl xl:max-w-7xl mx-auto px-2 sm:px-4 pt-2 sm:pt-4",children:m.map(e=>{var t,s,n,o,i,c;let d="flex flex-col break-words";"user"===e.sender?d+=" p-2 rounded-2xl max-w-[95%] sm:max-w-[85%] bg-sky-400 text-sky-900 self-end":e.is_error_message?d+=" px-1 py-1 sm:p-2 rounded-xl max-w-[95%] sm:max-w-[85%] bg-destructive text-destructive-foreground self-start rounded-bl-sm":d+=" w-full self-start py-1 sm:py-2 text-foreground my-2 sm:my-3 px-1 sm:px-2";let m=e.directionsData?(()=>{let t=e.parts.findIndex(e=>"tool_call"===e.type&&"get_directions"===e.toolCall.name);return t>=0?e.parts.slice(0,t):e.parts})():e.parts,u=eS(e.id);return u.length>0&&console.log("[PAGE.TSX] Message ".concat(e.id," has ").concat(u.length," previews:"),u),(0,a.jsxs)("div",{className:d,children:[m.map(t=>(0,a.jsxs)(r.Fragment,{children:["text"===t.type&&t.content&&(0,a.jsx)("div",{className:"w-full max-w-full min-w-0",children:(0,a.jsx)("div",{className:"message-content prose dark:prose-invert w-full max-w-full min-w-0 text-part-fade-in",style:{wordBreak:"break-word",overflowWrap:"anywhere"},dangerouslySetInnerHTML:{__html:eL(t.content)}})}),"tool_call"===t.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(U,{toolCall:t.toolCall,renderSanitizedMarkdown:eL}),eS(e.id).filter(e=>{var s;return(null===(s=e.toolCall)||void 0===s?void 0:s.call_id)===t.toolCall.call_id}).map(e=>(console.log("[PAGE.TSX] Rendering ContentPreview for tool call ".concat(t.toolCall.call_id,":"),e),(0,a.jsx)(ed,{id:e.id,type:e.type,data:e.data,toolCall:e.toolCall,onUpdate:ek},e.id))),"generate_images_with_prompts"===t.toolCall.name&&"Completed"===t.toolCall.status&&!t.toolCall.is_error&&e.generatedImageUrls&&e.generatedImageUrls.length>0&&(0,a.jsxs)("div",{className:"mt-4 border rounded-lg shadow-md bg-muted/40 overflow-hidden",children:[(0,a.jsx)("div",{className:"flex items-center justify-between p-3 bg-background border-b border-border",children:(0,a.jsx)("h4",{className:"text-sm font-semibold text-foreground",children:"Generated Images"})}),(0,a.jsx)("div",{className:"bg-background",children:(0,a.jsx)(Q,{imageUrls:e.generatedImageUrls})})]})]}),"thought_summary"===t.type&&(0,a.jsxs)("details",{className:"thought-summary-details my-2 rounded-lg border border-border bg-muted/20 shadow-sm",open:!1,children:[(0,a.jsxs)("summary",{className:"thought-summary-summary cursor-pointer p-3 list-none flex items-center justify-between text-sm font-medium text-muted-foreground hover:bg-muted/40 rounded-t-lg",children:[e.thinking?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-2 animate-spin"}),(0,a.jsx)("span",{className:"italic",children:"AST. thinking"})]}):(0,a.jsx)("span",{className:"italic",children:"Thought Process"}),(0,a.jsx)(N.Z,{className:"w-5 h-5 transition-transform duration-200 details-arrow"})]}),t.content&&(0,a.jsx)("div",{className:"w-full max-w-full min-w-0 p-3 border-t border-border bg-background rounded-b-lg",children:(0,a.jsx)("div",{className:"message-content prose-sm italic text-muted-foreground dark:prose-invert w-full max-w-full min-w-0 text-part-fade-in",style:{wordBreak:"break-word",overflowWrap:"anywhere"},dangerouslySetInnerHTML:{__html:eL(t.content)}})}),e.thinking&&!t.content&&(0,a.jsx)("div",{className:"w-full max-w-full min-w-0 p-3 border-t border-border bg-background rounded-b-lg",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x.O,{className:"h-3 w-[250px]"}),(0,a.jsx)(x.O,{className:"h-3 w-[200px]"}),(0,a.jsx)(x.O,{className:"h-3 w-[180px]"})]})})]},"".concat(t.id,"-thought-details"))]},t.id)),e.directionsData&&(0,a.jsxs)(a.Fragment,{children:[console.log("[PAGE.TSX] Rendering MapDisplay for message",e.id,e.directionsData),(0,a.jsx)("div",{className:"border rounded-lg shadow-md bg-muted/40 p-0 overflow-hidden mt-2",children:(0,a.jsx)(Y,{directionsResponse:e.directionsData,googleMapsApiKey:eo,showTraffic:em,theme:"dark"===eN?G:B},ei)}),(null===(o=e.directionsData)||void 0===o?void 0:null===(n=o.routes)||void 0===n?void 0:null===(s=n[0])||void 0===s?void 0:null===(t=s.legs)||void 0===t?void 0:t[0])&&(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(q,{steps:e.directionsData.routes[0].legs[0].steps,totalDuration:null===(i=e.directionsData.routes[0].legs[0].duration)||void 0===i?void 0:i.text,totalDistance:null===(c=e.directionsData.routes[0].legs[0].distance)||void 0===c?void 0:c.text})})]}),(e.showWebAppForThisMessage&&e.webAppUrl||e.parts.some(e=>"tool_call"===e.type&&("create_web_app"===e.toolCall.name||"edit_web_app"===e.toolCall.name)&&"Completed"===e.toolCall.status&&!e.toolCall.is_error&&e.toolCall.result))&&0===eS(e.id).filter(e=>"web_app"===e.type).length?(0,a.jsxs)("div",{className:"mt-4 border rounded-lg shadow-md bg-muted/40 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-background border-b border-border",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("h4",{className:"text-sm font-semibold text-foreground",children:e.parts.find(e=>"tool_call"===e.type&&"edit_web_app"===e.toolCall.name)?"Web Application Edited":"Web Application Created"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(()=>{let t=e.webAppUrl;if(!t){let s=e.parts.find(e=>"tool_call"===e.type&&("create_web_app"===e.toolCall.name||"edit_web_app"===e.toolCall.name)&&e.toolCall.result);if(s&&"tool_call"===s.type)try{t=JSON.parse(s.toolCall.result).url}catch(e){console.warn("Failed to parse web app result for URL:",e)}}return t?(0,a.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,className:"gap-2",children:(0,a.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4"}),"Open in New Tab"]})}):null})()})]}),(()=>{let t=e.webAppUrl,s="Web Application";if(!t){let a=e.parts.find(e=>"tool_call"===e.type&&("create_web_app"===e.toolCall.name||"edit_web_app"===e.toolCall.name)&&e.toolCall.result);if(a&&"tool_call"===a.type)try{let e=JSON.parse(a.toolCall.result);t=e.url,s=e.app_name||s}catch(e){console.warn("Failed to parse web app result:",e)}}return t?(0,a.jsx)("div",{className:"bg-background",children:(0,a.jsx)("iframe",{src:t,className:"w-full h-64 sm:h-80 md:h-96",title:"Web App Preview: ".concat(s),sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation-by-user-activation",loading:"lazy"})}):null})()]}):null]},e.id)})})})}),(0,a.jsxs)("footer",{className:"flex-none px-2 pb-[env(safe-area-inset-bottom)] pt-2 sm:px-4 sm:pb-[env(safe-area-inset-bottom)] sm:pt-3 bg-muted/40 border-t border-border transition-colors duration-300 flex-shrink-0",children:[(0,a.jsx)("form",{onSubmit:eX,className:"max-w-4xl lg:max-w-5xl xl:max-w-7xl mx-auto",children:(0,a.jsx)(u,{children:(0,a.jsxs)("div",{className:"flex items-center bg-background border border-input rounded-xl shadow-sm p-2 transition-colors duration-300 focus-within:ring-2 focus-within:ring-ring ".concat(J?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-950":""),children:[(0,a.jsxs)(p,{children:[(0,a.jsx)(h,{asChild:!0,children:(0,a.jsx)(l.z,{type:"button",variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground",onClick:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.click()},children:(0,a.jsx)(k.Z,{className:"w-5 h-5"})})}),(0,a.jsxs)(f,{children:[(0,a.jsx)("p",{children:"Attach files (images, documents, etc.)"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"\uD83D\uDCA1 Tip: You can also paste images directly!"})]})]}),(0,a.jsx)("input",{type:"file",multiple:!0,ref:O,onChange:eU,style:{display:"none"},accept:"image/*,.heic,.heif,application/pdf,.txt,.md,.py,.js,.html,.css,.json,.csv,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation"}),(0,a.jsxs)(p,{children:[(0,a.jsx)(h,{asChild:!0,children:(0,a.jsx)(l.z,{type:"button",variant:ea?"secondary":"ghost",size:"icon",onClick:()=>er(!ea),className:"mr-2 ".concat(ea?"text-primary":"text-muted-foreground"," hover:text-foreground"),children:(0,a.jsx)(S.Z,{className:"w-5 h-5"})})}),(0,a.jsx)(f,{children:(0,a.jsx)("p",{children:ea?"Stop sending location":"Send current location with query"})})]}),(0,a.jsx)(o.I,{type:"text",id:"userInput",value:t,onChange:e=>d(e.target.value),className:"flex-grow p-2 bg-transparent focus:outline-none border-0 focus:ring-0 placeholder-muted-foreground",placeholder:J?"\uD83D\uDCCB Ready to paste images...":"Send a message...",autoComplete:"off"}),(0,a.jsxs)(p,{children:[(0,a.jsx)(h,{asChild:!0,children:(0,a.jsx)(l.z,{type:"submit",variant:"default",size:"icon",disabled:!(t.trim()||F.length>0)||"Ready"!==H,className:"rounded-lg",children:(0,a.jsx)(C.Z,{className:"w-5 h-5"})})}),(0,a.jsx)(f,{children:(0,a.jsx)("p",{children:"Send message"})})]})]})})}),F.length>0&&(0,a.jsx)("div",{className:"max-w-4xl lg:max-w-5xl xl:max-w-7xl mx-auto mt-3",children:(0,a.jsxs)(eb.Zb,{className:"border-dashed",children:[(0,a.jsx)(eb.Ol,{className:"pb-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(eb.ll,{className:"text-sm flex items-center gap-2",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),"Selected Files (",F.length,")"]}),(0,a.jsx)(ew.C,{variant:"secondary",className:"text-xs",children:F.reduce((e,t)=>e+t.size,0)>1048576?"".concat((F.reduce((e,t)=>e+t.size,0)/1048576).toFixed(1)," MB"):"".concat(Math.round(F.reduce((e,t)=>e+t.size,0)/1024)," KB")})]})}),(0,a.jsx)(eb.aY,{className:"pt-0",children:(0,a.jsx)("div",{className:"space-y-2",children:F.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm truncate",children:e.name}),(0,a.jsxs)(ew.C,{variant:"outline",className:"text-xs",children:[Math.round(e.size/1024)," KB"]})]}),(0,a.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>eJ(e.name),className:"text-red-500 hover:text-red-700 h-6 w-6 p-0 flex-shrink-0",children:"\xd7"})]},e.name))})})]})}),R&&(0,a.jsx)("div",{className:"max-w-4xl lg:max-w-5xl xl:max-w-7xl mx-auto mt-3",children:(0,a.jsx)(eb.Zb,{className:"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950",children:(0,a.jsx)(eb.aY,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 animate-spin text-blue-600 dark:text-blue-400"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Processing Files"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:R})]})]})})})})]}),eQ&&(0,a.jsx)(eH,{artifactType:eQ.type,artifactName:eQ.name,artifactUrl:eQ.url,userNumber:$,open:eW,onOpenChange:e$})]})}},11696:function(e,t,s){"use strict";s.d(t,{l:function(){return o}});var a=s(57437);s(2265);var r=s(20653),n=s(25922),l=s(62869);function o(){let{theme:e,setTheme:t}=(0,n.F)();return(0,a.jsxs)(l.z,{variant:"outline",size:"icon",onClick:()=>t("light"===e?"dark":"light"),children:[(0,a.jsx)(r.NWY,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,a.jsx)(r.kLh,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}},35974:function(e,t,s){"use strict";s.d(t,{C:function(){return o}});var a=s(57437);s(2265);var r=s(90535),n=s(94508);let l=(0,r.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:s}),t),...r})}},62869:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var a=s(57437),r=s(2265),n=s(37053),l=s(90535),o=s(94508);let i=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:c=!1,...d}=e,m=c?n.g7:"button";return(0,a.jsx)(m,{className:(0,o.cn)(i({variant:r,size:l,className:s})),ref:t,...d})});c.displayName="Button"},66070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},ll:function(){return i}});var a=s(57437),r=s(2265),n=s(94508);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...r})});l.displayName="Card";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});o.displayName="CardHeader";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),...r})});i.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},26110:function(e,t,s){"use strict";s.d(t,{$N:function(){return h},Be:function(){return f},Vq:function(){return i},cZ:function(){return u},fK:function(){return p},hg:function(){return c}});var a=s(57437),r=s(2265),n=s(49027),l=s(32489),o=s(94508);let i=n.fC,c=n.xz,d=n.h_;n.x8;let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});m.displayName=n.aV.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(n.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...i,children:[r,(0,a.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=n.VY.displayName;let p=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};p.displayName="DialogHeader";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});h.displayName=n.Dx.displayName;let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})});f.displayName=n.dk.displayName},84190:function(e,t,s){"use strict";s.d(t,{$F:function(){return m},AW:function(){return u},Ju:function(){return h},VD:function(){return f},Xi:function(){return p},h_:function(){return d}});var a=s(57437),r=s(2265),n=s(70085),l=s(10407),o=s(30401),i=s(40519),c=s(94508);let d=n.fC,m=n.xz;n.ZA,n.Uv,n.Tr,n.Ee,r.forwardRef((e,t)=>{let{className:s,inset:r,children:o,...i}=e;return(0,a.jsxs)(n.fF,{ref:t,className:(0,c.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...i,children:[o,(0,a.jsx)(l.Z,{className:"ml-auto"})]})}).displayName=n.fF.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.tu,{ref:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...r})}).displayName=n.tu.displayName;let u=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(n.Uv,{children:(0,a.jsx)(n.VY,{ref:t,sideOffset:r,className:(0,c.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...l})})});u.displayName=n.VY.displayName;let p=r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(n.ck,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",r&&"pl-8",s),...l})});p.displayName=n.ck.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:l,...i}=e;return(0,a.jsxs)(n.oC,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.wU,{children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})}),r]})}).displayName=n.oC.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(n.Rk,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.wU,{children:(0,a.jsx)(i.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=n.Rk.displayName;let h=r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(n.__,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...l})});h.displayName=n.__.displayName;let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...r})});f.displayName=n.Z0.displayName},95186:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var a=s(57437),r=s(2265),n=s(94508);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});l.displayName="Input"},19378:function(e,t,s){"use strict";s.d(t,{x:function(){return o}});var a=s(57437),r=s(2265),n=s(43643),l=s(94508);let o=r.forwardRef((e,t)=>{let{className:s,children:r,...o}=e;return(0,a.jsxs)(n.fC,{ref:t,className:(0,l.cn)("relative overflow-hidden",s),...o,children:[(0,a.jsx)(n.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(i,{}),(0,a.jsx)(n.Ns,{})]})});o.displayName=n.fC.displayName;let i=r.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...o}=e;return(0,a.jsx)(n.gb,{ref:t,orientation:r,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...o,children:(0,a.jsx)(n.q4,{className:"relative flex-1 rounded-full bg-border"})})});i.displayName=n.gb.displayName},53647:function(e,t,s){"use strict";s.d(t,{Bw:function(){return f},Ph:function(){return d},Ql:function(){return x},i4:function(){return u},ki:function(){return m}});var a=s(57437),r=s(2265),n=s(28951),l=s(40875),o=s(22135),i=s(30401),c=s(94508);let d=n.fC;n.ZA;let m=n.B4,u=r.forwardRef((e,t)=>{let{className:s,children:r,...o}=e;return(0,a.jsxs)(n.xz,{ref:t,className:(0,c.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...o,children:[r,(0,a.jsx)(n.JO,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=n.xz.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-2 sm:py-1 bg-popover/80 backdrop-blur-sm",s),...r,children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})});p.displayName=n.u_.displayName;let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-2 sm:py-1 bg-popover/80 backdrop-blur-sm",s),...r,children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})});h.displayName=n.$G.displayName;let f=r.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...o}=e;return(0,a.jsx)(n.h_,{children:(0,a.jsxs)(n.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-[50vh] sm:max-h-[--radix-select-content-available-height] w-[calc(100%-2rem)] max-w-[420px] sm:w-auto sm:min-w-[8rem] mx-auto overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...o,children:[(0,a.jsx)(p,{}),(0,a.jsx)(n.l_,{className:(0,c.cn)("p-2 sm:p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(h,{})]})})});f.displayName=n.VY.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.__,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",s),...r})}).displayName=n.__.displayName;let x=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(n.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-3 sm:py-1.5 pl-3 sm:pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.wU,{children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(n.eT,{children:r})]})});x.displayName=n.ck.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=n.Z0.displayName},93022:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});var a=s(57437),r=s(94508);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-primary/10",t),...s})}},12339:function(e,t,s){"use strict";s.d(t,{SP:function(){return c},dr:function(){return i},mQ:function(){return o},nU:function(){return d}});var a=s(57437),r=s(2265),n=s(20271),l=s(94508);let o=n.fC,i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.aV,{ref:t,className:(0,l.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...r})});i.displayName=n.aV.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...r})});c.displayName=n.xz.displayName;let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});d.displayName=n.VY.displayName},94508:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var a=s(61994),r=s(53335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}}},function(e){e.O(0,[310,523,290,273,509,971,117,744],function(){return e(e.s=18069)}),_N_E=e.O()}]);